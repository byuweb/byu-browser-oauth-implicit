{"version":3,"file":"implicit-grant.nomodule.js","sources":["../node_modules/@byuweb/browser-oauth/constants.js","../src/url.mjs","../node_modules/cookie/index.js","../node_modules/local-storage-fallback/lib/CookieStorage.js","../node_modules/local-storage-fallback/lib/isSupported.js","../node_modules/local-storage-fallback/lib/MemoryStorage.js","../node_modules/local-storage-fallback/lib/index.js","../src/local-storage.mjs","../src/provider.mjs","../src/implicit-grant.mjs"],"sourcesContent":["export const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const EVENT_STATE_CHANGE = `${EVENT_PREFIX}-state-changed`;\nexport const EVENT_LOGIN_REQUESTED = `${EVENT_PREFIX}-login-requested`;\nexport const EVENT_LOGOUT_REQUESTED = `${EVENT_PREFIX}-logout-requested`;\nexport const EVENT_REFRESH_REQUESTED = `${EVENT_PREFIX}-refresh-requested`;\nexport const EVENT_CURRENT_INFO_REQUESTED = `${EVENT_PREFIX}-current-info-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nexport function parseHash(hash) {\n  if (!hash) return new Map();\n  let subHash = hash;\n  if (hash.startsWith('#')) {\n    subHash = hash.substr(1);\n  }\n\n  const keyValues = subHash.split('&')\n    .map(it => it.split('=', 2));\n  return new Map(keyValues);\n}\n\n","/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(pairSplitRegExp);\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var eq_idx = pair.indexOf('=');\n\n    // skip things that don't look like key=value\n    if (eq_idx < 0) {\n      continue;\n    }\n\n    var key = pair.substr(0, eq_idx).trim()\n    var val = pair.substr(++eq_idx, pair.length).trim();\n\n    // quoted values\n    if ('\"' == val[0]) {\n      val = val.slice(1, -1);\n    }\n\n    // only assign once\n    if (undefined == obj[key]) {\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n    if (isNaN(maxAge)) throw new Error('maxAge should be a Number');\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.hasCookies = hasCookies;\n\nvar _cookie = require('cookie');\n\nvar _cookie2 = _interopRequireDefault(_cookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar prefix = 'lS_';\n\nvar CookieStorage = function () {\n  function CookieStorage() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CookieStorage);\n\n    this.cookieOptions = Object.assign({ path: '/' }, options);\n    prefix = options.prefix || prefix;\n  }\n\n  _createClass(CookieStorage, [{\n    key: 'getItem',\n    value: function getItem(key) {\n      var cookies = _cookie2.default.parse(document.cookie);\n      if (!cookies || !cookies.hasOwnProperty(prefix + key)) {\n        return null;\n      }\n      return cookies[prefix + key];\n    }\n  }, {\n    key: 'setItem',\n    value: function setItem(key, value) {\n      document.cookie = _cookie2.default.serialize(prefix + key, value, this.cookieOptions);\n      return value;\n    }\n  }, {\n    key: 'removeItem',\n    value: function removeItem(key) {\n      var options = Object.assign({}, this.cookieOptions, { maxAge: -1 });\n      document.cookie = _cookie2.default.serialize(prefix + key, '', options);\n      return null;\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      var cookies = _cookie2.default.parse(document.cookie);\n      for (var key in cookies) {\n        if (key.indexOf(prefix) === 0) {\n          this.removeItem(key.substr(prefix.length));\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return CookieStorage;\n}();\n\nexports.default = CookieStorage;\nfunction hasCookies() {\n  var storage = new CookieStorage();\n\n  try {\n    var TEST_KEY = '__test';\n    storage.setItem(TEST_KEY, '1');\n    var value = storage.getItem(TEST_KEY);\n    storage.removeItem(TEST_KEY);\n\n    return value === '1';\n  } catch (e) {\n    return false;\n  }\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = isSupported;\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar TEST_KEY = '__test';\n\nfunction hasStorage(name) {\n  try {\n    var storage = window[name];\n    storage.setItem(TEST_KEY, '1');\n    storage.removeItem(TEST_KEY);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction isSupported() {\n  var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'localStorage';\n\n  var storage = String(name).replace(/storage$/i, '').toLowerCase();\n\n  if (storage === 'local') {\n    return hasStorage('localStorage');\n  }\n\n  if (storage === 'session') {\n    return hasStorage('sessionStorage');\n  }\n\n  if (storage === 'cookie') {\n    return (0, _CookieStorage.hasCookies)();\n  }\n\n  if (storage === 'memory') {\n    return true;\n  }\n\n  throw new Error('Storage method `' + name + '` is not available.\\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.');\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MemoryStorage = function () {\n  function MemoryStorage() {\n    _classCallCheck(this, MemoryStorage);\n\n    this._data = {};\n  }\n\n  _createClass(MemoryStorage, [{\n    key: \"getItem\",\n    value: function getItem(key) {\n      return this._data.hasOwnProperty(key) ? this._data[key] : null;\n    }\n  }, {\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      return this._data[key] = String(value);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(key) {\n      return delete this._data[key];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      return this._data = {};\n    }\n  }]);\n\n  return MemoryStorage;\n}();\n\nexports.default = MemoryStorage;","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MemoryStorage = exports.CookieStorage = exports.isSupported = exports.storage = undefined;\n\nvar _isSupported = require('./isSupported');\n\nvar _isSupported2 = _interopRequireDefault(_isSupported);\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar _CookieStorage2 = _interopRequireDefault(_CookieStorage);\n\nvar _MemoryStorage = require('./MemoryStorage');\n\nvar _MemoryStorage2 = _interopRequireDefault(_MemoryStorage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar storage = null;\n\nif ((0, _isSupported2.default)('localStorage')) {\n  // use localStorage\n  exports.storage = storage = window.localStorage;\n} else if ((0, _isSupported2.default)('sessionStorage')) {\n  // use sessionStorage\n  exports.storage = storage = window.sessionStorage;\n} else if ((0, _isSupported2.default)('cookieStorage')) {\n  // use cookies\n  exports.storage = storage = new _CookieStorage2.default();\n} else {\n  // use memory\n  exports.storage = storage = new _MemoryStorage2.default();\n}\n\nexports.default = storage;\nexports.storage = storage;\nexports.isSupported = _isSupported2.default;\nexports.CookieStorage = _CookieStorage2.default;\nexports.MemoryStorage = _MemoryStorage2.default;","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport storage from 'local-storage-fallback';\n\nexport class StorageHandler {\n\n  saveOAuthState(clientId, state) {\n    storage.setItem(getKey(clientId), JSON.stringify(state));\n  }\n\n  getOAuthState(clientId) {\n    const result = storage.getItem(getKey(clientId));\n    if (!result) {\n      return null;\n    }\n    return JSON.parse(result);\n  }\n\n  clearOAuthState(clientId) {\n    storage.removeItem(getKey(clientId));\n  }\n}\n\nfunction getKey(clientId) {\n  return 'oauth-state-' + encodeURIComponent(clientId);\n}\n\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\"use strict\";\n\nimport * as authn from '../node_modules/@byuweb/browser-oauth/constants.js';\nimport {parseHash} from './url.mjs';\nimport {StorageHandler} from \"./local-storage\";\n\nconst STORED_STATE_LIFETIME = 5 * 60 * 1000; // 5 minutes\n\nexport class ImplicitGrantProvider {\n  constructor(config, window, document, storageHandler = new StorageHandler()) {\n    this.config = config;\n    this.window = window;\n    this.document = document;\n    this.storageHandler = storageHandler;\n    this._listeners = {};\n\n    this.store = Object.freeze({\n      state: authn.STATE_INDETERMINATE,\n      user: null,\n      token: null,\n      error: null\n    })\n  }\n\n  _changeState(state, user, token, error) {\n    this.store = Object.freeze({\n      state, user, token, error\n    });\n    _dispatchEvent(this, authn.EVENT_STATE_CHANGE, this.store)\n  }\n\n  async startup() {\n    this.listen();\n    this._changeState(authn.STATE_INDETERMINATE);\n\n    const location = this._location;\n    const hash = this._hashParams;\n\n    if (this.isAuthenticationCallback(location.href, hash)) {\n      this._changeState(authn.STATE_AUTHENTICATING);\n      try {\n        const {state, user, token, error} = await _handleAuthenticationCallback(\n          this.config,\n          location,\n          hash,\n          this.storageHandler\n        );\n        this._changeState(state, user, token, error);\n      } catch (err) {\n        console.error('OAuth Error', err);\n        this._changeState(authn.STATE_ERROR, undefined, undefined, err);\n      }\n    } else {\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n  }\n\n  get _location() {\n    return this.window.location;\n  }\n\n  get _hashParams() {\n    return parseHash(this._location.hash);\n  }\n\n  isAuthenticationCallback(href, hash) {\n    const isCallbackUrl = href.indexOf(this.config.callbackUrl) === 0;\n    const hasHash = hash.size !== 0;\n\n    if (!isCallbackUrl || !hasHash) {\n      return false;\n    }\n\n    return hash.has('access_token') || hash.has('error');\n  }\n\n  shutdown() {\n    this.unlisten();\n    this._changeState(authn.STATE_INDETERMINATE);\n  }\n\n  listen() {\n    _listenTo(this, authn.EVENT_LOGIN_REQUESTED, this.startLogin);\n    _listenTo(this, authn.EVENT_LOGOUT_REQUESTED, this.startLogout);\n    _listenTo(this, authn.EVENT_REFRESH_REQUESTED, this.startRefresh);\n    _listenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED, this.handleCurrentInfoRequest);\n  }\n\n  unlisten() {\n    _unlistenTo(this, authn.EVENT_LOGIN_REQUESTED);\n    _unlistenTo(this, authn.EVENT_LOGOUT_REQUESTED);\n    _unlistenTo(this, authn.EVENT_REFRESH_REQUESTED);\n    _unlistenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED);\n  }\n\n  startLogin() {\n    console.log('starting login', this);\n    const {clientId, callbackUrl} = this.config;\n    const csrf = randomString();\n\n    const storedState = _prepareStoredState(Date.now() + STORED_STATE_LIFETIME, csrf, {});\n    this.storageHandler.saveOAuthState(this.config.clientId, storedState);\n\n    const loginUrl = `https://api.byu.edu/authorize?response_type=token&client_id=${clientId}&redirect_uri=${encodeURIComponent(callbackUrl)}&scope=openid&state=${csrf}`;\n\n    console.warn(`[OAuth] - Redirecting user to '${loginUrl}'`);\n\n    this.window.location = loginUrl;\n  }\n\n  startLogout() {\n    const redirectUrl = this.config.callbackUrl;\n    this.window.location = 'http://api.byu.edu/logout?redirect_url=' + redirectUrl;\n    //https://api.byu.edu/revoke\n\n    //TODO: WSO2 Identity Server 5.1 allows us to revoke implicit tokens.  Once that's done, we'll need to do this.\n    // const url = `https://api.byu.edu/revoke`;\n\n    // const form = new URLSearchParams();\n    // form.set('token', store.token.bearer);\n    // form.set('client_id', config.clientId);\n    // form.set('token_type_hint', 'access_token');\n\n    // console.log('logout url', url);\n\n    // fetch(url, {\n    //     method: 'POST',\n    //     body: form,\n    //     // headers: {\n    //     //     'Content-Type': 'application/x-www-form-urlencoded'\n    //     // }\n    // }).then(result => {\n    //     console.log('done with logout', result);\n    // });\n  }\n\n  startRefresh() {\n    this.startLogin();\n  }\n\n  handleCurrentInfoRequest({callback}) {\n    if (callback) {\n      callback(this.store);\n    }\n  }\n}\n\nfunction _listenTo(provider, event, listener) {\n  if (provider._listeners.hasOwnProperty(event)) {\n    throw new Error('A listener is already registered for ' + event);\n  }\n  const obs = provider._listeners[event] = function (e) {\n    listener.call(provider, e.detail);\n  }.bind(provider);\n\n  provider.document.addEventListener(event, obs, false);\n}\n\nfunction _unlistenTo(provider, event) {\n  if (!provider._listeners.hasOwnProperty(event)) {\n    return;\n  }\n\n  provider.document.removeEventListener(event, provider._listeners[event], false);\n  delete provider._listeners[event];\n}\n\n\nfunction _dispatchEvent(provider, name, detail) {\n  let event;\n  if (typeof provider.window.CustomEvent === 'function') {\n    event = new CustomEvent(name, {detail});\n  } else {\n    event = provider.document.createEvent('CustomEvent');\n    event.initCustomEvent(name, true, false, detail);\n  }\n  provider.document.dispatchEvent(event);\n}\n\nasync function _handleAuthenticationCallback(config, location, hash, storage) {\n  if (hash.has('error')) {\n    throw new OAuthError(\n      hash.get('error'),\n      hash.get('error_description'),\n      hash.get('error_uri'),\n    );\n  }\n  const oauthCsrfToken = hash.get('state');\n  const storedState = storage.getOAuthState(config.clientId);\n\n  storage.clearOAuthState(config.clientId);\n\n  const pageState = _validateAndGetStoredState(storedState, oauthCsrfToken);\n\n  const accessToken = hash.get('access_token');\n  const expiresIn = Number(hash.get('expires_in'));\n  const expiresAt = new Date(Date.now() + (expiresIn * 1000));\n  const authHeader = `Bearer ${accessToken}`;\n\n  const userInfo = await _fetchUserInfo(authHeader);\n\n  const user = _processUserInfo(userInfo);\n  const token = _processTokenInfo(userInfo, accessToken, expiresAt, authHeader);\n\n  location.hash = '';\n\n  return {state: authn.STATE_AUTHENTICATED, user, token};\n}\n\nasync function _fetchUserInfo(authHeader) {\n  const resp = await fetch('https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid', {\n    method: 'GET',\n    headers: new Headers({'Accept': 'application/json', 'Authorization': authHeader}),\n    mode: 'cors',\n  });\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    if (resp.status === 403) {\n      if (body.includes('<ams:code>900908</ams:code>')) {\n        console.error(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`);\n        throw new OAuthError(\n          'not-subscribe-to-user-info',\n          'This page has an authentication configuration error. Developers, see the console for details.'\n        );\n      } else {\n        throw new OAuthError(\n          'invalid-oauth-token',\n          'The provided authentication token is invalid. Please try again.'\n        );\n      }\n    }\n    console.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-get-user-info',\n      'Unable to fetch user information. Please try again.'\n    );\n  }\n\n  return await resp.json();\n}\n\n\nconst CLAIMS_PREFIX_RESOURCE_OWNER = 'http://byu.edu/claims/resourceowner_';\nconst CLAIMS_PREFIX_CLIENT = 'http://byu.edu/claims/client_';\nconst CLAIMS_PREFIX_WSO2 = 'http://wso2.org/claims/';\n\nfunction getClaims(userInfo, prefix) {\n  return Object.keys(userInfo).filter(k => k.startsWith(prefix))\n    .reduce((agg, key) => {\n      agg[key.substr(prefix.length)] = userInfo[key];\n      return agg;\n    }, {});\n}\n\nfunction _processUserInfo(userInfo) {\n  const roClaims = getClaims(userInfo, CLAIMS_PREFIX_RESOURCE_OWNER);\n\n  const familyNamePosition = roClaims.surname_position;\n  const givenName = userInfo.given_name;\n  const familyName = userInfo.family_name;\n\n  const displayName = familyNamePosition === 'F' ? `${familyName} ${givenName}` : `${givenName} ${familyName}`;\n\n  return {\n    personId: roClaims.person_id,\n    byuId: roClaims.byu_id,\n    netId: roClaims.net_id,\n    name: {\n      sortName: roClaims.sort_name,\n      displayName,\n      givenName,\n      familyName,\n      familyNamePosition,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _processTokenInfo(userInfo, accessToken, expiresAt, authHeader) {\n  const clientClaims = getClaims(userInfo, CLAIMS_PREFIX_CLIENT);\n  const wso2Claims = getClaims(userInfo, CLAIMS_PREFIX_WSO2);\n\n  return {\n    bearer: accessToken,\n    authorizationHeader: authHeader,\n    expiresAt,\n    client: {\n      id: wso2Claims.client_id,\n      byuId: clientClaims.byu_id,\n      appName: wso2Claims.applicationname,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _validateAndGetStoredState(storedState, expectedCsrfToken) {\n  const {e: stateExpiresString, c: storedCsrfToken, s: pageState} = storedState;\n\n  if (expectedCsrfToken !== storedCsrfToken) {\n    throw new OAuthError(\n      'oauth-state-mismatch',\n      'Your saved authentication information does not match. Please try again.'\n    );\n  }\n\n  if (Number(stateExpiresString) < Date.now()) {\n    throw new OAuthError(\n      'oauth-state-expired',\n      'Your login attempt has timed out. Please try again.'\n    );\n  }\n\n  return pageState;\n}\n\nfunction _prepareStoredState(expires, csrfToken, pageState) {\n  return {\n    e: expires,\n    c: csrfToken,\n    s: pageState,\n  }\n}\n\nclass OAuthError extends Error {\n  constructor(type, description, uri) {\n    super('OAuth Error: ' + description);\n    this.type = type;\n    this.description = description;\n    this.uri = uri;\n  }\n}\n\nfunction randomString() {\n  let idArray = new Uint32Array(3);\n  const crypto = window.crypto || window.msCrypto;\n  crypto.getRandomValues(idArray);\n\n  return idArray.reduce((str, cur) => str + cur.toString(16), '');\n}\n\n\n","/*\n * Copyright 2018 Brigham Young University\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ImplicitGrantProvider } from \"./provider.mjs\";\n\nexport const DEFAULT_ISSUER = 'https://api.byu.edu';\n\nexport const GLOBAL_CONFIG_KEY = 'byu-oauth-implicit-config';\n\n/**\n * @typedef {} ImplicitConfig\n * @prop {string} clientId\n * @prop {?string} issuer\n * @prop {?string} callbackUrl\n * @prop {?boolean} requireAuthentication\n */\n\n/**\n *\n * @param {ImplicitConfig} cfg\n */\nexport async function configure(cfg) {\n  const globalConfig = window[GLOBAL_CONFIG_KEY];\n\n  const config = Object.assign({\n    issuer: DEFAULT_ISSUER,\n    callbackUrl: `${location.origin}${location.pathname}`,\n    requireAuthentication: false,\n  }, globalConfig, cfg);\n\n  if (!config.clientId) {\n    throw new Error('clientId must be specified in config');\n  }\n\n  const provider = new ImplicitGrantProvider(config, window, document);\n\n  return provider.startup();\n}\n"],"names":["EVENT_PREFIX","EVENT_STATE_CHANGE","EVENT_LOGIN_REQUESTED","EVENT_LOGOUT_REQUESTED","EVENT_REFRESH_REQUESTED","EVENT_CURRENT_INFO_REQUESTED","STATE_INDETERMINATE","STATE_UNAUTHENTICATED","STATE_AUTHENTICATED","STATE_AUTHENTICATING","STATE_ERROR","parseHash","hash","Map","subHash","startsWith","substr","keyValues","split","map","it","exports","parse","serialize","decode","decodeURIComponent","encode","encodeURIComponent","pairSplitRegExp","fieldContentRegExp","str","options","TypeError","obj","opt","pairs","dec","i","length","pair","eq_idx","indexOf","key","trim","val","slice","undefined","tryDecode","name","enc","test","value","maxAge","isNaN","Error","Math","floor","domain","path","expires","toUTCString","httpOnly","secure","sameSite","toLowerCase","e","Object","defineProperty","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Constructor","protoProps","staticProps","prototype","hasCookies","_cookie2","_interopRequireDefault","_cookie","__esModule","default","_classCallCheck","instance","prefix","CookieStorage","arguments","cookieOptions","assign","getItem","cookies","document","cookie","hasOwnProperty","setItem","removeItem","clear","storage","TEST_KEY","isSupported","hasStorage","window","String","replace","_CookieStorage","MemoryStorage","_data","_isSupported2","_isSupported","_CookieStorage2","_MemoryStorage2","_MemoryStorage","localStorage","sessionStorage","StorageHandler","saveOAuthState","clientId","state","getKey","JSON","stringify","getOAuthState","result","clearOAuthState","STORED_STATE_LIFETIME","ImplicitGrantProvider","constructor","config","storageHandler","_listeners","store","freeze","authn","user","token","error","_changeState","_dispatchEvent","startup","listen","location","_location","_hashParams","isAuthenticationCallback","href","_handleAuthenticationCallback","err","console","isCallbackUrl","callbackUrl","hasHash","size","has","shutdown","unlisten","_listenTo","startLogin","startLogout","startRefresh","handleCurrentInfoRequest","_unlistenTo","log","csrf","randomString","storedState","_prepareStoredState","Date","now","loginUrl","warn","redirectUrl","callback","provider","event","listener","obs","call","detail","bind","addEventListener","removeEventListener","CustomEvent","createEvent","initCustomEvent","dispatchEvent","OAuthError","get","oauthCsrfToken","pageState","_validateAndGetStoredState","accessToken","expiresIn","Number","expiresAt","authHeader","userInfo","_fetchUserInfo","_processUserInfo","_processTokenInfo","resp","fetch","method","headers","Headers","mode","status","body","text","includes","json","CLAIMS_PREFIX_RESOURCE_OWNER","CLAIMS_PREFIX_CLIENT","CLAIMS_PREFIX_WSO2","getClaims","keys","filter","k","reduce","agg","roClaims","familyNamePosition","surname_position","givenName","given_name","familyName","family_name","displayName","personId","person_id","byuId","byu_id","netId","net_id","sortName","sort_name","rawUserInfo","clientClaims","wso2Claims","bearer","authorizationHeader","client","id","client_id","appName","applicationname","expectedCsrfToken","stateExpiresString","c","storedCsrfToken","s","csrfToken","type","description","uri","idArray","Uint32Array","crypto","msCrypto","getRandomValues","cur","toString","DEFAULT_ISSUER","GLOBAL_CONFIG_KEY","configure","cfg","globalConfig","issuer","origin","pathname","requireAuthentication"],"mappings":"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"}