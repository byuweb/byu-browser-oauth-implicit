{"version":3,"file":"implicit-grant.nomodule.js","sources":["../node_modules/@byuweb/browser-oauth/byu-browser-oauth.js","../src/implicit-grant.js"],"sourcesContent":["/*\n * Copyright 2018 Brigham Young University\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const STATE_CHANGE_EVENT = `${EVENT_PREFIX}-state-changed`;\nexport const LOGIN_REQUESTED_EVENT = `${EVENT_PREFIX}-login-requested`;\nexport const LOGOUT_REQUESTED_EVENT = `${EVENT_PREFIX}-logout-requested`;\nexport const REFRESH_REQUESTED_EVENT = `${EVENT_PREFIX}-refresh-requested`;\nexport const STATE_REQUESTED_EVENT = `${EVENT_PREFIX}-state-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n\nlet store = {state: STATE_INDETERMINATE};\n\nlet observer = onStateChange(detail => {\n    store = detail;\n});\n\nexport function onStateChange(callback) {\n    const func = function(e) {\n        callback(e.detail);\n    };\n    document.addEventListener(STATE_CHANGE_EVENT, func, false);\n    if (store.state === STATE_INDETERMINATE) {\n        dispatch(STATE_REQUESTED_EVENT, {callback});\n    } else {\n        callback(store);\n    }\n    return {\n        offStateChange: function() {\n            document.removeEventListener(STATE_CHANGE_EVENT, func, false);\n        }\n    }\n}\n\nexport function state() {\n    return store.state;\n}\n\nexport function hasToken() {\n    return !!store.token;\n}\n\nexport function token() {\n    return store.token;\n}\n\nexport function authorizationHeader() {\n    return store.token && store.token.authorizationHeader;\n}\n\nexport function user() {\n    return store.user;\n}\n\nexport function login() {\n    const promise = promiseState([STATE_AUTHENTICATED])\n    dispatch(LOGIN_REQUESTED_EVENT);\n    return promise;\n}\n\nexport function logout() {\n    const promise = promiseState([STATE_UNAUTHENTICATED]);\n    dispatch(LOGOUT_REQUESTED_EVENT);\n    return promise;\n}\n\nexport function refresh() {\n    const promise = promiseState([STATE_AUTHENTICATED, STATE_UNAUTHENTICATED]);\n    dispatch(REFRESH_REQUESTED_EVENT);\n    return promise;\n}\n\nexport function teardown() {\n    observer.offStateChange();\n    store = {state: STATE_INDETERMINATE};\n}\n\nfunction promiseState(desiredStates) {\n    if (!window.Promise) {\n        return null;\n    }\n    return new Promise((resolve, reject) => {\n        const observer = onStateChange(({state, token, user, error}) => {\n            if (error) {\n                reject(error);\n                observer.offStateChange();\n            } else if (desiredStates.indexOf(state) >= 0) {\n                resolve({state, token, user});\n                observer.offStateChange();\n            }\n        });\n    });\n}\n\nfunction dispatch(name, detail) {\n    let event;\n    if (typeof window.CustomEvent === 'function') {\n        event = new CustomEvent(name, {detail});\n    } else {\n        event = document.createEvent('CustomEvent');\n        event.initCustomEvent(name, true, false, detail);\n    }\n    document.dispatchEvent(event);\n}\n\n","/*\n * Copyright 2018 Brigham Young University\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as authn from '../node_modules/@byuweb/browser-oauth/byu-browser-oauth.js';\n\nexport const DEFAULT_ISSUER = 'https://api.byu.edu';\n\nlet config;\nconst observers = {};\nlet store = Object.freeze({ state: authn.STATE_INDETERMINATE });\n\n/**\n * @typedef {} ImplicitConfig\n * @prop {string} clientId\n * @prop {?string} issuer\n * @prop {?string} callbackUrl\n * @prop {?boolean} requireAuthentication\n */\n\n/**\n * \n * @param {ImplicitConfig} cfg \n */\nexport function configure(cfg) {\n    console.log('config', cfg);\n    if (!cfg) {\n        throw new Error('cfg must be defined');\n    }\n    if (!cfg.clientId) {\n        throw new Error('clientId must be specified');\n    }\n    config = Object.assign({\n        issuer: DEFAULT_ISSUER,\n        callbackUrl: `${location.origin}${location.pathname}`,\n        requireAuthentication: false,\n    }, cfg);\n\n    listen(authn.LOGIN_REQUESTED_EVENT, startLogin);\n    listen(authn.LOGOUT_REQUESTED_EVENT, startLogout);\n    listen(authn.REFRESH_REQUESTED_EVENT, startRefresh);\n    listen(authn.STATE_REQUESTED_EVENT, handleStateRequested);\n\n    maybeHandleAuthenticationCallback();\n}\n\nfunction maybeHandleAuthenticationCallback() {\n    if (!isAuthenticationCallback()) {\n        console.log('Not an auth callback');\n        state(authn.STATE_UNAUTHENTICATED);\n        return;\n    }\n    state(authn.STATE_AUTHENTICATING);\n    const params = new URLSearchParams(window.location.hash.substring(1));\n    if (params.has('error')) {\n        const error = {\n            type: params.get('error'),\n            description: params.get('error_description'),\n            uri: params.get('error_uri')\n        };\n        state(\n            authn.STATE_ERROR,\n            null,\n            null,\n            error\n        );\n        return;\n    }\n\n    const csrf = params.get('state');\n\n    window.location.hash = '';\n\n    const accessToken = params.get('access_token');\n    const expiresIn = Number(params.get('expires_in'));\n    const authHeader = `Bearer ${accessToken}`;\n    const expiresAt = new Date(Date.now() + (expiresIn * 1000));\n\n    fetch('https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid', {\n        method: 'GET',\n        headers: new Headers({ 'Accept': 'application/json', 'authorization': authHeader }),\n        mode: 'cors',\n    }).then(function (resp) {\n        return resp.json();\n    }).then(function (json) {\n        console.log('got user info', json);\n\n        const roClaims = getClaims(json, CLAIMS_PREFIX_RESOURCE_OWNER);\n        const clientClaims = getClaims(json, CLAIMS_PREFIX_CLIENT);\n        const wso2Claims = getClaims(json, CLAIMS_PREFIX_WSO2);\n\n        console.log('claims', roClaims, clientClaims, wso2Claims);\n        \n        const familyNamePosition = roClaims.surname_position;\n        const givenName = json.given_name;\n        const familyName = json.family_name;\n\n        const displayName = familyNamePosition === 'F' ? `${familyName} ${givenName}` : `${givenName} ${familyName}`;\n\n        const user = {\n            personId: roClaims.person_id,\n            byuId: roClaims.byu_id,\n            netId: roClaims.net_id,\n            name: {\n                sortName: roClaims.sort_name,\n                displayName,\n                givenName,\n                familyName,\n                familyNamePosition,\n            },\n            rawUserInfo: json\n        };\n\n        const token = {\n            bearer: accessToken,\n            authorizationHeader: authHeader,\n            expiresAt,\n            client: {\n                id: wso2Claims.client_id,\n                byuId: clientClaims.byu_id,\n                appName: wso2Claims.applicationname,\n            },\n            rawUserInfo: json\n        };\n\n        state(authn.STATE_AUTHENTICATED, token, user);\n    });\n}\n\nconst CLAIMS_PREFIX_RESOURCE_OWNER = 'http://byu.edu/claims/resourceowner_';\nconst CLAIMS_PREFIX_CLIENT = 'http://byu.edu/claims/client_';\nconst CLAIMS_PREFIX_WSO2 = 'http://wso2.org/claims/';\n\nfunction getClaims(userInfo, prefix) {\n    return Object.keys(userInfo).filter(k => k.startsWith(prefix))\n        .reduce((agg, key) => {\n            agg[key.substr(prefix.length)] = userInfo[key];\n            return agg;\n        }, {});\n}\n\nfunction isAuthenticationCallback() {\n    const isCallbackUrl = window.location.href.indexOf(config.callbackUrl) === 0;\n    console.log(window.location.href, config.callbackUrl, window.location.href.indexOf(config.callbackUrl));\n    const hasHash = !!window.location.hash;\n\n    console.log('hasHash', hasHash);\n    if (!isCallbackUrl) {\n        return false;\n    } else if (!hasHash) {\n        return false;\n    }\n    const params = new URLSearchParams(window.location.hash.substring(1));\n    console.log('params', params);\n    if (params.has('access_token') || params.has('error')) {\n        console.log('has params');\n        return true;\n    }\n    return false;\n}\n\nfunction state(state, token, user, error) {\n    store = Object.freeze({ state, token, user, error });\n    dispatch(authn.STATE_CHANGE_EVENT, store);\n}\n\nexport function startLogin() {\n    console.log('startLogin', config);\n\n    const csrf = saveLoginToken(randomString(), {});\n\n    const loginUrl = `https://api.byu.edu/authorize?response_type=token&client_id=${config.clientId}&redirect_uri=${encodeURIComponent(config.callbackUrl)}&scope=openid&state=${csrf}`;\n\n    console.log('loginUrl', loginUrl);\n    window.location = loginUrl;\n}\n\nexport function startLogout() {\n    console.log('startLogout');\n}\n\nfunction saveLoginToken(token, pageState) {\n    const value = `${token}.${btoa(JSON.stringify(pageState))}`;\n\n    if (storageAvailable('session')) {\n        window.sessionStorage.setItem('oauth-state', value);\n        return 's.' + token;\n    } else {\n        document.cookie = `oauth-state=${value};max-age=300`;\n        return 'c.' + token;\n    }\n}\n\nexport function startRefresh() {\n    startLogin();\n}\n\nexport function handleStateRequested({ callback }) {\n    callback(store);\n}\n\nfunction storageAvailable(type) {\n    try {\n        var storage = window[type],\n            x = '__storage_test__';\n        storage.setItem(x, x);\n        storage.removeItem(x);\n        return true;\n    }\n    catch (e) {\n        return e instanceof DOMException && (\n            // everything except Firefox\n            e.code === 22 ||\n            // Firefox\n            e.code === 1014 ||\n            // test name field too, because code might not be present\n            // everything except Firefox\n            e.name === 'QuotaExceededError' ||\n            // Firefox\n            e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&\n            // acknowledge QuotaExceededError only if there's something already stored\n            storage.length !== 0;\n    }\n}\n\nfunction randomString() {\n    let idArray = Uint32Array.of(1);\n    const crypto = window.crypto || window.msCrypto;\n    crypto.getRandomValues(idArray);\n\n    return new String(idArray[0]);\n}\n\nfunction listen(event, listener) {\n    if (observers.hasOwnProperty(event)) {\n        throw new Error('A listener is already registered for ' + event);\n    }\n    const obs = observers[event] = function (e) { listener(e.detail) };\n    document.addEventListener(event, obs, false);\n}\n\nfunction dispatch(name, detail) {\n    let event;\n    if (typeof window.CustomEvent === 'function') {\n        event = new CustomEvent(name, { detail });\n    } else {\n        event = document.createEvent('CustomEvent');\n        event.initCustomEvent(name, true, false, detail);\n    }\n    document.dispatchEvent(event);\n}\n"],"names":["const","let","store","authn.STATE_INDETERMINATE","authn.LOGIN_REQUESTED_EVENT","authn.LOGOUT_REQUESTED_EVENT","authn.REFRESH_REQUESTED_EVENT","authn.STATE_REQUESTED_EVENT","state","authn.STATE_UNAUTHENTICATED","authn.STATE_AUTHENTICATING","authn.STATE_ERROR","user","token","authn.STATE_AUTHENTICATED","dispatch","authn.STATE_CHANGE_EVENT"],"mappings":"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"}