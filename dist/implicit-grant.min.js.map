{"version":3,"file":"implicit-grant.min.js","sources":["../src/log.js","../node_modules/@byuweb/browser-oauth/constants.js","../node_modules/cookie/index.js","../node_modules/local-storage-fallback/lib/CookieStorage.js","../node_modules/local-storage-fallback/lib/isSupported.js","../node_modules/local-storage-fallback/lib/MemoryStorage.js","../node_modules/local-storage-fallback/lib/index.js","../src/local-storage.js","../src/provider.js","../src/implicit-grant.js"],"sourcesContent":["const LEVEL_TRACE = { priority: 0, name: \"trace\", run: handleTrace };\nconst LEVEL_DEBUG = { priority: 1, name: \"debug\", run: handleDebug };\nconst LEVEL_INFO = { priority: 10, name: \"info\", run: handleInfo };\nconst LEVEL_ERROR = { priority: 100, name: \"error\", run: handleError };\n\nconst ALL_LEVELS = [LEVEL_TRACE, LEVEL_DEBUG, LEVEL_INFO, LEVEL_ERROR];\nconst DEFAULT_LEVEL = LEVEL_ERROR;\n\nexport function debug(...args) {\n  log(LEVEL_DEBUG, ...args);\n}\n\nexport function info(...args) {\n  log(LEVEL_INFO, ...args);\n}\n\nexport function error(...args) {\n  log(LEVEL_ERROR, ...args);\n}\n\nexport function debugf(format, ...args) {\n  logf(LEVEL_DEBUG, format, ...args);\n}\n\nexport function infof(format, ...args) {\n  logf(LEVEL_INFO, format, ...args);\n}\n\nexport function errorf(format, ...args) {\n  logf(LEVEL_ERROR, format, ...args);\n}\n\nfunction logf(level, format, ...args) {\n  if (!shouldLog(level)) {\n    return;\n  }\n  level.run(\n    `[byu-browser-oauth-implicit] [${level.name}] (${getFormattedTime()}) ${format}`,\n    ...args\n  );\n}\n\nfunction log(level, ...args) {\n  if (!shouldLog(level)) {\n    return;\n  }\n  level.run(\n    \"[byu-browser-oauth-implicit]\",\n    `[${level.name}]`,\n    `(${getFormattedTime()})`,\n    ...args\n  );\n}\n\nfunction getFormattedTime() {\n  const now = new Date();\n  const h24 = String(now.getHours()).padStart(2, '0');\n  const min = String(now.getMinutes()).padStart(2, '0');\n  const sec = String(now.getSeconds()).padStart(2, '0');\n  const millis = String(now.getMilliseconds()).padStart(3, '0');\n\n  return `${h24}:${min}:${sec},${millis}${formatTimezone(now)}`;\n}\n\nfunction formatTimezone(date) {\n  const offset = date.getTimezoneOffset();\n  if (offset === 0) {\n    return 'Z';\n  }\n  const nonNegative = offset >= 0;\n  const absOffset = Math.abs(offset);\n\n  // Positive whole offset hours\n  const hourInt = Math.floor(absOffset / 60);\n  const hourDone = String(hourInt).padStart(2, '0')\n  const sign = (nonNegative ? '+' : '-');\n  const minDone = String(absOffset % 60).padStart(2, '0');\n\n  return `${sign}${hourDone}${minDone}`;\n}\n\nfunction shouldLog(level) {\n  return level.priority >= currentLevel().priority;\n}\n\nfunction currentLevel() {\n  const name = levelAttr() || levelGlobalVar();\n  if (!name) {\n    return DEFAULT_LEVEL;\n  }\n  const lower = name.toLowerCase();\n  return (\n    ALL_LEVELS.find(function(l) {\n      return l.name === lower;\n    }) || DEFAULT_LEVEL\n  );\n}\n\nfunction levelAttr() {\n  return document.documentElement.getAttribute(\"byu-oauth-logging\");\n}\n\nfunction levelGlobalVar() {\n  const o = window.byuOAuth || {};\n  return o.logging;\n}\n\nfunction handleTrace(...args) {\n  if (console.trace) {\n    console.trace(...args);\n  } else {\n    console.log(...args);\n  }\n}\n\nfunction handleDebug(...args) {\n  console.log(...args);\n}\n\nfunction handleInfo(...args) {\n  if (console.info) {\n    console.info(...args);\n  } else {\n    console.log(...args);\n  }\n}\n\nfunction handleError(...args) {\n  if (console.error) {\n    console.error(...args);\n  } else {\n    console.log(...args);\n  }\n}\n","export const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const EVENT_STATE_CHANGE = `${EVENT_PREFIX}-state-changed`;\nexport const EVENT_LOGIN_REQUESTED = `${EVENT_PREFIX}-login-requested`;\nexport const EVENT_LOGOUT_REQUESTED = `${EVENT_PREFIX}-logout-requested`;\nexport const EVENT_REFRESH_REQUESTED = `${EVENT_PREFIX}-refresh-requested`;\nexport const EVENT_CURRENT_INFO_REQUESTED = `${EVENT_PREFIX}-current-info-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n\n","/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(pairSplitRegExp);\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var eq_idx = pair.indexOf('=');\n\n    // skip things that don't look like key=value\n    if (eq_idx < 0) {\n      continue;\n    }\n\n    var key = pair.substr(0, eq_idx).trim()\n    var val = pair.substr(++eq_idx, pair.length).trim();\n\n    // quoted values\n    if ('\"' == val[0]) {\n      val = val.slice(1, -1);\n    }\n\n    // only assign once\n    if (undefined == obj[key]) {\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n    if (isNaN(maxAge)) throw new Error('maxAge should be a Number');\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.hasCookies = hasCookies;\n\nvar _cookie = require('cookie');\n\nvar _cookie2 = _interopRequireDefault(_cookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar prefix = 'lS_';\n\nvar CookieStorage = function () {\n  function CookieStorage() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CookieStorage);\n\n    this.cookieOptions = Object.assign({ path: '/' }, options);\n    prefix = options.prefix === undefined ? prefix : options.prefix;\n  }\n\n  _createClass(CookieStorage, [{\n    key: 'getItem',\n    value: function getItem(key) {\n      var cookies = _cookie2.default.parse(document.cookie);\n      if (!cookies || !cookies.hasOwnProperty(prefix + key)) {\n        return null;\n      }\n      return cookies[prefix + key];\n    }\n  }, {\n    key: 'setItem',\n    value: function setItem(key, value) {\n      document.cookie = _cookie2.default.serialize(prefix + key, value, this.cookieOptions);\n      return value;\n    }\n  }, {\n    key: 'removeItem',\n    value: function removeItem(key) {\n      var options = Object.assign({}, this.cookieOptions, { maxAge: -1 });\n      document.cookie = _cookie2.default.serialize(prefix + key, '', options);\n      return null;\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      var cookies = _cookie2.default.parse(document.cookie);\n      for (var key in cookies) {\n        if (key.indexOf(prefix) === 0) {\n          this.removeItem(key.substr(prefix.length));\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return CookieStorage;\n}();\n\nexports.default = CookieStorage;\nfunction hasCookies() {\n  var storage = new CookieStorage();\n\n  try {\n    var TEST_KEY = '__test';\n    storage.setItem(TEST_KEY, '1');\n    var value = storage.getItem(TEST_KEY);\n    storage.removeItem(TEST_KEY);\n\n    return value === '1';\n  } catch (e) {\n    return false;\n  }\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = isSupported;\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar TEST_KEY = '__test';\n\nfunction hasStorage(name) {\n  try {\n    var storage = window[name];\n    storage.setItem(TEST_KEY, '1');\n    storage.removeItem(TEST_KEY);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction isSupported() {\n  var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'localStorage';\n\n  var storage = String(name).replace(/storage$/i, '').toLowerCase();\n\n  if (storage === 'local') {\n    return hasStorage('localStorage');\n  }\n\n  if (storage === 'session') {\n    return hasStorage('sessionStorage');\n  }\n\n  if (storage === 'cookie') {\n    return (0, _CookieStorage.hasCookies)();\n  }\n\n  if (storage === 'memory') {\n    return true;\n  }\n\n  throw new Error('Storage method `' + name + '` is not available.\\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.');\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MemoryStorage = function () {\n  function MemoryStorage() {\n    _classCallCheck(this, MemoryStorage);\n\n    this._data = {};\n  }\n\n  _createClass(MemoryStorage, [{\n    key: \"getItem\",\n    value: function getItem(key) {\n      return this._data.hasOwnProperty(key) ? this._data[key] : null;\n    }\n  }, {\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      return this._data[key] = String(value);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(key) {\n      return delete this._data[key];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      return this._data = {};\n    }\n  }]);\n\n  return MemoryStorage;\n}();\n\nexports.default = MemoryStorage;","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MemoryStorage = exports.CookieStorage = exports.isSupported = exports.storage = undefined;\n\nvar _isSupported = require('./isSupported');\n\nvar _isSupported2 = _interopRequireDefault(_isSupported);\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar _CookieStorage2 = _interopRequireDefault(_CookieStorage);\n\nvar _MemoryStorage = require('./MemoryStorage');\n\nvar _MemoryStorage2 = _interopRequireDefault(_MemoryStorage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar storage = null;\n\nif ((0, _isSupported2.default)('localStorage')) {\n  // use localStorage\n  exports.storage = storage = window.localStorage;\n} else if ((0, _isSupported2.default)('sessionStorage')) {\n  // use sessionStorage\n  exports.storage = storage = window.sessionStorage;\n} else if ((0, _isSupported2.default)('cookieStorage')) {\n  // use cookies\n  exports.storage = storage = new _CookieStorage2.default();\n} else {\n  // use memory\n  exports.storage = storage = new _MemoryStorage2.default();\n}\n\nexports.default = storage;\nexports.storage = storage;\nexports.isSupported = _isSupported2.default;\nexports.CookieStorage = _CookieStorage2.default;\nexports.MemoryStorage = _MemoryStorage2.default;","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport storage from 'local-storage-fallback';\n// During initial page load, Firefox \"LocalStorage\" is wonky if in Private Browsing.\n// Fortunately, the \"OAuth State\" data is tiny (one date and one 16-character string),\n// so it won't hit any Cookie size limitations.\n// With those factors in mind, we intentionally downgrade to Cookie storage for initial OAuth data storage\nimport { CookieStorage } from 'local-storage-fallback';\n\nconst cookie = new CookieStorage();\n\nexport class StorageHandler {\n\n  saveOAuthState(clientId, state) {\n    cookie.setItem(getKey(clientId), JSON.stringify(state));\n  }\n\n  getOAuthState(clientId) {\n    const result = cookie.getItem(getKey(clientId));\n    if (!result) {\n      return null;\n    }\n    return JSON.parse(result);\n  }\n\n  clearOAuthState(clientId) {\n    cookie.removeItem(getKey(clientId));\n  }\n\n  saveSessionState(clientId, state) {\n    storage.setItem(getSessionKey(clientId), JSON.stringify(state));\n  }\n\n  getSessionState(clientId) {\n    const key = getSessionKey(clientId);\n    const stored = storage.getItem(key);\n    if (!stored) {\n      return null;\n    }\n    return JSON.parse(stored);\n  }\n\n  clearSessionState(clientId) {\n    storage.removeItem(getSessionKey(clientId));\n  }\n}\n\nfunction getKey(clientId) {\n  return 'oauth-state-' + encodeURIComponent(clientId);\n}\n\nfunction getSessionKey(clientId) {\n  return getKey(clientId) + '-active-session';\n}\n\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\"use strict\";\n\nimport * as log from './log.js';\nimport * as authn from '@byuweb/browser-oauth/constants.js';\nimport {StorageHandler} from \"./local-storage.js\";\n// NOTE: not using browser `crypto` module, because `crypto.subtle` isn't available when the browser isn't in HTTPS,\n// and our development environments usually use plain HTTP. We're only doing a single one-way hash, so performance\n// isn't a big deal\nimport sha256Lib from 'js-sha256'\nconst sha256 = sha256Lib.sha256\n\nlet SINGLETON_INSTANCE;\nlet BASE_URL;\n\nconst CHILD_IFRAME_ID = 'byu-oauth-implicit-grant-refresh-iframe'\nconst STORED_STATE_LIFETIME = 5 * 60 * 1000; // 5 minutes (in milliseconds)\nconst EXPIRATION_BUFFER = (5 * 60) + 5; // 5 minutes + 5 seconds (in seconds)\nexport const IG_STATE_AUTO_REFRESH_FAILED = 'implicit-grant-auto-refresh-failed'\n\nexport class ImplicitGrantProvider {\n  constructor(config, window, document, storageHandler = new StorageHandler()) {\n    log.debug('initializing provider with config', config);\n    this.config = config;\n    this.window = window;\n    this.document = document;\n    this.storageHandler = storageHandler;\n    this._listeners = {};\n\n    BASE_URL = this.config.baseUrl.replace(/\\/+$/, '') // strip trailing slash(es)\n\n    this.store = Object.freeze({\n      state: authn.STATE_INDETERMINATE,\n      user: null,\n      token: null,\n      error: null\n    });\n    log.debug('initialized provider');\n  }\n\n  _changeState(state, user, token, error) {\n    logStateChange(state, user, token, error);\n    this.store = Object.freeze({\n      state, user, token, error\n    });\n    _dispatchEvent(this, authn.EVENT_STATE_CHANGE, this.store);\n  }\n\n  _checkPopupOpener() {\n    try {\n      const origin = this.window.opener.location.origin\n      if (origin === (new URL(this.config.callbackUrl)).origin) { // Origins match\n        return this.window.opener\n      }\n    } catch (e) {\n      // Failed to get window.opener.location.origin, so we must have been opened\n      // from a different origin.\n      // Fall through to the \"return false\" outside this try/catch block\n    }\n    return false\n  }\n\n  _checkIframeOpener() {\n    try {\n      const iframe = this.window.parent.document.getElementById(CHILD_IFRAME_ID)\n      if (iframe && iframe.contentWindow === this.window) {\n        return iframe\n      }\n    } catch (e) {\n      // Failed to access window.parent info, so we must be in an iframe from a different\n      // origin.\n      // Fall through to the \"return false\" outside this try/catch block\n    }\n    return false\n  }\n\n  // Separate state change listener, because state change events\n  // might come from child iframe/popup window\n  handleStateChange({ state, user, token, source }) {\n    log.debug('in handleStateChange', state);\n\n    const opener = this._checkPopupOpener()\n    // If this is a popup\n    if (opener) {\n      // We're inside a child re-authentication popup\n\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(opener, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'popup' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('closing self');\n        this.window.close()\n      }\n\n      return\n    }\n\n    const iframe = this._checkIframeOpener()\n    // If we're inside a \"refresh\" iframe\n    if (iframe) {\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(this.window.parent, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'iframe' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('removing child iframe');\n        iframe.parentNode.removeChild(iframe)\n      }\n\n      return\n    }\n\n    this._maybeUpdateStoredSession(state, user, token);\n\n    if (state === authn.STATE_AUTHENTICATED) {\n      this._checkExpired(token.expiresAt.getTime())\n    }\n  }\n\n  async startup() {\n    ensureOnlyInstance(this);\n    log.info('starting up');\n    this.listen();\n    this._changeState(authn.STATE_INDETERMINATE);\n\n    const location = this._location;\n\n    if (this.isAuthenticationCallback(location)) {\n      log.debug('handling authentication callback');\n      this._changeState(authn.STATE_AUTHENTICATING);\n      try {\n        const {state, user, token, error} = await _handleAuthenticationCallback(\n          this.config,\n          location,\n          this.storageHandler\n        );\n        this._changeState(state, user, token, error);\n      } catch (err) {\n        log.error('OAuth Error', err);\n        this._changeState(authn.STATE_ERROR, undefined, undefined, err);\n      }\n    } else if (this.hasStoredSession()) {\n      log.debug('Has stored session');\n      this._updateStateFromStorage();\n    } else {\n      log.debug('no authentication present');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n    return this;\n  }\n\n  _checkExpired(expirationTimeInMs) {\n    const expiresInMs = expirationTimeInMs - Date.now()\n\n    log.debug(`checking expiration time; expires in ${expiresInMs} ms, ${new Date(expirationTimeInMs)}`);\n\n    if (expiresInMs > (30 * 1000)) { // 30 second buffer before token actually expires\n      if (this.__expirationTask) {\n        clearTimeout(this.__expirationTask);\n      }\n      // Simply using setTimeout for an hour in the future\n      // doesn't work; setTimeout isn't that precise over that long of a period.\n      // So re-check every five seconds until we're past the expiration time\n      this.__expirationTask = setTimeout(() =>  {\n        this.__expirationTask = null;\n        this._checkExpired(expirationTimeInMs);\n      }, 5000);\n\n      return;\n    }\n\n    if (this.config.autoRefreshOnTimeout) {\n      this.startRefresh('iframe');\n    } else {\n      // We don't have auto-refresh enabled, so flag the token as expired and let the application handle it.\n      this._changeState(authn.STATE_EXPIRED, this.store.user, this.store.token);\n    }\n  }\n\n  get _location() {\n    return this.window.location;\n  }\n\n  isAuthenticationCallback(location) {\n    const isCallbackUrl = location.href.indexOf(this.config.callbackUrl) === 0;\n    const hasCode = location.search && location.search.includes('code=') && location.search.includes('state=')\n\n    return !!(isCallbackUrl && hasCode)\n  }\n\n  hasStoredSession() {\n    return !!this.storageHandler.getSessionState(this.config.clientId);\n  }\n\n  shutdown() {\n    log.info('shutting down');\n    this.unlisten();\n    this._changeState(authn.STATE_INDETERMINATE);\n    cleanupOnlyInstance(this);\n  }\n\n  listen() {\n    log.debug('setting up event listeners');\n    _listenTo(this, authn.EVENT_LOGIN_REQUESTED, this.startLogin);\n    _listenTo(this, authn.EVENT_LOGOUT_REQUESTED, this.startLogout);\n    _listenTo(this, authn.EVENT_REFRESH_REQUESTED, this.startRefresh);\n    _listenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED, this.handleCurrentInfoRequest);\n    _listenTo(this, authn.EVENT_STATE_CHANGE, this.handleStateChange);\n  }\n\n  unlisten() {\n    log.debug('tearing down event listeners');\n    _unlistenTo(this, authn.EVENT_LOGIN_REQUESTED);\n    _unlistenTo(this, authn.EVENT_LOGOUT_REQUESTED);\n    _unlistenTo(this, authn.EVENT_REFRESH_REQUESTED);\n    _unlistenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED);\n    _unlistenTo(this, authn.EVENT_STATE_CHANGE);\n  }\n\n  startLogin(displayType = 'window') {\n    log.infof('Starting login. mode=%s', displayType);\n    const {clientId, callbackUrl} = this.config;\n    const csrf = randomString();\n    const codeVerifier = randomString(128);\n    // challenge is base64-encoded SHA256 hash of codeVerifier\n    const codeChallenge = btoa(String.fromCharCode(...sha256.array(codeVerifier)))\n      .replace(/\\+/g, '-')\n      .replace(/\\//g, '_')\n      .replace(/=/g, '')\n\n    const storedState = _prepareStoredState(Date.now() + STORED_STATE_LIFETIME, csrf, codeVerifier, {});\n    this.storageHandler.saveOAuthState(this.config.clientId, storedState);\n\n    const loginUrl = `${BASE_URL}/authorize?response_type=code&client_id=${clientId}&redirect_uri=${encodeURIComponent(callbackUrl)}&scope=openid&state=${csrf}&code_challenge=${codeChallenge}&code_challenge_method=S256`;\n    log.debug('computed login url of', loginUrl);\n\n    if (!displayType || displayType == 'window') {\n      log.info(`Redirecting user to '${loginUrl}'`);\n      this.window.location = loginUrl;\n      return\n    } else if (displayType === 'popup') {\n      log.info('launching popup at', loginUrl);\n      this.window.open(loginUrl)\n      return\n    }\n\n    log.info('Setting up hidden refresh iframe at', loginUrl);\n    // last option: displayType == 'iframe'\n    let iframe = this.document.getElementById(CHILD_IFRAME_ID)\n    if (iframe) {\n      iframe.parentNode.removeChild(iframe)\n    }\n    iframe = this.document.createElement('iframe')\n    iframe.onload = () => {\n      let html = null\n      try {\n        html = iframe.contentWindow.document.body.innerHTML\n      } catch (err) {\n        // intentional do-nothing\n      }\n      if (html === null) {\n        // Hidden-frame refresh failed. Remove frame and\n        // report problem\n        iframe.parentNode.removeChild(iframe)\n        this._changeState(IG_STATE_AUTO_REFRESH_FAILED, null, null)\n        this._changeState(authn.STATE_UNAUTHENTICATED, null, null)\n      }\n    }\n    iframe.id = CHILD_IFRAME_ID\n    iframe.src = loginUrl\n    iframe.style = 'display:none'\n    log.debug('appending iframe', iframe);\n    this.document.body.appendChild(iframe);\n  }\n\n  startLogout() {\n    log.info('starting logout');\n    this.storageHandler.clearSessionState(this.config.clientId);\n    // Need to ensure BOTH api.byu.edu and cas.byu.edu clean out their sessions\n    // With current config of those two sites, to have that full clean out AND a final \"where to go after logout\"\n    // redirect, we need to manually wrap them all together\n    const logoutRedirect = (this.config.logoutRedirect === undefined) ? this.config.callbackUrl : this.config.logoutRedirect\n    const casLogoutUrl = 'https://cas.byu.edu/cas/logout?service=' + encodeURIComponent(logoutRedirect)\n    const logoutUrl = `${BASE_URL}/logout?redirect_url=` + encodeURIComponent(casLogoutUrl);\n    log.info('logging out by redirecting to', logoutUrl);\n    this.window.location = logoutUrl;\n\n    //TODO: WSO2 Identity Server 5.1 allows us to revoke implicit tokens.  Once that's done, we'll need to do this.\n    // const url = `https://api.byu.edu/revoke`;\n\n    // const form = new URLSearchParams();\n    // form.set('token', store.token.bearer);\n    // form.set('client_id', config.clientId);\n    // form.set('token_type_hint', 'access_token');\n\n    // console.log('logout url', url);\n\n    // fetch(url, {\n    //     method: 'POST',\n    //     body: form,\n    //     // headers: {\n    //     //     'Content-Type': 'application/x-www-form-urlencoded'\n    //     // }\n    // }).then(result => {\n    //     console.log('done with logout', result);\n    // });\n  }\n\n  async startRefresh(displayType = 'iframe') {\n    log.infof('starting refresh. displayType=%s', displayType);\n\n    // Save copy of current info before triggering changeState\n    const token = Object.assign({}, this.store.token)\n    const user = Object.assign({}, this.store.user)\n\n    // Also pass yet another isolated copy to changeState\n    this._changeState(authn.STATE_REFRESHING, Object.assign({}, this.store.user), Object.assign({}, this.store.token));\n\n    if (displayType !== 'iframe') {\n      this.startLogin(displayType);\n      return;\n    }\n\n    // If we have a refresh token, then try that before doing the more complicated iframe version\n    if (!(token && token.refresh)) {\n      this.startLogin('iframe');\n      return;\n    }\n\n    const tokenUrl = `${BASE_URL}/token`;\n    const body = new URLSearchParams();\n    body.set('grant_type', 'refresh_token');\n    body.set('client_id', this.config.clientId);\n    body.set('refresh_token', token.refresh)\n\n    const resp = await fetch(tokenUrl, {\n      method: 'POST',\n      headers: new Headers({ 'Accept': 'application/json', 'Content-Type': 'application/x-www-form-urlencoded' }),\n      body\n    });\n\n    if (resp.status !== 200) {\n      this.startLogin('iframe');\n      return;\n    }\n\n    const tokenInfo = await resp.json();\n    token.bearer = tokenInfo.access_token;\n    token.refresh = tokenInfo.refresh_token;\n    const expiresIn = tokenInfo.expires_in - EXPIRATION_BUFFER;\n    token.authorizationHeader = `Bearer ${token.bearer}`;\n    token.expiresAt = new Date(Date.now() + (expiresIn * 1000));\n\n    this._changeState(authn.STATE_AUTHENTICATED, user, token);\n  }\n\n  handleCurrentInfoRequest({callback}) {\n    log.debug('got current info request');\n    if (callback) {\n      callback(this.store);\n    }\n  }\n\n  _updateStateFromStorage() {\n    log.debug('updating state from local storage');\n    const serialized = this.storageHandler.getSessionState(this.config.clientId);\n    if (!serialized) {\n      log.debug('no stored state');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n      return;\n    }\n    const {user, token} = deserializeSessionState(serialized);\n    if (!user || !token) {\n      log.debug('no stored user or token');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    } else if (token.expiresAt > new Date()) {\n      log.debug('found an unexpired saved session');\n      this._changeState(authn.STATE_AUTHENTICATED, user, token);\n    } else {\n      log.debug('stored session was expired');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n  }\n\n  _maybeUpdateStoredSession(state, user, token) {\n    log.debugf('updating stored session: state=%s hasUser=%s, hasToken=%s', state, !!user, !!token);\n    if (state === authn.STATE_UNAUTHENTICATED || state === authn.STATE_REFRESHING || state === authn.STATE_EXPIRED) {\n      log.debug('state is unauthenticated or expired, clearing stored session');\n      this.storageHandler.clearSessionState(this.config.clientId);\n    } else if (!!user && !!token) {\n      log.debug('storing session', redactUser(user), redactToken(token));\n      const serialized = serializeSessionState(user, token);\n      this.storageHandler.saveSessionState(this.config.clientId, serialized);\n    }\n  }\n}\n\nfunction serializeSessionState(user, token) {\n  const grouped = groupClaimPrefixes(token.rawUserInfo);\n\n  const smallerUserInfo = {\n    ro: grouped[CLAIMS_PREFIX_RESOURCE_OWNER],\n    cl: grouped[CLAIMS_PREFIX_CLIENT],\n    wso2: grouped[CLAIMS_PREFIX_WSO2],\n    o: grouped.other,\n  };\n\n  return {\n    ui: smallerUserInfo,\n    at: token.bearer,\n    rf: token.refresh,\n    ah: token.authorizationHeader,\n    ea: token.expiresAt.getTime()\n  };\n}\n\nfunction deserializeSessionState(state) {\n  const groupedUserInfo = {\n    [CLAIMS_PREFIX_RESOURCE_OWNER]: state.ui.ro,\n    [CLAIMS_PREFIX_CLIENT]: state.ui.cl,\n    [CLAIMS_PREFIX_WSO2]: state.ui.wso2,\n    other: state.ui.o,\n  }\n  const userInfo = ungroupClaimPrefixes(groupedUserInfo);\n\n  const user = _processUserInfo(userInfo);\n  const expiresAt = new Date(state.ea);\n  const token = _processTokenInfo({ userInfo, accessToken: state.at, expiresAt, authHeader: `Bearer ${state.at}`, refreshToken: state.rf });\n  return {user, token};\n}\n\nfunction _listenTo(provider, event, listener) {\n  if (provider._listeners.hasOwnProperty(event)) {\n    throw new Error('A listener is already registered for ' + event);\n  }\n  const obs = provider._listeners[event] = function (e) {\n    listener.call(provider, e.detail);\n  }.bind(provider);\n\n  provider.document.addEventListener(event, obs, false);\n}\n\nfunction _unlistenTo(provider, event) {\n  if (!provider._listeners.hasOwnProperty(event)) {\n    return;\n  }\n\n  provider.document.removeEventListener(event, provider._listeners[event], false);\n  delete provider._listeners[event];\n}\n\n\nfunction _dispatchEvent(provider, name, detail) {\n  let event;\n  if (typeof provider.window.CustomEvent === 'function') {\n    event = new CustomEvent(name, {detail});\n  } else {\n    event = provider.document.createEvent('CustomEvent');\n    event.initCustomEvent(name, true, false, detail);\n  }\n  provider.document.dispatchEvent(event);\n}\n\nasync function _handleAuthenticationCallback(config, location, storage) {\n  const searchParams = new URLSearchParams(location.search);\n\n  const oauthCsrfToken = searchParams.get('state');\n  const storedState = storage.getOAuthState(config.clientId);\n\n  storage.clearOAuthState(config.clientId);\n\n  log.debug('checking oauth state token');\n  const pageState = _validateAndGetStoredState(storedState, oauthCsrfToken);\n  const tokenInfo = await _fetchTokenInfo(searchParams.get('code'), config, storedState.v)\n\n  const accessToken = tokenInfo.access_token;\n  const refreshToken = tokenInfo.refresh_token;\n  const expiresIn = tokenInfo.expires_in - EXPIRATION_BUFFER;\n  const expiresAt = new Date(Date.now() + (expiresIn * 1000));\n  const authHeader = `Bearer ${accessToken}`;\n  log.debug('got token', redactBearerToken(accessToken), 'which expires in', expiresIn, 'seconds');\n\n  const userInfo = await _fetchUserInfo(authHeader);\n\n  const user = _processUserInfo(userInfo);\n  const token = _processTokenInfo({ userInfo, accessToken, expiresAt, authHeader, refreshToken });\n\n  return {state: authn.STATE_AUTHENTICATED, user, token};\n}\n\n\nasync function _fetchTokenInfo(code, config, codeVerifier) {\n  log.debug('Exchanging code for token');\n  const tokenUrl = `${BASE_URL}/token`;\n  const body = new URLSearchParams();\n  body.set('grant_type', 'authorization_code');\n  body.set('client_id', config.clientId);\n  body.set('redirect_uri', config.callbackUrl);\n  body.set('code', code);\n  body.set('code_verifier', codeVerifier)\n\n  const resp = await fetch(tokenUrl, {\n    method: 'POST',\n    headers: new Headers({ 'Accept': 'application/json', 'Content-Type': 'application/x-www-form-urlencoded' }),\n    body\n  });\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    log.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-exchange-code-for-token',\n      'Unable to exchange code for token. Please try again.'\n    );\n  }\n\n  const json = await resp.json();\n  log.debug('successfully got user info', json);\n  return json;\n}\n\nasync function _fetchUserInfo(authHeader) {\n  const USER_INFO_URL = `${BASE_URL}/openid-userinfo/v1/userinfo?schema=openid`;\n  log.debug('fetching user info from', USER_INFO_URL);\n  const resp = await fetch(USER_INFO_URL, {\n    method: 'GET',\n    headers: new Headers({'Accept': 'application/json', 'Authorization': authHeader}),\n    mode: 'cors',\n  });\n\n  log.debug('got status', resp.status);\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    if (resp.status === 403) {\n      log.debug('got forbidden error');\n      if (body.includes('<ams:code>900908</ams:code>')) {\n        log.debug('client app isn\\'t subscribed to OpenID UserInfo endpoint');\n        log.error(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`);\n        throw new OAuthError(\n          'not-subscribed-to-user-info',\n          'This page has an authentication configuration error. Developers, see the console for details.'\n        );\n      } else {\n        log.error('invalid oauth bearer token');\n        throw new OAuthError(\n          'invalid-oauth-token',\n          'The provided authentication token is invalid. Please try again.'\n        );\n      }\n    }\n    log.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-get-user-info',\n      'Unable to fetch user information. Please try again.'\n    );\n  }\n  const json = await resp.json();\n  log.debug('successfully got user info', json);\n  return json;\n}\n\nconst CLAIMS_PREFIX_RESOURCE_OWNER = 'http://byu.edu/claims/resourceowner_';\nconst CLAIMS_PREFIX_CLIENT = 'http://byu.edu/claims/client_';\nconst CLAIMS_PREFIX_WSO2 = 'http://wso2.org/claims/';\n\nconst CLAIMS_KNOWN_PREFIXES = [CLAIMS_PREFIX_CLIENT, CLAIMS_PREFIX_RESOURCE_OWNER, CLAIMS_PREFIX_WSO2];\n\nfunction groupClaimPrefixes(userInfo) {\n  const grouped = {\n    other: {}\n  };\n  for (const prefix of CLAIMS_KNOWN_PREFIXES) {\n    grouped[prefix] = {};\n  }\n  for (const key of Object.keys(userInfo)) {\n    const value = userInfo[key];\n    const prefix = CLAIMS_KNOWN_PREFIXES.find(it => key.startsWith(it));\n    if (prefix) {\n        grouped[prefix][key.substr(prefix.length)] = value;\n    } else {\n      grouped.other[key] = value;\n    }\n  }\n  return grouped;\n}\n\nfunction ungroupClaimPrefixes(grouped) {\n  const result = {};\n  for (const groupKey of CLAIMS_KNOWN_PREFIXES) {\n    const group = grouped[groupKey];\n    if (!group) continue;\n    for (const key of Object.keys(group)) {\n      result[groupKey + key] = group[key];\n    }\n  }\n  for (const other of Object.keys(grouped.other)) {\n    result[other] = grouped.other[other];\n  }\n  return result;\n}\n\nfunction getClaims(userInfo, prefix) {\n  return Object.keys(userInfo).filter(k => k.startsWith(prefix))\n    .reduce((agg, key) => {\n      agg[key.substr(prefix.length)] = userInfo[key];\n      return agg;\n    }, {});\n}\n\nfunction _processUserInfo(userInfo) {\n  const roClaims = getClaims(userInfo, CLAIMS_PREFIX_RESOURCE_OWNER);\n\n  const familyNamePosition = roClaims.surname_position;\n  const givenName = roClaims.preferred_first_name;\n  const familyName = roClaims.surname;\n\n  const displayName = familyNamePosition === 'F' ? `${familyName} ${givenName}` : `${givenName} ${familyName}`;\n\n  return {\n    personId: roClaims.person_id,\n    byuId: roClaims.byu_id,\n    netId: roClaims.net_id,\n    name: {\n      sortName: roClaims.sort_name,\n      displayName,\n      givenName,\n      familyName,\n      familyNamePosition,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _processTokenInfo({ userInfo, accessToken, expiresAt, authHeader, refreshToken }) {\n  const clientClaims = getClaims(userInfo, CLAIMS_PREFIX_CLIENT);\n  const wso2Claims = getClaims(userInfo, CLAIMS_PREFIX_WSO2);\n\n  return {\n    bearer: accessToken,\n    refresh: refreshToken,\n    authorizationHeader: authHeader,\n    expiresAt,\n    client: {\n      id: wso2Claims.client_id,\n      byuId: clientClaims.byu_id,\n      appName: wso2Claims.applicationname,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _validateAndGetStoredState(storedState, expectedCsrfToken) {\n  log.debug('validating stored state token. Expecting token', expectedCsrfToken, ', got state', storedState);\n  if (!storedState) {\n    log.error('no stored oauth login state');\n    throw new OAuthError('no-oauth-state', 'Your saved authentication information does not match. Please try again.');\n  }\n  const {e: stateExpiresString, c: storedCsrfToken, s: pageState} = storedState;\n\n  if (expectedCsrfToken !== storedCsrfToken) {\n    log.error('CSRF token mismatch')\n    throw new OAuthError(\n      'oauth-state-mismatch',\n      'Your saved authentication information does not match. Please try again.'\n    );\n  }\n\n  if (Number(stateExpiresString) < Date.now()) {\n    log.error('stored state has expired');\n    throw new OAuthError(\n      'oauth-state-expired',\n      'Your login attempt has timed out. Please try again.'\n    );\n  }\n\n  return pageState;\n}\n\nfunction _prepareStoredState(expires, csrfToken, codeVerifier, pageState) {\n  return {\n    e: expires,\n    c: csrfToken,\n    v: codeVerifier,\n    s: pageState,\n  }\n}\n\nclass OAuthError extends Error {\n  constructor(type, description, uri) {\n    super('OAuth Error: ' + description);\n    this.type = type;\n    this.description = description;\n    this.uri = uri;\n  }\n}\n\nconst allowableRandomChars = [...'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'];\nconst randomCharRangeConvert = allowableRandomChars.length / 2**8; // Using Uint8Array for getRandomValues\n\nfunction randomString(length) {\n  const randomArray = new Uint8Array(length || 24);\n  const crypto = window.crypto || window.msCrypto;\n  crypto.getRandomValues(randomArray);\n\n  return randomArray.reduce((str, cur) => str + allowableRandomChars[Math.floor(cur * randomCharRangeConvert)], '');\n}\n\nfunction logStateChange(state, user, token, error) {\n  const logParts = [\n    'state change:',\n    {\n      state,\n      user: redactUser(user),\n      token: token, //redactToken(token),\n      error: error\n    }\n  ];\n  if (error) {\n    log.error(...logParts);\n  } else {\n    log.info(...logParts);\n  }\n}\n\nfunction redactUser(u) {\n  if (!u) return undefined;\n  return {\n    netId: u.netId,\n    'rest-is-redacted': true\n  };\n}\n\nfunction redactToken(t) {\n  log.debug('redacting token', t);\n  if (!t) return undefined;\n  const {bearer, expiresAt, client} = t;\n  return {\n    bearer: redactBearerToken(bearer),\n    expiresAt: !!expiresAt ? expiresAt.toISOString() : null,\n    client,\n    'rest-is-redacted': true\n  }\n}\nfunction redactBearerToken(b) {\n  if (!b) return undefined;\n  return b.substring(0, 2) + '...redacted...' + b.substring(b.length - 2)\n}\n\nfunction ensureOnlyInstance(obj) {\n  if (SINGLETON_INSTANCE) {\n    const trace = SINGLETON_INSTANCE.___startupTrace;\n    throw new Error('There is already an instance of byu-oauth-implicit running!  Please call `#shutdown()` on that instance before starting a new one. Instance was started at:\\n' + trace);\n  }\n  obj.___startupTrace = new Error().stack;\n  SINGLETON_INSTANCE = obj;\n}\n\nfunction cleanupOnlyInstance(obj) {\n  SINGLETON_INSTANCE = null;\n}\n\nexport function __forceShutdown() {\n  if (SINGLETON_INSTANCE) {\n    SINGLETON_INSTANCE.shutdown();\n    cleanupOnlyInstance(SINGLETON_INSTANCE);\n  }\n}\n","/*\n * Copyright 2018 Brigham Young University\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IG_STATE_AUTO_REFRESH_FAILED, ImplicitGrantProvider } from \"./provider.js\";\nexport { IG_STATE_AUTO_REFRESH_FAILED }\n\nexport const DEFAULT_ISSUER = 'https://api.byu.edu';\nexport const DEFAULT_BASE_URL = 'https://api.byu.edu';\n\nexport const GLOBAL_CONFIG_KEY = 'byu-oauth-implicit-config';\n\n/**\n * @typedef {} ImplicitConfig\n * @prop {string} clientId\n * @prop {?string} issuer\n * @prop {?string} baseUrl\n * @prop {?string} callbackUrl\n * @prop {?boolean} requireAuthentication\n */\n\n/**\n * @param {ImplicitConfig|ImplicitConfig[]|undefined} cfgOrRules\n * @param location\n */\nexport async function configure(cfgOrRules, location = window.location) {\n  const cfg = resolveConfig(cfgOrRules, location);\n  const globalConfig = window[GLOBAL_CONFIG_KEY];\n\n  const config = Object.assign({\n    issuer: DEFAULT_ISSUER,\n    baseUrl: DEFAULT_BASE_URL,\n    callbackUrl: `${location.origin}${location.pathname}`,\n    autoRefreshOnTimeout: false\n  }, globalConfig, cfg);\n\n  if (!config.clientId) {\n    throw new Error('clientId must be specified in config');\n  }\n  const provider = new ImplicitGrantProvider(config, window, document);\n\n  return provider.startup();\n}\n\nfunction resolveConfig(rules, location) {\n  if (!rules) {\n    return {};\n  }\n\n  if ('clientId' in rules) {\n    return rules;\n  }\n\n  const keys = Object.keys(rules)\n    .filter(it => it.startsWith('https://') || it.startsWith('http://'));\n\n  if (keys.length === 0) {\n    return rules;\n  }\n\n  const key = keys\n    // order by length of key (most specific), descending\n    .sort((a, b) => b.length - a.length)\n    .find(it => location.href.startsWith(it));\n  if (key) {\n    return Object.assign({ callbackUrl: key }, rules[key]);\n  }\n  throw new Error(`Unable to match url [${location.href}] to one of [${keys}]`)\n}\n"],"names":["LEVEL_TRACE","priority","name","run","handleTrace","LEVEL_DEBUG","handleDebug","LEVEL_INFO","handleInfo","LEVEL_ERROR","handleError","ALL_LEVELS","DEFAULT_LEVEL","debug","args","log","info","error","debugf","format","logf","infof","level","shouldLog","getFormattedTime","now","Date","h24","String","getHours","padStart","min","getMinutes","sec","getSeconds","millis","getMilliseconds","formatTimezone","date","offset","getTimezoneOffset","absOffset","Math","abs","hourInt","floor","hourDone","sign","nonNegative","minDone","currentLevel","levelAttr","levelGlobalVar","lower","toLowerCase","find","l","document","documentElement","getAttribute","o","window","byuOAuth","logging","console","trace","EVENT_PREFIX","EVENT_STATE_CHANGE","EVENT_LOGIN_REQUESTED","EVENT_LOGOUT_REQUESTED","EVENT_REFRESH_REQUESTED","EVENT_CURRENT_INFO_REQUESTED","STATE_INDETERMINATE","STATE_UNAUTHENTICATED","STATE_AUTHENTICATED","STATE_AUTHENTICATING","STATE_REFRESHING","STATE_EXPIRED","STATE_ERROR","parse","serialize","decode","decodeURIComponent","encode","encodeURIComponent","pairSplitRegExp","fieldContentRegExp","str","options","TypeError","obj","opt","pairs","split","dec","i","length","pair","eq_idx","indexOf","key","substr","trim","val","slice","undefined","tryDecode","enc","test","value","maxAge","isNaN","Error","domain","path","expires","toUTCString","httpOnly","secure","sameSite","e","_classCallCheck","instance","Constructor","Object","defineProperty","exports","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","protoProps","staticProps","prototype","storage","CookieStorage","setItem","getItem","removeItem","_cookie2","__esModule","default","_interopRequireDefault","_cookie","prefix","arguments","cookieOptions","assign","cookies","cookie","hasOwnProperty","hasStorage","replace","_CookieStorage","hasCookies","MemoryStorage","_data","_isSupported2","_isSupported","_CookieStorage2","_MemoryStorage2","_MemoryStorage","localStorage","sessionStorage","StorageHandler","saveOAuthState","clientId","state","getKey","JSON","stringify","getOAuthState","result","clearOAuthState","saveSessionState","getSessionKey","getSessionState","stored","clearSessionState","sha256","sha256Lib","SINGLETON_INSTANCE","BASE_URL","CHILD_IFRAME_ID","STORED_STATE_LIFETIME","EXPIRATION_BUFFER","IG_STATE_AUTO_REFRESH_FAILED","ImplicitGrantProvider","constructor","config","storageHandler","_listeners","baseUrl","store","freeze","authn","user","token","_changeState","logStateChange","_dispatchEvent","_checkPopupOpener","origin","opener","location","URL","callbackUrl","_checkIframeOpener","iframe","parent","getElementById","contentWindow","handleStateChange","source","close","parentNode","removeChild","_maybeUpdateStoredSession","_checkExpired","expiresAt","getTime","startup","ensureOnlyInstance","listen","_location","isAuthenticationCallback","_handleAuthenticationCallback","err","hasStoredSession","_updateStateFromStorage","expirationTimeInMs","expiresInMs","__expirationTask","clearTimeout","setTimeout","_this","autoRefreshOnTimeout","startRefresh","isCallbackUrl","href","hasCode","search","includes","shutdown","unlisten","cleanupOnlyInstance","_listenTo","startLogin","startLogout","handleCurrentInfoRequest","_unlistenTo","displayType","fromCharCode","csrf","randomString","codeVerifier","codeChallenge","btoa","array","storedState","_prepareStoredState","loginUrl","open","createElement","onload","html","body","innerHTML","_this2","id","src","style","appendChild","logoutRedirect","casLogoutUrl","logoutUrl","refresh","tokenUrl","URLSearchParams","set","resp","fetch","method","headers","Headers","status","tokenInfo","json","bearer","access_token","refresh_token","expiresIn","expires_in","authorizationHeader","callback","serialized","deserializeSessionState","redactUser","redactToken","serializeSessionState","grouped","groupClaimPrefixes","rawUserInfo","smallerUserInfo","ro","CLAIMS_PREFIX_RESOURCE_OWNER","cl","CLAIMS_PREFIX_CLIENT","wso2","CLAIMS_PREFIX_WSO2","other","ui","at","rf","ah","ea","groupedUserInfo","userInfo","ungroupClaimPrefixes","_processUserInfo","_processTokenInfo","accessToken","authHeader","refreshToken","provider","event","listener","obs","call","detail","bind","addEventListener","removeEventListener","CustomEvent","createEvent","initCustomEvent","dispatchEvent","searchParams","oauthCsrfToken","get","pageState","_validateAndGetStoredState","_fetchTokenInfo","v","redactBearerToken","_fetchUserInfo","code","text","OAuthError","USER_INFO_URL","mode","CLAIMS_KNOWN_PREFIXES","keys","it","startsWith","groupKey","group","getClaims","filter","k","reduce","agg","roClaims","familyNamePosition","surname_position","givenName","preferred_first_name","familyName","surname","displayName","personId","person_id","byuId","byu_id","netId","net_id","sortName","sort_name","clientClaims","wso2Claims","client","client_id","appName","applicationname","expectedCsrfToken","stateExpiresString","c","storedCsrfToken","s","Number","csrfToken","type","description","uri","allowableRandomChars","randomCharRangeConvert","randomArray","Uint8Array","crypto","msCrypto","getRandomValues","cur","logParts","u","t","toISOString","b","substring","___startupTrace","stack","DEFAULT_ISSUER","DEFAULT_BASE_URL","GLOBAL_CONFIG_KEY","configure","cfgOrRules","cfg","resolveConfig","globalConfig","issuer","pathname","rules","sort","a"],"mappings":"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"}