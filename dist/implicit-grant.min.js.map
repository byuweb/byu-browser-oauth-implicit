{"version":3,"file":"implicit-grant.min.js","sources":["../node_modules/@byuweb/browser-oauth/constants.js","../src/url.mjs","../node_modules/cookie/index.js","../node_modules/local-storage-fallback/lib/CookieStorage.js","../node_modules/local-storage-fallback/lib/isSupported.js","../node_modules/local-storage-fallback/lib/MemoryStorage.js","../node_modules/local-storage-fallback/lib/index.js","../src/local-storage.mjs","../src/provider.mjs","../src/implicit-grant.mjs"],"sourcesContent":["export const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const EVENT_STATE_CHANGE = `${EVENT_PREFIX}-state-changed`;\nexport const EVENT_LOGIN_REQUESTED = `${EVENT_PREFIX}-login-requested`;\nexport const EVENT_LOGOUT_REQUESTED = `${EVENT_PREFIX}-logout-requested`;\nexport const EVENT_REFRESH_REQUESTED = `${EVENT_PREFIX}-refresh-requested`;\nexport const EVENT_CURRENT_INFO_REQUESTED = `${EVENT_PREFIX}-current-info-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nexport function parseHash(hash) {\n  if (!hash) return new Map();\n  let subHash = hash;\n  if (hash.startsWith('#')) {\n    subHash = hash.substr(1);\n  }\n\n  const keyValues = subHash.split('&')\n    .map(it => it.split('=', 2));\n  return new Map(keyValues);\n}\n\n","/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(pairSplitRegExp);\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var eq_idx = pair.indexOf('=');\n\n    // skip things that don't look like key=value\n    if (eq_idx < 0) {\n      continue;\n    }\n\n    var key = pair.substr(0, eq_idx).trim()\n    var val = pair.substr(++eq_idx, pair.length).trim();\n\n    // quoted values\n    if ('\"' == val[0]) {\n      val = val.slice(1, -1);\n    }\n\n    // only assign once\n    if (undefined == obj[key]) {\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n    if (isNaN(maxAge)) throw new Error('maxAge should be a Number');\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.hasCookies = hasCookies;\n\nvar _cookie = require('cookie');\n\nvar _cookie2 = _interopRequireDefault(_cookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar prefix = 'lS_';\n\nvar CookieStorage = function () {\n  function CookieStorage() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CookieStorage);\n\n    this.cookieOptions = Object.assign({ path: '/' }, options);\n    prefix = options.prefix === undefined ? prefix : options.prefix;\n  }\n\n  _createClass(CookieStorage, [{\n    key: 'getItem',\n    value: function getItem(key) {\n      var cookies = _cookie2.default.parse(document.cookie);\n      if (!cookies || !cookies.hasOwnProperty(prefix + key)) {\n        return null;\n      }\n      return cookies[prefix + key];\n    }\n  }, {\n    key: 'setItem',\n    value: function setItem(key, value) {\n      document.cookie = _cookie2.default.serialize(prefix + key, value, this.cookieOptions);\n      return value;\n    }\n  }, {\n    key: 'removeItem',\n    value: function removeItem(key) {\n      var options = Object.assign({}, this.cookieOptions, { maxAge: -1 });\n      document.cookie = _cookie2.default.serialize(prefix + key, '', options);\n      return null;\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      var cookies = _cookie2.default.parse(document.cookie);\n      for (var key in cookies) {\n        if (key.indexOf(prefix) === 0) {\n          this.removeItem(key.substr(prefix.length));\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return CookieStorage;\n}();\n\nexports.default = CookieStorage;\nfunction hasCookies() {\n  var storage = new CookieStorage();\n\n  try {\n    var TEST_KEY = '__test';\n    storage.setItem(TEST_KEY, '1');\n    var value = storage.getItem(TEST_KEY);\n    storage.removeItem(TEST_KEY);\n\n    return value === '1';\n  } catch (e) {\n    return false;\n  }\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = isSupported;\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar TEST_KEY = '__test';\n\nfunction hasStorage(name) {\n  try {\n    var storage = window[name];\n    storage.setItem(TEST_KEY, '1');\n    storage.removeItem(TEST_KEY);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction isSupported() {\n  var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'localStorage';\n\n  var storage = String(name).replace(/storage$/i, '').toLowerCase();\n\n  if (storage === 'local') {\n    return hasStorage('localStorage');\n  }\n\n  if (storage === 'session') {\n    return hasStorage('sessionStorage');\n  }\n\n  if (storage === 'cookie') {\n    return (0, _CookieStorage.hasCookies)();\n  }\n\n  if (storage === 'memory') {\n    return true;\n  }\n\n  throw new Error('Storage method `' + name + '` is not available.\\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.');\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MemoryStorage = function () {\n  function MemoryStorage() {\n    _classCallCheck(this, MemoryStorage);\n\n    this._data = {};\n  }\n\n  _createClass(MemoryStorage, [{\n    key: \"getItem\",\n    value: function getItem(key) {\n      return this._data.hasOwnProperty(key) ? this._data[key] : null;\n    }\n  }, {\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      return this._data[key] = String(value);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(key) {\n      return delete this._data[key];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      return this._data = {};\n    }\n  }]);\n\n  return MemoryStorage;\n}();\n\nexports.default = MemoryStorage;","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MemoryStorage = exports.CookieStorage = exports.isSupported = exports.storage = undefined;\n\nvar _isSupported = require('./isSupported');\n\nvar _isSupported2 = _interopRequireDefault(_isSupported);\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar _CookieStorage2 = _interopRequireDefault(_CookieStorage);\n\nvar _MemoryStorage = require('./MemoryStorage');\n\nvar _MemoryStorage2 = _interopRequireDefault(_MemoryStorage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar storage = null;\n\nif ((0, _isSupported2.default)('localStorage')) {\n  // use localStorage\n  exports.storage = storage = window.localStorage;\n} else if ((0, _isSupported2.default)('sessionStorage')) {\n  // use sessionStorage\n  exports.storage = storage = window.sessionStorage;\n} else if ((0, _isSupported2.default)('cookieStorage')) {\n  // use cookies\n  exports.storage = storage = new _CookieStorage2.default();\n} else {\n  // use memory\n  exports.storage = storage = new _MemoryStorage2.default();\n}\n\nexports.default = storage;\nexports.storage = storage;\nexports.isSupported = _isSupported2.default;\nexports.CookieStorage = _CookieStorage2.default;\nexports.MemoryStorage = _MemoryStorage2.default;","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport storage from 'local-storage-fallback';\n\nexport class StorageHandler {\n\n  saveOAuthState(clientId, state) {\n    storage.setItem(getKey(clientId), JSON.stringify(state));\n  }\n\n  getOAuthState(clientId) {\n    const result = storage.getItem(getKey(clientId));\n    if (!result) {\n      return null;\n    }\n    return JSON.parse(result);\n  }\n\n  clearOAuthState(clientId) {\n    storage.removeItem(getKey(clientId));\n  }\n\n  saveSessionState(clientId, state) {\n    storage.setItem(getSessionKey(clientId), JSON.stringify(state));\n  }\n  \n  getSessionState(clientId) {\n    const key = getSessionKey(clientId);\n    const stored = storage.getItem(key);\n    if (!stored) {\n      return null;\n    }\n    return JSON.parse(stored);\n  }\n  \n  clearSessionState(clientId) {\n    storage.removeItem(getSessionKey(clientId));\n  }\n}\n\nfunction getKey(clientId) {\n  return 'oauth-state-' + encodeURIComponent(clientId);\n}\n\nfunction getSessionKey(clientId) {\n  return getKey(clientId) + '-active-session';\n}\n\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\"use strict\";\n\nimport * as authn from '../node_modules/@byuweb/browser-oauth/constants.js';\nimport {parseHash} from './url.mjs';\nimport {StorageHandler} from \"./local-storage.mjs\";\n\nconst CHILD_IFRAME_ID = 'byu-oauth-implicit-grant-refresh-iframe'\nconst STORED_STATE_LIFETIME = 5 * 60 * 1000; // 5 minutes\nexport const IG_STATE_REFRESH_REQUIRED = 'implicit-grant-refresh-required'\nexport const IG_STATE_AUTO_REFRESH_FAILED = 'implicit-grant-auto-refresh-failed'\n\nexport class ImplicitGrantProvider {\n  constructor(config, window, document, storageHandler = new StorageHandler()) {\n    this.config = config;\n    this.window = window;\n    this.document = document;\n    this.storageHandler = storageHandler;\n    this._listeners = {};\n\n    this.store = Object.freeze({\n      state: authn.STATE_INDETERMINATE,\n      user: null,\n      token: null,\n      error: null\n    })\n  }\n\n  _changeState(state, user, token, error) {\n    this.store = Object.freeze({\n      state, user, token, error\n    });\n    _dispatchEvent(this, authn.EVENT_STATE_CHANGE, this.store)\n  }\n\n  // Separate state change listener, because state change events\n  // might come from child iframe/popup window\n  handleStateChange({ state, user, token, source }) {\n    // If this is a popup\n    if (this.window.opener) {\n      // We're inside a child re-authentication popup\n\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      // Pass event along to parent\n      _dispatchEvent(this.window.opener, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'popup' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        //this.window.close()\n      }\n\n      return\n    }\n\n    // If we're inside the \"refresh\" iframe\n    const iframe = parent.document.getElementById(CHILD_IFRAME_ID)\n    if (iframe) {\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      // Pass event along to parent\n      _dispatchEvent(parent, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'iframe' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        iframe.parentNode.removeChild(iframe)\n      }\n\n      return\n    }\n\n    this._maybeUpdateStoredSession(state, user, token);\n\n    if (state === authn.STATE_AUTHENTICATED) {\n      this._checkRefresh(token.expiresAt.getTime())\n    }\n  }\n\n  async startup() {\n    this.listen();\n    this._changeState(authn.STATE_INDETERMINATE);\n\n    const location = this._location;\n    const hash = this._hashParams;\n\n    if (this.isAuthenticationCallback(location.href, hash)) {\n      this._changeState(authn.STATE_AUTHENTICATING);\n      try {\n        const {state, user, token, error} = await _handleAuthenticationCallback(\n          this.config,\n          location,\n          hash,\n          this.storageHandler\n        );\n        this._changeState(state, user, token, error);\n      } catch (err) {\n        console.error('OAuth Error', err);\n        this._changeState(authn.STATE_ERROR, undefined, undefined, err);\n      }\n    } if (this.hasStoredSession()) {\n      this._updateStateFromStorage();\n    } else {\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n  }\n\n  _checkRefresh(expirationTimeInMs) {\n    // Simply using setTimeout for an hour in the future\n    // doesn't work; setTimeout isn't that precise over that long of a period.\n    // So re-check every five seconds until we're past the expiration time\n\n    const expiresInMs = expirationTimeInMs - Date.now()\n\n    if (expiresInMs < 0 || expiresInMs > 3300000) {\n      // If we've expired OR if the WSO2 five-minute grace period was not added, then trigger a refresh.\n      // Wait an extra 5 seconds to avoid WSO2 clock skew problems\n      // Existing token *should* have a five-minute grace period after expiration:\n      // a new request will generate a new token, but the old token should still\n      // work during that grace period\n      let fn = () => this.startRefresh('iframe')\n      if (this.config.doNotAutoRefreshOnTimeout) {\n        fn = () => this._changeState(IG_STATE_REFRESH_REQUIRED)\n      }\n      return setTimeout(fn, 5000)\n    }\n\n    setTimeout(() => this._checkRefresh(expirationTimeInMs), 5000)\n  }\n\n  get _location() {\n    return this.window.location;\n  }\n\n  get _hashParams() {\n    return parseHash(this._location.hash);\n  }\n\n  isAuthenticationCallback(href, hash) {\n    const isCallbackUrl = href.indexOf(this.config.callbackUrl) === 0;\n    const hasHash = hash.size !== 0;\n\n    if (!isCallbackUrl || !hasHash) {\n      return false;\n    }\n\n    return hash.has('access_token') || hash.has('error');\n  }\n\n  hasStoredSession() {\n    return !!this.storageHandler.getSessionState(this.config.clientId);\n  }\n\n  shutdown() {\n    this.unlisten();\n    this._changeState(authn.STATE_INDETERMINATE);\n  }\n\n  listen() {\n    _listenTo(this, authn.EVENT_LOGIN_REQUESTED, this.startLogin);\n    _listenTo(this, authn.EVENT_LOGOUT_REQUESTED, this.startLogout);\n    _listenTo(this, authn.EVENT_REFRESH_REQUESTED, this.startRefresh);\n    _listenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED, this.handleCurrentInfoRequest);\n    _listenTo(this, authn.EVENT_STATE_CHANGE, this.handleStateChange);\n  }\n\n  unlisten() {\n    _unlistenTo(this, authn.EVENT_LOGIN_REQUESTED);\n    _unlistenTo(this, authn.EVENT_LOGOUT_REQUESTED);\n    _unlistenTo(this, authn.EVENT_REFRESH_REQUESTED);\n    _unlistenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED);\n    _unlistenTo(this, authn.EVENT_STATE_CHANGE);\n  }\n\n  startLogin(displayType = 'window') {\n    console.log('starting login', this);\n    const {clientId, callbackUrl} = this.config;\n    const csrf = randomString();\n\n    const storedState = _prepareStoredState(Date.now() + STORED_STATE_LIFETIME, csrf, {});\n    this.storageHandler.saveOAuthState(this.config.clientId, storedState);\n\n    const loginUrl = `https://api.byu.edu/authorize?response_type=token&client_id=${clientId}&redirect_uri=${encodeURIComponent(callbackUrl)}&scope=openid&state=${csrf}`;\n\n    if (!displayType || displayType == 'window') {\n      console.warn(`[OAuth] - Redirecting user to '${loginUrl}'`);\n      this.window.location = loginUrl;\n      return\n    } else if (displayType === 'popup') {\n      this.window.open(loginUrl)\n      return\n    }\n\n    // last option: displayType == 'iframe'\n    let iframe = document.getElementById(CHILD_IFRAME_ID)\n    if (iframe) {\n      iframe.parentNode.removeChild(iframe)\n    }\n    iframe = document.createElement('iframe')\n    iframe.onload = () => {\n      let html = null\n      try {\n        html = iframe.contentWindow.document.body.innerHTML\n      } catch (err) {\n        // intentional do-nothing\n      }\n      if (html === null) {\n        // Hidden-frame refresh failed. Remove frame and\n        // report problem\n        iframe.parentNode.removeChild(iframe)\n        this._changeState(IG_STATE_AUTO_REFRESH_FAILED, null, null)\n      }\n    }\n    iframe.id = CHILD_IFRAME_ID\n    iframe.src = loginUrl\n    iframe.style = 'display:none'\n    document.body.appendChild(iframe)\n  }\n\n  startLogout() {\n    this.storageHandler.clearSessionState(this.config.clientId);\n    const redirectUrl = this.config.callbackUrl;\n    this.window.location = 'http://api.byu.edu/logout?redirect_url=' + redirectUrl;\n    //https://api.byu.edu/revoke\n\n    //TODO: WSO2 Identity Server 5.1 allows us to revoke implicit tokens.  Once that's done, we'll need to do this.\n    // const url = `https://api.byu.edu/revoke`;\n\n    // const form = new URLSearchParams();\n    // form.set('token', store.token.bearer);\n    // form.set('client_id', config.clientId);\n    // form.set('token_type_hint', 'access_token');\n\n    // console.log('logout url', url);\n\n    // fetch(url, {\n    //     method: 'POST',\n    //     body: form,\n    //     // headers: {\n    //     //     'Content-Type': 'application/x-www-form-urlencoded'\n    //     // }\n    // }).then(result => {\n    //     console.log('done with logout', result);\n    // });\n  }\n\n  startRefresh(displayType = 'iframe') {\n    this.startLogin(displayType);\n  }\n\n  handleCurrentInfoRequest({callback}) {\n    if (callback) {\n      callback(this.store);\n    }\n  }\n\n  _updateStateFromStorage() {\n    const serialized = this.storageHandler.getSessionState(this.config.clientId);\n    if (!serialized) {\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n      return;\n    }\n    const {user, token} = deserializeSessionState(serialized);\n    if (!user || !token) {\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    } else if (token.expiresAt > new Date()) {\n      this._changeState(authn.STATE_AUTHENTICATED, user, token);\n    } else {\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n  }\n\n  _maybeUpdateStoredSession(state, user, token) {\n    if (state === authn.STATE_UNAUTHENTICATED) {\n      this.storageHandler.clearSessionState(this.config.clientId);\n    } else if (!!user && !!token) {\n      const serialized = serializeSessionState(user, token);\n      this.storageHandler.saveSessionState(this.config.clientId, serialized);\n    }\n  }\n}\n\nfunction serializeSessionState(user, token) {\n  const grouped = groupClaimPrefixes(token.rawUserInfo);\n\n  const smallerUserInfo = {\n    ro: grouped[CLAIMS_PREFIX_RESOURCE_OWNER],\n    cl: grouped[CLAIMS_PREFIX_CLIENT],\n    wso2: grouped[CLAIMS_PREFIX_WSO2],\n    o: grouped.other,\n  };\n\n  return {\n    ui: smallerUserInfo,\n    at: token.bearer,\n    ah: token.authorizationHeader,\n    ea: token.expiresAt.getTime()\n  };\n}\n\nfunction deserializeSessionState(state) {\n  const groupedUserInfo = {\n    [CLAIMS_PREFIX_RESOURCE_OWNER]: state.ui.ro,\n    [CLAIMS_PREFIX_CLIENT]: state.ui.cl,\n    [CLAIMS_PREFIX_WSO2]: state.ui.wso2,\n    other: state.ui.o,\n  }\n  const userInfo = ungroupClaimPrefixes(groupedUserInfo);\n\n  const user = _processUserInfo(userInfo);\n  const expiresAt = new Date(state.ea);\n  const token = _processTokenInfo(userInfo, state.at, expiresAt, `Bearer ${state.at}`);\n  return {user, token};\n}\n\nfunction _listenTo(provider, event, listener) {\n  if (provider._listeners.hasOwnProperty(event)) {\n    throw new Error('A listener is already registered for ' + event);\n  }\n  const obs = provider._listeners[event] = function (e) {\n    listener.call(provider, e.detail);\n  }.bind(provider);\n\n  provider.document.addEventListener(event, obs, false);\n}\n\nfunction _unlistenTo(provider, event) {\n  if (!provider._listeners.hasOwnProperty(event)) {\n    return;\n  }\n\n  provider.document.removeEventListener(event, provider._listeners[event], false);\n  delete provider._listeners[event];\n}\n\n\nfunction _dispatchEvent(provider, name, detail) {\n  let event;\n  if (typeof provider.window.CustomEvent === 'function') {\n    event = new CustomEvent(name, {detail});\n  } else {\n    event = provider.document.createEvent('CustomEvent');\n    event.initCustomEvent(name, true, false, detail);\n  }\n  provider.document.dispatchEvent(event);\n}\n\nasync function _handleAuthenticationCallback(config, location, hash, storage) {\n  if (hash.has('error')) {\n    throw new OAuthError(\n      hash.get('error'),\n      hash.get('error_description'),\n      hash.get('error_uri'),\n    );\n  }\n  const oauthCsrfToken = hash.get('state');\n  const storedState = storage.getOAuthState(config.clientId);\n\n  storage.clearOAuthState(config.clientId);\n\n  const pageState = _validateAndGetStoredState(storedState, oauthCsrfToken);\n\n  const accessToken = hash.get('access_token');\n  const expiresIn = Number(hash.get('expires_in'));\n  const expiresAt = new Date(Date.now() + (expiresIn * 1000));\n  const authHeader = `Bearer ${accessToken}`;\n\n  const userInfo = await _fetchUserInfo(authHeader);\n\n  const user = _processUserInfo(userInfo);\n  const token = _processTokenInfo(userInfo, accessToken, expiresAt, authHeader);\n\n  location.hash = '';\n\n  return {state: authn.STATE_AUTHENTICATED, user, token};\n}\n\nasync function _fetchUserInfo(authHeader) {\n  const resp = await fetch('https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid', {\n    method: 'GET',\n    headers: new Headers({'Accept': 'application/json', 'Authorization': authHeader}),\n    mode: 'cors',\n  });\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    if (resp.status === 403) {\n      if (body.includes('<ams:code>900908</ams:code>')) {\n        console.error(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`);\n        throw new OAuthError(\n          'not-subscribe-to-user-info',\n          'This page has an authentication configuration error. Developers, see the console for details.'\n        );\n      } else {\n        throw new OAuthError(\n          'invalid-oauth-token',\n          'The provided authentication token is invalid. Please try again.'\n        );\n      }\n    }\n    console.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-get-user-info',\n      'Unable to fetch user information. Please try again.'\n    );\n  }\n\n  return await resp.json();\n}\n\nconst CLAIMS_PREFIX_RESOURCE_OWNER = 'http://byu.edu/claims/resourceowner_';\nconst CLAIMS_PREFIX_CLIENT = 'http://byu.edu/claims/client_';\nconst CLAIMS_PREFIX_WSO2 = 'http://wso2.org/claims/';\n\nconst CLAIMS_KNOWN_PREFIXES = [CLAIMS_PREFIX_CLIENT, CLAIMS_PREFIX_RESOURCE_OWNER, CLAIMS_PREFIX_WSO2];\n\nfunction groupClaimPrefixes(userInfo) {\n  const grouped = {\n    other: {}\n  };\n  for (const prefix of CLAIMS_KNOWN_PREFIXES) {\n    grouped[prefix] = {};\n  }\n  for (const key of Object.keys(userInfo)) {\n    const value = userInfo[key];\n    const prefix = CLAIMS_KNOWN_PREFIXES.find(it => key.startsWith(it));\n    if (prefix) {\n        grouped[prefix][key.substr(prefix.length)] = value;\n    } else {\n      grouped.other[key] = value;\n    }\n  }\n  return grouped;\n}\n\nfunction ungroupClaimPrefixes(grouped) {\n  const result = {};\n  for (const groupKey of CLAIMS_KNOWN_PREFIXES) {\n    const group = grouped[groupKey];\n    if (!group) continue;\n    for (const key of Object.keys(group)) {\n      result[groupKey + key] = group[key];\n    }\n  }\n  for (const other of Object.keys(grouped.other)) {\n    result[other] = grouped.other[other];\n  }\n  return result;\n}\n\nfunction getClaims(userInfo, prefix) {\n  return Object.keys(userInfo).filter(k => k.startsWith(prefix))\n    .reduce((agg, key) => {\n      agg[key.substr(prefix.length)] = userInfo[key];\n      return agg;\n    }, {});\n}\n\nfunction _processUserInfo(userInfo) {\n  const roClaims = getClaims(userInfo, CLAIMS_PREFIX_RESOURCE_OWNER);\n\n  const familyNamePosition = roClaims.surname_position;\n  const givenName = userInfo.given_name;\n  const familyName = userInfo.family_name;\n\n  const displayName = familyNamePosition === 'F' ? `${familyName} ${givenName}` : `${givenName} ${familyName}`;\n\n  return {\n    personId: roClaims.person_id,\n    byuId: roClaims.byu_id,\n    netId: roClaims.net_id,\n    name: {\n      sortName: roClaims.sort_name,\n      displayName,\n      givenName,\n      familyName,\n      familyNamePosition,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _processTokenInfo(userInfo, accessToken, expiresAt, authHeader) {\n  const clientClaims = getClaims(userInfo, CLAIMS_PREFIX_CLIENT);\n  const wso2Claims = getClaims(userInfo, CLAIMS_PREFIX_WSO2);\n\n  return {\n    bearer: accessToken,\n    authorizationHeader: authHeader,\n    expiresAt,\n    client: {\n      id: wso2Claims.client_id,\n      byuId: clientClaims.byu_id,\n      appName: wso2Claims.applicationname,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _validateAndGetStoredState(storedState, expectedCsrfToken) {\n  const {e: stateExpiresString, c: storedCsrfToken, s: pageState} = storedState;\n\n  if (expectedCsrfToken !== storedCsrfToken) {\n    throw new OAuthError(\n      'oauth-state-mismatch',\n      'Your saved authentication information does not match. Please try again.'\n    );\n  }\n\n  if (Number(stateExpiresString) < Date.now()) {\n    throw new OAuthError(\n      'oauth-state-expired',\n      'Your login attempt has timed out. Please try again.'\n    );\n  }\n\n  return pageState;\n}\n\nfunction _prepareStoredState(expires, csrfToken, pageState) {\n  return {\n    e: expires,\n    c: csrfToken,\n    s: pageState,\n  }\n}\n\nclass OAuthError extends Error {\n  constructor(type, description, uri) {\n    super('OAuth Error: ' + description);\n    this.type = type;\n    this.description = description;\n    this.uri = uri;\n  }\n}\n\nfunction randomString() {\n  let idArray = new Uint32Array(3);\n  const crypto = window.crypto || window.msCrypto;\n  crypto.getRandomValues(idArray);\n\n  return idArray.reduce((str, cur) => str + cur.toString(16), '');\n}\n\n\n","/*\n * Copyright 2018 Brigham Young University\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ImplicitGrantProvider } from \"./provider.mjs\";\n\nexport const DEFAULT_ISSUER = 'https://api.byu.edu';\n\nexport const GLOBAL_CONFIG_KEY = 'byu-oauth-implicit-config';\n\n/**\n * @typedef {} ImplicitConfig\n * @prop {string} clientId\n * @prop {?string} issuer\n * @prop {?string} callbackUrl\n * @prop {?boolean} requireAuthentication\n */\n\n/**\n *\n * @param {ImplicitConfig} cfg\n */\nexport async function configure(cfg) {\n  const globalConfig = window[GLOBAL_CONFIG_KEY];\n\n  const config = Object.assign({\n    issuer: DEFAULT_ISSUER,\n    callbackUrl: `${location.origin}${location.pathname}`,\n    doNotAutoRefreshOnTimeout: false\n  }, globalConfig, cfg);\n\n  if (!config.clientId) {\n    throw new Error('clientId must be specified in config');\n  }\n\n  const provider = new ImplicitGrantProvider(config, window, document);\n\n  return provider.startup();\n}\n"],"names":["EVENT_PREFIX","EVENT_STATE_CHANGE","EVENT_LOGIN_REQUESTED","EVENT_LOGOUT_REQUESTED","EVENT_REFRESH_REQUESTED","EVENT_CURRENT_INFO_REQUESTED","STATE_INDETERMINATE","STATE_UNAUTHENTICATED","STATE_AUTHENTICATED","STATE_AUTHENTICATING","STATE_ERROR","parseHash","hash","Map","subHash","startsWith","substr","keyValues","split","map","it","parse","serialize","decode","decodeURIComponent","encode","encodeURIComponent","pairSplitRegExp","fieldContentRegExp","str","options","TypeError","obj","opt","pairs","dec","i","length","pair","eq_idx","indexOf","key","trim","val","slice","undefined","tryDecode","name","Math","floor","enc","test","value","maxAge","isNaN","Error","domain","path","expires","toUTCString","httpOnly","secure","sameSite","toLowerCase","e","_classCallCheck","instance","Constructor","Object","defineProperty","exports","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","protoProps","staticProps","prototype","storage","CookieStorage","setItem","getItem","removeItem","_cookie2","__esModule","default","_interopRequireDefault","_cookie","prefix","arguments","cookieOptions","assign","cookies","document","cookie","hasOwnProperty","hasStorage","window","String","replace","_CookieStorage","hasCookies","MemoryStorage","_data","_isSupported2","_isSupported","_CookieStorage2","_MemoryStorage2","_MemoryStorage","localStorage","sessionStorage","StorageHandler","saveOAuthState","clientId","state","getKey","JSON","stringify","getOAuthState","result","clearOAuthState","saveSessionState","getSessionKey","getSessionState","stored","clearSessionState","CHILD_IFRAME_ID","STORED_STATE_LIFETIME","IG_STATE_REFRESH_REQUIRED","IG_STATE_AUTO_REFRESH_FAILED","ImplicitGrantProvider","constructor","config","storageHandler","_listeners","store","freeze","authn","user","token","error","_changeState","_dispatchEvent","handleStateChange","source","opener","iframe","parent","getElementById","parentNode","removeChild","_maybeUpdateStoredSession","_checkRefresh","expiresAt","getTime","startup","listen","location","_location","_hashParams","isAuthenticationCallback","href","_handleAuthenticationCallback","err","console","hasStoredSession","_updateStateFromStorage","expirationTimeInMs","expiresInMs","Date","now","fn","_this","startRefresh","doNotAutoRefreshOnTimeout","setTimeout","isCallbackUrl","callbackUrl","hasHash","size","has","shutdown","unlisten","_listenTo","startLogin","startLogout","handleCurrentInfoRequest","_unlistenTo","displayType","log","csrf","randomString","storedState","_prepareStoredState","loginUrl","warn","open","createElement","onload","html","contentWindow","body","innerHTML","_this2","id","src","style","appendChild","redirectUrl","callback","serialized","deserializeSessionState","serializeSessionState","grouped","groupClaimPrefixes","rawUserInfo","smallerUserInfo","ro","CLAIMS_PREFIX_RESOURCE_OWNER","cl","CLAIMS_PREFIX_CLIENT","wso2","CLAIMS_PREFIX_WSO2","o","other","ui","at","bearer","ah","authorizationHeader","ea","groupedUserInfo","userInfo","ungroupClaimPrefixes","_processUserInfo","_processTokenInfo","provider","event","listener","obs","call","detail","bind","addEventListener","removeEventListener","CustomEvent","createEvent","initCustomEvent","dispatchEvent","OAuthError","get","oauthCsrfToken","pageState","_validateAndGetStoredState","accessToken","expiresIn","authHeader","_fetchUserInfo","resp","fetch","method","headers","Headers","mode","status","text","includes","json","CLAIMS_KNOWN_PREFIXES","keys","find","groupKey","group","getClaims","filter","k","reduce","agg","roClaims","familyNamePosition","surname_position","givenName","given_name","familyName","family_name","displayName","personId","person_id","byuId","byu_id","netId","net_id","sortName","sort_name","clientClaims","wso2Claims","client","client_id","appName","applicationname","expectedCsrfToken","stateExpiresString","c","storedCsrfToken","s","Number","csrfToken","type","description","uri","idArray","Uint32Array","crypto","msCrypto","getRandomValues","cur","toString","DEFAULT_ISSUER","GLOBAL_CONFIG_KEY","configure","cfg","globalConfig","issuer","origin","pathname"],"mappings":"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"}