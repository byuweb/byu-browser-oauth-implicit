{"version":3,"file":"implicit-grant.min.js","sources":["../node_modules/@byuweb/browser-oauth/constants.js","../src/implicit-grant.js"],"sourcesContent":["export const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const EVENT_STATE_CHANGE = `${EVENT_PREFIX}-state-changed`;\nexport const EVENT_LOGIN_REQUESTED = `${EVENT_PREFIX}-login-requested`;\nexport const EVENT_LOGOUT_REQUESTED = `${EVENT_PREFIX}-logout-requested`;\nexport const EVENT_REFRESH_REQUESTED = `${EVENT_PREFIX}-refresh-requested`;\nexport const EVENT_CURRENT_INFO_REQUESTED = `${EVENT_PREFIX}-current-info-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n\n","/*\n * Copyright 2018 Brigham Young University\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as authn from '../node_modules/@byuweb/browser-oauth/constants.js';\n\nexport const DEFAULT_ISSUER = 'https://api.byu.edu';\n\nlet config;\nconst observers = {};\nlet store = Object.freeze({ state: authn.STATE_INDETERMINATE });\n\n/*\n * TODOS:\n *  - implement logout\n *  - implement requireAuthentication\n */\n\n/**\n * @typedef {} ImplicitConfig\n * @prop {string} clientId\n * @prop {?string} issuer\n * @prop {?string} callbackUrl\n * @prop {?boolean} requireAuthentication\n */\n\n/**\n * \n * @param {ImplicitConfig} cfg \n */\nexport function configure(cfg) {\n    console.log('config', cfg);\n    if (!cfg) {\n        throw new Error('cfg must be defined');\n    }\n    if (!cfg.clientId) {\n        throw new Error('clientId must be specified');\n    }\n    config = Object.assign({\n        issuer: DEFAULT_ISSUER,\n        callbackUrl: `${location.origin}${location.pathname}`,\n        requireAuthentication: false,\n    }, cfg);\n\n    listen(authn.EVENT_LOGIN_REQUESTED, startLogin);\n    listen(authn.EVENT_LOGOUT_REQUESTED, startLogout);\n    listen(authn.EVENT_REFRESH_REQUESTED, startRefresh);\n    listen(authn.EVENT_CURRENT_INFO_REQUESTED, handleCurrentInfoRequest);\n\n    maybeHandleAuthenticationCallback();\n}\n\nfunction maybeHandleAuthenticationCallback() {\n    if (!isAuthenticationCallback()) {\n        console.log('Not an auth callback');\n        state(authn.STATE_UNAUTHENTICATED);\n        return;\n    }\n    state(authn.STATE_AUTHENTICATING);\n    const params = new URLSearchParams(window.location.hash.substring(1));\n    if (params.has('error')) {\n        const error = {\n            type: params.get('error'),\n            description: params.get('error_description'),\n            uri: params.get('error_uri')\n        };\n        state(\n            authn.STATE_ERROR,\n            null,\n            null,\n            error\n        );\n        return;\n    }\n\n    const csrf = params.get('state');\n\n    window.location.hash = '';\n\n    let pageData;\n    try {\n        pageData = validateCsrfAndGetPageData(csrf);\n    } catch (err) {\n        state(authn.STATE_ERROR, null, null, {\n            type: 'oauth-state-mismatch',\n            description: err.message || err,\n        });\n        return;\n    }\n\n    clearSavedStateFor('s');\n\n    const accessToken = params.get('access_token');\n    const expiresIn = Number(params.get('expires_in'));\n    const authHeader = `Bearer ${accessToken}`;\n    const expiresAt = new Date(Date.now() + (expiresIn * 1000));\n\n    fetch('https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid', {\n        method: 'GET',\n        headers: new Headers({ 'Accept': 'application/json', 'authorization': authHeader }),\n        mode: 'cors',\n    }).then(function (resp) {\n        return resp.json();\n    }).then(function (json) {\n        console.log('got user info', json);\n\n        const roClaims = getClaims(json, CLAIMS_PREFIX_RESOURCE_OWNER);\n        const clientClaims = getClaims(json, CLAIMS_PREFIX_CLIENT);\n        const wso2Claims = getClaims(json, CLAIMS_PREFIX_WSO2);\n\n        console.log('claims', roClaims, clientClaims, wso2Claims);\n\n        const familyNamePosition = roClaims.surname_position;\n        const givenName = json.given_name;\n        const familyName = json.family_name;\n\n        const displayName = familyNamePosition === 'F' ? `${familyName} ${givenName}` : `${givenName} ${familyName}`;\n\n        const user = {\n            personId: roClaims.person_id,\n            byuId: roClaims.byu_id,\n            netId: roClaims.net_id,\n            name: {\n                sortName: roClaims.sort_name,\n                displayName,\n                givenName,\n                familyName,\n                familyNamePosition,\n            },\n            rawUserInfo: json\n        };\n\n        const token = {\n            bearer: accessToken,\n            authorizationHeader: authHeader,\n            expiresAt,\n            client: {\n                id: wso2Claims.client_id,\n                byuId: clientClaims.byu_id,\n                appName: wso2Claims.applicationname,\n            },\n            rawUserInfo: json\n        };\n\n        state(authn.STATE_AUTHENTICATED, token, user);\n    });\n}\n\nconst CLAIMS_PREFIX_RESOURCE_OWNER = 'http://byu.edu/claims/resourceowner_';\nconst CLAIMS_PREFIX_CLIENT = 'http://byu.edu/claims/client_';\nconst CLAIMS_PREFIX_WSO2 = 'http://wso2.org/claims/';\n\nfunction getClaims(userInfo, prefix) {\n    return Object.keys(userInfo).filter(k => k.startsWith(prefix))\n        .reduce((agg, key) => {\n            agg[key.substr(prefix.length)] = userInfo[key];\n            return agg;\n        }, {});\n}\n\nfunction isAuthenticationCallback() {\n    const isCallbackUrl = window.location.href.indexOf(config.callbackUrl) === 0;\n    console.log(window.location.href, config.callbackUrl, window.location.href.indexOf(config.callbackUrl));\n    const hasHash = !!window.location.hash;\n\n    console.log('hasHash', hasHash);\n    if (!isCallbackUrl) {\n        return false;\n    } else if (!hasHash) {\n        return false;\n    }\n    const params = new URLSearchParams(window.location.hash.substring(1));\n    console.log('params', params);\n    if (params.has('access_token') || params.has('error')) {\n        console.log('has params');\n        return true;\n    }\n    return false;\n}\n\nfunction state(state, token, user, error) {\n    store = Object.freeze({ state, token, user, error });\n    dispatch(authn.EVENT_STATE_CHANGE, store);\n}\n\nexport function startLogin() {\n    console.log('startLogin', config);\n\n    const csrf = saveLoginToken(randomString(), {});\n\n    console.log('csrf', csrf);\n\n    const loginUrl = `https://api.byu.edu/authorize?response_type=token&client_id=${config.clientId}&redirect_uri=${encodeURIComponent(config.callbackUrl)}&scope=openid&state=${csrf}`;\n\n    console.log('loginUrl', loginUrl);\n    window.location = loginUrl;\n}\n\nexport function startLogout() {\n    console.log('startLogout');\n\n    window.location = 'http://api.byu.edu/logout?redirect_url=' + config.callbackUrl;\n    //https://api.byu.edu/revoke\n\n    //TODO: WSO2 Identity Server 5.1 allows us to revoke implicit tokens.  Once that's done, we'll need to do this.\n    // const url = `https://api.byu.edu/revoke`;\n\n    // const form = new URLSearchParams();\n    // form.set('token', store.token.bearer);\n    // form.set('client_id', config.clientId);\n    // form.set('token_type_hint', 'access_token');\n\n    // console.log('logout url', url);\n\n    // fetch(url, {\n    //     method: 'POST',\n    //     body: form,\n    //     // headers: {\n    //     //     'Content-Type': 'application/x-www-form-urlencoded'\n    //     // }\n    // }).then(result => {\n    //     console.log('done with logout', result);\n    // });\n}\n\nfunction saveLoginToken(token, pageState) {\n    const name = getStorageName(config.clientId);\n    const value = `${token}.${btoa(JSON.stringify(pageState))}`;\n\n    let type;\n    if (storageAvailable('sessionStorage')) {\n        window.sessionStorage.setItem(name, value);\n        type = TOKEN_STORE_TYPE_SESSION;\n    } else {\n        document.cookie = `${name}=${value};max-age=300`;\n        type = TOKEN_STORE_TYPE_COOKIE;\n    }\n    return type + '.' + token;\n}\n\nfunction getStorageName(clientId) {\n    return `oauth-state-${encodeURIComponent(clientId)}`;\n}\n\nconst TOKEN_STORE_TYPE_SESSION = 's';\nconst TOKEN_STORE_TYPE_COOKIE = 'c';\n\nfunction validateCsrfAndGetPageData(csrf) {\n    const [type, token] = csrf.split('.');\n    const possibleValues = getSavedStateFor(type);\n    \n    if (possibleValues.length === 0) {\n        console.error('No OAuth state has been stored, or it has expired');\n        throw new Error('Your authentication session has expired or something has gone wrong.');\n    } \n    const found = possibleValues.map(v => v.split('.'))\n        .find(([key, data]) => key === token);\n    \n    if (!found) {\n        console.error('Authentication state mismatch - no saved values match CSRF token');\n        throw new Error('Your saved authentication information does not match. Please try again.');\n    }\n\n    const pageData = found[1];\n\n    return JSON.parse(atob(pageData));\n}\n\nfunction getSavedStateFor(type) {\n    const name = getStorageName(config.clientId);\n    switch (type) {\n        case TOKEN_STORE_TYPE_SESSION:\n            return [window.sessionStorage.getItem(name)];\n        case TOKEN_STORE_TYPE_COOKIE:\n            const values = [];\n            (document.cookie || '').split(';').map(c => c.trim()).forEach(cookie => {\n                if (cookie.indexOf(name + '=') === 0) {\n                    values.push(cookie.split('=', 2)[1]);\n                }\n            });\n            return values;\n    }\n}\n\nfunction clearSavedStateFor(type) {\n    const name = getStorageName(config.clientId);\n    switch (type) {\n        case TOKEN_STORE_TYPE_SESSION:\n            window.sessionStorage.removeItem(name);\n            break;\n        case TOKEN_STORE_TYPE_COOKIE:\n            document.cookie = name + '=null;expires=Thu, 01 Jan 1970 00:00:00 GMT';\n            break;\n    }\n}\n\nexport function startRefresh() {\n    startLogin();\n}\n\nexport function handleCurrentInfoRequest({ callback }) {\n    callback(store);\n}\n\nfunction storageAvailable(type) {\n    try {\n        var storage = window[type],\n            x = '__storage_test__';\n        storage.setItem(x, x);\n        storage.removeItem(x);\n        return true;\n    }\n    catch (e) {\n        return e instanceof DOMException && (\n            // everything except Firefox\n            e.code === 22 ||\n            // Firefox\n            e.code === 1014 ||\n            // test name field too, because code might not be present\n            // everything except Firefox\n            e.name === 'QuotaExceededError' ||\n            // Firefox\n            e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&\n            // acknowledge QuotaExceededError only if there's something already stored\n            storage.length !== 0;\n    }\n}\n\nfunction randomString() {\n    let idArray = new Uint32Array(3);\n    const crypto = window.crypto || window.msCrypto;\n    crypto.getRandomValues(idArray);\n\n    return idArray.reduce((str, cur) => str + cur.toString(16), '');\n}\n\nfunction listen(event, listener) {\n    console.log('listening to', event);\n    if (observers.hasOwnProperty(event)) {\n        throw new Error('A listener is already registered for ' + event);\n    }\n    const obs = observers[event] = function (e) { listener(e.detail) };\n    document.addEventListener(event, obs, false);\n}\n\nfunction dispatch(name, detail) {\n    let event;\n    if (typeof window.CustomEvent === 'function') {\n        event = new CustomEvent(name, { detail });\n    } else {\n        event = document.createEvent('CustomEvent');\n        event.initCustomEvent(name, true, false, detail);\n    }\n    document.dispatchEvent(event);\n}\n"],"names":["EVENT_PREFIX","EVENT_STATE_CHANGE","EVENT_LOGIN_REQUESTED","EVENT_LOGOUT_REQUESTED","EVENT_REFRESH_REQUESTED","EVENT_CURRENT_INFO_REQUESTED","STATE_INDETERMINATE","STATE_UNAUTHENTICATED","STATE_AUTHENTICATED","STATE_AUTHENTICATING","STATE_ERROR","DEFAULT_ISSUER","config","observers","store","Object","freeze","state","configure","cfg","console","log","Error","clientId","assign","issuer","callbackUrl","location","origin","pathname","requireAuthentication","listen","authn.EVENT_LOGIN_REQUESTED","startLogin","authn.EVENT_LOGOUT_REQUESTED","startLogout","authn.EVENT_REFRESH_REQUESTED","startRefresh","authn.EVENT_CURRENT_INFO_REQUESTED","handleCurrentInfoRequest","maybeHandleAuthenticationCallback","isAuthenticationCallback","authn.STATE_UNAUTHENTICATED","authn.STATE_AUTHENTICATING","params","URLSearchParams","window","hash","substring","has","error","type","get","description","uri","authn.STATE_ERROR","csrf","pageData","validateCsrfAndGetPageData","err","message","clearSavedStateFor","accessToken","expiresIn","Number","authHeader","expiresAt","Date","now","fetch","method","headers","Headers","Accept","authorization","mode","then","resp","json","roClaims","getClaims","CLAIMS_PREFIX_RESOURCE_OWNER","clientClaims","CLAIMS_PREFIX_CLIENT","wso2Claims","CLAIMS_PREFIX_WSO2","familyNamePosition","surname_position","givenName","given_name","familyName","family_name","displayName","user","personId","person_id","byuId","byu_id","netId","net_id","name","sortName","sort_name","rawUserInfo","token","bearer","authorizationHeader","client","id","client_id","appName","applicationname","authn.STATE_AUTHENTICATED","userInfo","prefix","keys","filter","k","startsWith","reduce","agg","key","substr","length","isCallbackUrl","href","indexOf","hasHash","dispatch","authn.EVENT_STATE_CHANGE","saveLoginToken","randomString","loginUrl","encodeURIComponent","pageState","getStorageName","value","btoa","JSON","stringify","storageAvailable","sessionStorage","setItem","TOKEN_STORE_TYPE_SESSION","document","cookie","TOKEN_STORE_TYPE_COOKIE","split","possibleValues","getSavedStateFor","found","map","v","find","data","parse","atob","getItem","values","c","trim","forEach","push","removeItem","callback","storage","x","e","DOMException","code","idArray","Uint32Array","crypto","msCrypto","getRandomValues","str","cur","toString","event","listener","hasOwnProperty","obs","detail","addEventListener","CustomEvent","createEvent","initCustomEvent","dispatchEvent"],"mappings":"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"}