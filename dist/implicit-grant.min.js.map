{"version":3,"file":"implicit-grant.min.js","sources":["../src/log.js","../node_modules/@byuweb/browser-oauth/constants.js","../src/url.js","../node_modules/cookie/index.js","../node_modules/local-storage-fallback/lib/CookieStorage.js","../node_modules/local-storage-fallback/lib/isSupported.js","../node_modules/local-storage-fallback/lib/MemoryStorage.js","../node_modules/local-storage-fallback/lib/index.js","../src/local-storage.js","../src/provider.js","../src/implicit-grant.js"],"sourcesContent":["const LEVEL_TRACE = { priority: 0, name: \"trace\", run: handleTrace };\nconst LEVEL_DEBUG = { priority: 1, name: \"debug\", run: handleDebug };\nconst LEVEL_INFO = { priority: 10, name: \"info\", run: handleInfo };\nconst LEVEL_ERROR = { priority: 100, name: \"error\", run: handleError };\n\nconst ALL_LEVELS = [LEVEL_TRACE, LEVEL_DEBUG, LEVEL_INFO, LEVEL_ERROR];\nconst DEFAULT_LEVEL = LEVEL_ERROR;\n\nexport function debug(...args) {\n  log(LEVEL_DEBUG, ...args);\n}\n\nexport function info(...args) {\n  log(LEVEL_INFO, ...args);\n}\n\nexport function error(...args) {\n  log(LEVEL_ERROR, ...args);\n}\n\nexport function debugf(format, ...args) {\n  logf(LEVEL_DEBUG, format, ...args);\n}\n\nexport function infof(format, ...args) {\n  logf(LEVEL_INFO, format, ...args);\n}\n\nexport function errorf(format, ...args) {\n  logf(LEVEL_ERROR, format, ...args);\n}\n\nfunction logf(level, format, ...args) {\n  if (!shouldLog(level)) {\n    return;\n  }\n  level.run(\n    `[byu-browser-oauth-implicit] [${level.name}] (${getFormattedTime()}) ${format}`,\n    ...args\n  );\n}\n\nfunction log(level, ...args) {\n  if (!shouldLog(level)) {\n    return;\n  }\n  level.run(\n    \"[byu-browser-oauth-implicit]\",\n    `[${level.name}]`,\n    `(${getFormattedTime()})`,\n    ...args\n  );\n}\n\nfunction getFormattedTime() {\n  const now = new Date();\n  const h24 = String(now.getHours()).padStart(2, '0');\n  const min = String(now.getMinutes()).padStart(2, '0');\n  const sec = String(now.getSeconds()).padStart(2, '0');\n  const millis = String(now.getMilliseconds()).padStart(3, '0');\n\n  return `${h24}:${min}:${sec},${millis}${formatTimezone(now)}`;\n}\n\nfunction formatTimezone(date) {\n  const offset = date.getTimezoneOffset();\n  if (offset === 0) {\n    return 'Z';\n  }\n  const nonNegative = offset >= 0;\n  const absOffset = Math.abs(offset);\n\n  // Positive whole offset hours\n  const hourInt = Math.floor(absOffset / 60);\n  const hourDone = String(hourInt).padStart(2, '0')\n  const sign = (nonNegative ? '+' : '-');\n  const minDone = String(absOffset % 60).padStart(2, '0');\n\n  return `${sign}${hourDone}${minDone}`;\n}\n\nfunction shouldLog(level) {\n  return level.priority >= currentLevel().priority;\n}\n\nfunction currentLevel() {\n  const name = levelAttr() || levelGlobalVar();\n  if (!name) {\n    return DEFAULT_LEVEL;\n  }\n  const lower = name.toLowerCase();\n  return (\n    ALL_LEVELS.find(function(l) {\n      return l.name === lower;\n    }) || DEFAULT_LEVEL\n  );\n}\n\nfunction levelAttr() {\n  return document.documentElement.getAttribute(\"byu-oauth-logging\");\n}\n\nfunction levelGlobalVar() {\n  const o = window.byuOAuth || {};\n  return o.logging;\n}\n\nfunction handleTrace(...args) {\n  if (console.trace) {\n    console.trace(...args);\n  } else {\n    console.log(...args);\n  }\n}\n\nfunction handleDebug(...args) {\n  console.log(...args);\n}\n\nfunction handleInfo(...args) {\n  if (console.info) {\n    console.info(...args);\n  } else {\n    console.log(...args);\n  }\n}\n\nfunction handleError(...args) {\n  if (console.error) {\n    console.error(...args);\n  } else {\n    console.log(...args);\n  }\n}\n","export const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const EVENT_STATE_CHANGE = `${EVENT_PREFIX}-state-changed`;\nexport const EVENT_LOGIN_REQUESTED = `${EVENT_PREFIX}-login-requested`;\nexport const EVENT_LOGOUT_REQUESTED = `${EVENT_PREFIX}-logout-requested`;\nexport const EVENT_REFRESH_REQUESTED = `${EVENT_PREFIX}-refresh-requested`;\nexport const EVENT_CURRENT_INFO_REQUESTED = `${EVENT_PREFIX}-current-info-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport {debug} from './log.js';\n\nexport function parseHash(hash) {\n  debug('parsing hash', hash);\n  if (!hash) return new Map();\n  let subHash = hash;\n  if (hash.startsWith('#')) {\n    subHash = hash.substr(1);\n  }\n\n  const keyValues = subHash.split('&')\n    .map(it => it.split('=', 2));\n  return new Map(keyValues);\n}\n\n","/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(pairSplitRegExp);\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var eq_idx = pair.indexOf('=');\n\n    // skip things that don't look like key=value\n    if (eq_idx < 0) {\n      continue;\n    }\n\n    var key = pair.substr(0, eq_idx).trim()\n    var val = pair.substr(++eq_idx, pair.length).trim();\n\n    // quoted values\n    if ('\"' == val[0]) {\n      val = val.slice(1, -1);\n    }\n\n    // only assign once\n    if (undefined == obj[key]) {\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n    if (isNaN(maxAge)) throw new Error('maxAge should be a Number');\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.hasCookies = hasCookies;\n\nvar _cookie = require('cookie');\n\nvar _cookie2 = _interopRequireDefault(_cookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar prefix = 'lS_';\n\nvar CookieStorage = function () {\n  function CookieStorage() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CookieStorage);\n\n    this.cookieOptions = Object.assign({ path: '/' }, options);\n    prefix = options.prefix === undefined ? prefix : options.prefix;\n  }\n\n  _createClass(CookieStorage, [{\n    key: 'getItem',\n    value: function getItem(key) {\n      var cookies = _cookie2.default.parse(document.cookie);\n      if (!cookies || !cookies.hasOwnProperty(prefix + key)) {\n        return null;\n      }\n      return cookies[prefix + key];\n    }\n  }, {\n    key: 'setItem',\n    value: function setItem(key, value) {\n      document.cookie = _cookie2.default.serialize(prefix + key, value, this.cookieOptions);\n      return value;\n    }\n  }, {\n    key: 'removeItem',\n    value: function removeItem(key) {\n      var options = Object.assign({}, this.cookieOptions, { maxAge: -1 });\n      document.cookie = _cookie2.default.serialize(prefix + key, '', options);\n      return null;\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      var cookies = _cookie2.default.parse(document.cookie);\n      for (var key in cookies) {\n        if (key.indexOf(prefix) === 0) {\n          this.removeItem(key.substr(prefix.length));\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return CookieStorage;\n}();\n\nexports.default = CookieStorage;\nfunction hasCookies() {\n  var storage = new CookieStorage();\n\n  try {\n    var TEST_KEY = '__test';\n    storage.setItem(TEST_KEY, '1');\n    var value = storage.getItem(TEST_KEY);\n    storage.removeItem(TEST_KEY);\n\n    return value === '1';\n  } catch (e) {\n    return false;\n  }\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = isSupported;\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar TEST_KEY = '__test';\n\nfunction hasStorage(name) {\n  try {\n    var storage = window[name];\n    storage.setItem(TEST_KEY, '1');\n    storage.removeItem(TEST_KEY);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction isSupported() {\n  var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'localStorage';\n\n  var storage = String(name).replace(/storage$/i, '').toLowerCase();\n\n  if (storage === 'local') {\n    return hasStorage('localStorage');\n  }\n\n  if (storage === 'session') {\n    return hasStorage('sessionStorage');\n  }\n\n  if (storage === 'cookie') {\n    return (0, _CookieStorage.hasCookies)();\n  }\n\n  if (storage === 'memory') {\n    return true;\n  }\n\n  throw new Error('Storage method `' + name + '` is not available.\\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.');\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MemoryStorage = function () {\n  function MemoryStorage() {\n    _classCallCheck(this, MemoryStorage);\n\n    this._data = {};\n  }\n\n  _createClass(MemoryStorage, [{\n    key: \"getItem\",\n    value: function getItem(key) {\n      return this._data.hasOwnProperty(key) ? this._data[key] : null;\n    }\n  }, {\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      return this._data[key] = String(value);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(key) {\n      return delete this._data[key];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      return this._data = {};\n    }\n  }]);\n\n  return MemoryStorage;\n}();\n\nexports.default = MemoryStorage;","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MemoryStorage = exports.CookieStorage = exports.isSupported = exports.storage = undefined;\n\nvar _isSupported = require('./isSupported');\n\nvar _isSupported2 = _interopRequireDefault(_isSupported);\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar _CookieStorage2 = _interopRequireDefault(_CookieStorage);\n\nvar _MemoryStorage = require('./MemoryStorage');\n\nvar _MemoryStorage2 = _interopRequireDefault(_MemoryStorage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar storage = null;\n\nif ((0, _isSupported2.default)('localStorage')) {\n  // use localStorage\n  exports.storage = storage = window.localStorage;\n} else if ((0, _isSupported2.default)('sessionStorage')) {\n  // use sessionStorage\n  exports.storage = storage = window.sessionStorage;\n} else if ((0, _isSupported2.default)('cookieStorage')) {\n  // use cookies\n  exports.storage = storage = new _CookieStorage2.default();\n} else {\n  // use memory\n  exports.storage = storage = new _MemoryStorage2.default();\n}\n\nexports.default = storage;\nexports.storage = storage;\nexports.isSupported = _isSupported2.default;\nexports.CookieStorage = _CookieStorage2.default;\nexports.MemoryStorage = _MemoryStorage2.default;","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport storage from 'local-storage-fallback';\n// During initial page load, Firefox \"LocalStorage\" is wonky if in Private Browsing.\n// Fortunately, the \"OAuth State\" data is tiny (one date and one 16-character string),\n// so it won't hit any Cookie size limitations.\n// With those factors in mind, we intentionally downgrade to Cookie storage for initial OAuth data storage\nimport { CookieStorage } from 'local-storage-fallback';\n\nconst cookie = new CookieStorage();\n\nexport class StorageHandler {\n\n  saveOAuthState(clientId, state) {\n    cookie.setItem(getKey(clientId), JSON.stringify(state));\n  }\n\n  getOAuthState(clientId) {\n    const result = cookie.getItem(getKey(clientId));\n    if (!result) {\n      return null;\n    }\n    return JSON.parse(result);\n  }\n\n  clearOAuthState(clientId) {\n    cookie.removeItem(getKey(clientId));\n  }\n\n  saveSessionState(clientId, state) {\n    storage.setItem(getSessionKey(clientId), JSON.stringify(state));\n  }\n\n  getSessionState(clientId) {\n    const key = getSessionKey(clientId);\n    const stored = storage.getItem(key);\n    if (!stored) {\n      return null;\n    }\n    return JSON.parse(stored);\n  }\n\n  clearSessionState(clientId) {\n    storage.removeItem(getSessionKey(clientId));\n  }\n}\n\nfunction getKey(clientId) {\n  return 'oauth-state-' + encodeURIComponent(clientId);\n}\n\nfunction getSessionKey(clientId) {\n  return getKey(clientId) + '-active-session';\n}\n\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\"use strict\";\n\nimport * as log from './log.js';\nimport * as authn from '../node_modules/@byuweb/browser-oauth/constants.js';\nimport {parseHash} from './url.js';\nimport {StorageHandler} from \"./local-storage.js\";\n\nlet SINGLETON_INSTANCE;\n\nconst CHILD_IFRAME_ID = 'byu-oauth-implicit-grant-refresh-iframe'\nconst FIFTY_FIVE_MINUTES_MILLIS = 3300000;\nconst STORED_STATE_LIFETIME = 5 * 60 * 1000; // 5 minutes\nexport const IG_STATE_AUTO_REFRESH_FAILED = 'implicit-grant-auto-refresh-failed'\n\nexport class ImplicitGrantProvider {\n  constructor(config, window, document, storageHandler = new StorageHandler()) {\n    log.debug('initializing provider with config', config);\n    this.config = config;\n    this.window = window;\n    this.document = document;\n    this.storageHandler = storageHandler;\n    this._listeners = {};\n\n    this.store = Object.freeze({\n      state: authn.STATE_INDETERMINATE,\n      user: null,\n      token: null,\n      error: null\n    });\n    log.debug('initialized provider');\n  }\n\n  _changeState(state, user, token, error) {\n    logStateChange(state, user, token, error);\n    this.store = Object.freeze({\n      state, user, token, error\n    });\n    _dispatchEvent(this, authn.EVENT_STATE_CHANGE, this.store);\n  }\n\n  _checkPopupOpener() {\n    try {\n      const origin = this.window.opener.location.origin\n      if (origin === (new URL(this.config.callbackUrl)).origin) { // Origins match\n        return this.window.opener\n      }\n    } catch (e) {\n      // Failed to get window.opener.location.origin, so we must have been opened\n      // from a different origin.\n      // Fall through to the \"return false\" outside this try/catch block\n    }\n    return false\n  }\n\n  _checkIframeOpener() {\n    try {\n      const iframe = this.window.parent.document.getElementById(CHILD_IFRAME_ID)\n      if (iframe && iframe.contentWindow === this.window) {\n        return iframe\n      }\n    } catch (e) {\n      // Failed to access window.parent info, so we must be in an iframe from a different\n      // origin.\n      // Fall through to the \"return false\" outside this try/catch block\n    }\n    return false\n  }\n\n  // Separate state change listener, because state change events\n  // might come from child iframe/popup window\n  handleStateChange({ state, user, token, source }) {\n    log.debug('in handleStateChange', state);\n\n    const opener = this._checkPopupOpener()\n    // If this is a popup\n    if (opener) {\n      // We're inside a child re-authentication popup\n\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(opener, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'popup' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('closing self');\n        this.window.close()\n      }\n\n      return\n    }\n\n    const iframe = this._checkIframeOpener()\n    // If we're inside a \"refresh\" iframe\n    if (iframe) {\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(this.window.parent, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'iframe' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('removing child iframe');\n        iframe.parentNode.removeChild(iframe)\n      }\n\n      return\n    }\n\n    this._maybeUpdateStoredSession(state, user, token);\n\n    if (state === authn.STATE_AUTHENTICATED) {\n      this._checkExpired(token.expiresAt.getTime())\n    }\n  }\n\n  async startup() {\n    ensureOnlyInstance(this);\n    log.info('starting up');\n    this.listen();\n    this._changeState(authn.STATE_INDETERMINATE);\n\n    const location = this._location;\n    const hash = this._hashParams;\n\n    if (this.isAuthenticationCallback(location.href, hash)) {\n      log.debug('handling authentication callback');\n      this._changeState(authn.STATE_AUTHENTICATING);\n      try {\n        const {state, user, token, error} = await _handleAuthenticationCallback(\n          this.config,\n          location,\n          hash,\n          this.storageHandler\n        );\n        this._changeState(state, user, token, error);\n      } catch (err) {\n        log.error('OAuth Error', err);\n        this._changeState(authn.STATE_ERROR, undefined, undefined, err);\n      }\n    } else if (this.hasStoredSession()) {\n      log.debug('Has stored session');\n      this._updateStateFromStorage();\n    } else {\n      log.debug('no authentication present');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n    return this;\n  }\n\n  _checkExpired(expirationTimeInMs) {\n    log.debug('checking expiration time');\n\n    const expiresInMs = expirationTimeInMs - Date.now()\n\n    const definitelyExpired = expiresInMs < 0;\n    // In certain cases, WSO2 can send us a token whose expiration is ACTUALLY 55 minutes (60 minutes minus the 5-minute grace period) ðŸ¤¦.\n    // So, if we see a longer-than-55-minute expiration, we may try to silently auto-refresh the token so we can get an accurate expiration.\n    // BUT there's yet another bug in WSO2 where sometimes the authentication response *always* says the expiration is 60 minutes away,\n    // even if it's less than 60 minutes away. So we only do this \"maybeFunkyExpiration\" *once* per token initialization\n    const maybeFunkyExpiration = expiresInMs > FIFTY_FIVE_MINUTES_MILLIS && !this._alreadyDidFunkyCheck;\n\n    // *After* the \"maybeFunky\" check, update _alreadyDidFunkyCheck based on whether the current token is expired\n    this._alreadyDidFunkyCheck = !definitelyExpired;\n\n    if (!definitelyExpired && !maybeFunkyExpiration) {\n      this._scheduleExpirationCheck(expirationTimeInMs);\n      return;\n    }\n\n    if (this.config.autoRefreshOnTimeout) {\n      // If we've expired OR if the WSO2 five-minute grace period was not added, mark the state as refreshing.\n      // Schedule a refresh in an extra 5 seconds to avoid WSO2 clock skew problems.\n      // Existing token *should* have a five-minute grace period after expiration:\n      // a new request will generate a new token, but the old token should still\n      // work during that grace period, so we keep the user and token objects around.\n      if (maybeFunkyExpiration) {\n        log.debug('silently refreshing token to work around odd identity server issue');\n      }\n      this._changeState(authn.STATE_REFRESHING, this.store.user, this.store.token);\n      this._scheduleRefresh();\n    } else if (definitelyExpired) {\n      // We don't have auto-refresh enabled, so flag the token as expired and let the application handle it.\n      this._changeState(authn.STATE_EXPIRED, this.store.user, this.store.token);\n    }\n  }\n\n  _scheduleRefresh() {\n    log.info('scheduling auto-refresh');\n    if (this.__refreshTask) {\n      log.debug('refresh already scheduled');\n      return;\n    }\n    // Wait a few seconds before triggering the actual refresh, allowing for clock\n    // skew with WSO2\n    return this.__refreshTask = setTimeout(() =>  {\n      this.__refreshTask = null;\n      this.startRefresh('iframe')\n    }, 5000);\n  }\n\n  _scheduleExpirationCheck(expirationTimeInMs) {\n    if (this.__expirationTask) {\n      clearTimeout(this.__expirationTask);\n    }\n    // Simply using setTimeout for an hour in the future\n    // doesn't work; setTimeout isn't that precise over that long of a period.\n    // So re-check every five seconds until we're past the expiration time\n    return this.__expirationTask = setTimeout(() =>  {\n      this.__expirationTask = null;\n      this._checkExpired(expirationTimeInMs);\n    }, 5000);\n  }\n\n  get _location() {\n    return this.window.location;\n  }\n\n  get _hashParams() {\n    return parseHash(this._location.hash);\n  }\n\n  isAuthenticationCallback(href, hash) {\n    const isCallbackUrl = href.indexOf(this.config.callbackUrl) === 0;\n    const hasHash = hash.size !== 0;\n\n    if (!isCallbackUrl || !hasHash) {\n      return false;\n    }\n\n    return hash.has('access_token') || hash.has('error');\n  }\n\n  hasStoredSession() {\n    return !!this.storageHandler.getSessionState(this.config.clientId);\n  }\n\n  shutdown() {\n    log.info('shutting down');\n    this.unlisten();\n    this._changeState(authn.STATE_INDETERMINATE);\n    cleanupOnlyInstance(this);\n  }\n\n  listen() {\n    log.debug('setting up event listeners');\n    _listenTo(this, authn.EVENT_LOGIN_REQUESTED, this.startLogin);\n    _listenTo(this, authn.EVENT_LOGOUT_REQUESTED, this.startLogout);\n    _listenTo(this, authn.EVENT_REFRESH_REQUESTED, this.startRefresh);\n    _listenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED, this.handleCurrentInfoRequest);\n    _listenTo(this, authn.EVENT_STATE_CHANGE, this.handleStateChange);\n  }\n\n  unlisten() {\n    log.debug('tearing down event listeners');\n    _unlistenTo(this, authn.EVENT_LOGIN_REQUESTED);\n    _unlistenTo(this, authn.EVENT_LOGOUT_REQUESTED);\n    _unlistenTo(this, authn.EVENT_REFRESH_REQUESTED);\n    _unlistenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED);\n    _unlistenTo(this, authn.EVENT_STATE_CHANGE);\n  }\n\n  startLogin(displayType = 'window') {\n    log.infof('Starting login. mode=%s', displayType);\n    const {clientId, callbackUrl} = this.config;\n    const csrf = randomString();\n\n    const storedState = _prepareStoredState(Date.now() + STORED_STATE_LIFETIME, csrf, {});\n    this.storageHandler.saveOAuthState(this.config.clientId, storedState);\n\n    const loginUrl = `https://api.byu.edu/authorize?response_type=token&client_id=${clientId}&redirect_uri=${encodeURIComponent(callbackUrl)}&scope=openid&state=${csrf}`;\n    log.debug('computed login url of', loginUrl);\n\n    if (!displayType || displayType == 'window') {\n      log.info(`Redirecting user to '${loginUrl}'`);\n      this.window.location = loginUrl;\n      return\n    } else if (displayType === 'popup') {\n      log.info('launching popup at', loginUrl);\n      this.window.open(loginUrl)\n      return\n    }\n\n    log.info('Setting up hidden refresh iframe at', loginUrl);\n    // last option: displayType == 'iframe'\n    let iframe = this.document.getElementById(CHILD_IFRAME_ID)\n    if (iframe) {\n      iframe.parentNode.removeChild(iframe)\n    }\n    iframe = this.document.createElement('iframe')\n    iframe.onload = () => {\n      let html = null\n      try {\n        html = iframe.contentWindow.document.body.innerHTML\n      } catch (err) {\n        // intentional do-nothing\n      }\n      if (html === null) {\n        // Hidden-frame refresh failed. Remove frame and\n        // report problem\n        iframe.parentNode.removeChild(iframe)\n        this._changeState(IG_STATE_AUTO_REFRESH_FAILED, null, null)\n      }\n    }\n    iframe.id = CHILD_IFRAME_ID\n    iframe.src = loginUrl\n    iframe.style = 'display:none'\n    log.debug('appending iframe', iframe);\n    this.document.body.appendChild(iframe);\n  }\n\n  startLogout() {\n    log.info('starting logout');\n    this.storageHandler.clearSessionState(this.config.clientId);\n    // Need to ensure BOTH api.byu.edu and cas.byu.edu clean out their sessions\n    // With current config of those two sites, to have that full clean out AND a final \"where to go after logout\"\n    // redirect, we need to manually wrap them all together\n    const logoutRedirect = (this.config.logoutRedirect === undefined) ? this.config.callbackUrl : this.config.logoutRedirect\n    const casLogoutUrl = 'https://cas.byu.edu/cas/logout?service=' + encodeURIComponent(logoutRedirect)\n    const logoutUrl = 'https://api.byu.edu/logout?redirect_url=' + encodeURIComponent(casLogoutUrl);\n    log.info('logging out by redirecting to', logoutUrl);\n    this.window.location = logoutUrl;\n\n    //TODO: WSO2 Identity Server 5.1 allows us to revoke implicit tokens.  Once that's done, we'll need to do this.\n    // const url = `https://api.byu.edu/revoke`;\n\n    // const form = new URLSearchParams();\n    // form.set('token', store.token.bearer);\n    // form.set('client_id', config.clientId);\n    // form.set('token_type_hint', 'access_token');\n\n    // console.log('logout url', url);\n\n    // fetch(url, {\n    //     method: 'POST',\n    //     body: form,\n    //     // headers: {\n    //     //     'Content-Type': 'application/x-www-form-urlencoded'\n    //     // }\n    // }).then(result => {\n    //     console.log('done with logout', result);\n    // });\n  }\n\n  startRefresh(displayType = 'iframe') {\n    log.infof('starting refresh. displayType=%s', displayType);\n    this.startLogin(displayType);\n  }\n\n  handleCurrentInfoRequest({callback}) {\n    log.debug('got current info request');\n    if (callback) {\n      callback(this.store);\n    }\n  }\n\n  _updateStateFromStorage() {\n    log.debug('updating state from local storage');\n    const serialized = this.storageHandler.getSessionState(this.config.clientId);\n    if (!serialized) {\n      log.debug('no stored state');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n      return;\n    }\n    const {user, token} = deserializeSessionState(serialized);\n    if (!user || !token) {\n      log.debug('no stored user or token');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    } else if (token.expiresAt > new Date()) {\n      log.debug('found an unexpired saved session');\n      this._changeState(authn.STATE_AUTHENTICATED, user, token);\n    } else {\n      log.debug('stored session was expired');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n  }\n\n  _maybeUpdateStoredSession(state, user, token) {\n    log.debugf('updating stored session: state=%s hasUser=%s, hasToken=%s', state, !!user, !!token);\n    if (state === authn.STATE_UNAUTHENTICATED || state === authn.STATE_REFRESHING || state === authn.STATE_EXPIRED) {\n      log.debug('state is unauthenticated or expired, clearing stored session');\n      this.storageHandler.clearSessionState(this.config.clientId);\n    } else if (!!user && !!token) {\n      log.debug('storing session', redactUser(user), redactToken(token));\n      const serialized = serializeSessionState(user, token);\n      this.storageHandler.saveSessionState(this.config.clientId, serialized);\n    }\n  }\n}\n\nfunction serializeSessionState(user, token) {\n  const grouped = groupClaimPrefixes(token.rawUserInfo);\n\n  const smallerUserInfo = {\n    ro: grouped[CLAIMS_PREFIX_RESOURCE_OWNER],\n    cl: grouped[CLAIMS_PREFIX_CLIENT],\n    wso2: grouped[CLAIMS_PREFIX_WSO2],\n    o: grouped.other,\n  };\n\n  return {\n    ui: smallerUserInfo,\n    at: token.bearer,\n    ah: token.authorizationHeader,\n    ea: token.expiresAt.getTime()\n  };\n}\n\nfunction deserializeSessionState(state) {\n  const groupedUserInfo = {\n    [CLAIMS_PREFIX_RESOURCE_OWNER]: state.ui.ro,\n    [CLAIMS_PREFIX_CLIENT]: state.ui.cl,\n    [CLAIMS_PREFIX_WSO2]: state.ui.wso2,\n    other: state.ui.o,\n  }\n  const userInfo = ungroupClaimPrefixes(groupedUserInfo);\n\n  const user = _processUserInfo(userInfo);\n  const expiresAt = new Date(state.ea);\n  const token = _processTokenInfo(userInfo, state.at, expiresAt, `Bearer ${state.at}`);\n  return {user, token};\n}\n\nfunction _listenTo(provider, event, listener) {\n  if (provider._listeners.hasOwnProperty(event)) {\n    throw new Error('A listener is already registered for ' + event);\n  }\n  const obs = provider._listeners[event] = function (e) {\n    listener.call(provider, e.detail);\n  }.bind(provider);\n\n  provider.document.addEventListener(event, obs, false);\n}\n\nfunction _unlistenTo(provider, event) {\n  if (!provider._listeners.hasOwnProperty(event)) {\n    return;\n  }\n\n  provider.document.removeEventListener(event, provider._listeners[event], false);\n  delete provider._listeners[event];\n}\n\n\nfunction _dispatchEvent(provider, name, detail) {\n  let event;\n  if (typeof provider.window.CustomEvent === 'function') {\n    event = new CustomEvent(name, {detail});\n  } else {\n    event = provider.document.createEvent('CustomEvent');\n    event.initCustomEvent(name, true, false, detail);\n  }\n  provider.document.dispatchEvent(event);\n}\n\nasync function _handleAuthenticationCallback(config, location, hash, storage) {\n  if (hash.has('error')) {\n    log.error('Got oauth error in URL hash');\n    throw new OAuthError(\n      hash.get('error'),\n      hash.get('error_description'),\n      hash.get('error_uri'),\n    );\n  }\n\n  const oauthCsrfToken = hash.get('state');\n  const storedState = storage.getOAuthState(config.clientId);\n\n  storage.clearOAuthState(config.clientId);\n\n  log.debug('checking oauth state token');\n  const pageState = _validateAndGetStoredState(storedState, oauthCsrfToken);\n\n  const accessToken = hash.get('access_token');\n  const expiresIn = Number(hash.get('expires_in'));\n  const expiresAt = new Date(Date.now() + (expiresIn * 1000));\n  const authHeader = `Bearer ${accessToken}`;\n  log.debug('got token', redactBearerToken(accessToken), 'which expires in', expiresIn, 'seconds');\n\n  const userInfo = await _fetchUserInfo(authHeader);\n\n  const user = _processUserInfo(userInfo);\n  const token = _processTokenInfo(userInfo, accessToken, expiresAt, authHeader);\n\n  location.hash = '';\n\n  return {state: authn.STATE_AUTHENTICATED, user, token};\n}\n\nconst USER_INFO_URL = 'https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid';\n\nasync function _fetchUserInfo(authHeader) {\n  log.debug('fetching user info from', USER_INFO_URL);\n  const resp = await fetch(USER_INFO_URL, {\n    method: 'GET',\n    headers: new Headers({'Accept': 'application/json', 'Authorization': authHeader}),\n    mode: 'cors',\n  });\n\n  log.debug('got status', resp.status);\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    if (resp.status === 403) {\n      log.debug('got forbidden error');\n      if (body.includes('<ams:code>900908</ams:code>')) {\n        log.debug('client app isn\\'t subscribed to OpenID UserInfo endpoint');\n        log.error(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`);\n        throw new OAuthError(\n          'not-subscribed-to-user-info',\n          'This page has an authentication configuration error. Developers, see the console for details.'\n        );\n      } else {\n        log.error('invalid oauth bearer token');\n        throw new OAuthError(\n          'invalid-oauth-token',\n          'The provided authentication token is invalid. Please try again.'\n        );\n      }\n    }\n    log.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-get-user-info',\n      'Unable to fetch user information. Please try again.'\n    );\n  }\n  const json = await resp.json();\n  log.debug('successfully got user info', json);\n  return json;\n}\n\nconst CLAIMS_PREFIX_RESOURCE_OWNER = 'http://byu.edu/claims/resourceowner_';\nconst CLAIMS_PREFIX_CLIENT = 'http://byu.edu/claims/client_';\nconst CLAIMS_PREFIX_WSO2 = 'http://wso2.org/claims/';\n\nconst CLAIMS_KNOWN_PREFIXES = [CLAIMS_PREFIX_CLIENT, CLAIMS_PREFIX_RESOURCE_OWNER, CLAIMS_PREFIX_WSO2];\n\nfunction groupClaimPrefixes(userInfo) {\n  const grouped = {\n    other: {}\n  };\n  for (const prefix of CLAIMS_KNOWN_PREFIXES) {\n    grouped[prefix] = {};\n  }\n  for (const key of Object.keys(userInfo)) {\n    const value = userInfo[key];\n    const prefix = CLAIMS_KNOWN_PREFIXES.find(it => key.startsWith(it));\n    if (prefix) {\n        grouped[prefix][key.substr(prefix.length)] = value;\n    } else {\n      grouped.other[key] = value;\n    }\n  }\n  return grouped;\n}\n\nfunction ungroupClaimPrefixes(grouped) {\n  const result = {};\n  for (const groupKey of CLAIMS_KNOWN_PREFIXES) {\n    const group = grouped[groupKey];\n    if (!group) continue;\n    for (const key of Object.keys(group)) {\n      result[groupKey + key] = group[key];\n    }\n  }\n  for (const other of Object.keys(grouped.other)) {\n    result[other] = grouped.other[other];\n  }\n  return result;\n}\n\nfunction getClaims(userInfo, prefix) {\n  return Object.keys(userInfo).filter(k => k.startsWith(prefix))\n    .reduce((agg, key) => {\n      agg[key.substr(prefix.length)] = userInfo[key];\n      return agg;\n    }, {});\n}\n\nfunction _processUserInfo(userInfo) {\n  const roClaims = getClaims(userInfo, CLAIMS_PREFIX_RESOURCE_OWNER);\n\n  const familyNamePosition = roClaims.surname_position;\n  const givenName = roClaims.preferred_first_name;\n  const familyName = roClaims.surname;\n\n  const displayName = familyNamePosition === 'F' ? `${familyName} ${givenName}` : `${givenName} ${familyName}`;\n\n  return {\n    personId: roClaims.person_id,\n    byuId: roClaims.byu_id,\n    netId: roClaims.net_id,\n    name: {\n      sortName: roClaims.sort_name,\n      displayName,\n      givenName,\n      familyName,\n      familyNamePosition,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _processTokenInfo(userInfo, accessToken, expiresAt, authHeader) {\n  const clientClaims = getClaims(userInfo, CLAIMS_PREFIX_CLIENT);\n  const wso2Claims = getClaims(userInfo, CLAIMS_PREFIX_WSO2);\n\n  return {\n    bearer: accessToken,\n    authorizationHeader: authHeader,\n    expiresAt,\n    client: {\n      id: wso2Claims.client_id,\n      byuId: clientClaims.byu_id,\n      appName: wso2Claims.applicationname,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _validateAndGetStoredState(storedState, expectedCsrfToken) {\n  log.debug('validating stored state token. Expecting token', expectedCsrfToken, ', got state', storedState);\n  if (!storedState) {\n    log.error('no stored oauth login state');\n    throw new OAuthError('no-oauth-state', 'Your saved authentication information does not match. Please try again.');\n  }\n  const {e: stateExpiresString, c: storedCsrfToken, s: pageState} = storedState;\n\n  if (expectedCsrfToken !== storedCsrfToken) {\n    log.error('CSRF token mismatch')\n    throw new OAuthError(\n      'oauth-state-mismatch',\n      'Your saved authentication information does not match. Please try again.'\n    );\n  }\n\n  if (Number(stateExpiresString) < Date.now()) {\n    log.error('stored state has expired');\n    throw new OAuthError(\n      'oauth-state-expired',\n      'Your login attempt has timed out. Please try again.'\n    );\n  }\n\n  return pageState;\n}\n\nfunction _prepareStoredState(expires, csrfToken, pageState) {\n  return {\n    e: expires,\n    c: csrfToken,\n    s: pageState,\n  }\n}\n\nclass OAuthError extends Error {\n  constructor(type, description, uri) {\n    super('OAuth Error: ' + description);\n    this.type = type;\n    this.description = description;\n    this.uri = uri;\n  }\n}\n\nfunction randomString() {\n  let idArray = new Uint32Array(3);\n  const crypto = window.crypto || window.msCrypto;\n  crypto.getRandomValues(idArray);\n\n  return idArray.reduce((str, cur) => str + cur.toString(16), '');\n}\n\nfunction logStateChange(state, user, token, error) {\n  const logParts = [\n    'state change:',\n    {\n      state,\n      user: redactUser(user),\n      token: token, //redactToken(token),\n      error: error\n    }\n  ];\n  if (error) {\n    log.error(...logParts);\n  } else {\n    log.info(...logParts);\n  }\n}\n\nfunction redactUser(u) {\n  if (!u) return undefined;\n  return {\n    netId: u.netId,\n    'rest-is-redacted': true\n  };\n}\n\nfunction redactToken(t) {\n  log.debug('redacting token', t);\n  if (!t) return undefined;\n  const {bearer, expiresAt, client} = t;\n  return {\n    bearer: redactBearerToken(bearer),\n    expiresAt: !!expiresAt ? expiresAt.toISOString() : null,\n    client,\n    'rest-is-redacted': true\n  }\n}\nfunction redactBearerToken(b) {\n  if (!b) return undefined;\n  return b.substring(0, 2) + '...redacted...' + b.substring(b.length - 2)\n}\n\nfunction ensureOnlyInstance(obj) {\n  if (SINGLETON_INSTANCE) {\n    const trace = SINGLETON_INSTANCE.___startupTrace;\n    throw new Error('There is already an instance of byu-oauth-implicit running!  Please call `#shutdown()` on that instance before starting a new one. Instance was started at:\\n' + trace);\n  }\n  obj.___startupTrace = new Error().stack;\n  SINGLETON_INSTANCE = obj;\n}\n\nfunction cleanupOnlyInstance(obj) {\n  SINGLETON_INSTANCE = null;\n}\n\nexport function __forceShutdown() {\n  if (SINGLETON_INSTANCE) {\n    SINGLETON_INSTANCE.shutdown();\n    cleanupOnlyInstance(SINGLETON_INSTANCE);\n  }\n}\n","/*\n * Copyright 2018 Brigham Young University\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ImplicitGrantProvider } from \"./provider.js\";\n\nexport const DEFAULT_ISSUER = 'https://api.byu.edu';\n\nexport const GLOBAL_CONFIG_KEY = 'byu-oauth-implicit-config';\n\n/**\n * @typedef {} ImplicitConfig\n * @prop {string} clientId\n * @prop {?string} issuer\n * @prop {?string} callbackUrl\n * @prop {?boolean} requireAuthentication\n */\n\n/**\n * @param {ImplicitConfig|ImplicitConfig[]|undefined} cfgOrRules\n * @param location\n */\nexport async function configure(cfgOrRules, location = window.location) {\n  const cfg = resolveConfig(cfgOrRules, location);\n  const globalConfig = window[GLOBAL_CONFIG_KEY];\n\n  const config = Object.assign({\n    issuer: DEFAULT_ISSUER,\n    callbackUrl: `${location.origin}${location.pathname}`,\n    autoRefreshOnTimeout: false\n  }, globalConfig, cfg);\n\n  if (!config.clientId) {\n    throw new Error('clientId must be specified in config');\n  }\n\n  const provider = new ImplicitGrantProvider(config, window, document);\n\n  return provider.startup();\n}\n\nfunction resolveConfig(rules, location) {\n  if (!rules) {\n    return {};\n  }\n\n  if ('clientId' in rules) {\n    return rules;\n  }\n\n  const keys = Object.keys(rules)\n    .filter(it => it.startsWith('https://') || it.startsWith('http://'));\n\n  if (keys.length === 0) {\n    return rules;\n  }\n\n  const key = keys\n    // order by length of key (most specific), descending\n    .sort((a, b) => b.length - a.length)\n    .find(it => location.href.startsWith(it));\n  if (key) {\n    return Object.assign({ callbackUrl: key }, rules[key]);\n  }\n  throw new Error(`Unable to match url [${location.href}] to one of [${keys}]`)\n}\n"],"names":["LEVEL_TRACE","priority","name","run","handleTrace","LEVEL_DEBUG","handleDebug","LEVEL_INFO","handleInfo","LEVEL_ERROR","handleError","ALL_LEVELS","DEFAULT_LEVEL","debug","args","log","info","error","debugf","format","logf","infof","level","shouldLog","getFormattedTime","now","Date","h24","String","getHours","padStart","min","getMinutes","sec","getSeconds","millis","getMilliseconds","formatTimezone","date","offset","getTimezoneOffset","absOffset","Math","abs","hourInt","floor","hourDone","sign","nonNegative","minDone","currentLevel","levelAttr","levelGlobalVar","lower","toLowerCase","find","l","document","documentElement","getAttribute","o","window","byuOAuth","logging","console","trace","EVENT_PREFIX","EVENT_STATE_CHANGE","EVENT_LOGIN_REQUESTED","EVENT_LOGOUT_REQUESTED","EVENT_REFRESH_REQUESTED","EVENT_CURRENT_INFO_REQUESTED","STATE_INDETERMINATE","STATE_UNAUTHENTICATED","STATE_AUTHENTICATED","STATE_AUTHENTICATING","STATE_REFRESHING","STATE_EXPIRED","STATE_ERROR","parseHash","hash","Map","subHash","startsWith","substr","keyValues","split","map","it","parse","serialize","decode","decodeURIComponent","encode","encodeURIComponent","pairSplitRegExp","fieldContentRegExp","str","options","TypeError","obj","opt","pairs","dec","i","length","pair","eq_idx","indexOf","key","trim","val","slice","undefined","tryDecode","enc","test","value","maxAge","isNaN","Error","domain","path","expires","toUTCString","httpOnly","secure","sameSite","e","_classCallCheck","instance","Constructor","Object","defineProperty","exports","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","protoProps","staticProps","prototype","storage","CookieStorage","setItem","getItem","removeItem","_cookie2","__esModule","default","_interopRequireDefault","_cookie","prefix","arguments","cookieOptions","assign","cookies","cookie","hasOwnProperty","hasStorage","replace","_CookieStorage","hasCookies","MemoryStorage","_data","_isSupported2","_isSupported","_CookieStorage2","_MemoryStorage2","_MemoryStorage","localStorage","sessionStorage","StorageHandler","saveOAuthState","clientId","state","getKey","JSON","stringify","getOAuthState","result","clearOAuthState","saveSessionState","getSessionKey","getSessionState","stored","clearSessionState","SINGLETON_INSTANCE","CHILD_IFRAME_ID","FIFTY_FIVE_MINUTES_MILLIS","STORED_STATE_LIFETIME","IG_STATE_AUTO_REFRESH_FAILED","ImplicitGrantProvider","constructor","config","storageHandler","_listeners","store","freeze","authn","user","token","_changeState","logStateChange","_dispatchEvent","_checkPopupOpener","origin","opener","location","URL","callbackUrl","_checkIframeOpener","iframe","parent","getElementById","contentWindow","handleStateChange","source","close","parentNode","removeChild","_maybeUpdateStoredSession","_checkExpired","expiresAt","getTime","startup","ensureOnlyInstance","listen","_location","_hashParams","isAuthenticationCallback","href","_handleAuthenticationCallback","err","hasStoredSession","_updateStateFromStorage","expirationTimeInMs","expiresInMs","definitelyExpired","maybeFunkyExpiration","_alreadyDidFunkyCheck","autoRefreshOnTimeout","_scheduleRefresh","_scheduleExpirationCheck","__refreshTask","setTimeout","_this","startRefresh","__expirationTask","clearTimeout","_this2","isCallbackUrl","hasHash","size","has","shutdown","unlisten","cleanupOnlyInstance","_listenTo","startLogin","startLogout","handleCurrentInfoRequest","_unlistenTo","displayType","csrf","randomString","storedState","_prepareStoredState","loginUrl","open","createElement","onload","html","body","innerHTML","_this3","id","src","style","appendChild","logoutRedirect","casLogoutUrl","logoutUrl","callback","serialized","deserializeSessionState","redactUser","redactToken","serializeSessionState","grouped","groupClaimPrefixes","rawUserInfo","smallerUserInfo","ro","CLAIMS_PREFIX_RESOURCE_OWNER","cl","CLAIMS_PREFIX_CLIENT","wso2","CLAIMS_PREFIX_WSO2","other","ui","at","bearer","ah","authorizationHeader","ea","groupedUserInfo","userInfo","ungroupClaimPrefixes","_processUserInfo","_processTokenInfo","provider","event","listener","obs","call","detail","bind","addEventListener","removeEventListener","CustomEvent","createEvent","initCustomEvent","dispatchEvent","OAuthError","get","oauthCsrfToken","pageState","_validateAndGetStoredState","accessToken","expiresIn","authHeader","redactBearerToken","_fetchUserInfo","USER_INFO_URL","resp","fetch","method","headers","Headers","mode","status","text","includes","json","CLAIMS_KNOWN_PREFIXES","keys","groupKey","group","getClaims","filter","k","reduce","agg","roClaims","familyNamePosition","surname_position","givenName","preferred_first_name","familyName","surname","displayName","personId","person_id","byuId","byu_id","netId","net_id","sortName","sort_name","clientClaims","wso2Claims","client","client_id","appName","applicationname","expectedCsrfToken","stateExpiresString","c","storedCsrfToken","s","Number","csrfToken","type","description","uri","idArray","Uint32Array","crypto","msCrypto","getRandomValues","cur","toString","logParts","u","t","toISOString","b","substring","___startupTrace","stack","DEFAULT_ISSUER","GLOBAL_CONFIG_KEY","configure","cfgOrRules","cfg","resolveConfig","globalConfig","issuer","pathname","rules","sort","a"],"mappings":"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"}