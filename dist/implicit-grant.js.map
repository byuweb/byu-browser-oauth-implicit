{"version":3,"file":"implicit-grant.js","sources":["../src/log.js","../node_modules/@byuweb/browser-oauth/constants.js","../src/url.js","../node_modules/cookie/index.js","../node_modules/local-storage-fallback/lib/CookieStorage.js","../node_modules/local-storage-fallback/lib/isSupported.js","../node_modules/local-storage-fallback/lib/MemoryStorage.js","../node_modules/local-storage-fallback/lib/index.js","../src/local-storage.js","../src/provider.js","../src/implicit-grant.js"],"sourcesContent":["const LEVEL_TRACE = { priority: 0, name: \"trace\", run: handleTrace };\nconst LEVEL_DEBUG = { priority: 1, name: \"debug\", run: handleDebug };\nconst LEVEL_INFO = { priority: 10, name: \"info\", run: handleInfo };\nconst LEVEL_ERROR = { priority: 100, name: \"error\", run: handleError };\n\nconst ALL_LEVELS = [LEVEL_TRACE, LEVEL_DEBUG, LEVEL_INFO, LEVEL_ERROR];\nconst DEFAULT_LEVEL = LEVEL_INFO;\n\nexport function debug(...args) {\n  log(LEVEL_DEBUG, ...args);\n}\n\nexport function info(...args) {\n  log(LEVEL_INFO, ...args);\n}\n\nexport function error(...args) {\n  log(LEVEL_ERROR, ...args);\n}\n\nexport function debugf(format, ...args) {\n  logf(LEVEL_DEBUG, format, ...args);\n}\n\nexport function infof(format, ...args) {\n  logf(LEVEL_INFO, format, ...args);\n}\n\nexport function errorf(format, ...args) {\n  logf(LEVEL_ERROR, format, ...args);\n}\n\nfunction logf(level, format, ...args) {\n  if (!shouldLog(level)) {\n    return;\n  }\n  level.run(\n    `[byu-browser-oauth-implicit] [${level.name}] (${getFormattedTime()}) ${format}`,\n    ...args\n  );\n}\n\nfunction log(level, ...args) {\n  if (!shouldLog(level)) {\n    return;\n  }\n  level.run(\n    \"[byu-browser-oauth-implicit]\",\n    `[${level.name}]`,\n    `(${getFormattedTime()})`,\n    ...args\n  );\n}\n\nfunction getFormattedTime() {\n  const now = new Date();\n  const h24 = String(now.getHours()).padStart(2, '0');\n  const min = String(now.getMinutes()).padStart(2, '0');\n  const sec = String(now.getSeconds()).padStart(2, '0');\n  const millis = String(now.getMilliseconds()).padStart(3, '0');\n\n  return `${h24}:${min}:${sec},${millis}${formatTimezone(now)}`;\n}\n\nfunction formatTimezone(date) {\n  const offset = date.getTimezoneOffset();\n  if (offset === 0) {\n    return 'Z';\n  }\n  const nonNegative = offset >= 0;\n  const absOffset = Math.abs(offset);\n\n  // Positive whole offset hours\n  const hourInt = Math.floor(absOffset / 60);\n  const hourDone = String(hourInt).padStart(2, '0')\n  const sign = (nonNegative ? '+' : '-');\n  const minDone = String(absOffset % 60).padStart(2, '0');\n\n  return `${sign}${hourDone}${minDone}`;\n}\n\nfunction shouldLog(level) {\n  return level.priority >= currentLevel().priority;\n}\n\nfunction currentLevel() {\n  const name = levelAttr() || levelGlobalVar();\n  if (!name) {\n    return DEFAULT_LEVEL;\n  }\n  const lower = name.toLowerCase();\n  return (\n    ALL_LEVELS.find(function(l) {\n      return l.name === lower;\n    }) || DEFAULT_LEVEL\n  );\n}\n\nfunction levelAttr() {\n  return document.documentElement.getAttribute(\"byu-oauth-logging\");\n}\n\nfunction levelGlobalVar() {\n  const o = window.byuOAuth || {};\n  return o.logging;\n}\n\nfunction handleTrace(...args) {\n  if (console.trace) {\n    console.trace(...args);\n  } else {\n    console.log(...args);\n  }\n}\n\nfunction handleDebug(...args) {\n  console.log(...args);\n}\n\nfunction handleInfo(...args) {\n  if (console.info) {\n    console.info(...args);\n  } else {\n    console.log(...args);\n  }\n}\n\nfunction handleError(...args) {\n  if (console.error) {\n    console.error(...args);\n  } else {\n    console.log(...args);\n  }\n}\n","export const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const EVENT_STATE_CHANGE = `${EVENT_PREFIX}-state-changed`;\nexport const EVENT_LOGIN_REQUESTED = `${EVENT_PREFIX}-login-requested`;\nexport const EVENT_LOGOUT_REQUESTED = `${EVENT_PREFIX}-logout-requested`;\nexport const EVENT_REFRESH_REQUESTED = `${EVENT_PREFIX}-refresh-requested`;\nexport const EVENT_CURRENT_INFO_REQUESTED = `${EVENT_PREFIX}-current-info-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport {debug} from './log.js';\n\nexport function parseHash(hash) {\n  debug('parsing hash', hash);\n  if (!hash) return new Map();\n  let subHash = hash;\n  if (hash.startsWith('#')) {\n    subHash = hash.substr(1);\n  }\n\n  const keyValues = subHash.split('&')\n    .map(it => it.split('=', 2));\n  return new Map(keyValues);\n}\n\n","/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(pairSplitRegExp);\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var eq_idx = pair.indexOf('=');\n\n    // skip things that don't look like key=value\n    if (eq_idx < 0) {\n      continue;\n    }\n\n    var key = pair.substr(0, eq_idx).trim()\n    var val = pair.substr(++eq_idx, pair.length).trim();\n\n    // quoted values\n    if ('\"' == val[0]) {\n      val = val.slice(1, -1);\n    }\n\n    // only assign once\n    if (undefined == obj[key]) {\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n    if (isNaN(maxAge)) throw new Error('maxAge should be a Number');\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.hasCookies = hasCookies;\n\nvar _cookie = require('cookie');\n\nvar _cookie2 = _interopRequireDefault(_cookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar prefix = 'lS_';\n\nvar CookieStorage = function () {\n  function CookieStorage() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CookieStorage);\n\n    this.cookieOptions = Object.assign({ path: '/' }, options);\n    prefix = options.prefix === undefined ? prefix : options.prefix;\n  }\n\n  _createClass(CookieStorage, [{\n    key: 'getItem',\n    value: function getItem(key) {\n      var cookies = _cookie2.default.parse(document.cookie);\n      if (!cookies || !cookies.hasOwnProperty(prefix + key)) {\n        return null;\n      }\n      return cookies[prefix + key];\n    }\n  }, {\n    key: 'setItem',\n    value: function setItem(key, value) {\n      document.cookie = _cookie2.default.serialize(prefix + key, value, this.cookieOptions);\n      return value;\n    }\n  }, {\n    key: 'removeItem',\n    value: function removeItem(key) {\n      var options = Object.assign({}, this.cookieOptions, { maxAge: -1 });\n      document.cookie = _cookie2.default.serialize(prefix + key, '', options);\n      return null;\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      var cookies = _cookie2.default.parse(document.cookie);\n      for (var key in cookies) {\n        if (key.indexOf(prefix) === 0) {\n          this.removeItem(key.substr(prefix.length));\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return CookieStorage;\n}();\n\nexports.default = CookieStorage;\nfunction hasCookies() {\n  var storage = new CookieStorage();\n\n  try {\n    var TEST_KEY = '__test';\n    storage.setItem(TEST_KEY, '1');\n    var value = storage.getItem(TEST_KEY);\n    storage.removeItem(TEST_KEY);\n\n    return value === '1';\n  } catch (e) {\n    return false;\n  }\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = isSupported;\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar TEST_KEY = '__test';\n\nfunction hasStorage(name) {\n  try {\n    var storage = window[name];\n    storage.setItem(TEST_KEY, '1');\n    storage.removeItem(TEST_KEY);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction isSupported() {\n  var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'localStorage';\n\n  var storage = String(name).replace(/storage$/i, '').toLowerCase();\n\n  if (storage === 'local') {\n    return hasStorage('localStorage');\n  }\n\n  if (storage === 'session') {\n    return hasStorage('sessionStorage');\n  }\n\n  if (storage === 'cookie') {\n    return (0, _CookieStorage.hasCookies)();\n  }\n\n  if (storage === 'memory') {\n    return true;\n  }\n\n  throw new Error('Storage method `' + name + '` is not available.\\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.');\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MemoryStorage = function () {\n  function MemoryStorage() {\n    _classCallCheck(this, MemoryStorage);\n\n    this._data = {};\n  }\n\n  _createClass(MemoryStorage, [{\n    key: \"getItem\",\n    value: function getItem(key) {\n      return this._data.hasOwnProperty(key) ? this._data[key] : null;\n    }\n  }, {\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      return this._data[key] = String(value);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(key) {\n      return delete this._data[key];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      return this._data = {};\n    }\n  }]);\n\n  return MemoryStorage;\n}();\n\nexports.default = MemoryStorage;","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MemoryStorage = exports.CookieStorage = exports.isSupported = exports.storage = undefined;\n\nvar _isSupported = require('./isSupported');\n\nvar _isSupported2 = _interopRequireDefault(_isSupported);\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar _CookieStorage2 = _interopRequireDefault(_CookieStorage);\n\nvar _MemoryStorage = require('./MemoryStorage');\n\nvar _MemoryStorage2 = _interopRequireDefault(_MemoryStorage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar storage = null;\n\nif ((0, _isSupported2.default)('localStorage')) {\n  // use localStorage\n  exports.storage = storage = window.localStorage;\n} else if ((0, _isSupported2.default)('sessionStorage')) {\n  // use sessionStorage\n  exports.storage = storage = window.sessionStorage;\n} else if ((0, _isSupported2.default)('cookieStorage')) {\n  // use cookies\n  exports.storage = storage = new _CookieStorage2.default();\n} else {\n  // use memory\n  exports.storage = storage = new _MemoryStorage2.default();\n}\n\nexports.default = storage;\nexports.storage = storage;\nexports.isSupported = _isSupported2.default;\nexports.CookieStorage = _CookieStorage2.default;\nexports.MemoryStorage = _MemoryStorage2.default;","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport storage from 'local-storage-fallback';\n\nexport class StorageHandler {\n\n  saveOAuthState(clientId, state) {\n    storage.setItem(getKey(clientId), JSON.stringify(state));\n  }\n\n  getOAuthState(clientId) {\n    const result = storage.getItem(getKey(clientId));\n    if (!result) {\n      return null;\n    }\n    return JSON.parse(result);\n  }\n\n  clearOAuthState(clientId) {\n    storage.removeItem(getKey(clientId));\n  }\n\n  saveSessionState(clientId, state) {\n    storage.setItem(getSessionKey(clientId), JSON.stringify(state));\n  }\n  \n  getSessionState(clientId) {\n    const key = getSessionKey(clientId);\n    const stored = storage.getItem(key);\n    if (!stored) {\n      return null;\n    }\n    return JSON.parse(stored);\n  }\n  \n  clearSessionState(clientId) {\n    storage.removeItem(getSessionKey(clientId));\n  }\n}\n\nfunction getKey(clientId) {\n  return 'oauth-state-' + encodeURIComponent(clientId);\n}\n\nfunction getSessionKey(clientId) {\n  return getKey(clientId) + '-active-session';\n}\n\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\"use strict\";\n\nimport * as log from './log.js';\nimport * as authn from '../node_modules/@byuweb/browser-oauth/constants.js';\nimport {parseHash} from './url.js';\nimport {StorageHandler} from \"./local-storage.js\";\n\nlet SINGLETON_INSTANCE;\n\nconst CHILD_IFRAME_ID = 'byu-oauth-implicit-grant-refresh-iframe'\nconst FIFTY_FIVE_MINUTES_MILLIS = 3300000;\nconst STORED_STATE_LIFETIME = 5 * 60 * 1000; // 5 minutes\nexport const IG_STATE_AUTO_REFRESH_FAILED = 'implicit-grant-auto-refresh-failed'\n\nexport class ImplicitGrantProvider {\n  constructor(config, window, document, storageHandler = new StorageHandler()) {\n    log.debug('initializing provider with config', config);\n    this.config = config;\n    this.window = window;\n    this.document = document;\n    this.storageHandler = storageHandler;\n    this._listeners = {};\n\n    this.store = Object.freeze({\n      state: authn.STATE_INDETERMINATE,\n      user: null,\n      token: null,\n      error: null\n    });\n    log.debug('initialized provider');\n  }\n\n  _changeState(state, user, token, error) {\n    logStateChange(state, user, token, error);\n    this.store = Object.freeze({\n      state, user, token, error\n    });\n    _dispatchEvent(this, authn.EVENT_STATE_CHANGE, this.store);\n  }\n\n  // Separate state change listener, because state change events\n  // might come from child iframe/popup window\n  handleStateChange({ state, user, token, source }) {\n    log.debug('in handleStateChange', state);\n    // If this is a popup\n    if (this.window.opener) {\n      // We're inside a child re-authentication popup\n\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(this.window.opener, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'popup' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('closing self');\n        this.window.close()\n      }\n\n      return\n    }\n\n    // If we're inside the \"refresh\" iframe\n    const iframe = this.window.parent.document.getElementById(CHILD_IFRAME_ID)\n    if (iframe) {\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(this.window.parent, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'iframe' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('removing child iframe');\n        iframe.parentNode.removeChild(iframe)\n      }\n\n      return\n    }\n\n    this._maybeUpdateStoredSession(state, user, token);\n\n    if (state === authn.STATE_AUTHENTICATED) {\n      this._checkExpired(token.expiresAt.getTime())\n    }\n  }\n\n  async startup() {\n    ensureOnlyInstance(this);\n    log.info('starting up');\n    this.listen();\n    this._changeState(authn.STATE_INDETERMINATE);\n\n    const location = this._location;\n    const hash = this._hashParams;\n\n    if (this.isAuthenticationCallback(location.href, hash)) {\n      log.debug('handling authentication callback');\n      this._changeState(authn.STATE_AUTHENTICATING);\n      try {\n        const {state, user, token, error} = await _handleAuthenticationCallback(\n          this.config,\n          location,\n          hash,\n          this.storageHandler\n        );\n        this._changeState(state, user, token, error);\n      } catch (err) {\n        log.error('OAuth Error', err);\n        this._changeState(authn.STATE_ERROR, undefined, undefined, err);\n      }\n    } if (this.hasStoredSession()) {\n      log.debug('Has stored session');\n      this._updateStateFromStorage();\n    } else {\n      log.debug('no authentication present');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n    return this;\n  }\n\n  _checkExpired(expirationTimeInMs) {\n    log.debug('checking expiration time');\n\n    const expiresInMs = expirationTimeInMs - Date.now()\n\n    const definitelyExpired = expiresInMs < 0;\n    // In certain cases, WSO2 can send us a token whose expiration is ACTUALLY 55 minutes (60 minutes minus the 5-minute grace period) ðŸ¤¦.\n    // So, if we see a longer-than-55-minute expiration, we may try to silently auto-refresh the token so we can get an accurate expiration.\n    const maybeFunkyExpiration = expiresInMs > FIFTY_FIVE_MINUTES_MILLIS;\n\n    if (!definitelyExpired && !maybeFunkyExpiration) {\n      this._scheduleExpirationCheck(expirationTimeInMs);\n      return;\n    }\n\n    if (this.config.autoRefreshOnTimeout) {\n      // If we've expired OR if the WSO2 five-minute grace period was not added, mark the state as refreshing.\n      // Schedule a refresh in an extra 5 seconds to avoid WSO2 clock skew problems.\n      // Existing token *should* have a five-minute grace period after expiration:\n      // a new request will generate a new token, but the old token should still\n      // work during that grace period, so we keep the user and token objects around.\n      if (maybeFunkyExpiration) {\n        log.debug('silently refreshing token to work around odd identity server issue');\n      }\n      this._changeState(authn.STATE_REFRESHING, this.store.user, this.store.token);\n      this._schedulePeriodic(() => this.startRefresh('iframe'));\n    } else if (definitelyExpired) {\n      // We don't have auto-refresh enabled, so flag the token as expired and let the application handle it.\n      this._changeState(authn.STATE_EXPIRED, this.store.user, this.store.token);\n    }\n  }\n\n  _scheduleRefresh() {\n    log.info('scheduling auto-refresh');\n    if (this.__refreshTask) {\n      log.debug('refresh already scheduled');\n      return;\n    }\n    return this.__refreshTask = this._schedulePeriodic(() =>  {\n      this.__refreshTask = null;\n      this.startRefresh('iframe')\n    });\n  }\n\n  _scheduleExpirationCheck(expirationTimeInMs) {\n    if (this.__expirationTask) {\n      clearTimeout(this.__expirationTask);\n    }\n    return this.__expirationTask = this._schedulePeriodic(() =>  {\n      this.__expirationTask = null;\n      this._checkExpired(expirationTimeInMs);\n    });\n  }\n\n  _schedulePeriodic(task) {\n    // Simply using setTimeout for an hour in the future\n    // doesn't work; setTimeout isn't that precise over that long of a period.\n    // So re-check every five seconds until we're past the expiration time\n    return setTimeout(task, 5000);\n  }\n\n  get _location() {\n    return this.window.location;\n  }\n\n  get _hashParams() {\n    return parseHash(this._location.hash);\n  }\n\n  isAuthenticationCallback(href, hash) {\n    const isCallbackUrl = href.indexOf(this.config.callbackUrl) === 0;\n    const hasHash = hash.size !== 0;\n\n    if (!isCallbackUrl || !hasHash) {\n      return false;\n    }\n\n    return hash.has('access_token') || hash.has('error');\n  }\n\n  hasStoredSession() {\n    return !!this.storageHandler.getSessionState(this.config.clientId);\n  }\n\n  shutdown() {\n    log.info('shutting down');\n    this.unlisten();\n    this._changeState(authn.STATE_INDETERMINATE);\n    cleanupOnlyInstance(this);\n  }\n\n  listen() {\n    log.debug('setting up event listeners');\n    _listenTo(this, authn.EVENT_LOGIN_REQUESTED, this.startLogin);\n    _listenTo(this, authn.EVENT_LOGOUT_REQUESTED, this.startLogout);\n    _listenTo(this, authn.EVENT_REFRESH_REQUESTED, this.startRefresh);\n    _listenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED, this.handleCurrentInfoRequest);\n    _listenTo(this, authn.EVENT_STATE_CHANGE, this.handleStateChange);\n  }\n\n  unlisten() {\n    log.debug('tearing down event listeners');\n    _unlistenTo(this, authn.EVENT_LOGIN_REQUESTED);\n    _unlistenTo(this, authn.EVENT_LOGOUT_REQUESTED);\n    _unlistenTo(this, authn.EVENT_REFRESH_REQUESTED);\n    _unlistenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED);\n    _unlistenTo(this, authn.EVENT_STATE_CHANGE);\n  }\n\n  startLogin(displayType = 'window') {\n    log.infof('Starting login. mode=%s', displayType);\n    const {clientId, callbackUrl} = this.config;\n    const csrf = randomString();\n\n    const storedState = _prepareStoredState(Date.now() + STORED_STATE_LIFETIME, csrf, {});\n    this.storageHandler.saveOAuthState(this.config.clientId, storedState);\n\n    const loginUrl = `https://api.byu.edu/authorize?response_type=token&client_id=${clientId}&redirect_uri=${encodeURIComponent(callbackUrl)}&scope=openid&state=${csrf}`;\n    log.debug('computed login url of', loginUrl);\n\n    if (!displayType || displayType == 'window') {\n      log.info(`Redirecting user to '${loginUrl}'`);\n      this.window.location = loginUrl;\n      return\n    } else if (displayType === 'popup') {\n      log.info('launching popup at', loginUrl);\n      this.window.open(loginUrl)\n      return\n    }\n\n    log.info('Setting up hidden refresh iframe at', loginUrl);\n    // last option: displayType == 'iframe'\n    let iframe = this.document.getElementById(CHILD_IFRAME_ID)\n    if (iframe) {\n      iframe.parentNode.removeChild(iframe)\n    }\n    iframe = this.document.createElement('iframe')\n    iframe.onload = () => {\n      let html = null\n      try {\n        html = iframe.contentWindow.document.body.innerHTML\n      } catch (err) {\n        // intentional do-nothing\n      }\n      if (html === null) {\n        // Hidden-frame refresh failed. Remove frame and\n        // report problem\n        iframe.parentNode.removeChild(iframe)\n        this._changeState(IG_STATE_AUTO_REFRESH_FAILED, null, null)\n      }\n    }\n    iframe.id = CHILD_IFRAME_ID\n    iframe.src = loginUrl\n    iframe.style = 'display:none'\n    log.debug('appending iframe', iframe);\n    this.document.body.appendChild(iframe);\n  }\n\n  startLogout() {\n    log.info('starting logout');\n    this.storageHandler.clearSessionState(this.config.clientId);\n    const logoutUrl = 'http://api.byu.edu/logout?redirect_url=' + encodeURIComponent(this.config.callbackUrl);\n    log.info('logging out by redirecting to', logoutUrl);\n    this.window.location = logoutUrl;\n    //https://api.byu.edu/revoke\n\n    //TODO: WSO2 Identity Server 5.1 allows us to revoke implicit tokens.  Once that's done, we'll need to do this.\n    // const url = `https://api.byu.edu/revoke`;\n\n    // const form = new URLSearchParams();\n    // form.set('token', store.token.bearer);\n    // form.set('client_id', config.clientId);\n    // form.set('token_type_hint', 'access_token');\n\n    // console.log('logout url', url);\n\n    // fetch(url, {\n    //     method: 'POST',\n    //     body: form,\n    //     // headers: {\n    //     //     'Content-Type': 'application/x-www-form-urlencoded'\n    //     // }\n    // }).then(result => {\n    //     console.log('done with logout', result);\n    // });\n  }\n\n  startRefresh(displayType = 'iframe') {\n    log.infof('starting refresh. displayType=%s', displayType);\n    this.startLogin(displayType);\n  }\n\n  handleCurrentInfoRequest({callback}) {\n    log.debug('got current info request');\n    if (callback) {\n      callback(this.store);\n    }\n  }\n\n  _updateStateFromStorage() {\n    log.debug('updating state from local storage');\n    const serialized = this.storageHandler.getSessionState(this.config.clientId);\n    if (!serialized) {\n      log.debug('no stored state');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n      return;\n    }\n    const {user, token} = deserializeSessionState(serialized);\n    if (!user || !token) {\n      log.debug('no stored user or token');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    } else if (token.expiresAt > new Date()) {\n      log.debug('found an unexpired saved session');\n      this._changeState(authn.STATE_AUTHENTICATED, user, token);\n    } else {\n      log.debug('stored session was expired');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n  }\n\n  _maybeUpdateStoredSession(state, user, token) {\n    log.debugf('updating stored session: state=%s hasUser=%s, hasToken=%s', state, !!user, !!token);\n    if (state === authn.STATE_UNAUTHENTICATED) {\n      log.debug('state is unauthenticated, clearing stored session');\n      this.storageHandler.clearSessionState(this.config.clientId);\n    } else if (!!user && !!token) {\n      log.debug('storing session', redactUser(user), redactToken(token));\n      const serialized = serializeSessionState(user, token);\n      this.storageHandler.saveSessionState(this.config.clientId, serialized);\n    }\n  }\n}\n\nfunction serializeSessionState(user, token) {\n  const grouped = groupClaimPrefixes(token.rawUserInfo);\n\n  const smallerUserInfo = {\n    ro: grouped[CLAIMS_PREFIX_RESOURCE_OWNER],\n    cl: grouped[CLAIMS_PREFIX_CLIENT],\n    wso2: grouped[CLAIMS_PREFIX_WSO2],\n    o: grouped.other,\n  };\n\n  return {\n    ui: smallerUserInfo,\n    at: token.bearer,\n    ah: token.authorizationHeader,\n    ea: token.expiresAt.getTime()\n  };\n}\n\nfunction deserializeSessionState(state) {\n  const groupedUserInfo = {\n    [CLAIMS_PREFIX_RESOURCE_OWNER]: state.ui.ro,\n    [CLAIMS_PREFIX_CLIENT]: state.ui.cl,\n    [CLAIMS_PREFIX_WSO2]: state.ui.wso2,\n    other: state.ui.o,\n  }\n  const userInfo = ungroupClaimPrefixes(groupedUserInfo);\n\n  const user = _processUserInfo(userInfo);\n  const expiresAt = new Date(state.ea);\n  const token = _processTokenInfo(userInfo, state.at, expiresAt, `Bearer ${state.at}`);\n  return {user, token};\n}\n\nfunction _listenTo(provider, event, listener) {\n  if (provider._listeners.hasOwnProperty(event)) {\n    throw new Error('A listener is already registered for ' + event);\n  }\n  const obs = provider._listeners[event] = function (e) {\n    listener.call(provider, e.detail);\n  }.bind(provider);\n\n  provider.document.addEventListener(event, obs, false);\n}\n\nfunction _unlistenTo(provider, event) {\n  if (!provider._listeners.hasOwnProperty(event)) {\n    return;\n  }\n\n  provider.document.removeEventListener(event, provider._listeners[event], false);\n  delete provider._listeners[event];\n}\n\n\nfunction _dispatchEvent(provider, name, detail) {\n  let event;\n  if (typeof provider.window.CustomEvent === 'function') {\n    event = new CustomEvent(name, {detail});\n  } else {\n    event = provider.document.createEvent('CustomEvent');\n    event.initCustomEvent(name, true, false, detail);\n  }\n  provider.document.dispatchEvent(event);\n}\n\nasync function _handleAuthenticationCallback(config, location, hash, storage) {\n  if (hash.has('error')) {\n    log.error('Got oauth error in URL hash');\n    throw new OAuthError(\n      hash.get('error'),\n      hash.get('error_description'),\n      hash.get('error_uri'),\n    );\n  }\n\n  const oauthCsrfToken = hash.get('state');\n  const storedState = storage.getOAuthState(config.clientId);\n\n  storage.clearOAuthState(config.clientId);\n\n  log.debug('checking oauth state token');\n  const pageState = _validateAndGetStoredState(storedState, oauthCsrfToken);\n\n  const accessToken = hash.get('access_token');\n  const expiresIn = Number(hash.get('expires_in'));\n  const expiresAt = new Date(Date.now() + (expiresIn * 1000));\n  const authHeader = `Bearer ${accessToken}`;\n  log.debug('got token', redactBearerToken(accessToken), 'which expires in', expiresIn, 'seconds');\n\n  const userInfo = await _fetchUserInfo(authHeader);\n\n  const user = _processUserInfo(userInfo);\n  const token = _processTokenInfo(userInfo, accessToken, expiresAt, authHeader);\n\n  location.hash = '';\n\n  return {state: authn.STATE_AUTHENTICATED, user, token};\n}\n\nconst USER_INFO_URL = 'https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid';\n\nasync function _fetchUserInfo(authHeader) {\n  log.debug('fetching user info from', USER_INFO_URL);\n  const resp = await fetch(USER_INFO_URL, {\n    method: 'GET',\n    headers: new Headers({'Accept': 'application/json', 'Authorization': authHeader}),\n    mode: 'cors',\n  });\n\n  log.debug('got status', resp.status);\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    if (resp.status === 403) {\n      log.debug('got forbidden error');\n      if (body.includes('<ams:code>900908</ams:code>')) {\n        log.debug('client app isn\\'t subscribed to OpenID UserInfo endpoint');\n        console.error(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`);\n        throw new OAuthError(\n          'not-subscribed-to-user-info',\n          'This page has an authentication configuration error. Developers, see the console for details.'\n        );\n      } else {\n        log.error('invalid oauth bearer token');\n        throw new OAuthError(\n          'invalid-oauth-token',\n          'The provided authentication token is invalid. Please try again.'\n        );\n      }\n    }\n    console.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-get-user-info',\n      'Unable to fetch user information. Please try again.'\n    );\n  }\n  const json = await resp.json();\n  log.debug('successfully got user info', json);\n  return json;\n}\n\nconst CLAIMS_PREFIX_RESOURCE_OWNER = 'http://byu.edu/claims/resourceowner_';\nconst CLAIMS_PREFIX_CLIENT = 'http://byu.edu/claims/client_';\nconst CLAIMS_PREFIX_WSO2 = 'http://wso2.org/claims/';\n\nconst CLAIMS_KNOWN_PREFIXES = [CLAIMS_PREFIX_CLIENT, CLAIMS_PREFIX_RESOURCE_OWNER, CLAIMS_PREFIX_WSO2];\n\nfunction groupClaimPrefixes(userInfo) {\n  const grouped = {\n    other: {}\n  };\n  for (const prefix of CLAIMS_KNOWN_PREFIXES) {\n    grouped[prefix] = {};\n  }\n  for (const key of Object.keys(userInfo)) {\n    const value = userInfo[key];\n    const prefix = CLAIMS_KNOWN_PREFIXES.find(it => key.startsWith(it));\n    if (prefix) {\n        grouped[prefix][key.substr(prefix.length)] = value;\n    } else {\n      grouped.other[key] = value;\n    }\n  }\n  return grouped;\n}\n\nfunction ungroupClaimPrefixes(grouped) {\n  const result = {};\n  for (const groupKey of CLAIMS_KNOWN_PREFIXES) {\n    const group = grouped[groupKey];\n    if (!group) continue;\n    for (const key of Object.keys(group)) {\n      result[groupKey + key] = group[key];\n    }\n  }\n  for (const other of Object.keys(grouped.other)) {\n    result[other] = grouped.other[other];\n  }\n  return result;\n}\n\nfunction getClaims(userInfo, prefix) {\n  return Object.keys(userInfo).filter(k => k.startsWith(prefix))\n    .reduce((agg, key) => {\n      agg[key.substr(prefix.length)] = userInfo[key];\n      return agg;\n    }, {});\n}\n\nfunction _processUserInfo(userInfo) {\n  const roClaims = getClaims(userInfo, CLAIMS_PREFIX_RESOURCE_OWNER);\n\n  const familyNamePosition = roClaims.surname_position;\n  const givenName = userInfo.given_name;\n  const familyName = userInfo.family_name;\n\n  const displayName = familyNamePosition === 'F' ? `${familyName} ${givenName}` : `${givenName} ${familyName}`;\n\n  return {\n    personId: roClaims.person_id,\n    byuId: roClaims.byu_id,\n    netId: roClaims.net_id,\n    name: {\n      sortName: roClaims.sort_name,\n      displayName,\n      givenName,\n      familyName,\n      familyNamePosition,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _processTokenInfo(userInfo, accessToken, expiresAt, authHeader) {\n  const clientClaims = getClaims(userInfo, CLAIMS_PREFIX_CLIENT);\n  const wso2Claims = getClaims(userInfo, CLAIMS_PREFIX_WSO2);\n\n  return {\n    bearer: accessToken,\n    authorizationHeader: authHeader,\n    expiresAt,\n    client: {\n      id: wso2Claims.client_id,\n      byuId: clientClaims.byu_id,\n      appName: wso2Claims.applicationname,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _validateAndGetStoredState(storedState, expectedCsrfToken) {\n  log.debug('validating stored state token. Expecting token', expectedCsrfToken, ', got state', storedState);\n  if (!storedState) {\n    log.error('no stored oauth login state');\n    throw new OAuthError('no-oauth-state', 'Your saved authentication information does not match. Please try again.');\n  }\n  const {e: stateExpiresString, c: storedCsrfToken, s: pageState} = storedState;\n\n  if (expectedCsrfToken !== storedCsrfToken) {\n    log.error('CSRF token mismatch')\n    throw new OAuthError(\n      'oauth-state-mismatch',\n      'Your saved authentication information does not match. Please try again.'\n    );\n  }\n\n  if (Number(stateExpiresString) < Date.now()) {\n    log.error('stored state has expired');\n    throw new OAuthError(\n      'oauth-state-expired',\n      'Your login attempt has timed out. Please try again.'\n    );\n  }\n\n  return pageState;\n}\n\nfunction _prepareStoredState(expires, csrfToken, pageState) {\n  return {\n    e: expires,\n    c: csrfToken,\n    s: pageState,\n  }\n}\n\nclass OAuthError extends Error {\n  constructor(type, description, uri) {\n    super('OAuth Error: ' + description);\n    this.type = type;\n    this.description = description;\n    this.uri = uri;\n  }\n}\n\nfunction randomString() {\n  let idArray = new Uint32Array(3);\n  const crypto = window.crypto || window.msCrypto;\n  crypto.getRandomValues(idArray);\n\n  return idArray.reduce((str, cur) => str + cur.toString(16), '');\n}\n\nfunction logStateChange(state, user, token, error) {\n  const logParts = [\n    'state change:',\n    {\n      state,\n      user: redactUser(user),\n      token: token, //redactToken(token),\n      error: error\n    }\n  ];\n  if (error) {\n    log.error(...logParts);\n  } else {\n    log.info(...logParts);\n  }\n}\n\nfunction redactUser(u) {\n  if (!u) return undefined;\n  return {\n    netId: u.netId,\n    'rest-is-redacted': true\n  };\n}\n\nfunction redactToken(t) {\n  console.log('redacting token', t);\n  if (!t) return undefined;\n  console.log(t);\n  const {bearer, expiresAt, client} = t;\n  console.log(expiresAt);\n  console.log(typeof expiresAt);\n  return {\n    bearer: redactBearerToken(bearer),\n    expiresAt: !!expiresAt ? expiresAt.toISOString() : null,\n    client,\n    'rest-is-redacted': true\n  }\n}\nfunction redactBearerToken(b) {\n  if (!b) return undefined;\n  return b.substring(0, 2) + '...redacted...' + b.substring(b.length - 2)\n}\n\nfunction ensureOnlyInstance(obj) {\n  if (SINGLETON_INSTANCE) {\n    const trace = SINGLETON_INSTANCE.___startupTrace;\n    throw new Error('There is already an instance of byu-oauth-implicit running!  Please call `#shutdown()` on that instance before starting a new one. Instance was started at:\\n' + trace);\n  }\n  obj.___startupTrace = new Error().stack;\n  SINGLETON_INSTANCE = obj;\n}\n\nfunction cleanupOnlyInstance(obj) {\n  SINGLETON_INSTANCE = null;\n}\n\nexport function __forceShutdown() {\n  if (SINGLETON_INSTANCE) {\n    SINGLETON_INSTANCE.shutdown();\n    cleanupOnlyInstance(SINGLETON_INSTANCE);\n  }\n}\n","/*\n * Copyright 2018 Brigham Young University\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ImplicitGrantProvider } from \"./provider.js\";\n\nexport const DEFAULT_ISSUER = 'https://api.byu.edu';\n\nexport const GLOBAL_CONFIG_KEY = 'byu-oauth-implicit-config';\n\n/**\n * @typedef {} ImplicitConfig\n * @prop {string} clientId\n * @prop {?string} issuer\n * @prop {?string} callbackUrl\n * @prop {?boolean} requireAuthentication\n */\n\n/**\n * @param {ImplicitConfig|ImplicitConfig[]|undefined} cfgOrRules\n * @param location\n */\nexport async function configure(cfgOrRules, location = window.location) {\n  const cfg = resolveConfig(cfgOrRules, location);\n  const globalConfig = window[GLOBAL_CONFIG_KEY];\n\n  const config = Object.assign({\n    issuer: DEFAULT_ISSUER,\n    callbackUrl: `${location.origin}${location.pathname}`,\n    autoRefreshOnTimeout: false\n  }, globalConfig, cfg);\n\n  if (!config.clientId) {\n    throw new Error('clientId must be specified in config');\n  }\n\n  const provider = new ImplicitGrantProvider(config, window, document);\n\n  return provider.startup();\n}\n\nfunction resolveConfig(rules, location) {\n  if (!rules) {\n    return {};\n  }\n\n  if ('clientId' in rules) {\n    return rules;\n  }\n\n  const keys = Object.keys(rules)\n    .filter(it => it.startsWith('https://') || it.startsWith('http://'));\n\n  if (keys.length === 0) {\n    return rules;\n  }\n\n  const key = keys\n    // order by length of key (most specific), descending\n    .sort((a, b) => b.length - a.length)\n    .find(it => location.href.startsWith(it));\n  if (key) {\n    return rules[key];\n  }\n  throw new Error(`Unable to match url [${location.href}] to one of [${keys}]`)\n}\n"],"names":["LEVEL_TRACE","priority","name","run","handleTrace","LEVEL_DEBUG","handleDebug","LEVEL_INFO","handleInfo","LEVEL_ERROR","handleError","ALL_LEVELS","DEFAULT_LEVEL","debug","args","log","info","error","debugf","format","logf","infof","level","shouldLog","getFormattedTime","now","Date","h24","String","getHours","padStart","min","getMinutes","sec","getSeconds","millis","getMilliseconds","formatTimezone","date","offset","getTimezoneOffset","nonNegative","absOffset","Math","abs","hourInt","floor","hourDone","sign","minDone","currentLevel","levelAttr","levelGlobalVar","lower","toLowerCase","find","l","document","documentElement","getAttribute","o","window","byuOAuth","logging","console","trace","EVENT_PREFIX","EVENT_STATE_CHANGE","EVENT_LOGIN_REQUESTED","EVENT_LOGOUT_REQUESTED","EVENT_REFRESH_REQUESTED","EVENT_CURRENT_INFO_REQUESTED","STATE_INDETERMINATE","STATE_UNAUTHENTICATED","STATE_AUTHENTICATED","STATE_AUTHENTICATING","STATE_REFRESHING","STATE_EXPIRED","STATE_ERROR","parseHash","hash","Map","subHash","startsWith","substr","keyValues","split","map","it","exports","parse","serialize","decode","decodeURIComponent","encode","encodeURIComponent","pairSplitRegExp","fieldContentRegExp","str","options","TypeError","obj","opt","pairs","dec","i","length","pair","eq_idx","indexOf","key","trim","val","slice","undefined","tryDecode","enc","test","value","maxAge","isNaN","Error","domain","path","expires","toUTCString","httpOnly","secure","sameSite","e","Object","defineProperty","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Constructor","protoProps","staticProps","prototype","hasCookies","_cookie2","_interopRequireDefault","_cookie","__esModule","default","_classCallCheck","instance","prefix","CookieStorage","arguments","cookieOptions","assign","getItem","cookies","cookie","hasOwnProperty","setItem","removeItem","clear","storage","TEST_KEY","isSupported","hasStorage","replace","_CookieStorage","MemoryStorage","_data","_isSupported2","_isSupported","_CookieStorage2","_MemoryStorage2","_MemoryStorage","localStorage","sessionStorage","StorageHandler","saveOAuthState","clientId","state","getKey","JSON","stringify","getOAuthState","result","clearOAuthState","saveSessionState","getSessionKey","getSessionState","stored","clearSessionState","SINGLETON_INSTANCE","CHILD_IFRAME_ID","FIFTY_FIVE_MINUTES_MILLIS","STORED_STATE_LIFETIME","IG_STATE_AUTO_REFRESH_FAILED","ImplicitGrantProvider","constructor","config","storageHandler","_listeners","store","freeze","authn","user","token","_changeState","logStateChange","_dispatchEvent","handleStateChange","source","opener","close","iframe","parent","getElementById","parentNode","removeChild","_maybeUpdateStoredSession","_checkExpired","expiresAt","getTime","startup","ensureOnlyInstance","listen","location","_location","_hashParams","isAuthenticationCallback","href","_handleAuthenticationCallback","err","hasStoredSession","_updateStateFromStorage","expirationTimeInMs","expiresInMs","definitelyExpired","maybeFunkyExpiration","_scheduleExpirationCheck","autoRefreshOnTimeout","_schedulePeriodic","startRefresh","_scheduleRefresh","__refreshTask","__expirationTask","clearTimeout","task","setTimeout","isCallbackUrl","callbackUrl","hasHash","size","has","shutdown","unlisten","cleanupOnlyInstance","_listenTo","startLogin","startLogout","handleCurrentInfoRequest","_unlistenTo","displayType","csrf","randomString","storedState","_prepareStoredState","loginUrl","open","createElement","onload","html","contentWindow","body","innerHTML","id","src","style","appendChild","logoutUrl","callback","serialized","deserializeSessionState","redactUser","redactToken","serializeSessionState","grouped","groupClaimPrefixes","rawUserInfo","smallerUserInfo","ro","CLAIMS_PREFIX_RESOURCE_OWNER","cl","CLAIMS_PREFIX_CLIENT","wso2","CLAIMS_PREFIX_WSO2","other","ui","at","bearer","ah","authorizationHeader","ea","groupedUserInfo","userInfo","ungroupClaimPrefixes","_processUserInfo","_processTokenInfo","provider","event","listener","obs","call","detail","bind","addEventListener","removeEventListener","CustomEvent","createEvent","initCustomEvent","dispatchEvent","OAuthError","get","oauthCsrfToken","pageState","_validateAndGetStoredState","accessToken","expiresIn","Number","authHeader","redactBearerToken","_fetchUserInfo","USER_INFO_URL","resp","fetch","method","headers","Headers","mode","status","text","includes","json","CLAIMS_KNOWN_PREFIXES","keys","groupKey","group","getClaims","filter","k","reduce","agg","roClaims","familyNamePosition","surname_position","givenName","given_name","familyName","family_name","displayName","personId","person_id","byuId","byu_id","netId","net_id","sortName","sort_name","clientClaims","wso2Claims","client","client_id","appName","applicationname","expectedCsrfToken","stateExpiresString","c","storedCsrfToken","s","csrfToken","type","description","uri","idArray","Uint32Array","crypto","msCrypto","getRandomValues","cur","toString","logParts","u","t","toISOString","b","substring","___startupTrace","stack","DEFAULT_ISSUER","GLOBAL_CONFIG_KEY","configure","cfgOrRules","cfg","resolveConfig","globalConfig","issuer","origin","pathname","rules","sort","a"],"mappings":"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"}