{"version":3,"file":"implicit-grant.js","sources":["../src/log.js","../node_modules/@byuweb/browser-oauth/constants.js","../node_modules/cookie/index.js","../node_modules/local-storage-fallback/lib/CookieStorage.js","../node_modules/local-storage-fallback/lib/isSupported.js","../node_modules/local-storage-fallback/lib/MemoryStorage.js","../node_modules/local-storage-fallback/lib/index.js","../src/local-storage.js","../node_modules/js-sha256/src/sha256.js","../src/provider.js","../src/implicit-grant.js"],"sourcesContent":["const LEVEL_TRACE = { priority: 0, name: \"trace\", run: handleTrace };\nconst LEVEL_DEBUG = { priority: 1, name: \"debug\", run: handleDebug };\nconst LEVEL_INFO = { priority: 10, name: \"info\", run: handleInfo };\nconst LEVEL_ERROR = { priority: 100, name: \"error\", run: handleError };\n\nconst ALL_LEVELS = [LEVEL_TRACE, LEVEL_DEBUG, LEVEL_INFO, LEVEL_ERROR];\nconst DEFAULT_LEVEL = LEVEL_ERROR;\n\nexport function debug(...args) {\n  log(LEVEL_DEBUG, ...args);\n}\n\nexport function info(...args) {\n  log(LEVEL_INFO, ...args);\n}\n\nexport function error(...args) {\n  log(LEVEL_ERROR, ...args);\n}\n\nexport function debugf(format, ...args) {\n  logf(LEVEL_DEBUG, format, ...args);\n}\n\nexport function infof(format, ...args) {\n  logf(LEVEL_INFO, format, ...args);\n}\n\nexport function errorf(format, ...args) {\n  logf(LEVEL_ERROR, format, ...args);\n}\n\nfunction logf(level, format, ...args) {\n  if (!shouldLog(level)) {\n    return;\n  }\n  level.run(\n    `[byu-browser-oauth-implicit] [${level.name}] (${getFormattedTime()}) ${format}`,\n    ...args\n  );\n}\n\nfunction log(level, ...args) {\n  if (!shouldLog(level)) {\n    return;\n  }\n  level.run(\n    \"[byu-browser-oauth-implicit]\",\n    `[${level.name}]`,\n    `(${getFormattedTime()})`,\n    ...args\n  );\n}\n\nfunction getFormattedTime() {\n  const now = new Date();\n  const h24 = String(now.getHours()).padStart(2, '0');\n  const min = String(now.getMinutes()).padStart(2, '0');\n  const sec = String(now.getSeconds()).padStart(2, '0');\n  const millis = String(now.getMilliseconds()).padStart(3, '0');\n\n  return `${h24}:${min}:${sec},${millis}${formatTimezone(now)}`;\n}\n\nfunction formatTimezone(date) {\n  const offset = date.getTimezoneOffset();\n  if (offset === 0) {\n    return 'Z';\n  }\n  const nonNegative = offset >= 0;\n  const absOffset = Math.abs(offset);\n\n  // Positive whole offset hours\n  const hourInt = Math.floor(absOffset / 60);\n  const hourDone = String(hourInt).padStart(2, '0')\n  const sign = (nonNegative ? '+' : '-');\n  const minDone = String(absOffset % 60).padStart(2, '0');\n\n  return `${sign}${hourDone}${minDone}`;\n}\n\nfunction shouldLog(level) {\n  return level.priority >= currentLevel().priority;\n}\n\nfunction currentLevel() {\n  const name = levelAttr() || levelGlobalVar();\n  if (!name) {\n    return DEFAULT_LEVEL;\n  }\n  const lower = name.toLowerCase();\n  return (\n    ALL_LEVELS.find(function(l) {\n      return l.name === lower;\n    }) || DEFAULT_LEVEL\n  );\n}\n\nfunction levelAttr() {\n  return document.documentElement.getAttribute(\"byu-oauth-logging\");\n}\n\nfunction levelGlobalVar() {\n  const o = window.byuOAuth || {};\n  return o.logging;\n}\n\nfunction handleTrace(...args) {\n  if (console.trace) {\n    console.trace(...args);\n  } else {\n    console.log(...args);\n  }\n}\n\nfunction handleDebug(...args) {\n  console.log(...args);\n}\n\nfunction handleInfo(...args) {\n  if (console.info) {\n    console.info(...args);\n  } else {\n    console.log(...args);\n  }\n}\n\nfunction handleError(...args) {\n  if (console.error) {\n    console.error(...args);\n  } else {\n    console.log(...args);\n  }\n}\n","export const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const EVENT_STATE_CHANGE = `${EVENT_PREFIX}-state-changed`;\nexport const EVENT_LOGIN_REQUESTED = `${EVENT_PREFIX}-login-requested`;\nexport const EVENT_LOGOUT_REQUESTED = `${EVENT_PREFIX}-logout-requested`;\nexport const EVENT_REFRESH_REQUESTED = `${EVENT_PREFIX}-refresh-requested`;\nexport const EVENT_CURRENT_INFO_REQUESTED = `${EVENT_PREFIX}-current-info-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n\n","/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(pairSplitRegExp);\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var eq_idx = pair.indexOf('=');\n\n    // skip things that don't look like key=value\n    if (eq_idx < 0) {\n      continue;\n    }\n\n    var key = pair.substr(0, eq_idx).trim()\n    var val = pair.substr(++eq_idx, pair.length).trim();\n\n    // quoted values\n    if ('\"' == val[0]) {\n      val = val.slice(1, -1);\n    }\n\n    // only assign once\n    if (undefined == obj[key]) {\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n    if (isNaN(maxAge)) throw new Error('maxAge should be a Number');\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.hasCookies = hasCookies;\n\nvar _cookie = require('cookie');\n\nvar _cookie2 = _interopRequireDefault(_cookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar prefix = 'lS_';\n\nvar CookieStorage = function () {\n  function CookieStorage() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CookieStorage);\n\n    this.cookieOptions = Object.assign({ path: '/' }, options);\n    prefix = options.prefix === undefined ? prefix : options.prefix;\n  }\n\n  _createClass(CookieStorage, [{\n    key: 'getItem',\n    value: function getItem(key) {\n      var cookies = _cookie2.default.parse(document.cookie);\n      if (!cookies || !cookies.hasOwnProperty(prefix + key)) {\n        return null;\n      }\n      return cookies[prefix + key];\n    }\n  }, {\n    key: 'setItem',\n    value: function setItem(key, value) {\n      document.cookie = _cookie2.default.serialize(prefix + key, value, this.cookieOptions);\n      return value;\n    }\n  }, {\n    key: 'removeItem',\n    value: function removeItem(key) {\n      var options = Object.assign({}, this.cookieOptions, { maxAge: -1 });\n      document.cookie = _cookie2.default.serialize(prefix + key, '', options);\n      return null;\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      var cookies = _cookie2.default.parse(document.cookie);\n      for (var key in cookies) {\n        if (key.indexOf(prefix) === 0) {\n          this.removeItem(key.substr(prefix.length));\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return CookieStorage;\n}();\n\nexports.default = CookieStorage;\nfunction hasCookies() {\n  var storage = new CookieStorage();\n\n  try {\n    var TEST_KEY = '__test';\n    storage.setItem(TEST_KEY, '1');\n    var value = storage.getItem(TEST_KEY);\n    storage.removeItem(TEST_KEY);\n\n    return value === '1';\n  } catch (e) {\n    return false;\n  }\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = isSupported;\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar TEST_KEY = '__test';\n\nfunction hasStorage(name) {\n  try {\n    var storage = window[name];\n    storage.setItem(TEST_KEY, '1');\n    storage.removeItem(TEST_KEY);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction isSupported() {\n  var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'localStorage';\n\n  var storage = String(name).replace(/storage$/i, '').toLowerCase();\n\n  if (storage === 'local') {\n    return hasStorage('localStorage');\n  }\n\n  if (storage === 'session') {\n    return hasStorage('sessionStorage');\n  }\n\n  if (storage === 'cookie') {\n    return (0, _CookieStorage.hasCookies)();\n  }\n\n  if (storage === 'memory') {\n    return true;\n  }\n\n  throw new Error('Storage method `' + name + '` is not available.\\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.');\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MemoryStorage = function () {\n  function MemoryStorage() {\n    _classCallCheck(this, MemoryStorage);\n\n    this._data = {};\n  }\n\n  _createClass(MemoryStorage, [{\n    key: \"getItem\",\n    value: function getItem(key) {\n      return this._data.hasOwnProperty(key) ? this._data[key] : null;\n    }\n  }, {\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      return this._data[key] = String(value);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(key) {\n      return delete this._data[key];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      return this._data = {};\n    }\n  }]);\n\n  return MemoryStorage;\n}();\n\nexports.default = MemoryStorage;","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MemoryStorage = exports.CookieStorage = exports.isSupported = exports.storage = undefined;\n\nvar _isSupported = require('./isSupported');\n\nvar _isSupported2 = _interopRequireDefault(_isSupported);\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar _CookieStorage2 = _interopRequireDefault(_CookieStorage);\n\nvar _MemoryStorage = require('./MemoryStorage');\n\nvar _MemoryStorage2 = _interopRequireDefault(_MemoryStorage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar storage = null;\n\nif ((0, _isSupported2.default)('localStorage')) {\n  // use localStorage\n  exports.storage = storage = window.localStorage;\n} else if ((0, _isSupported2.default)('sessionStorage')) {\n  // use sessionStorage\n  exports.storage = storage = window.sessionStorage;\n} else if ((0, _isSupported2.default)('cookieStorage')) {\n  // use cookies\n  exports.storage = storage = new _CookieStorage2.default();\n} else {\n  // use memory\n  exports.storage = storage = new _MemoryStorage2.default();\n}\n\nexports.default = storage;\nexports.storage = storage;\nexports.isSupported = _isSupported2.default;\nexports.CookieStorage = _CookieStorage2.default;\nexports.MemoryStorage = _MemoryStorage2.default;","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport storage from 'local-storage-fallback';\n// During initial page load, Firefox \"LocalStorage\" is wonky if in Private Browsing.\n// Fortunately, the \"OAuth State\" data is tiny (one date and one 16-character string),\n// so it won't hit any Cookie size limitations.\n// With those factors in mind, we intentionally downgrade to Cookie storage for initial OAuth data storage\nimport { CookieStorage } from 'local-storage-fallback';\n\nconst cookie = new CookieStorage();\n\nexport class StorageHandler {\n\n  saveOAuthState(clientId, state) {\n    cookie.setItem(getKey(clientId), JSON.stringify(state));\n  }\n\n  getOAuthState(clientId) {\n    const result = cookie.getItem(getKey(clientId));\n    if (!result) {\n      return null;\n    }\n    return JSON.parse(result);\n  }\n\n  clearOAuthState(clientId) {\n    cookie.removeItem(getKey(clientId));\n  }\n\n  saveSessionState(clientId, state) {\n    storage.setItem(getSessionKey(clientId), JSON.stringify(state));\n  }\n\n  getSessionState(clientId) {\n    const key = getSessionKey(clientId);\n    const stored = storage.getItem(key);\n    if (!stored) {\n      return null;\n    }\n    return JSON.parse(stored);\n  }\n\n  clearSessionState(clientId) {\n    storage.removeItem(getSessionKey(clientId));\n  }\n}\n\nfunction getKey(clientId) {\n  return 'oauth-state-' + encodeURIComponent(clientId);\n}\n\nfunction getSessionKey(clientId) {\n  return getKey(clientId) + '-active-session';\n}\n\n","/**\n * [js-sha256]{@link https://github.com/emn178/js-sha256}\n *\n * @version 0.9.0\n * @author Chen, Yi-Cyuan [emn178@gmail.com]\n * @copyright Chen, Yi-Cyuan 2014-2017\n * @license MIT\n */\n/*jslint bitwise: true */\n(function () {\n  'use strict';\n\n  var ERROR = 'input is invalid type';\n  var WINDOW = typeof window === 'object';\n  var root = WINDOW ? window : {};\n  if (root.JS_SHA256_NO_WINDOW) {\n    WINDOW = false;\n  }\n  var WEB_WORKER = !WINDOW && typeof self === 'object';\n  var NODE_JS = !root.JS_SHA256_NO_NODE_JS && typeof process === 'object' && process.versions && process.versions.node;\n  if (NODE_JS) {\n    root = global;\n  } else if (WEB_WORKER) {\n    root = self;\n  }\n  var COMMON_JS = !root.JS_SHA256_NO_COMMON_JS && typeof module === 'object' && module.exports;\n  var AMD = typeof define === 'function' && define.amd;\n  var ARRAY_BUFFER = !root.JS_SHA256_NO_ARRAY_BUFFER && typeof ArrayBuffer !== 'undefined';\n  var HEX_CHARS = '0123456789abcdef'.split('');\n  var EXTRA = [-2147483648, 8388608, 32768, 128];\n  var SHIFT = [24, 16, 8, 0];\n  var K = [\n    0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,\n    0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,\n    0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,\n    0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,\n    0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,\n    0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,\n    0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,\n    0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2\n  ];\n  var OUTPUT_TYPES = ['hex', 'array', 'digest', 'arrayBuffer'];\n\n  var blocks = [];\n\n  if (root.JS_SHA256_NO_NODE_JS || !Array.isArray) {\n    Array.isArray = function (obj) {\n      return Object.prototype.toString.call(obj) === '[object Array]';\n    };\n  }\n\n  if (ARRAY_BUFFER && (root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW || !ArrayBuffer.isView)) {\n    ArrayBuffer.isView = function (obj) {\n      return typeof obj === 'object' && obj.buffer && obj.buffer.constructor === ArrayBuffer;\n    };\n  }\n\n  var createOutputMethod = function (outputType, is224) {\n    return function (message) {\n      return new Sha256(is224, true).update(message)[outputType]();\n    };\n  };\n\n  var createMethod = function (is224) {\n    var method = createOutputMethod('hex', is224);\n    if (NODE_JS) {\n      method = nodeWrap(method, is224);\n    }\n    method.create = function () {\n      return new Sha256(is224);\n    };\n    method.update = function (message) {\n      return method.create().update(message);\n    };\n    for (var i = 0; i < OUTPUT_TYPES.length; ++i) {\n      var type = OUTPUT_TYPES[i];\n      method[type] = createOutputMethod(type, is224);\n    }\n    return method;\n  };\n\n  var nodeWrap = function (method, is224) {\n    var crypto = eval(\"require('crypto')\");\n    var Buffer = eval(\"require('buffer').Buffer\");\n    var algorithm = is224 ? 'sha224' : 'sha256';\n    var nodeMethod = function (message) {\n      if (typeof message === 'string') {\n        return crypto.createHash(algorithm).update(message, 'utf8').digest('hex');\n      } else {\n        if (message === null || message === undefined) {\n          throw new Error(ERROR);\n        } else if (message.constructor === ArrayBuffer) {\n          message = new Uint8Array(message);\n        }\n      }\n      if (Array.isArray(message) || ArrayBuffer.isView(message) ||\n        message.constructor === Buffer) {\n        return crypto.createHash(algorithm).update(new Buffer(message)).digest('hex');\n      } else {\n        return method(message);\n      }\n    };\n    return nodeMethod;\n  };\n\n  var createHmacOutputMethod = function (outputType, is224) {\n    return function (key, message) {\n      return new HmacSha256(key, is224, true).update(message)[outputType]();\n    };\n  };\n\n  var createHmacMethod = function (is224) {\n    var method = createHmacOutputMethod('hex', is224);\n    method.create = function (key) {\n      return new HmacSha256(key, is224);\n    };\n    method.update = function (key, message) {\n      return method.create(key).update(message);\n    };\n    for (var i = 0; i < OUTPUT_TYPES.length; ++i) {\n      var type = OUTPUT_TYPES[i];\n      method[type] = createHmacOutputMethod(type, is224);\n    }\n    return method;\n  };\n\n  function Sha256(is224, sharedMemory) {\n    if (sharedMemory) {\n      blocks[0] = blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n        blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n        blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n        blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n      this.blocks = blocks;\n    } else {\n      this.blocks = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n    }\n\n    if (is224) {\n      this.h0 = 0xc1059ed8;\n      this.h1 = 0x367cd507;\n      this.h2 = 0x3070dd17;\n      this.h3 = 0xf70e5939;\n      this.h4 = 0xffc00b31;\n      this.h5 = 0x68581511;\n      this.h6 = 0x64f98fa7;\n      this.h7 = 0xbefa4fa4;\n    } else { // 256\n      this.h0 = 0x6a09e667;\n      this.h1 = 0xbb67ae85;\n      this.h2 = 0x3c6ef372;\n      this.h3 = 0xa54ff53a;\n      this.h4 = 0x510e527f;\n      this.h5 = 0x9b05688c;\n      this.h6 = 0x1f83d9ab;\n      this.h7 = 0x5be0cd19;\n    }\n\n    this.block = this.start = this.bytes = this.hBytes = 0;\n    this.finalized = this.hashed = false;\n    this.first = true;\n    this.is224 = is224;\n  }\n\n  Sha256.prototype.update = function (message) {\n    if (this.finalized) {\n      return;\n    }\n    var notString, type = typeof message;\n    if (type !== 'string') {\n      if (type === 'object') {\n        if (message === null) {\n          throw new Error(ERROR);\n        } else if (ARRAY_BUFFER && message.constructor === ArrayBuffer) {\n          message = new Uint8Array(message);\n        } else if (!Array.isArray(message)) {\n          if (!ARRAY_BUFFER || !ArrayBuffer.isView(message)) {\n            throw new Error(ERROR);\n          }\n        }\n      } else {\n        throw new Error(ERROR);\n      }\n      notString = true;\n    }\n    var code, index = 0, i, length = message.length, blocks = this.blocks;\n\n    while (index < length) {\n      if (this.hashed) {\n        this.hashed = false;\n        blocks[0] = this.block;\n        blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n          blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n          blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n          blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n      }\n\n      if (notString) {\n        for (i = this.start; index < length && i < 64; ++index) {\n          blocks[i >> 2] |= message[index] << SHIFT[i++ & 3];\n        }\n      } else {\n        for (i = this.start; index < length && i < 64; ++index) {\n          code = message.charCodeAt(index);\n          if (code < 0x80) {\n            blocks[i >> 2] |= code << SHIFT[i++ & 3];\n          } else if (code < 0x800) {\n            blocks[i >> 2] |= (0xc0 | (code >> 6)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n          } else if (code < 0xd800 || code >= 0xe000) {\n            blocks[i >> 2] |= (0xe0 | (code >> 12)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | ((code >> 6) & 0x3f)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n          } else {\n            code = 0x10000 + (((code & 0x3ff) << 10) | (message.charCodeAt(++index) & 0x3ff));\n            blocks[i >> 2] |= (0xf0 | (code >> 18)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | ((code >> 12) & 0x3f)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | ((code >> 6) & 0x3f)) << SHIFT[i++ & 3];\n            blocks[i >> 2] |= (0x80 | (code & 0x3f)) << SHIFT[i++ & 3];\n          }\n        }\n      }\n\n      this.lastByteIndex = i;\n      this.bytes += i - this.start;\n      if (i >= 64) {\n        this.block = blocks[16];\n        this.start = i - 64;\n        this.hash();\n        this.hashed = true;\n      } else {\n        this.start = i;\n      }\n    }\n    if (this.bytes > 4294967295) {\n      this.hBytes += this.bytes / 4294967296 << 0;\n      this.bytes = this.bytes % 4294967296;\n    }\n    return this;\n  };\n\n  Sha256.prototype.finalize = function () {\n    if (this.finalized) {\n      return;\n    }\n    this.finalized = true;\n    var blocks = this.blocks, i = this.lastByteIndex;\n    blocks[16] = this.block;\n    blocks[i >> 2] |= EXTRA[i & 3];\n    this.block = blocks[16];\n    if (i >= 56) {\n      if (!this.hashed) {\n        this.hash();\n      }\n      blocks[0] = this.block;\n      blocks[16] = blocks[1] = blocks[2] = blocks[3] =\n        blocks[4] = blocks[5] = blocks[6] = blocks[7] =\n        blocks[8] = blocks[9] = blocks[10] = blocks[11] =\n        blocks[12] = blocks[13] = blocks[14] = blocks[15] = 0;\n    }\n    blocks[14] = this.hBytes << 3 | this.bytes >>> 29;\n    blocks[15] = this.bytes << 3;\n    this.hash();\n  };\n\n  Sha256.prototype.hash = function () {\n    var a = this.h0, b = this.h1, c = this.h2, d = this.h3, e = this.h4, f = this.h5, g = this.h6,\n      h = this.h7, blocks = this.blocks, j, s0, s1, maj, t1, t2, ch, ab, da, cd, bc;\n\n    for (j = 16; j < 64; ++j) {\n      // rightrotate\n      t1 = blocks[j - 15];\n      s0 = ((t1 >>> 7) | (t1 << 25)) ^ ((t1 >>> 18) | (t1 << 14)) ^ (t1 >>> 3);\n      t1 = blocks[j - 2];\n      s1 = ((t1 >>> 17) | (t1 << 15)) ^ ((t1 >>> 19) | (t1 << 13)) ^ (t1 >>> 10);\n      blocks[j] = blocks[j - 16] + s0 + blocks[j - 7] + s1 << 0;\n    }\n\n    bc = b & c;\n    for (j = 0; j < 64; j += 4) {\n      if (this.first) {\n        if (this.is224) {\n          ab = 300032;\n          t1 = blocks[0] - 1413257819;\n          h = t1 - 150054599 << 0;\n          d = t1 + 24177077 << 0;\n        } else {\n          ab = 704751109;\n          t1 = blocks[0] - 210244248;\n          h = t1 - 1521486534 << 0;\n          d = t1 + 143694565 << 0;\n        }\n        this.first = false;\n      } else {\n        s0 = ((a >>> 2) | (a << 30)) ^ ((a >>> 13) | (a << 19)) ^ ((a >>> 22) | (a << 10));\n        s1 = ((e >>> 6) | (e << 26)) ^ ((e >>> 11) | (e << 21)) ^ ((e >>> 25) | (e << 7));\n        ab = a & b;\n        maj = ab ^ (a & c) ^ bc;\n        ch = (e & f) ^ (~e & g);\n        t1 = h + s1 + ch + K[j] + blocks[j];\n        t2 = s0 + maj;\n        h = d + t1 << 0;\n        d = t1 + t2 << 0;\n      }\n      s0 = ((d >>> 2) | (d << 30)) ^ ((d >>> 13) | (d << 19)) ^ ((d >>> 22) | (d << 10));\n      s1 = ((h >>> 6) | (h << 26)) ^ ((h >>> 11) | (h << 21)) ^ ((h >>> 25) | (h << 7));\n      da = d & a;\n      maj = da ^ (d & b) ^ ab;\n      ch = (h & e) ^ (~h & f);\n      t1 = g + s1 + ch + K[j + 1] + blocks[j + 1];\n      t2 = s0 + maj;\n      g = c + t1 << 0;\n      c = t1 + t2 << 0;\n      s0 = ((c >>> 2) | (c << 30)) ^ ((c >>> 13) | (c << 19)) ^ ((c >>> 22) | (c << 10));\n      s1 = ((g >>> 6) | (g << 26)) ^ ((g >>> 11) | (g << 21)) ^ ((g >>> 25) | (g << 7));\n      cd = c & d;\n      maj = cd ^ (c & a) ^ da;\n      ch = (g & h) ^ (~g & e);\n      t1 = f + s1 + ch + K[j + 2] + blocks[j + 2];\n      t2 = s0 + maj;\n      f = b + t1 << 0;\n      b = t1 + t2 << 0;\n      s0 = ((b >>> 2) | (b << 30)) ^ ((b >>> 13) | (b << 19)) ^ ((b >>> 22) | (b << 10));\n      s1 = ((f >>> 6) | (f << 26)) ^ ((f >>> 11) | (f << 21)) ^ ((f >>> 25) | (f << 7));\n      bc = b & c;\n      maj = bc ^ (b & d) ^ cd;\n      ch = (f & g) ^ (~f & h);\n      t1 = e + s1 + ch + K[j + 3] + blocks[j + 3];\n      t2 = s0 + maj;\n      e = a + t1 << 0;\n      a = t1 + t2 << 0;\n    }\n\n    this.h0 = this.h0 + a << 0;\n    this.h1 = this.h1 + b << 0;\n    this.h2 = this.h2 + c << 0;\n    this.h3 = this.h3 + d << 0;\n    this.h4 = this.h4 + e << 0;\n    this.h5 = this.h5 + f << 0;\n    this.h6 = this.h6 + g << 0;\n    this.h7 = this.h7 + h << 0;\n  };\n\n  Sha256.prototype.hex = function () {\n    this.finalize();\n\n    var h0 = this.h0, h1 = this.h1, h2 = this.h2, h3 = this.h3, h4 = this.h4, h5 = this.h5,\n      h6 = this.h6, h7 = this.h7;\n\n    var hex = HEX_CHARS[(h0 >> 28) & 0x0F] + HEX_CHARS[(h0 >> 24) & 0x0F] +\n      HEX_CHARS[(h0 >> 20) & 0x0F] + HEX_CHARS[(h0 >> 16) & 0x0F] +\n      HEX_CHARS[(h0 >> 12) & 0x0F] + HEX_CHARS[(h0 >> 8) & 0x0F] +\n      HEX_CHARS[(h0 >> 4) & 0x0F] + HEX_CHARS[h0 & 0x0F] +\n      HEX_CHARS[(h1 >> 28) & 0x0F] + HEX_CHARS[(h1 >> 24) & 0x0F] +\n      HEX_CHARS[(h1 >> 20) & 0x0F] + HEX_CHARS[(h1 >> 16) & 0x0F] +\n      HEX_CHARS[(h1 >> 12) & 0x0F] + HEX_CHARS[(h1 >> 8) & 0x0F] +\n      HEX_CHARS[(h1 >> 4) & 0x0F] + HEX_CHARS[h1 & 0x0F] +\n      HEX_CHARS[(h2 >> 28) & 0x0F] + HEX_CHARS[(h2 >> 24) & 0x0F] +\n      HEX_CHARS[(h2 >> 20) & 0x0F] + HEX_CHARS[(h2 >> 16) & 0x0F] +\n      HEX_CHARS[(h2 >> 12) & 0x0F] + HEX_CHARS[(h2 >> 8) & 0x0F] +\n      HEX_CHARS[(h2 >> 4) & 0x0F] + HEX_CHARS[h2 & 0x0F] +\n      HEX_CHARS[(h3 >> 28) & 0x0F] + HEX_CHARS[(h3 >> 24) & 0x0F] +\n      HEX_CHARS[(h3 >> 20) & 0x0F] + HEX_CHARS[(h3 >> 16) & 0x0F] +\n      HEX_CHARS[(h3 >> 12) & 0x0F] + HEX_CHARS[(h3 >> 8) & 0x0F] +\n      HEX_CHARS[(h3 >> 4) & 0x0F] + HEX_CHARS[h3 & 0x0F] +\n      HEX_CHARS[(h4 >> 28) & 0x0F] + HEX_CHARS[(h4 >> 24) & 0x0F] +\n      HEX_CHARS[(h4 >> 20) & 0x0F] + HEX_CHARS[(h4 >> 16) & 0x0F] +\n      HEX_CHARS[(h4 >> 12) & 0x0F] + HEX_CHARS[(h4 >> 8) & 0x0F] +\n      HEX_CHARS[(h4 >> 4) & 0x0F] + HEX_CHARS[h4 & 0x0F] +\n      HEX_CHARS[(h5 >> 28) & 0x0F] + HEX_CHARS[(h5 >> 24) & 0x0F] +\n      HEX_CHARS[(h5 >> 20) & 0x0F] + HEX_CHARS[(h5 >> 16) & 0x0F] +\n      HEX_CHARS[(h5 >> 12) & 0x0F] + HEX_CHARS[(h5 >> 8) & 0x0F] +\n      HEX_CHARS[(h5 >> 4) & 0x0F] + HEX_CHARS[h5 & 0x0F] +\n      HEX_CHARS[(h6 >> 28) & 0x0F] + HEX_CHARS[(h6 >> 24) & 0x0F] +\n      HEX_CHARS[(h6 >> 20) & 0x0F] + HEX_CHARS[(h6 >> 16) & 0x0F] +\n      HEX_CHARS[(h6 >> 12) & 0x0F] + HEX_CHARS[(h6 >> 8) & 0x0F] +\n      HEX_CHARS[(h6 >> 4) & 0x0F] + HEX_CHARS[h6 & 0x0F];\n    if (!this.is224) {\n      hex += HEX_CHARS[(h7 >> 28) & 0x0F] + HEX_CHARS[(h7 >> 24) & 0x0F] +\n        HEX_CHARS[(h7 >> 20) & 0x0F] + HEX_CHARS[(h7 >> 16) & 0x0F] +\n        HEX_CHARS[(h7 >> 12) & 0x0F] + HEX_CHARS[(h7 >> 8) & 0x0F] +\n        HEX_CHARS[(h7 >> 4) & 0x0F] + HEX_CHARS[h7 & 0x0F];\n    }\n    return hex;\n  };\n\n  Sha256.prototype.toString = Sha256.prototype.hex;\n\n  Sha256.prototype.digest = function () {\n    this.finalize();\n\n    var h0 = this.h0, h1 = this.h1, h2 = this.h2, h3 = this.h3, h4 = this.h4, h5 = this.h5,\n      h6 = this.h6, h7 = this.h7;\n\n    var arr = [\n      (h0 >> 24) & 0xFF, (h0 >> 16) & 0xFF, (h0 >> 8) & 0xFF, h0 & 0xFF,\n      (h1 >> 24) & 0xFF, (h1 >> 16) & 0xFF, (h1 >> 8) & 0xFF, h1 & 0xFF,\n      (h2 >> 24) & 0xFF, (h2 >> 16) & 0xFF, (h2 >> 8) & 0xFF, h2 & 0xFF,\n      (h3 >> 24) & 0xFF, (h3 >> 16) & 0xFF, (h3 >> 8) & 0xFF, h3 & 0xFF,\n      (h4 >> 24) & 0xFF, (h4 >> 16) & 0xFF, (h4 >> 8) & 0xFF, h4 & 0xFF,\n      (h5 >> 24) & 0xFF, (h5 >> 16) & 0xFF, (h5 >> 8) & 0xFF, h5 & 0xFF,\n      (h6 >> 24) & 0xFF, (h6 >> 16) & 0xFF, (h6 >> 8) & 0xFF, h6 & 0xFF\n    ];\n    if (!this.is224) {\n      arr.push((h7 >> 24) & 0xFF, (h7 >> 16) & 0xFF, (h7 >> 8) & 0xFF, h7 & 0xFF);\n    }\n    return arr;\n  };\n\n  Sha256.prototype.array = Sha256.prototype.digest;\n\n  Sha256.prototype.arrayBuffer = function () {\n    this.finalize();\n\n    var buffer = new ArrayBuffer(this.is224 ? 28 : 32);\n    var dataView = new DataView(buffer);\n    dataView.setUint32(0, this.h0);\n    dataView.setUint32(4, this.h1);\n    dataView.setUint32(8, this.h2);\n    dataView.setUint32(12, this.h3);\n    dataView.setUint32(16, this.h4);\n    dataView.setUint32(20, this.h5);\n    dataView.setUint32(24, this.h6);\n    if (!this.is224) {\n      dataView.setUint32(28, this.h7);\n    }\n    return buffer;\n  };\n\n  function HmacSha256(key, is224, sharedMemory) {\n    var i, type = typeof key;\n    if (type === 'string') {\n      var bytes = [], length = key.length, index = 0, code;\n      for (i = 0; i < length; ++i) {\n        code = key.charCodeAt(i);\n        if (code < 0x80) {\n          bytes[index++] = code;\n        } else if (code < 0x800) {\n          bytes[index++] = (0xc0 | (code >> 6));\n          bytes[index++] = (0x80 | (code & 0x3f));\n        } else if (code < 0xd800 || code >= 0xe000) {\n          bytes[index++] = (0xe0 | (code >> 12));\n          bytes[index++] = (0x80 | ((code >> 6) & 0x3f));\n          bytes[index++] = (0x80 | (code & 0x3f));\n        } else {\n          code = 0x10000 + (((code & 0x3ff) << 10) | (key.charCodeAt(++i) & 0x3ff));\n          bytes[index++] = (0xf0 | (code >> 18));\n          bytes[index++] = (0x80 | ((code >> 12) & 0x3f));\n          bytes[index++] = (0x80 | ((code >> 6) & 0x3f));\n          bytes[index++] = (0x80 | (code & 0x3f));\n        }\n      }\n      key = bytes;\n    } else {\n      if (type === 'object') {\n        if (key === null) {\n          throw new Error(ERROR);\n        } else if (ARRAY_BUFFER && key.constructor === ArrayBuffer) {\n          key = new Uint8Array(key);\n        } else if (!Array.isArray(key)) {\n          if (!ARRAY_BUFFER || !ArrayBuffer.isView(key)) {\n            throw new Error(ERROR);\n          }\n        }\n      } else {\n        throw new Error(ERROR);\n      }\n    }\n\n    if (key.length > 64) {\n      key = (new Sha256(is224, true)).update(key).array();\n    }\n\n    var oKeyPad = [], iKeyPad = [];\n    for (i = 0; i < 64; ++i) {\n      var b = key[i] || 0;\n      oKeyPad[i] = 0x5c ^ b;\n      iKeyPad[i] = 0x36 ^ b;\n    }\n\n    Sha256.call(this, is224, sharedMemory);\n\n    this.update(iKeyPad);\n    this.oKeyPad = oKeyPad;\n    this.inner = true;\n    this.sharedMemory = sharedMemory;\n  }\n  HmacSha256.prototype = new Sha256();\n\n  HmacSha256.prototype.finalize = function () {\n    Sha256.prototype.finalize.call(this);\n    if (this.inner) {\n      this.inner = false;\n      var innerHash = this.array();\n      Sha256.call(this, this.is224, this.sharedMemory);\n      this.update(this.oKeyPad);\n      this.update(innerHash);\n      Sha256.prototype.finalize.call(this);\n    }\n  };\n\n  var exports = createMethod();\n  exports.sha256 = exports;\n  exports.sha224 = createMethod(true);\n  exports.sha256.hmac = createHmacMethod();\n  exports.sha224.hmac = createHmacMethod(true);\n\n  if (COMMON_JS) {\n    module.exports = exports;\n  } else {\n    root.sha256 = exports.sha256;\n    root.sha224 = exports.sha224;\n    if (AMD) {\n      define(function () {\n        return exports;\n      });\n    }\n  }\n})();\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\"use strict\";\n\nimport * as log from './log.js';\nimport * as authn from '@byuweb/browser-oauth/constants.js';\nimport {StorageHandler} from \"./local-storage.js\";\n// NOTE: not using browser `crypto` module, because `crypto.subtle` isn't available when the browser isn't in HTTPS,\n// and our development environments usually use plain HTTP. We're only doing a single one-way hash, so performance\n// isn't a big deal\nimport sha256Lib from 'js-sha256'\nconst sha256 = sha256Lib.sha256\n\nlet SINGLETON_INSTANCE;\nlet BASE_URL;\n\nconst CHILD_IFRAME_ID = 'byu-oauth-implicit-grant-refresh-iframe'\nconst STORED_STATE_LIFETIME = 5 * 60 * 1000; // 5 minutes (in milliseconds)\nconst EXPIRATION_BUFFER = (5 * 60) + 5; // 5 minutes + 5 seconds (in seconds)\nexport const IG_STATE_AUTO_REFRESH_FAILED = 'implicit-grant-auto-refresh-failed'\n\nexport class ImplicitGrantProvider {\n  constructor(config, window, document, storageHandler = new StorageHandler()) {\n    log.debug('initializing provider with config', config);\n    this.config = config;\n    this.window = window;\n    this.document = document;\n    this.storageHandler = storageHandler;\n    this._listeners = {};\n\n    BASE_URL = this.config.baseUrl.replace(/\\/+$/, '') // strip trailing slash(es)\n\n    this.store = Object.freeze({\n      state: authn.STATE_INDETERMINATE,\n      user: null,\n      token: null,\n      error: null\n    });\n    log.debug('initialized provider');\n  }\n\n  _changeState(state, user, token, error) {\n    logStateChange(state, user, token, error);\n    this.store = Object.freeze({\n      state, user, token, error\n    });\n    _dispatchEvent(this, authn.EVENT_STATE_CHANGE, this.store);\n  }\n\n  _checkPopupOpener() {\n    try {\n      const origin = this.window.opener.location.origin\n      if (origin === (new URL(this.config.callbackUrl)).origin) { // Origins match\n        return this.window.opener\n      }\n    } catch (e) {\n      // Failed to get window.opener.location.origin, so we must have been opened\n      // from a different origin.\n      // Fall through to the \"return false\" outside this try/catch block\n    }\n    return false\n  }\n\n  _checkIframeOpener() {\n    try {\n      const iframe = this.window.parent.document.getElementById(CHILD_IFRAME_ID)\n      if (iframe && iframe.contentWindow === this.window) {\n        return iframe\n      }\n    } catch (e) {\n      // Failed to access window.parent info, so we must be in an iframe from a different\n      // origin.\n      // Fall through to the \"return false\" outside this try/catch block\n    }\n    return false\n  }\n\n  // Separate state change listener, because state change events\n  // might come from child iframe/popup window\n  handleStateChange({ state, user, token, source }) {\n    log.debug('in handleStateChange', state);\n\n    const opener = this._checkPopupOpener()\n    // If this is a popup\n    if (opener) {\n      // We're inside a child re-authentication popup\n\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(opener, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'popup' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('closing self');\n        this.window.close()\n      }\n\n      return\n    }\n\n    const iframe = this._checkIframeOpener()\n    // If we're inside a \"refresh\" iframe\n    if (iframe) {\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(this.window.parent, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'iframe' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('removing child iframe');\n        iframe.parentNode.removeChild(iframe)\n      }\n\n      return\n    }\n\n    this._maybeUpdateStoredSession(state, user, token);\n\n    if (state === authn.STATE_AUTHENTICATED) {\n      this._checkExpired(token.expiresAt.getTime())\n    }\n  }\n\n  async startup() {\n    ensureOnlyInstance(this);\n    log.info('starting up');\n    this.listen();\n    this._changeState(authn.STATE_INDETERMINATE);\n\n    const location = this._location;\n\n    if (this.isAuthenticationCallback(location)) {\n      log.debug('handling authentication callback');\n      this._changeState(authn.STATE_AUTHENTICATING);\n      try {\n        const {state, user, token, error} = await _handleAuthenticationCallback(\n          this.config,\n          location,\n          this.storageHandler\n        );\n        this._changeState(state, user, token, error);\n      } catch (err) {\n        log.error('OAuth Error', err);\n        this._changeState(authn.STATE_ERROR, undefined, undefined, err);\n      }\n    } else if (this.hasStoredSession()) {\n      log.debug('Has stored session');\n      this._updateStateFromStorage();\n    } else {\n      log.debug('no authentication present');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n    return this;\n  }\n\n  _checkExpired(expirationTimeInMs) {\n    const expiresInMs = expirationTimeInMs - Date.now()\n\n    log.debug(`checking expiration time; expires in ${expiresInMs} ms, ${new Date(expirationTimeInMs)}`);\n\n    if (expiresInMs > (30 * 1000)) { // 30 second buffer before token actually expires\n      if (this.__expirationTask) {\n        clearTimeout(this.__expirationTask);\n      }\n      // Simply using setTimeout for an hour in the future\n      // doesn't work; setTimeout isn't that precise over that long of a period.\n      // So re-check every five seconds until we're past the expiration time\n      this.__expirationTask = setTimeout(() =>  {\n        this.__expirationTask = null;\n        this._checkExpired(expirationTimeInMs);\n      }, 5000);\n\n      return;\n    }\n\n    if (this.config.autoRefreshOnTimeout) {\n      this.startRefresh('iframe');\n    } else {\n      // We don't have auto-refresh enabled, so flag the token as expired and let the application handle it.\n      this._changeState(authn.STATE_EXPIRED, this.store.user, this.store.token);\n    }\n  }\n\n  get _location() {\n    return this.window.location;\n  }\n\n  isAuthenticationCallback(location) {\n    const isCallbackUrl = location.href.indexOf(this.config.callbackUrl) === 0;\n    const hasCode = location.search && location.search.includes('code=') && location.search.includes('state=')\n\n    return !!(isCallbackUrl && hasCode)\n  }\n\n  hasStoredSession() {\n    return !!this.storageHandler.getSessionState(this.config.clientId);\n  }\n\n  shutdown() {\n    log.info('shutting down');\n    this.unlisten();\n    this._changeState(authn.STATE_INDETERMINATE);\n    cleanupOnlyInstance(this);\n  }\n\n  listen() {\n    log.debug('setting up event listeners');\n    _listenTo(this, authn.EVENT_LOGIN_REQUESTED, this.startLogin);\n    _listenTo(this, authn.EVENT_LOGOUT_REQUESTED, this.startLogout);\n    _listenTo(this, authn.EVENT_REFRESH_REQUESTED, this.startRefresh);\n    _listenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED, this.handleCurrentInfoRequest);\n    _listenTo(this, authn.EVENT_STATE_CHANGE, this.handleStateChange);\n  }\n\n  unlisten() {\n    log.debug('tearing down event listeners');\n    _unlistenTo(this, authn.EVENT_LOGIN_REQUESTED);\n    _unlistenTo(this, authn.EVENT_LOGOUT_REQUESTED);\n    _unlistenTo(this, authn.EVENT_REFRESH_REQUESTED);\n    _unlistenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED);\n    _unlistenTo(this, authn.EVENT_STATE_CHANGE);\n  }\n\n  startLogin(displayType = 'window') {\n    log.infof('Starting login. mode=%s', displayType);\n    const {clientId, callbackUrl} = this.config;\n    const csrf = randomString();\n    const codeVerifier = randomString(128);\n    // challenge is base64-encoded SHA256 hash of codeVerifier\n    const codeChallenge = btoa(String.fromCharCode(...sha256.array(codeVerifier)))\n      .replace(/\\+/g, '-')\n      .replace(/\\//g, '_')\n      .replace(/=/g, '')\n\n    const storedState = _prepareStoredState(Date.now() + STORED_STATE_LIFETIME, csrf, codeVerifier, {});\n    this.storageHandler.saveOAuthState(this.config.clientId, storedState);\n\n    const loginUrl = `${BASE_URL}/authorize?response_type=code&client_id=${clientId}&redirect_uri=${encodeURIComponent(callbackUrl)}&scope=openid&state=${csrf}&code_challenge=${codeChallenge}&code_challenge_method=S256`;\n    log.debug('computed login url of', loginUrl);\n\n    if (!displayType || displayType == 'window') {\n      log.info(`Redirecting user to '${loginUrl}'`);\n      this.window.location = loginUrl;\n      return\n    } else if (displayType === 'popup') {\n      log.info('launching popup at', loginUrl);\n      this.window.open(loginUrl)\n      return\n    }\n\n    log.info('Setting up hidden refresh iframe at', loginUrl);\n    // last option: displayType == 'iframe'\n    let iframe = this.document.getElementById(CHILD_IFRAME_ID)\n    if (iframe) {\n      iframe.parentNode.removeChild(iframe)\n    }\n    iframe = this.document.createElement('iframe')\n    iframe.onload = () => {\n      let html = null\n      try {\n        html = iframe.contentWindow.document.body.innerHTML\n      } catch (err) {\n        // intentional do-nothing\n      }\n      if (html === null) {\n        // Hidden-frame refresh failed. Remove frame and\n        // report problem\n        iframe.parentNode.removeChild(iframe)\n        this._changeState(IG_STATE_AUTO_REFRESH_FAILED, null, null)\n        this._changeState(authn.STATE_UNAUTHENTICATED, null, null)\n      }\n    }\n    iframe.id = CHILD_IFRAME_ID\n    iframe.src = loginUrl\n    iframe.style = 'display:none'\n    log.debug('appending iframe', iframe);\n    this.document.body.appendChild(iframe);\n  }\n\n  startLogout() {\n    log.info('starting logout');\n    this.storageHandler.clearSessionState(this.config.clientId);\n    // Need to ensure BOTH api.byu.edu and cas.byu.edu clean out their sessions\n    // With current config of those two sites, to have that full clean out AND a final \"where to go after logout\"\n    // redirect, we need to manually wrap them all together\n    const logoutRedirect = (this.config.logoutRedirect === undefined) ? this.config.callbackUrl : this.config.logoutRedirect\n    const casLogoutUrl = 'https://cas.byu.edu/cas/logout?service=' + encodeURIComponent(logoutRedirect)\n    const logoutUrl = `${BASE_URL}/logout?redirect_url=` + encodeURIComponent(casLogoutUrl);\n    log.info('logging out by redirecting to', logoutUrl);\n    this.window.location = logoutUrl;\n\n    //TODO: WSO2 Identity Server 5.1 allows us to revoke implicit tokens.  Once that's done, we'll need to do this.\n    // const url = `https://api.byu.edu/revoke`;\n\n    // const form = new URLSearchParams();\n    // form.set('token', store.token.bearer);\n    // form.set('client_id', config.clientId);\n    // form.set('token_type_hint', 'access_token');\n\n    // console.log('logout url', url);\n\n    // fetch(url, {\n    //     method: 'POST',\n    //     body: form,\n    //     // headers: {\n    //     //     'Content-Type': 'application/x-www-form-urlencoded'\n    //     // }\n    // }).then(result => {\n    //     console.log('done with logout', result);\n    // });\n  }\n\n  async startRefresh(displayType = 'iframe') {\n    log.infof('starting refresh. displayType=%s', displayType);\n\n    // Save copy of current info before triggering changeState\n    const token = Object.assign({}, this.store.token)\n    const user = Object.assign({}, this.store.user)\n\n    // Also pass yet another isolated copy to changeState\n    this._changeState(authn.STATE_REFRESHING, Object.assign({}, this.store.user), Object.assign({}, this.store.token));\n\n    if (displayType !== 'iframe') {\n      this.startLogin(displayType);\n      return;\n    }\n\n    // If we have a refresh token, then try that before doing the more complicated iframe version\n    if (!(token && token.refresh)) {\n      this.startLogin('iframe');\n      return;\n    }\n\n    const tokenUrl = `${BASE_URL}/token`;\n    const body = new URLSearchParams();\n    body.set('grant_type', 'refresh_token');\n    body.set('client_id', this.config.clientId);\n    body.set('refresh_token', token.refresh)\n\n    const resp = await fetch(tokenUrl, {\n      method: 'POST',\n      headers: new Headers({ 'Accept': 'application/json', 'Content-Type': 'application/x-www-form-urlencoded' }),\n      body\n    });\n\n    if (resp.status !== 200) {\n      this.startLogin('iframe');\n      return;\n    }\n\n    const tokenInfo = await resp.json();\n    token.bearer = tokenInfo.access_token;\n    token.refresh = tokenInfo.refresh_token;\n    const expiresIn = tokenInfo.expires_in - EXPIRATION_BUFFER;\n    token.authorizationHeader = `Bearer ${token.bearer}`;\n    token.expiresAt = new Date(Date.now() + (expiresIn * 1000));\n\n    this._changeState(authn.STATE_AUTHENTICATED, user, token);\n  }\n\n  handleCurrentInfoRequest({callback}) {\n    log.debug('got current info request');\n    if (callback) {\n      callback(this.store);\n    }\n  }\n\n  _updateStateFromStorage() {\n    log.debug('updating state from local storage');\n    const serialized = this.storageHandler.getSessionState(this.config.clientId);\n    if (!serialized) {\n      log.debug('no stored state');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n      return;\n    }\n    const {user, token} = deserializeSessionState(serialized);\n    if (!user || !token) {\n      log.debug('no stored user or token');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    } else if (token.expiresAt > new Date()) {\n      log.debug('found an unexpired saved session');\n      this._changeState(authn.STATE_AUTHENTICATED, user, token);\n    } else {\n      log.debug('stored session was expired');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n  }\n\n  _maybeUpdateStoredSession(state, user, token) {\n    log.debugf('updating stored session: state=%s hasUser=%s, hasToken=%s', state, !!user, !!token);\n    if (state === authn.STATE_UNAUTHENTICATED || state === authn.STATE_REFRESHING || state === authn.STATE_EXPIRED) {\n      log.debug('state is unauthenticated or expired, clearing stored session');\n      this.storageHandler.clearSessionState(this.config.clientId);\n    } else if (!!user && !!token) {\n      log.debug('storing session', redactUser(user), redactToken(token));\n      const serialized = serializeSessionState(user, token);\n      this.storageHandler.saveSessionState(this.config.clientId, serialized);\n    }\n  }\n}\n\nfunction serializeSessionState(user, token) {\n  const grouped = groupClaimPrefixes(token.rawUserInfo);\n\n  const smallerUserInfo = {\n    ro: grouped[CLAIMS_PREFIX_RESOURCE_OWNER],\n    cl: grouped[CLAIMS_PREFIX_CLIENT],\n    wso2: grouped[CLAIMS_PREFIX_WSO2],\n    o: grouped.other,\n  };\n\n  return {\n    ui: smallerUserInfo,\n    at: token.bearer,\n    rf: token.refresh,\n    ah: token.authorizationHeader,\n    ea: token.expiresAt.getTime()\n  };\n}\n\nfunction deserializeSessionState(state) {\n  const groupedUserInfo = {\n    [CLAIMS_PREFIX_RESOURCE_OWNER]: state.ui.ro,\n    [CLAIMS_PREFIX_CLIENT]: state.ui.cl,\n    [CLAIMS_PREFIX_WSO2]: state.ui.wso2,\n    other: state.ui.o,\n  }\n  const userInfo = ungroupClaimPrefixes(groupedUserInfo);\n\n  const user = _processUserInfo(userInfo);\n  const expiresAt = new Date(state.ea);\n  const token = _processTokenInfo({ userInfo, accessToken: state.at, expiresAt, authHeader: `Bearer ${state.at}`, refreshToken: state.rf });\n  return {user, token};\n}\n\nfunction _listenTo(provider, event, listener) {\n  if (provider._listeners.hasOwnProperty(event)) {\n    throw new Error('A listener is already registered for ' + event);\n  }\n  const obs = provider._listeners[event] = function (e) {\n    listener.call(provider, e.detail);\n  }.bind(provider);\n\n  provider.document.addEventListener(event, obs, false);\n}\n\nfunction _unlistenTo(provider, event) {\n  if (!provider._listeners.hasOwnProperty(event)) {\n    return;\n  }\n\n  provider.document.removeEventListener(event, provider._listeners[event], false);\n  delete provider._listeners[event];\n}\n\n\nfunction _dispatchEvent(provider, name, detail) {\n  let event;\n  if (typeof provider.window.CustomEvent === 'function') {\n    event = new CustomEvent(name, {detail});\n  } else {\n    event = provider.document.createEvent('CustomEvent');\n    event.initCustomEvent(name, true, false, detail);\n  }\n  provider.document.dispatchEvent(event);\n}\n\nasync function _handleAuthenticationCallback(config, location, storage) {\n  const searchParams = new URLSearchParams(location.search);\n\n  const oauthCsrfToken = searchParams.get('state');\n  const storedState = storage.getOAuthState(config.clientId);\n\n  storage.clearOAuthState(config.clientId);\n\n  log.debug('checking oauth state token');\n  const pageState = _validateAndGetStoredState(storedState, oauthCsrfToken);\n  const tokenInfo = await _fetchTokenInfo(searchParams.get('code'), config, storedState.v)\n\n  const accessToken = tokenInfo.access_token;\n  const refreshToken = tokenInfo.refresh_token;\n  const expiresIn = tokenInfo.expires_in - EXPIRATION_BUFFER;\n  const expiresAt = new Date(Date.now() + (expiresIn * 1000));\n  const authHeader = `Bearer ${accessToken}`;\n  log.debug('got token', redactBearerToken(accessToken), 'which expires in', expiresIn, 'seconds');\n\n  const userInfo = await _fetchUserInfo(authHeader);\n\n  const user = _processUserInfo(userInfo);\n  const token = _processTokenInfo({ userInfo, accessToken, expiresAt, authHeader, refreshToken });\n\n  return {state: authn.STATE_AUTHENTICATED, user, token};\n}\n\n\nasync function _fetchTokenInfo(code, config, codeVerifier) {\n  log.debug('Exchanging code for token');\n  const tokenUrl = `${BASE_URL}/token`;\n  const body = new URLSearchParams();\n  body.set('grant_type', 'authorization_code');\n  body.set('client_id', config.clientId);\n  body.set('redirect_uri', config.callbackUrl);\n  body.set('code', code);\n  body.set('code_verifier', codeVerifier)\n\n  const resp = await fetch(tokenUrl, {\n    method: 'POST',\n    headers: new Headers({ 'Accept': 'application/json', 'Content-Type': 'application/x-www-form-urlencoded' }),\n    body\n  });\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    log.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-exchange-code-for-token',\n      'Unable to exchange code for token. Please try again.'\n    );\n  }\n\n  const json = await resp.json();\n  log.debug('successfully got user info', json);\n  return json;\n}\n\nasync function _fetchUserInfo(authHeader) {\n  const USER_INFO_URL = `${BASE_URL}/openid-userinfo/v1/userinfo?schema=openid`;\n  log.debug('fetching user info from', USER_INFO_URL);\n  const resp = await fetch(USER_INFO_URL, {\n    method: 'GET',\n    headers: new Headers({'Accept': 'application/json', 'Authorization': authHeader}),\n    mode: 'cors',\n  });\n\n  log.debug('got status', resp.status);\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    if (resp.status === 403) {\n      log.debug('got forbidden error');\n      if (body.includes('<ams:code>900908</ams:code>')) {\n        log.debug('client app isn\\'t subscribed to OpenID UserInfo endpoint');\n        log.error(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`);\n        throw new OAuthError(\n          'not-subscribed-to-user-info',\n          'This page has an authentication configuration error. Developers, see the console for details.'\n        );\n      } else {\n        log.error('invalid oauth bearer token');\n        throw new OAuthError(\n          'invalid-oauth-token',\n          'The provided authentication token is invalid. Please try again.'\n        );\n      }\n    }\n    log.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-get-user-info',\n      'Unable to fetch user information. Please try again.'\n    );\n  }\n  const json = await resp.json();\n  log.debug('successfully got user info', json);\n  return json;\n}\n\nconst CLAIMS_PREFIX_RESOURCE_OWNER = 'http://byu.edu/claims/resourceowner_';\nconst CLAIMS_PREFIX_CLIENT = 'http://byu.edu/claims/client_';\nconst CLAIMS_PREFIX_WSO2 = 'http://wso2.org/claims/';\n\nconst CLAIMS_KNOWN_PREFIXES = [CLAIMS_PREFIX_CLIENT, CLAIMS_PREFIX_RESOURCE_OWNER, CLAIMS_PREFIX_WSO2];\n\nfunction groupClaimPrefixes(userInfo) {\n  const grouped = {\n    other: {}\n  };\n  for (const prefix of CLAIMS_KNOWN_PREFIXES) {\n    grouped[prefix] = {};\n  }\n  for (const key of Object.keys(userInfo)) {\n    const value = userInfo[key];\n    const prefix = CLAIMS_KNOWN_PREFIXES.find(it => key.startsWith(it));\n    if (prefix) {\n        grouped[prefix][key.substr(prefix.length)] = value;\n    } else {\n      grouped.other[key] = value;\n    }\n  }\n  return grouped;\n}\n\nfunction ungroupClaimPrefixes(grouped) {\n  const result = {};\n  for (const groupKey of CLAIMS_KNOWN_PREFIXES) {\n    const group = grouped[groupKey];\n    if (!group) continue;\n    for (const key of Object.keys(group)) {\n      result[groupKey + key] = group[key];\n    }\n  }\n  for (const other of Object.keys(grouped.other)) {\n    result[other] = grouped.other[other];\n  }\n  return result;\n}\n\nfunction getClaims(userInfo, prefix) {\n  return Object.keys(userInfo).filter(k => k.startsWith(prefix))\n    .reduce((agg, key) => {\n      agg[key.substr(prefix.length)] = userInfo[key];\n      return agg;\n    }, {});\n}\n\nfunction _processUserInfo(userInfo) {\n  const roClaims = getClaims(userInfo, CLAIMS_PREFIX_RESOURCE_OWNER);\n\n  const familyNamePosition = roClaims.surname_position;\n  const givenName = roClaims.preferred_first_name;\n  const familyName = roClaims.surname;\n\n  const displayName = familyNamePosition === 'F' ? `${familyName} ${givenName}` : `${givenName} ${familyName}`;\n\n  return {\n    personId: roClaims.person_id,\n    byuId: roClaims.byu_id,\n    netId: roClaims.net_id,\n    name: {\n      sortName: roClaims.sort_name,\n      displayName,\n      givenName,\n      familyName,\n      familyNamePosition,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _processTokenInfo({ userInfo, accessToken, expiresAt, authHeader, refreshToken }) {\n  const clientClaims = getClaims(userInfo, CLAIMS_PREFIX_CLIENT);\n  const wso2Claims = getClaims(userInfo, CLAIMS_PREFIX_WSO2);\n\n  return {\n    bearer: accessToken,\n    refresh: refreshToken,\n    authorizationHeader: authHeader,\n    expiresAt,\n    client: {\n      id: wso2Claims.client_id,\n      byuId: clientClaims.byu_id,\n      appName: wso2Claims.applicationname,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _validateAndGetStoredState(storedState, expectedCsrfToken) {\n  log.debug('validating stored state token. Expecting token', expectedCsrfToken, ', got state', storedState);\n  if (!storedState) {\n    log.error('no stored oauth login state');\n    throw new OAuthError('no-oauth-state', 'Your saved authentication information does not match. Please try again.');\n  }\n  const {e: stateExpiresString, c: storedCsrfToken, s: pageState} = storedState;\n\n  if (expectedCsrfToken !== storedCsrfToken) {\n    log.error('CSRF token mismatch')\n    throw new OAuthError(\n      'oauth-state-mismatch',\n      'Your saved authentication information does not match. Please try again.'\n    );\n  }\n\n  if (Number(stateExpiresString) < Date.now()) {\n    log.error('stored state has expired');\n    throw new OAuthError(\n      'oauth-state-expired',\n      'Your login attempt has timed out. Please try again.'\n    );\n  }\n\n  return pageState;\n}\n\nfunction _prepareStoredState(expires, csrfToken, codeVerifier, pageState) {\n  return {\n    e: expires,\n    c: csrfToken,\n    v: codeVerifier,\n    s: pageState,\n  }\n}\n\nclass OAuthError extends Error {\n  constructor(type, description, uri) {\n    super('OAuth Error: ' + description);\n    this.type = type;\n    this.description = description;\n    this.uri = uri;\n  }\n}\n\nconst allowableRandomChars = [...'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'];\nconst randomCharRangeConvert = allowableRandomChars.length / 2**8; // Using Uint8Array for getRandomValues\n\nfunction randomString(length) {\n  const randomArray = new Uint8Array(length || 24);\n  const crypto = window.crypto || window.msCrypto;\n  crypto.getRandomValues(randomArray);\n\n  return randomArray.reduce((str, cur) => str + allowableRandomChars[Math.floor(cur * randomCharRangeConvert)], '');\n}\n\nfunction logStateChange(state, user, token, error) {\n  const logParts = [\n    'state change:',\n    {\n      state,\n      user: redactUser(user),\n      token: token, //redactToken(token),\n      error: error\n    }\n  ];\n  if (error) {\n    log.error(...logParts);\n  } else {\n    log.info(...logParts);\n  }\n}\n\nfunction redactUser(u) {\n  if (!u) return undefined;\n  return {\n    netId: u.netId,\n    'rest-is-redacted': true\n  };\n}\n\nfunction redactToken(t) {\n  log.debug('redacting token', t);\n  if (!t) return undefined;\n  const {bearer, expiresAt, client} = t;\n  return {\n    bearer: redactBearerToken(bearer),\n    expiresAt: !!expiresAt ? expiresAt.toISOString() : null,\n    client,\n    'rest-is-redacted': true\n  }\n}\nfunction redactBearerToken(b) {\n  if (!b) return undefined;\n  return b.substring(0, 2) + '...redacted...' + b.substring(b.length - 2)\n}\n\nfunction ensureOnlyInstance(obj) {\n  if (SINGLETON_INSTANCE) {\n    const trace = SINGLETON_INSTANCE.___startupTrace;\n    throw new Error('There is already an instance of byu-oauth-implicit running!  Please call `#shutdown()` on that instance before starting a new one. Instance was started at:\\n' + trace);\n  }\n  obj.___startupTrace = new Error().stack;\n  SINGLETON_INSTANCE = obj;\n}\n\nfunction cleanupOnlyInstance(obj) {\n  SINGLETON_INSTANCE = null;\n}\n\nexport function __forceShutdown() {\n  if (SINGLETON_INSTANCE) {\n    SINGLETON_INSTANCE.shutdown();\n    cleanupOnlyInstance(SINGLETON_INSTANCE);\n  }\n}\n","/*\n * Copyright 2018 Brigham Young University\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IG_STATE_AUTO_REFRESH_FAILED, ImplicitGrantProvider } from \"./provider.js\";\nexport { IG_STATE_AUTO_REFRESH_FAILED }\n\nexport const DEFAULT_ISSUER = 'https://api.byu.edu';\nexport const DEFAULT_BASE_URL = 'https://api.byu.edu';\n\nexport const GLOBAL_CONFIG_KEY = 'byu-oauth-implicit-config';\n\n/**\n * @typedef {} ImplicitConfig\n * @prop {string} clientId\n * @prop {?string} issuer\n * @prop {?string} baseUrl\n * @prop {?string} callbackUrl\n * @prop {?boolean} requireAuthentication\n */\n\n/**\n * @param {ImplicitConfig|ImplicitConfig[]|undefined} cfgOrRules\n * @param location\n */\nexport async function configure(cfgOrRules, location = window.location) {\n  const cfg = resolveConfig(cfgOrRules, location);\n  const globalConfig = window[GLOBAL_CONFIG_KEY];\n\n  const config = Object.assign({\n    issuer: DEFAULT_ISSUER,\n    baseUrl: DEFAULT_BASE_URL,\n    callbackUrl: `${location.origin}${location.pathname}`,\n    autoRefreshOnTimeout: false\n  }, globalConfig, cfg);\n\n  if (!config.clientId) {\n    throw new Error('clientId must be specified in config');\n  }\n  const provider = new ImplicitGrantProvider(config, window, document);\n\n  return provider.startup();\n}\n\nfunction resolveConfig(rules, location) {\n  if (!rules) {\n    return {};\n  }\n\n  if ('clientId' in rules) {\n    return rules;\n  }\n\n  const keys = Object.keys(rules)\n    .filter(it => it.startsWith('https://') || it.startsWith('http://'));\n\n  if (keys.length === 0) {\n    return rules;\n  }\n\n  const key = keys\n    // order by length of key (most specific), descending\n    .sort((a, b) => b.length - a.length)\n    .find(it => location.href.startsWith(it));\n  if (key) {\n    return Object.assign({ callbackUrl: key }, rules[key]);\n  }\n  throw new Error(`Unable to match url [${location.href}] to one of [${keys}]`)\n}\n"],"names":["LEVEL_TRACE","priority","name","run","handleTrace","LEVEL_DEBUG","handleDebug","LEVEL_INFO","handleInfo","LEVEL_ERROR","handleError","ALL_LEVELS","DEFAULT_LEVEL","debug","args","log","info","error","debugf","format","logf","infof","level","shouldLog","getFormattedTime","now","Date","h24","String","getHours","padStart","min","getMinutes","sec","getSeconds","millis","getMilliseconds","formatTimezone","date","offset","getTimezoneOffset","nonNegative","absOffset","Math","abs","hourInt","floor","hourDone","sign","minDone","currentLevel","levelAttr","levelGlobalVar","lower","toLowerCase","find","l","document","documentElement","getAttribute","o","window","byuOAuth","logging","console","trace","EVENT_PREFIX","EVENT_STATE_CHANGE","EVENT_LOGIN_REQUESTED","EVENT_LOGOUT_REQUESTED","EVENT_REFRESH_REQUESTED","EVENT_CURRENT_INFO_REQUESTED","STATE_INDETERMINATE","STATE_UNAUTHENTICATED","STATE_AUTHENTICATED","STATE_AUTHENTICATING","STATE_REFRESHING","STATE_EXPIRED","STATE_ERROR","exports","parse","serialize","decode","decodeURIComponent","encode","encodeURIComponent","pairSplitRegExp","fieldContentRegExp","str","options","TypeError","obj","opt","pairs","split","dec","i","length","pair","eq_idx","indexOf","key","substr","trim","val","slice","undefined","tryDecode","enc","test","value","maxAge","isNaN","Error","domain","path","expires","toUTCString","httpOnly","secure","sameSite","e","Object","defineProperty","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Constructor","protoProps","staticProps","prototype","hasCookies","_cookie2","_interopRequireDefault","_cookie","__esModule","default","_classCallCheck","instance","prefix","CookieStorage","arguments","cookieOptions","assign","getItem","cookies","cookie","hasOwnProperty","setItem","removeItem","clear","storage","TEST_KEY","isSupported","hasStorage","replace","_CookieStorage","MemoryStorage","_data","_isSupported2","_isSupported","_CookieStorage2","_MemoryStorage2","_MemoryStorage","localStorage","sessionStorage","StorageHandler","saveOAuthState","clientId","state","getKey","JSON","stringify","getOAuthState","result","clearOAuthState","saveSessionState","getSessionKey","getSessionState","stored","clearSessionState","ERROR","WINDOW","root","JS_SHA256_NO_WINDOW","WEB_WORKER","self","NODE_JS","JS_SHA256_NO_NODE_JS","process","versions","node","global","COMMON_JS","JS_SHA256_NO_COMMON_JS","module","ARRAY_BUFFER","JS_SHA256_NO_ARRAY_BUFFER","ArrayBuffer","HEX_CHARS","EXTRA","SHIFT","K","OUTPUT_TYPES","blocks","Array","isArray","toString","call","JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW","isView","buffer","constructor","createOutputMethod","outputType","is224","message","Sha256","update","createMethod","method","nodeWrap","create","type","crypto","eval","Buffer","algorithm","nodeMethod","createHash","digest","Uint8Array","createHmacOutputMethod","HmacSha256","createHmacMethod","sharedMemory","h0","h1","h2","h3","h4","h5","h6","h7","block","start","bytes","hBytes","finalized","hashed","first","notString","code","index","charCodeAt","lastByteIndex","hash","finalize","a","b","c","d","f","g","h","j","s0","s1","maj","t1","t2","ch","ab","da","cd","bc","hex","arr","push","array","arrayBuffer","dataView","DataView","setUint32","oKeyPad","iKeyPad","inner","innerHash","sha256","sha224","hmac","sha256Lib","SINGLETON_INSTANCE","BASE_URL","CHILD_IFRAME_ID","STORED_STATE_LIFETIME","EXPIRATION_BUFFER","IG_STATE_AUTO_REFRESH_FAILED","ImplicitGrantProvider","config","storageHandler","_listeners","baseUrl","store","freeze","authn","user","token","_changeState","logStateChange","_dispatchEvent","_checkPopupOpener","origin","opener","location","URL","callbackUrl","_checkIframeOpener","iframe","parent","getElementById","contentWindow","handleStateChange","source","close","parentNode","removeChild","_maybeUpdateStoredSession","_checkExpired","expiresAt","getTime","startup","ensureOnlyInstance","listen","_location","isAuthenticationCallback","_handleAuthenticationCallback","err","hasStoredSession","_updateStateFromStorage","expirationTimeInMs","expiresInMs","__expirationTask","clearTimeout","setTimeout","autoRefreshOnTimeout","startRefresh","isCallbackUrl","href","hasCode","search","includes","shutdown","unlisten","cleanupOnlyInstance","_listenTo","startLogin","startLogout","handleCurrentInfoRequest","_unlistenTo","displayType","csrf","randomString","codeVerifier","codeChallenge","btoa","fromCharCode","storedState","_prepareStoredState","loginUrl","open","createElement","onload","html","body","innerHTML","id","src","style","appendChild","logoutRedirect","casLogoutUrl","logoutUrl","refresh","tokenUrl","URLSearchParams","set","resp","fetch","headers","Headers","status","tokenInfo","json","bearer","access_token","refresh_token","expiresIn","expires_in","authorizationHeader","callback","serialized","deserializeSessionState","redactUser","redactToken","serializeSessionState","grouped","groupClaimPrefixes","rawUserInfo","smallerUserInfo","ro","CLAIMS_PREFIX_RESOURCE_OWNER","cl","CLAIMS_PREFIX_CLIENT","wso2","CLAIMS_PREFIX_WSO2","other","ui","at","rf","ah","ea","groupedUserInfo","userInfo","ungroupClaimPrefixes","_processUserInfo","_processTokenInfo","accessToken","authHeader","refreshToken","provider","event","listener","obs","detail","bind","addEventListener","removeEventListener","CustomEvent","createEvent","initCustomEvent","dispatchEvent","searchParams","oauthCsrfToken","get","pageState","_validateAndGetStoredState","_fetchTokenInfo","v","redactBearerToken","_fetchUserInfo","text","OAuthError","USER_INFO_URL","mode","CLAIMS_KNOWN_PREFIXES","keys","it","startsWith","groupKey","group","getClaims","filter","k","reduce","agg","roClaims","familyNamePosition","surname_position","givenName","preferred_first_name","familyName","surname","displayName","personId","person_id","byuId","byu_id","netId","net_id","sortName","sort_name","clientClaims","wso2Claims","client","client_id","appName","applicationname","expectedCsrfToken","stateExpiresString","storedCsrfToken","s","Number","csrfToken","description","uri","allowableRandomChars","randomCharRangeConvert","randomArray","msCrypto","getRandomValues","cur","logParts","u","t","toISOString","substring","___startupTrace","stack","DEFAULT_ISSUER","DEFAULT_BASE_URL","GLOBAL_CONFIG_KEY","configure","cfgOrRules","cfg","resolveConfig","globalConfig","issuer","pathname","rules","sort"],"mappings":"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"}