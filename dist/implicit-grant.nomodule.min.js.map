{"version":3,"file":"implicit-grant.nomodule.min.js","sources":["../src/log.js","../src/url.mjs","../node_modules/cookie/index.js","../src/local-storage.mjs","../src/provider.mjs","../src/implicit-grant.mjs","../node_modules/@byuweb/browser-oauth/constants.js","../node_modules/local-storage-fallback/lib/CookieStorage.js","../node_modules/local-storage-fallback/lib/isSupported.js","../node_modules/local-storage-fallback/lib/MemoryStorage.js","../node_modules/local-storage-fallback/lib/index.js"],"sourcesContent":["const LEVEL_TRACE = {priority: 0, name: 'trace', run: handleTrace};\nconst LEVEL_DEBUG = {priority: 1, name: 'debug', run: handleDebug};\nconst LEVEL_INFO = {priority: 10, name: 'info', run: handleInfo};\nconst LEVEL_ERROR = {priority: 100, name: 'error', run: handleError};\n\nconst ALL_LEVELS = [LEVEL_TRACE, LEVEL_DEBUG, LEVEL_INFO, LEVEL_ERROR];\nconst DEFAULT_LEVEL = LEVEL_INFO;\n\nexport function debug(...args) {\n  doLog(LEVEL_DEBUG, ...args);\n}\n\nexport function info(...args) {\n  doLog(LEVEL_INFO, ...args);\n} \n\nexport function error(...args) {\n  doLog(LEVEL_ERROR, ...args);\n} \n\nfunction doLog(level, ...args) {\n    if (!shouldLog(level)) {\n        return;\n    }\n  const time = new Date().toLocaleTimeString({h12: false});\n  level.run('[byu-browser-oauth-implicit]', `[${level.name}]`, `(${time})`, ...args);\n}\n\nfunction shouldLog(level) {\n    return level.priority >= currentLevel().priority;\n}\n\nfunction currentLevel() {\n    const name = levelAttr() || levelGlobalVar();\n    if (!name) {\n        return DEFAULT_LEVEL;\n    }\n    const lower = name.toLowerCase();\n    return ALL_LEVELS.find(function(l) {return l.name === lower}) || DEFAULT_LEVEL;\n}\n\nfunction levelAttr() {\n    return document.documentElement.getAttribute('byu-oauth-logging')\n}\n\nfunction levelGlobalVar() {\n    const o = window.byuOAuth || {};\n    return o.logging;\n}\n\nfunction handleTrace(...args) {\n    if (console.trace) {\n        console.trace(...args);\n    } else {\n        console.log(...args);\n    }\n}\n\nfunction handleDebug(...args) {\n    console.log(...args);\n}\n\nfunction handleInfo(...args) {\n    if (console.info) {\n        console.info(...args);\n    } else {\n        console.log(...args);\n    }\n}\n\nfunction handleError(...args) {\n    if (console.error) {\n        console.error(...args);\n    } else {\n        console.log(...args);\n    }\n}\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport {debug} from './log.js';\n\nexport function parseHash(hash) {\n  debug('parsing hash', hash);\n  if (!hash) return new Map();\n  let subHash = hash;\n  if (hash.startsWith('#')) {\n    subHash = hash.substr(1);\n  }\n\n  const keyValues = subHash.split('&')\n    .map(it => it.split('=', 2));\n  return new Map(keyValues);\n}\n\n","/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(pairSplitRegExp);\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var eq_idx = pair.indexOf('=');\n\n    // skip things that don't look like key=value\n    if (eq_idx < 0) {\n      continue;\n    }\n\n    var key = pair.substr(0, eq_idx).trim()\n    var val = pair.substr(++eq_idx, pair.length).trim();\n\n    // quoted values\n    if ('\"' == val[0]) {\n      val = val.slice(1, -1);\n    }\n\n    // only assign once\n    if (undefined == obj[key]) {\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n    if (isNaN(maxAge)) throw new Error('maxAge should be a Number');\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport storage from 'local-storage-fallback';\n\nexport class StorageHandler {\n\n  saveOAuthState(clientId, state) {\n    storage.setItem(getKey(clientId), JSON.stringify(state));\n  }\n\n  getOAuthState(clientId) {\n    const result = storage.getItem(getKey(clientId));\n    if (!result) {\n      return null;\n    }\n    return JSON.parse(result);\n  }\n\n  clearOAuthState(clientId) {\n    storage.removeItem(getKey(clientId));\n  }\n\n  saveSessionState(clientId, state) {\n    storage.setItem(getSessionKey(clientId), JSON.stringify(state));\n  }\n  \n  getSessionState(clientId) {\n    const key = getSessionKey(clientId);\n    const stored = storage.getItem(key);\n    if (!stored) {\n      return null;\n    }\n    return JSON.parse(stored);\n  }\n  \n  clearSessionState(clientId) {\n    storage.removeItem(getSessionKey(clientId));\n  }\n}\n\nfunction getKey(clientId) {\n  return 'oauth-state-' + encodeURIComponent(clientId);\n}\n\nfunction getSessionKey(clientId) {\n  return getKey(clientId) + '-active-session';\n}\n\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\"use strict\";\n\nimport * as log from './log.js';\nimport * as authn from '../node_modules/@byuweb/browser-oauth/constants.js';\nimport {parseHash} from './url.mjs';\nimport {StorageHandler} from \"./local-storage.mjs\";\n\nconst CHILD_IFRAME_ID = 'byu-oauth-implicit-grant-refresh-iframe'\nconst FIFTY_FIVE_MINUTES_MILLIS = 3300000;\nconst STORED_STATE_LIFETIME = 5 * 60 * 1000; // 5 minutes\nexport const IG_STATE_AUTO_REFRESH_FAILED = 'implicit-grant-auto-refresh-failed'\n\nexport class ImplicitGrantProvider {\n  constructor(config, window, document, storageHandler = new StorageHandler()) {\n    log.debug('initializing provider with config', config);\n    this.config = config;\n    this.window = window;\n    this.document = document;\n    this.storageHandler = storageHandler;\n    this._listeners = {};\n\n    this.store = Object.freeze({\n      state: authn.STATE_INDETERMINATE,\n      user: null,\n      token: null,\n      error: null\n    });\n    log.debug('initialized provider');\n  }\n\n  _changeState(state, user, token, error) {\n    logStateChange(state, user, token, error);\n    this.store = Object.freeze({\n      state, user, token, error\n    });\n    _dispatchEvent(this, authn.EVENT_STATE_CHANGE, this.store);\n  }\n\n  // Separate state change listener, because state change events\n  // might come from child iframe/popup window\n  handleStateChange({ state, user, token, source }) {\n    log.debug('in handleStateChange', state);\n    // If this is a popup\n    if (this.window.opener) {\n      // We're inside a child re-authentication popup\n\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(this.window.opener, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'popup' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('closing self');\n        this.window.close()\n      }\n\n      return\n    }\n\n    // If we're inside the \"refresh\" iframe\n    const iframe = parent.document.getElementById(CHILD_IFRAME_ID)\n    if (iframe) {\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(parent, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'iframe' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('removing child iframe');\n        iframe.parentNode.removeChild(iframe)\n      }\n\n      return\n    }\n\n    this._maybeUpdateStoredSession(state, user, token);\n\n    if (state === authn.STATE_AUTHENTICATED) {\n      this._checkExpired(token.expiresAt.getTime())\n    }\n  }\n\n  async startup() {\n    log.info('starting up');\n    this.listen();\n    this._changeState(authn.STATE_INDETERMINATE);\n\n    const location = this._location;\n    const hash = this._hashParams;\n\n    if (this.isAuthenticationCallback(location.href, hash)) {\n      log.debug('handling authentication callback');\n      this._changeState(authn.STATE_AUTHENTICATING);\n      try {\n        const {state, user, token, error} = await _handleAuthenticationCallback(\n          this.config,\n          location,\n          hash,\n          this.storageHandler\n        );\n        this._changeState(state, user, token, error);\n      } catch (err) {\n        log.error('OAuth Error', err);\n        this._changeState(authn.STATE_ERROR, undefined, undefined, err);\n      }\n    } if (this.hasStoredSession()) {\n      log.debug('Has stored session');\n      this._updateStateFromStorage();\n    } else {\n      log.debug('no authentication present');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n  }\n\n  _checkExpired(expirationTimeInMs) {\n    log.debug('checking expiration time');\n\n    const expiresInMs = expirationTimeInMs - Date.now()\n\n    const definitelyExpired = expiresInMs < 0;\n    // In certain cases, WSO2 can send us a token whose expiration is ACTUALLY 55 minutes (60 minutes minus the 5-minute grace period) 🤦. \n    // So, if we see a longer-than-55-minute expiration, we may try to silently auto-refresh the token so we can get an accurate expiration.\n    const maybeFunkyExpiration = expiresInMs > FIFTY_FIVE_MINUTES_MILLIS;\n\n    if (!definitelyExpired && !maybeFunkyExpiration) {\n      this._scheduleExpirationCheck(expirationTimeInMs);\n      return;\n    }\n\n    if (this.config.autoRefreshOnTimeout) {\n      // If we've expired OR if the WSO2 five-minute grace period was not added, mark the state as refreshing.\n      // Schedule a refresh in an extra 5 seconds to avoid WSO2 clock skew problems.\n      // Existing token *should* have a five-minute grace period after expiration:\n      // a new request will generate a new token, but the old token should still\n      // work during that grace period, so we keep the user and token objects around.\n      if (maybeFunkyExpiration) {\n        log.debug('silently refreshing token to work around odd identity server issue');\n      }\n      this._changeState(authn.STATE_REFRESHING, this.store.user, this.store.token);\n      log.info('scheduling auto-refresh');\n      this._schedulePeriodic(() => this.startRefresh('iframe'));\n    } else if (definitelyExpired) {\n      // We don't have auto-refresh enabled, so flag the token as expired and let the application handle it.\n      this._changeState(authn.STATE_EXPIRED, this.store.user, this.store.token);\n    }\n  }\n\n  _scheduleExpirationCheck(expirationTimeInMs) {\n    this._schedulePeriodic(() => this._checkExpired(expirationTimeInMs));\n  }\n\n  _schedulePeriodic(task) {\n    // Simply using setTimeout for an hour in the future\n    // doesn't work; setTimeout isn't that precise over that long of a period.\n    // So re-check every five seconds until we're past the expiration time\n    return setTimeout(task, 5000);\n  }\n\n  get _location() {\n    return this.window.location;\n  }\n\n  get _hashParams() {\n    return parseHash(this._location.hash);\n  }\n\n  isAuthenticationCallback(href, hash) {\n    const isCallbackUrl = href.indexOf(this.config.callbackUrl) === 0;\n    const hasHash = hash.size !== 0;\n\n    if (!isCallbackUrl || !hasHash) {\n      return false;\n    }\n\n    return hash.has('access_token') || hash.has('error');\n  }\n\n  hasStoredSession() {\n    return !!this.storageHandler.getSessionState(this.config.clientId);\n  }\n\n  shutdown() {\n    log.info('shutting down');\n    this.unlisten();\n    this._changeState(authn.STATE_INDETERMINATE);\n  }\n\n  listen() {\n    log.debug('setting up event listeners');\n    _listenTo(this, authn.EVENT_LOGIN_REQUESTED, this.startLogin);\n    _listenTo(this, authn.EVENT_LOGOUT_REQUESTED, this.startLogout);\n    _listenTo(this, authn.EVENT_REFRESH_REQUESTED, this.startRefresh);\n    _listenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED, this.handleCurrentInfoRequest);\n    _listenTo(this, authn.EVENT_STATE_CHANGE, this.handleStateChange);\n  }\n\n  unlisten() {\n    log.debug('tearing down event listeners');\n    _unlistenTo(this, authn.EVENT_LOGIN_REQUESTED);\n    _unlistenTo(this, authn.EVENT_LOGOUT_REQUESTED);\n    _unlistenTo(this, authn.EVENT_REFRESH_REQUESTED);\n    _unlistenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED);\n    _unlistenTo(this, authn.EVENT_STATE_CHANGE);\n  }\n\n  startLogin(displayType = 'window') {\n    log.info('Starting login. mode=%s', displayType);\n    const {clientId, callbackUrl} = this.config;\n    const csrf = randomString();\n\n    const storedState = _prepareStoredState(Date.now() + STORED_STATE_LIFETIME, csrf, {});\n    this.storageHandler.saveOAuthState(this.config.clientId, storedState);\n\n    const loginUrl = `https://api.byu.edu/authorize?response_type=token&client_id=${clientId}&redirect_uri=${encodeURIComponent(callbackUrl)}&scope=openid&state=${csrf}`;\n    log.debug('computed login url of', loginUrl);\n\n    if (!displayType || displayType == 'window') {\n      log.info(`Redirecting user to '${loginUrl}'`);\n      this.window.location = loginUrl;\n      return\n    } else if (displayType === 'popup') {\n      log.info('launching popup at', loginUrl);\n      this.window.open(loginUrl)\n      return\n    }\n\n    log.info('Setting up hidden refresh iframe at', loginUrl);\n    // last option: displayType == 'iframe'\n    let iframe = document.getElementById(CHILD_IFRAME_ID)\n    if (iframe) {\n      iframe.parentNode.removeChild(iframe)\n    }\n    iframe = document.createElement('iframe')\n    iframe.onload = () => {\n      let html = null\n      try {\n        html = iframe.contentWindow.document.body.innerHTML\n      } catch (err) {\n        // intentional do-nothing\n      }\n      if (html === null) {\n        // Hidden-frame refresh failed. Remove frame and\n        // report problem\n        iframe.parentNode.removeChild(iframe)\n        this._changeState(IG_STATE_AUTO_REFRESH_FAILED, null, null)\n      }\n    }\n    iframe.id = CHILD_IFRAME_ID\n    iframe.src = loginUrl\n    iframe.style = 'display:none'\n    log.debug('appending iframe', iframe);\n    document.body.appendChild(iframe)\n  }\n\n  startLogout() {\n    log.info('starting logout');\n    this.storageHandler.clearSessionState(this.config.clientId);\n    const logoutUrl = 'http://api.byu.edu/logout?redirect_url=' + encodeURIComponent(this.config.callbackUrl);\n    log.info('logging out by redirecting to', logoutUrl);\n    this.window.location = logoutUrl;\n    //https://api.byu.edu/revoke\n\n    //TODO: WSO2 Identity Server 5.1 allows us to revoke implicit tokens.  Once that's done, we'll need to do this.\n    // const url = `https://api.byu.edu/revoke`;\n\n    // const form = new URLSearchParams();\n    // form.set('token', store.token.bearer);\n    // form.set('client_id', config.clientId);\n    // form.set('token_type_hint', 'access_token');\n\n    // console.log('logout url', url);\n\n    // fetch(url, {\n    //     method: 'POST',\n    //     body: form,\n    //     // headers: {\n    //     //     'Content-Type': 'application/x-www-form-urlencoded'\n    //     // }\n    // }).then(result => {\n    //     console.log('done with logout', result);\n    // });\n  }\n\n  startRefresh(displayType = 'iframe') {\n    log.info('starting refresh. displayType=%s', displayType);\n    this.startLogin(displayType);\n  }\n\n  handleCurrentInfoRequest({callback}) {\n    log.debug('got current info request');\n    if (callback) {\n      callback(this.store);\n    }\n  }\n\n  _updateStateFromStorage() {\n    log.debug('updating state from local storage');\n    const serialized = this.storageHandler.getSessionState(this.config.clientId);\n    if (!serialized) {\n      log.debug('no stored state');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n      return;\n    }\n    const {user, token} = deserializeSessionState(serialized);\n    if (!user || !token) {\n      log.debug('no stored user or token');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    } else if (token.expiresAt > new Date()) {\n      log.debug('found an unexpired saved session');\n      this._changeState(authn.STATE_AUTHENTICATED, user, token);\n    } else {\n      log.debug('stored session was expired');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n  }\n\n  _maybeUpdateStoredSession(state, user, token) {\n    log.debug('updating stored session: state=%s hasUser=%s, hasToken=%s', state, !!user, !!token);\n    if (state === authn.STATE_UNAUTHENTICATED) {\n      log.debug('state is unauthenticated, clearing stored session');\n      this.storageHandler.clearSessionState(this.config.clientId);\n    } else if (!!user && !!token) {\n      log.debug('storing session', redactUser(user), redactToken(token));\n      const serialized = serializeSessionState(user, token);\n      this.storageHandler.saveSessionState(this.config.clientId, serialized);\n    }\n  }\n}\n\nfunction serializeSessionState(user, token) {\n  const grouped = groupClaimPrefixes(token.rawUserInfo);\n\n  const smallerUserInfo = {\n    ro: grouped[CLAIMS_PREFIX_RESOURCE_OWNER],\n    cl: grouped[CLAIMS_PREFIX_CLIENT],\n    wso2: grouped[CLAIMS_PREFIX_WSO2],\n    o: grouped.other,\n  };\n\n  return {\n    ui: smallerUserInfo,\n    at: token.bearer,\n    ah: token.authorizationHeader,\n    ea: token.expiresAt.getTime()\n  };\n}\n\nfunction deserializeSessionState(state) {\n  const groupedUserInfo = {\n    [CLAIMS_PREFIX_RESOURCE_OWNER]: state.ui.ro,\n    [CLAIMS_PREFIX_CLIENT]: state.ui.cl,\n    [CLAIMS_PREFIX_WSO2]: state.ui.wso2,\n    other: state.ui.o,\n  }\n  const userInfo = ungroupClaimPrefixes(groupedUserInfo);\n\n  const user = _processUserInfo(userInfo);\n  const expiresAt = new Date(state.ea);\n  const token = _processTokenInfo(userInfo, state.at, expiresAt, `Bearer ${state.at}`);\n  return {user, token};\n}\n\nfunction _listenTo(provider, event, listener) {\n  if (provider._listeners.hasOwnProperty(event)) {\n    throw new Error('A listener is already registered for ' + event);\n  }\n  const obs = provider._listeners[event] = function (e) {\n    listener.call(provider, e.detail);\n  }.bind(provider);\n\n  provider.document.addEventListener(event, obs, false);\n}\n\nfunction _unlistenTo(provider, event) {\n  if (!provider._listeners.hasOwnProperty(event)) {\n    return;\n  }\n\n  provider.document.removeEventListener(event, provider._listeners[event], false);\n  delete provider._listeners[event];\n}\n\n\nfunction _dispatchEvent(provider, name, detail) {\n  let event;\n  if (typeof provider.window.CustomEvent === 'function') {\n    event = new CustomEvent(name, {detail});\n  } else {\n    event = provider.document.createEvent('CustomEvent');\n    event.initCustomEvent(name, true, false, detail);\n  }\n  provider.document.dispatchEvent(event);\n}\n\nasync function _handleAuthenticationCallback(config, location, hash, storage) {\n  if (hash.has('error')) {\n    log.error('Got oauth error in URL hash');\n    throw new OAuthError(\n      hash.get('error'),\n      hash.get('error_description'),\n      hash.get('error_uri'),\n    );\n  }\n\n  const oauthCsrfToken = hash.get('state');\n  const storedState = storage.getOAuthState(config.clientId);\n\n  storage.clearOAuthState(config.clientId);\n\n  log.debug('checking oauth state token');\n  const pageState = _validateAndGetStoredState(storedState, oauthCsrfToken);\n\n  const accessToken = hash.get('access_token');\n  const expiresIn = Number(hash.get('expires_in'));\n  const expiresAt = new Date(Date.now() + (expiresIn * 1000));\n  const authHeader = `Bearer ${accessToken}`;\n  log.debug('got token', redactBearerToken(accessToken), 'which expires in', expiresIn, 'seconds');\n\n  const userInfo = await _fetchUserInfo(authHeader);\n\n  const user = _processUserInfo(userInfo);\n  const token = _processTokenInfo(userInfo, accessToken, expiresAt, authHeader);\n\n  location.hash = '';\n\n  return {state: authn.STATE_AUTHENTICATED, user, token};\n}\n\nconst USER_INFO_URL = 'https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid';\n\nasync function _fetchUserInfo(authHeader) {\n  log.debug('fetching user info from', USER_INFO_URL);\n  const resp = await fetch(USER_INFO_URL, {\n    method: 'GET',\n    headers: new Headers({'Accept': 'application/json', 'Authorization': authHeader}),\n    mode: 'cors',\n  });\n\n  log.debug('got status', resp.status);\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    if (resp.status === 403) {\n      log.debug('got forbidden error');\n      if (body.includes('<ams:code>900908</ams:code>')) {\n        log.debug('client app isn\\'t subscribed to OpenID UserInfo endpoint');\n        console.error(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`);\n        throw new OAuthError(\n          'not-subscribed-to-user-info',\n          'This page has an authentication configuration error. Developers, see the console for details.'\n        );\n      } else {\n        log.error('invalid oauth bearer token');\n        throw new OAuthError(\n          'invalid-oauth-token',\n          'The provided authentication token is invalid. Please try again.'\n        );\n      }\n    }\n    console.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-get-user-info',\n      'Unable to fetch user information. Please try again.'\n    );\n  }\n  const json = await resp.json();\n  log.debug('successfully got user info', json);\n  return json;\n}\n\nconst CLAIMS_PREFIX_RESOURCE_OWNER = 'http://byu.edu/claims/resourceowner_';\nconst CLAIMS_PREFIX_CLIENT = 'http://byu.edu/claims/client_';\nconst CLAIMS_PREFIX_WSO2 = 'http://wso2.org/claims/';\n\nconst CLAIMS_KNOWN_PREFIXES = [CLAIMS_PREFIX_CLIENT, CLAIMS_PREFIX_RESOURCE_OWNER, CLAIMS_PREFIX_WSO2];\n\nfunction groupClaimPrefixes(userInfo) {\n  const grouped = {\n    other: {}\n  };\n  for (const prefix of CLAIMS_KNOWN_PREFIXES) {\n    grouped[prefix] = {};\n  }\n  for (const key of Object.keys(userInfo)) {\n    const value = userInfo[key];\n    const prefix = CLAIMS_KNOWN_PREFIXES.find(it => key.startsWith(it));\n    if (prefix) {\n        grouped[prefix][key.substr(prefix.length)] = value;\n    } else {\n      grouped.other[key] = value;\n    }\n  }\n  return grouped;\n}\n\nfunction ungroupClaimPrefixes(grouped) {\n  const result = {};\n  for (const groupKey of CLAIMS_KNOWN_PREFIXES) {\n    const group = grouped[groupKey];\n    if (!group) continue;\n    for (const key of Object.keys(group)) {\n      result[groupKey + key] = group[key];\n    }\n  }\n  for (const other of Object.keys(grouped.other)) {\n    result[other] = grouped.other[other];\n  }\n  return result;\n}\n\nfunction getClaims(userInfo, prefix) {\n  return Object.keys(userInfo).filter(k => k.startsWith(prefix))\n    .reduce((agg, key) => {\n      agg[key.substr(prefix.length)] = userInfo[key];\n      return agg;\n    }, {});\n}\n\nfunction _processUserInfo(userInfo) {\n  const roClaims = getClaims(userInfo, CLAIMS_PREFIX_RESOURCE_OWNER);\n\n  const familyNamePosition = roClaims.surname_position;\n  const givenName = userInfo.given_name;\n  const familyName = userInfo.family_name;\n\n  const displayName = familyNamePosition === 'F' ? `${familyName} ${givenName}` : `${givenName} ${familyName}`;\n\n  return {\n    personId: roClaims.person_id,\n    byuId: roClaims.byu_id,\n    netId: roClaims.net_id,\n    name: {\n      sortName: roClaims.sort_name,\n      displayName,\n      givenName,\n      familyName,\n      familyNamePosition,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _processTokenInfo(userInfo, accessToken, expiresAt, authHeader) {\n  const clientClaims = getClaims(userInfo, CLAIMS_PREFIX_CLIENT);\n  const wso2Claims = getClaims(userInfo, CLAIMS_PREFIX_WSO2);\n\n  return {\n    bearer: accessToken,\n    authorizationHeader: authHeader,\n    expiresAt,\n    client: {\n      id: wso2Claims.client_id,\n      byuId: clientClaims.byu_id,\n      appName: wso2Claims.applicationname,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _validateAndGetStoredState(storedState, expectedCsrfToken) {\n  log.debug('validating stored state token. Expecting token', expectedCsrfToken, ', got state', storedState);\n  if (!storedState) {\n    log.error('no stored oauth login state');\n    throw new OAuthError('no-oauth-state', 'Your saved authentication information does not match. Please try again.');\n  }\n  const {e: stateExpiresString, c: storedCsrfToken, s: pageState} = storedState;\n\n  if (expectedCsrfToken !== storedCsrfToken) {\n    log.error('CSRF token mismatch')\n    throw new OAuthError(\n      'oauth-state-mismatch',\n      'Your saved authentication information does not match. Please try again.'\n    );\n  }\n\n  if (Number(stateExpiresString) < Date.now()) {\n    log.error('stored state has expired');\n    throw new OAuthError(\n      'oauth-state-expired',\n      'Your login attempt has timed out. Please try again.'\n    );\n  }\n\n  return pageState;\n}\n\nfunction _prepareStoredState(expires, csrfToken, pageState) {\n  return {\n    e: expires,\n    c: csrfToken,\n    s: pageState,\n  }\n}\n\nclass OAuthError extends Error {\n  constructor(type, description, uri) {\n    super('OAuth Error: ' + description);\n    this.type = type;\n    this.description = description;\n    this.uri = uri;\n  }\n}\n\nfunction randomString() {\n  let idArray = new Uint32Array(3);\n  const crypto = window.crypto || window.msCrypto;\n  crypto.getRandomValues(idArray);\n\n  return idArray.reduce((str, cur) => str + cur.toString(16), '');\n}\n\nfunction logStateChange(state, user, token, error) {\n  const logParts = [\n    'state change:',\n    {\n      state,\n      user: redactUser(user),\n      token: redactToken(token),\n      error: error\n    }\n  ];\n  if (error) {\n    log.error(...logParts);\n  } else {\n    log.info(...logParts);\n  }\n}\n\nfunction redactUser(u) {\n  if (!u) return undefined;\n  return {\n    netId: u.netId,\n    'rest-is-redacted': true\n  };\n}\n\nfunction redactToken(t) {\n  if (!t) return undefined;\n  const {bearer, expiresAt, client} = t;\n  return {\n    bearer: redactBearerToken(bearer),\n    expiresAt: expiresAt.toISOString(),\n    client,\n    'rest-is-redacted': true\n  }\n}\nfunction redactBearerToken(b) {\n  if (!b) return undefined;\n  return b.substring(0, 2) + '...redacted...' + b.substring(b.length - 2)\n}\n","/*\n * Copyright 2018 Brigham Young University\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ImplicitGrantProvider } from \"./provider.mjs\";\n\nexport const DEFAULT_ISSUER = 'https://api.byu.edu';\n\nexport const GLOBAL_CONFIG_KEY = 'byu-oauth-implicit-config';\n\n/**\n * @typedef {} ImplicitConfig\n * @prop {string} clientId\n * @prop {?string} issuer\n * @prop {?string} callbackUrl\n * @prop {?boolean} requireAuthentication\n */\n\n/**\n *\n * @param {ImplicitConfig} cfg\n */\nexport async function configure(cfg) {\n  const globalConfig = window[GLOBAL_CONFIG_KEY];\n\n  const config = Object.assign({\n    issuer: DEFAULT_ISSUER,\n    callbackUrl: `${location.origin}${location.pathname}`,\n    autoRefreshOnTimeout: false\n  }, globalConfig, cfg);\n\n  if (!config.clientId) {\n    throw new Error('clientId must be specified in config');\n  }\n\n  const provider = new ImplicitGrantProvider(config, window, document);\n\n  return provider.startup();\n}\n","export const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const EVENT_STATE_CHANGE = `${EVENT_PREFIX}-state-changed`;\nexport const EVENT_LOGIN_REQUESTED = `${EVENT_PREFIX}-login-requested`;\nexport const EVENT_LOGOUT_REQUESTED = `${EVENT_PREFIX}-logout-requested`;\nexport const EVENT_REFRESH_REQUESTED = `${EVENT_PREFIX}-refresh-requested`;\nexport const EVENT_CURRENT_INFO_REQUESTED = `${EVENT_PREFIX}-current-info-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.hasCookies = hasCookies;\n\nvar _cookie = require('cookie');\n\nvar _cookie2 = _interopRequireDefault(_cookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar prefix = 'lS_';\n\nvar CookieStorage = function () {\n  function CookieStorage() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CookieStorage);\n\n    this.cookieOptions = Object.assign({ path: '/' }, options);\n    prefix = options.prefix === undefined ? prefix : options.prefix;\n  }\n\n  _createClass(CookieStorage, [{\n    key: 'getItem',\n    value: function getItem(key) {\n      var cookies = _cookie2.default.parse(document.cookie);\n      if (!cookies || !cookies.hasOwnProperty(prefix + key)) {\n        return null;\n      }\n      return cookies[prefix + key];\n    }\n  }, {\n    key: 'setItem',\n    value: function setItem(key, value) {\n      document.cookie = _cookie2.default.serialize(prefix + key, value, this.cookieOptions);\n      return value;\n    }\n  }, {\n    key: 'removeItem',\n    value: function removeItem(key) {\n      var options = Object.assign({}, this.cookieOptions, { maxAge: -1 });\n      document.cookie = _cookie2.default.serialize(prefix + key, '', options);\n      return null;\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      var cookies = _cookie2.default.parse(document.cookie);\n      for (var key in cookies) {\n        if (key.indexOf(prefix) === 0) {\n          this.removeItem(key.substr(prefix.length));\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return CookieStorage;\n}();\n\nexports.default = CookieStorage;\nfunction hasCookies() {\n  var storage = new CookieStorage();\n\n  try {\n    var TEST_KEY = '__test';\n    storage.setItem(TEST_KEY, '1');\n    var value = storage.getItem(TEST_KEY);\n    storage.removeItem(TEST_KEY);\n\n    return value === '1';\n  } catch (e) {\n    return false;\n  }\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = isSupported;\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar TEST_KEY = '__test';\n\nfunction hasStorage(name) {\n  try {\n    var storage = window[name];\n    storage.setItem(TEST_KEY, '1');\n    storage.removeItem(TEST_KEY);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction isSupported() {\n  var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'localStorage';\n\n  var storage = String(name).replace(/storage$/i, '').toLowerCase();\n\n  if (storage === 'local') {\n    return hasStorage('localStorage');\n  }\n\n  if (storage === 'session') {\n    return hasStorage('sessionStorage');\n  }\n\n  if (storage === 'cookie') {\n    return (0, _CookieStorage.hasCookies)();\n  }\n\n  if (storage === 'memory') {\n    return true;\n  }\n\n  throw new Error('Storage method `' + name + '` is not available.\\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.');\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MemoryStorage = function () {\n  function MemoryStorage() {\n    _classCallCheck(this, MemoryStorage);\n\n    this._data = {};\n  }\n\n  _createClass(MemoryStorage, [{\n    key: \"getItem\",\n    value: function getItem(key) {\n      return this._data.hasOwnProperty(key) ? this._data[key] : null;\n    }\n  }, {\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      return this._data[key] = String(value);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(key) {\n      return delete this._data[key];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      return this._data = {};\n    }\n  }]);\n\n  return MemoryStorage;\n}();\n\nexports.default = MemoryStorage;","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MemoryStorage = exports.CookieStorage = exports.isSupported = exports.storage = undefined;\n\nvar _isSupported = require('./isSupported');\n\nvar _isSupported2 = _interopRequireDefault(_isSupported);\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar _CookieStorage2 = _interopRequireDefault(_CookieStorage);\n\nvar _MemoryStorage = require('./MemoryStorage');\n\nvar _MemoryStorage2 = _interopRequireDefault(_MemoryStorage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar storage = null;\n\nif ((0, _isSupported2.default)('localStorage')) {\n  // use localStorage\n  exports.storage = storage = window.localStorage;\n} else if ((0, _isSupported2.default)('sessionStorage')) {\n  // use sessionStorage\n  exports.storage = storage = window.sessionStorage;\n} else if ((0, _isSupported2.default)('cookieStorage')) {\n  // use cookies\n  exports.storage = storage = new _CookieStorage2.default();\n} else {\n  // use memory\n  exports.storage = storage = new _MemoryStorage2.default();\n}\n\nexports.default = storage;\nexports.storage = storage;\nexports.isSupported = _isSupported2.default;\nexports.CookieStorage = _CookieStorage2.default;\nexports.MemoryStorage = _MemoryStorage2.default;"],"names":["debug","args","doLog","LEVEL_DEBUG","info","LEVEL_INFO","error","LEVEL_ERROR","level","shouldLog","time","Date","toLocaleTimeString","h12","run","name","priority","currentLevel","levelAttr","levelGlobalVar","DEFAULT_LEVEL","lower","toLowerCase","ALL_LEVELS","find","l","document","documentElement","getAttribute","o","window","byuOAuth","logging","parseHash","hash","Map","subHash","startsWith","substr","keyValues","split","map","it","tryDecode","str","decode","e","getKey","clientId","encodeURIComponent","getSessionKey","serializeSessionState","user","token","grouped","groupClaimPrefixes","rawUserInfo","smallerUserInfo","ro","CLAIMS_PREFIX_RESOURCE_OWNER","cl","CLAIMS_PREFIX_CLIENT","wso2","CLAIMS_PREFIX_WSO2","other","ui","at","bearer","ah","authorizationHeader","ea","expiresAt","getTime","deserializeSessionState","state","groupedUserInfo","userInfo","ungroupClaimPrefixes","_processUserInfo","_processTokenInfo","_listenTo","provider","event","listener","_listeners","hasOwnProperty","Error","obs","call","detail","bind","addEventListener","_unlistenTo","removeEventListener","_dispatchEvent","CustomEvent","createEvent","initCustomEvent","dispatchEvent","_handleAuthenticationCallback","config","location","storage","has","log","OAuthError","get","oauthCsrfToken","storedState","getOAuthState","clearOAuthState","pageState","_validateAndGetStoredState","accessToken","expiresIn","now","authHeader","redactBearerToken","_fetchUserInfo","authn","USER_INFO_URL","resp","fetch","method","headers","Headers","mode","status","body","text","includes","console","json","prefix","CLAIMS_KNOWN_PREFIXES","key","Object","keys","value","length","result","groupKey","group","getClaims","filter","k","reduce","agg","roClaims","familyNamePosition","surname_position","givenName","given_name","familyName","family_name","displayName","personId","person_id","byuId","byu_id","netId","net_id","sortName","sort_name","clientClaims","wso2Claims","client","id","client_id","appName","applicationname","expectedCsrfToken","stateExpiresString","c","storedCsrfToken","s","Number","_prepareStoredState","expires","csrfToken","randomString","idArray","Uint32Array","crypto","msCrypto","getRandomValues","cur","toString","logStateChange","logParts","redactUser","redactToken","u","t","toISOString","b","substring","trace","EVENT_PREFIX","EVENT_STATE_CHANGE","EVENT_LOGIN_REQUESTED","EVENT_LOGOUT_REQUESTED","EVENT_REFRESH_REQUESTED","EVENT_CURRENT_INFO_REQUESTED","STATE_INDETERMINATE","STATE_UNAUTHENTICATED","STATE_AUTHENTICATED","decodeURIComponent","encode","pairSplitRegExp","fieldContentRegExp","options","TypeError","obj","opt","pairs","dec","i","pair","eq_idx","indexOf","trim","val","slice","undefined","Math","floor","enc","test","maxAge","isNaN","domain","path","toUTCString","httpOnly","secure","sameSite","_classCallCheck","instance","Constructor","defineProperty","exports","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","protoProps","staticProps","prototype","CookieStorage","setItem","getItem","removeItem","_cookie2","__esModule","default","_interopRequireDefault","_cookie","arguments","cookieOptions","assign","cookies","parse","cookie","serialize","hasStorage","String","replace","_CookieStorage","hasCookies","MemoryStorage","_data","_isSupported2","_isSupported","_CookieStorage2","_MemoryStorage2","_MemoryStorage","localStorage","sessionStorage","StorageHandler","saveOAuthState","JSON","stringify","saveSessionState","getSessionState","stored","clearSessionState","CHILD_IFRAME_ID","ImplicitGrantProvider","constructor","storageHandler","store","freeze","_changeState","handleStateChange","source","opener","close","iframe","parent","getElementById","parentNode","removeChild","_maybeUpdateStoredSession","_checkExpired","startup","listen","_location","_hashParams","isAuthenticationCallback","href","err","hasStoredSession","_updateStateFromStorage","expirationTimeInMs","expiresInMs","definitelyExpired","maybeFunkyExpiration","autoRefreshOnTimeout","_schedulePeriodic","_this","startRefresh","_scheduleExpirationCheck","_this2","task","setTimeout","isCallbackUrl","callbackUrl","hasHash","size","shutdown","unlisten","startLogin","startLogout","handleCurrentInfoRequest","displayType","csrf","loginUrl","open","createElement","onload","html","contentWindow","innerHTML","_this3","src","style","appendChild","logoutUrl","callback","serialized","type","description","uri","GLOBAL_CONFIG_KEY","cfg","globalConfig","issuer","origin","pathname"],"mappings":"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"}