{"version":3,"file":"implicit-grant.nomodule.min.js","sources":["../src/log.js","../node_modules/cookie/index.js","../src/local-storage.js","../src/provider.js","../src/implicit-grant.js","../node_modules/@byuweb/browser-oauth/constants.js","../node_modules/local-storage-fallback/lib/CookieStorage.js","../node_modules/local-storage-fallback/lib/isSupported.js","../node_modules/local-storage-fallback/lib/MemoryStorage.js","../node_modules/local-storage-fallback/lib/index.js"],"sourcesContent":["const LEVEL_TRACE = { priority: 0, name: \"trace\", run: handleTrace };\nconst LEVEL_DEBUG = { priority: 1, name: \"debug\", run: handleDebug };\nconst LEVEL_INFO = { priority: 10, name: \"info\", run: handleInfo };\nconst LEVEL_ERROR = { priority: 100, name: \"error\", run: handleError };\n\nconst ALL_LEVELS = [LEVEL_TRACE, LEVEL_DEBUG, LEVEL_INFO, LEVEL_ERROR];\nconst DEFAULT_LEVEL = LEVEL_ERROR;\n\nexport function debug(...args) {\n  log(LEVEL_DEBUG, ...args);\n}\n\nexport function info(...args) {\n  log(LEVEL_INFO, ...args);\n}\n\nexport function error(...args) {\n  log(LEVEL_ERROR, ...args);\n}\n\nexport function debugf(format, ...args) {\n  logf(LEVEL_DEBUG, format, ...args);\n}\n\nexport function infof(format, ...args) {\n  logf(LEVEL_INFO, format, ...args);\n}\n\nexport function errorf(format, ...args) {\n  logf(LEVEL_ERROR, format, ...args);\n}\n\nfunction logf(level, format, ...args) {\n  if (!shouldLog(level)) {\n    return;\n  }\n  level.run(\n    `[byu-browser-oauth-implicit] [${level.name}] (${getFormattedTime()}) ${format}`,\n    ...args\n  );\n}\n\nfunction log(level, ...args) {\n  if (!shouldLog(level)) {\n    return;\n  }\n  level.run(\n    \"[byu-browser-oauth-implicit]\",\n    `[${level.name}]`,\n    `(${getFormattedTime()})`,\n    ...args\n  );\n}\n\nfunction getFormattedTime() {\n  const now = new Date();\n  const h24 = String(now.getHours()).padStart(2, '0');\n  const min = String(now.getMinutes()).padStart(2, '0');\n  const sec = String(now.getSeconds()).padStart(2, '0');\n  const millis = String(now.getMilliseconds()).padStart(3, '0');\n\n  return `${h24}:${min}:${sec},${millis}${formatTimezone(now)}`;\n}\n\nfunction formatTimezone(date) {\n  const offset = date.getTimezoneOffset();\n  if (offset === 0) {\n    return 'Z';\n  }\n  const nonNegative = offset >= 0;\n  const absOffset = Math.abs(offset);\n\n  // Positive whole offset hours\n  const hourInt = Math.floor(absOffset / 60);\n  const hourDone = String(hourInt).padStart(2, '0')\n  const sign = (nonNegative ? '+' : '-');\n  const minDone = String(absOffset % 60).padStart(2, '0');\n\n  return `${sign}${hourDone}${minDone}`;\n}\n\nfunction shouldLog(level) {\n  return level.priority >= currentLevel().priority;\n}\n\nfunction currentLevel() {\n  const name = levelAttr() || levelGlobalVar();\n  if (!name) {\n    return DEFAULT_LEVEL;\n  }\n  const lower = name.toLowerCase();\n  return (\n    ALL_LEVELS.find(function(l) {\n      return l.name === lower;\n    }) || DEFAULT_LEVEL\n  );\n}\n\nfunction levelAttr() {\n  return document.documentElement.getAttribute(\"byu-oauth-logging\");\n}\n\nfunction levelGlobalVar() {\n  const o = window.byuOAuth || {};\n  return o.logging;\n}\n\nfunction handleTrace(...args) {\n  if (console.trace) {\n    console.trace(...args);\n  } else {\n    console.log(...args);\n  }\n}\n\nfunction handleDebug(...args) {\n  console.log(...args);\n}\n\nfunction handleInfo(...args) {\n  if (console.info) {\n    console.info(...args);\n  } else {\n    console.log(...args);\n  }\n}\n\nfunction handleError(...args) {\n  if (console.error) {\n    console.error(...args);\n  } else {\n    console.log(...args);\n  }\n}\n","/*!\n * cookie\n * Copyright(c) 2012-2014 Roman Shtylman\n * Copyright(c) 2015 Douglas Christopher Wilson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nexports.parse = parse;\nexports.serialize = serialize;\n\n/**\n * Module variables.\n * @private\n */\n\nvar decode = decodeURIComponent;\nvar encode = encodeURIComponent;\nvar pairSplitRegExp = /; */;\n\n/**\n * RegExp to match field-content in RFC 7230 sec 3.2\n *\n * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]\n * field-vchar   = VCHAR / obs-text\n * obs-text      = %x80-FF\n */\n\nvar fieldContentRegExp = /^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;\n\n/**\n * Parse a cookie header.\n *\n * Parse the given cookie header string into an object\n * The object has the various cookies as keys(names) => values\n *\n * @param {string} str\n * @param {object} [options]\n * @return {object}\n * @public\n */\n\nfunction parse(str, options) {\n  if (typeof str !== 'string') {\n    throw new TypeError('argument str must be a string');\n  }\n\n  var obj = {}\n  var opt = options || {};\n  var pairs = str.split(pairSplitRegExp);\n  var dec = opt.decode || decode;\n\n  for (var i = 0; i < pairs.length; i++) {\n    var pair = pairs[i];\n    var eq_idx = pair.indexOf('=');\n\n    // skip things that don't look like key=value\n    if (eq_idx < 0) {\n      continue;\n    }\n\n    var key = pair.substr(0, eq_idx).trim()\n    var val = pair.substr(++eq_idx, pair.length).trim();\n\n    // quoted values\n    if ('\"' == val[0]) {\n      val = val.slice(1, -1);\n    }\n\n    // only assign once\n    if (undefined == obj[key]) {\n      obj[key] = tryDecode(val, dec);\n    }\n  }\n\n  return obj;\n}\n\n/**\n * Serialize data into a cookie header.\n *\n * Serialize the a name value pair into a cookie string suitable for\n * http headers. An optional options object specified cookie parameters.\n *\n * serialize('foo', 'bar', { httpOnly: true })\n *   => \"foo=bar; httpOnly\"\n *\n * @param {string} name\n * @param {string} val\n * @param {object} [options]\n * @return {string}\n * @public\n */\n\nfunction serialize(name, val, options) {\n  var opt = options || {};\n  var enc = opt.encode || encode;\n\n  if (typeof enc !== 'function') {\n    throw new TypeError('option encode is invalid');\n  }\n\n  if (!fieldContentRegExp.test(name)) {\n    throw new TypeError('argument name is invalid');\n  }\n\n  var value = enc(val);\n\n  if (value && !fieldContentRegExp.test(value)) {\n    throw new TypeError('argument val is invalid');\n  }\n\n  var str = name + '=' + value;\n\n  if (null != opt.maxAge) {\n    var maxAge = opt.maxAge - 0;\n    if (isNaN(maxAge)) throw new Error('maxAge should be a Number');\n    str += '; Max-Age=' + Math.floor(maxAge);\n  }\n\n  if (opt.domain) {\n    if (!fieldContentRegExp.test(opt.domain)) {\n      throw new TypeError('option domain is invalid');\n    }\n\n    str += '; Domain=' + opt.domain;\n  }\n\n  if (opt.path) {\n    if (!fieldContentRegExp.test(opt.path)) {\n      throw new TypeError('option path is invalid');\n    }\n\n    str += '; Path=' + opt.path;\n  }\n\n  if (opt.expires) {\n    if (typeof opt.expires.toUTCString !== 'function') {\n      throw new TypeError('option expires is invalid');\n    }\n\n    str += '; Expires=' + opt.expires.toUTCString();\n  }\n\n  if (opt.httpOnly) {\n    str += '; HttpOnly';\n  }\n\n  if (opt.secure) {\n    str += '; Secure';\n  }\n\n  if (opt.sameSite) {\n    var sameSite = typeof opt.sameSite === 'string'\n      ? opt.sameSite.toLowerCase() : opt.sameSite;\n\n    switch (sameSite) {\n      case true:\n        str += '; SameSite=Strict';\n        break;\n      case 'lax':\n        str += '; SameSite=Lax';\n        break;\n      case 'strict':\n        str += '; SameSite=Strict';\n        break;\n      default:\n        throw new TypeError('option sameSite is invalid');\n    }\n  }\n\n  return str;\n}\n\n/**\n * Try decoding a string using a decoding function.\n *\n * @param {string} str\n * @param {function} decode\n * @private\n */\n\nfunction tryDecode(str, decode) {\n  try {\n    return decode(str);\n  } catch (e) {\n    return str;\n  }\n}\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\n\"use strict\";\n\nimport storage from 'local-storage-fallback';\n// During initial page load, Firefox \"LocalStorage\" is wonky if in Private Browsing.\n// Fortunately, the \"OAuth State\" data is tiny (one date and one 16-character string),\n// so it won't hit any Cookie size limitations.\n// With those factors in mind, we intentionally downgrade to Cookie storage for initial OAuth data storage\nimport { CookieStorage } from 'local-storage-fallback';\n\nconst cookie = new CookieStorage();\n\nexport class StorageHandler {\n\n  saveOAuthState(clientId, state) {\n    cookie.setItem(getKey(clientId), JSON.stringify(state));\n  }\n\n  getOAuthState(clientId) {\n    const result = cookie.getItem(getKey(clientId));\n    if (!result) {\n      return null;\n    }\n    return JSON.parse(result);\n  }\n\n  clearOAuthState(clientId) {\n    cookie.removeItem(getKey(clientId));\n  }\n\n  saveSessionState(clientId, state) {\n    storage.setItem(getSessionKey(clientId), JSON.stringify(state));\n  }\n\n  getSessionState(clientId) {\n    const key = getSessionKey(clientId);\n    const stored = storage.getItem(key);\n    if (!stored) {\n      return null;\n    }\n    return JSON.parse(stored);\n  }\n\n  clearSessionState(clientId) {\n    storage.removeItem(getSessionKey(clientId));\n  }\n}\n\nfunction getKey(clientId) {\n  return 'oauth-state-' + encodeURIComponent(clientId);\n}\n\nfunction getSessionKey(clientId) {\n  return getKey(clientId) + '-active-session';\n}\n\n","/*\n *  @license\n *    Copyright 2018 Brigham Young University\n *\n *    Licensed under the Apache License, Version 2.0 (the \"License\");\n *    you may not use this file except in compliance with the License.\n *    You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n *    Unless required by applicable law or agreed to in writing, software\n *    distributed under the License is distributed on an \"AS IS\" BASIS,\n *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *    See the License for the specific language governing permissions and\n *    limitations under the License.\n */\n\"use strict\";\n\nimport * as log from './log.js';\nimport * as authn from '@byuweb/browser-oauth/constants.js';\nimport {StorageHandler} from \"./local-storage.js\";\n// NOTE: not using browser `crypto` module, because `crypto.subtle` isn't available when the browser isn't in HTTPS,\n// and our development environments usually use plain HTTP. We're only doing a single one-way hash, so performance\n// isn't a big deal\nimport sha256Lib from 'js-sha256'\nconst sha256 = sha256Lib.sha256\n\nlet SINGLETON_INSTANCE;\nlet BASE_URL;\n\nconst CHILD_IFRAME_ID = 'byu-oauth-implicit-grant-refresh-iframe'\nconst STORED_STATE_LIFETIME = 5 * 60 * 1000; // 5 minutes (in milliseconds)\nconst EXPIRATION_BUFFER = (5 * 60) + 5; // 5 minutes + 5 seconds (in seconds)\nexport const IG_STATE_AUTO_REFRESH_FAILED = 'implicit-grant-auto-refresh-failed'\n\nexport class ImplicitGrantProvider {\n  constructor(config, window, document, storageHandler = new StorageHandler()) {\n    log.debug('initializing provider with config', config);\n    this.config = config;\n    this.window = window;\n    this.document = document;\n    this.storageHandler = storageHandler;\n    this._listeners = {};\n\n    BASE_URL = this.config.baseUrl.replace(/\\/+$/, '') // strip trailing slash(es)\n\n    this.store = Object.freeze({\n      state: authn.STATE_INDETERMINATE,\n      user: null,\n      token: null,\n      error: null\n    });\n    log.debug('initialized provider');\n  }\n\n  _changeState(state, user, token, error) {\n    logStateChange(state, user, token, error);\n    this.store = Object.freeze({\n      state, user, token, error\n    });\n    _dispatchEvent(this, authn.EVENT_STATE_CHANGE, this.store);\n  }\n\n  _checkPopupOpener() {\n    try {\n      const origin = this.window.opener.location.origin\n      if (origin === (new URL(this.config.callbackUrl)).origin) { // Origins match\n        return this.window.opener\n      }\n    } catch (e) {\n      // Failed to get window.opener.location.origin, so we must have been opened\n      // from a different origin.\n      // Fall through to the \"return false\" outside this try/catch block\n    }\n    return false\n  }\n\n  _checkIframeOpener() {\n    try {\n      const iframe = this.window.parent.document.getElementById(CHILD_IFRAME_ID)\n      if (iframe && iframe.contentWindow === this.window) {\n        return iframe\n      }\n    } catch (e) {\n      // Failed to access window.parent info, so we must be in an iframe from a different\n      // origin.\n      // Fall through to the \"return false\" outside this try/catch block\n    }\n    return false\n  }\n\n  // Separate state change listener, because state change events\n  // might come from child iframe/popup window\n  handleStateChange({ state, user, token, source }) {\n    log.debug('in handleStateChange', state);\n\n    const opener = this._checkPopupOpener()\n    // If this is a popup\n    if (opener) {\n      // We're inside a child re-authentication popup\n\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(opener, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'popup' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('closing self');\n        this.window.close()\n      }\n\n      return\n    }\n\n    const iframe = this._checkIframeOpener()\n    // If we're inside a \"refresh\" iframe\n    if (iframe) {\n      if (source) {\n        // event was triggered by a child, so ignore since we're inside a child\n        return\n      }\n\n      log.debug('dispatching event to parent');\n      // Pass event along to parent\n      _dispatchEvent(this.window.parent, authn.EVENT_STATE_CHANGE, { state, token, user, source: 'iframe' })\n\n      if (state === authn.STATE_AUTHENTICATED) {\n        // delete self now that authentication is complete\n        log.info('removing child iframe');\n        iframe.parentNode.removeChild(iframe)\n      }\n\n      return\n    }\n\n    this._maybeUpdateStoredSession(state, user, token);\n\n    if (state === authn.STATE_AUTHENTICATED) {\n      this._checkExpired(token.expiresAt.getTime())\n    }\n  }\n\n  async startup() {\n    ensureOnlyInstance(this);\n    log.info('starting up');\n    this.listen();\n    this._changeState(authn.STATE_INDETERMINATE);\n\n    const location = this._location;\n\n    if (this.isAuthenticationCallback(location)) {\n      log.debug('handling authentication callback');\n      this._changeState(authn.STATE_AUTHENTICATING);\n      try {\n        const {state, user, token, error} = await _handleAuthenticationCallback(\n          this.config,\n          location,\n          this.storageHandler\n        );\n        this._changeState(state, user, token, error);\n      } catch (err) {\n        log.error('OAuth Error', err);\n        this._changeState(authn.STATE_ERROR, undefined, undefined, err);\n      }\n    } else if (this.hasStoredSession()) {\n      log.debug('Has stored session');\n      this._updateStateFromStorage();\n    } else {\n      log.debug('no authentication present');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n    return this;\n  }\n\n  _checkExpired(expirationTimeInMs) {\n    const expiresInMs = expirationTimeInMs - Date.now()\n\n    log.debug(`checking expiration time; expires in ${expiresInMs} ms, ${new Date(expirationTimeInMs)}`);\n\n    if (expiresInMs > (30 * 1000)) { // 30 second buffer before token actually expires\n      if (this.__expirationTask) {\n        clearTimeout(this.__expirationTask);\n      }\n      // Simply using setTimeout for an hour in the future\n      // doesn't work; setTimeout isn't that precise over that long of a period.\n      // So re-check every five seconds until we're past the expiration time\n      this.__expirationTask = setTimeout(() =>  {\n        this.__expirationTask = null;\n        this._checkExpired(expirationTimeInMs);\n      }, 5000);\n\n      return;\n    }\n\n    if (this.config.autoRefreshOnTimeout) {\n      this.startRefresh('iframe');\n    } else {\n      // We don't have auto-refresh enabled, so flag the token as expired and let the application handle it.\n      this._changeState(authn.STATE_EXPIRED, this.store.user, this.store.token);\n    }\n  }\n\n  get _location() {\n    return this.window.location;\n  }\n\n  isAuthenticationCallback(location) {\n    const isCallbackUrl = location.href.indexOf(this.config.callbackUrl) === 0;\n    const hasCode = location.search && location.search.includes('code=') && location.search.includes('state=')\n\n    return !!(isCallbackUrl && hasCode)\n  }\n\n  hasStoredSession() {\n    return !!this.storageHandler.getSessionState(this.config.clientId);\n  }\n\n  shutdown() {\n    log.info('shutting down');\n    this.unlisten();\n    this._changeState(authn.STATE_INDETERMINATE);\n    cleanupOnlyInstance(this);\n  }\n\n  listen() {\n    log.debug('setting up event listeners');\n    _listenTo(this, authn.EVENT_LOGIN_REQUESTED, this.startLogin);\n    _listenTo(this, authn.EVENT_LOGOUT_REQUESTED, this.startLogout);\n    _listenTo(this, authn.EVENT_REFRESH_REQUESTED, this.startRefresh);\n    _listenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED, this.handleCurrentInfoRequest);\n    _listenTo(this, authn.EVENT_STATE_CHANGE, this.handleStateChange);\n  }\n\n  unlisten() {\n    log.debug('tearing down event listeners');\n    _unlistenTo(this, authn.EVENT_LOGIN_REQUESTED);\n    _unlistenTo(this, authn.EVENT_LOGOUT_REQUESTED);\n    _unlistenTo(this, authn.EVENT_REFRESH_REQUESTED);\n    _unlistenTo(this, authn.EVENT_CURRENT_INFO_REQUESTED);\n    _unlistenTo(this, authn.EVENT_STATE_CHANGE);\n  }\n\n  startLogin(displayType = 'window') {\n    log.infof('Starting login. mode=%s', displayType);\n    const {clientId, callbackUrl} = this.config;\n    const csrf = randomString();\n    const codeVerifier = randomString(128);\n    // challenge is base64-encoded SHA256 hash of codeVerifier\n    const codeChallenge = btoa(String.fromCharCode(...sha256.array(codeVerifier)))\n      .replace(/\\+/g, '-')\n      .replace(/\\//g, '_')\n      .replace(/=/g, '')\n\n    const storedState = _prepareStoredState(Date.now() + STORED_STATE_LIFETIME, csrf, codeVerifier, {});\n    this.storageHandler.saveOAuthState(this.config.clientId, storedState);\n\n    const loginUrl = `${BASE_URL}/authorize?response_type=code&client_id=${clientId}&redirect_uri=${encodeURIComponent(callbackUrl)}&scope=openid&state=${csrf}&code_challenge=${codeChallenge}&code_challenge_method=S256`;\n    log.debug('computed login url of', loginUrl);\n\n    if (!displayType || displayType == 'window') {\n      log.info(`Redirecting user to '${loginUrl}'`);\n      this.window.location = loginUrl;\n      return\n    } else if (displayType === 'popup') {\n      log.info('launching popup at', loginUrl);\n      this.window.open(loginUrl)\n      return\n    }\n\n    log.info('Setting up hidden refresh iframe at', loginUrl);\n    // last option: displayType == 'iframe'\n    let iframe = this.document.getElementById(CHILD_IFRAME_ID)\n    if (iframe) {\n      iframe.parentNode.removeChild(iframe)\n    }\n    iframe = this.document.createElement('iframe')\n    iframe.onload = () => {\n      let html = null\n      try {\n        html = iframe.contentWindow.document.body.innerHTML\n      } catch (err) {\n        // intentional do-nothing\n      }\n      if (html === null) {\n        // Hidden-frame refresh failed. Remove frame and\n        // report problem\n        iframe.parentNode.removeChild(iframe)\n        this._changeState(IG_STATE_AUTO_REFRESH_FAILED, null, null)\n        this._changeState(authn.STATE_UNAUTHENTICATED, null, null)\n      }\n    }\n    iframe.id = CHILD_IFRAME_ID\n    iframe.src = loginUrl\n    iframe.style = 'display:none'\n    log.debug('appending iframe', iframe);\n    this.document.body.appendChild(iframe);\n  }\n\n  startLogout() {\n    log.info('starting logout');\n    this.storageHandler.clearSessionState(this.config.clientId);\n    // Need to ensure BOTH api.byu.edu and cas.byu.edu clean out their sessions\n    // With current config of those two sites, to have that full clean out AND a final \"where to go after logout\"\n    // redirect, we need to manually wrap them all together\n    const logoutRedirect = (this.config.logoutRedirect === undefined) ? this.config.callbackUrl : this.config.logoutRedirect\n    const casLogoutUrl = 'https://cas.byu.edu/cas/logout?service=' + encodeURIComponent(logoutRedirect)\n    const logoutUrl = `${BASE_URL}/logout?redirect_url=` + encodeURIComponent(casLogoutUrl);\n    log.info('logging out by redirecting to', logoutUrl);\n    this.window.location = logoutUrl;\n\n    //TODO: WSO2 Identity Server 5.1 allows us to revoke implicit tokens.  Once that's done, we'll need to do this.\n    // const url = `https://api.byu.edu/revoke`;\n\n    // const form = new URLSearchParams();\n    // form.set('token', store.token.bearer);\n    // form.set('client_id', config.clientId);\n    // form.set('token_type_hint', 'access_token');\n\n    // console.log('logout url', url);\n\n    // fetch(url, {\n    //     method: 'POST',\n    //     body: form,\n    //     // headers: {\n    //     //     'Content-Type': 'application/x-www-form-urlencoded'\n    //     // }\n    // }).then(result => {\n    //     console.log('done with logout', result);\n    // });\n  }\n\n  async startRefresh(displayType = 'iframe') {\n    log.infof('starting refresh. displayType=%s', displayType);\n\n    // Save copy of current info before triggering changeState\n    const token = Object.assign({}, this.store.token)\n    const user = Object.assign({}, this.store.user)\n\n    // Also pass yet another isolated copy to changeState\n    this._changeState(authn.STATE_REFRESHING, Object.assign({}, this.store.user), Object.assign({}, this.store.token));\n\n    if (displayType !== 'iframe') {\n      this.startLogin(displayType);\n      return;\n    }\n\n    // If we have a refresh token, then try that before doing the more complicated iframe version\n    if (!(token && token.refresh)) {\n      this.startLogin('iframe');\n      return;\n    }\n\n    const tokenUrl = `${BASE_URL}/token`;\n    const body = new URLSearchParams();\n    body.set('grant_type', 'refresh_token');\n    body.set('client_id', this.config.clientId);\n    body.set('refresh_token', token.refresh)\n\n    const resp = await fetch(tokenUrl, {\n      method: 'POST',\n      headers: new Headers({ 'Accept': 'application/json', 'Content-Type': 'application/x-www-form-urlencoded' }),\n      body\n    });\n\n    if (resp.status !== 200) {\n      this.startLogin('iframe');\n      return;\n    }\n\n    const tokenInfo = await resp.json();\n    token.bearer = tokenInfo.access_token;\n    token.refresh = tokenInfo.refresh_token;\n    const expiresIn = tokenInfo.expires_in - EXPIRATION_BUFFER;\n    token.authorizationHeader = `Bearer ${token.bearer}`;\n    token.expiresAt = new Date(Date.now() + (expiresIn * 1000));\n\n    this._changeState(authn.STATE_AUTHENTICATED, user, token);\n  }\n\n  handleCurrentInfoRequest({callback}) {\n    log.debug('got current info request');\n    if (callback) {\n      callback(this.store);\n    }\n  }\n\n  _updateStateFromStorage() {\n    log.debug('updating state from local storage');\n    const serialized = this.storageHandler.getSessionState(this.config.clientId);\n    if (!serialized) {\n      log.debug('no stored state');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n      return;\n    }\n    const {user, token} = deserializeSessionState(serialized);\n    if (!user || !token) {\n      log.debug('no stored user or token');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    } else if (token.expiresAt > new Date()) {\n      log.debug('found an unexpired saved session');\n      this._changeState(authn.STATE_AUTHENTICATED, user, token);\n    } else {\n      log.debug('stored session was expired');\n      this._changeState(authn.STATE_UNAUTHENTICATED);\n    }\n  }\n\n  _maybeUpdateStoredSession(state, user, token) {\n    log.debugf('updating stored session: state=%s hasUser=%s, hasToken=%s', state, !!user, !!token);\n    if (state === authn.STATE_UNAUTHENTICATED || state === authn.STATE_REFRESHING || state === authn.STATE_EXPIRED) {\n      log.debug('state is unauthenticated or expired, clearing stored session');\n      this.storageHandler.clearSessionState(this.config.clientId);\n    } else if (!!user && !!token) {\n      log.debug('storing session', redactUser(user), redactToken(token));\n      const serialized = serializeSessionState(user, token);\n      this.storageHandler.saveSessionState(this.config.clientId, serialized);\n    }\n  }\n}\n\nfunction serializeSessionState(user, token) {\n  const grouped = groupClaimPrefixes(token.rawUserInfo);\n\n  const smallerUserInfo = {\n    ro: grouped[CLAIMS_PREFIX_RESOURCE_OWNER],\n    cl: grouped[CLAIMS_PREFIX_CLIENT],\n    wso2: grouped[CLAIMS_PREFIX_WSO2],\n    o: grouped.other,\n  };\n\n  return {\n    ui: smallerUserInfo,\n    at: token.bearer,\n    rf: token.refresh,\n    ah: token.authorizationHeader,\n    ea: token.expiresAt.getTime()\n  };\n}\n\nfunction deserializeSessionState(state) {\n  const groupedUserInfo = {\n    [CLAIMS_PREFIX_RESOURCE_OWNER]: state.ui.ro,\n    [CLAIMS_PREFIX_CLIENT]: state.ui.cl,\n    [CLAIMS_PREFIX_WSO2]: state.ui.wso2,\n    other: state.ui.o,\n  }\n  const userInfo = ungroupClaimPrefixes(groupedUserInfo);\n\n  const user = _processUserInfo(userInfo);\n  const expiresAt = new Date(state.ea);\n  const token = _processTokenInfo({ userInfo, accessToken: state.at, expiresAt, authHeader: `Bearer ${state.at}`, refreshToken: state.rf });\n  return {user, token};\n}\n\nfunction _listenTo(provider, event, listener) {\n  if (provider._listeners.hasOwnProperty(event)) {\n    throw new Error('A listener is already registered for ' + event);\n  }\n  const obs = provider._listeners[event] = function (e) {\n    listener.call(provider, e.detail);\n  }.bind(provider);\n\n  provider.document.addEventListener(event, obs, false);\n}\n\nfunction _unlistenTo(provider, event) {\n  if (!provider._listeners.hasOwnProperty(event)) {\n    return;\n  }\n\n  provider.document.removeEventListener(event, provider._listeners[event], false);\n  delete provider._listeners[event];\n}\n\n\nfunction _dispatchEvent(provider, name, detail) {\n  let event;\n  if (typeof provider.window.CustomEvent === 'function') {\n    event = new CustomEvent(name, {detail});\n  } else {\n    event = provider.document.createEvent('CustomEvent');\n    event.initCustomEvent(name, true, false, detail);\n  }\n  provider.document.dispatchEvent(event);\n}\n\nasync function _handleAuthenticationCallback(config, location, storage) {\n  const searchParams = new URLSearchParams(location.search);\n\n  const oauthCsrfToken = searchParams.get('state');\n  const storedState = storage.getOAuthState(config.clientId);\n\n  storage.clearOAuthState(config.clientId);\n\n  log.debug('checking oauth state token');\n  const pageState = _validateAndGetStoredState(storedState, oauthCsrfToken);\n  const tokenInfo = await _fetchTokenInfo(searchParams.get('code'), config, storedState.v)\n\n  const accessToken = tokenInfo.access_token;\n  const refreshToken = tokenInfo.refresh_token;\n  const expiresIn = tokenInfo.expires_in - EXPIRATION_BUFFER;\n  const expiresAt = new Date(Date.now() + (expiresIn * 1000));\n  const authHeader = `Bearer ${accessToken}`;\n  log.debug('got token', redactBearerToken(accessToken), 'which expires in', expiresIn, 'seconds');\n\n  const userInfo = await _fetchUserInfo(authHeader);\n\n  const user = _processUserInfo(userInfo);\n  const token = _processTokenInfo({ userInfo, accessToken, expiresAt, authHeader, refreshToken });\n\n  return {state: authn.STATE_AUTHENTICATED, user, token};\n}\n\n\nasync function _fetchTokenInfo(code, config, codeVerifier) {\n  log.debug('Exchanging code for token');\n  const tokenUrl = `${BASE_URL}/token`;\n  const body = new URLSearchParams();\n  body.set('grant_type', 'authorization_code');\n  body.set('client_id', config.clientId);\n  body.set('redirect_uri', config.callbackUrl);\n  body.set('code', code);\n  body.set('code_verifier', codeVerifier)\n\n  const resp = await fetch(tokenUrl, {\n    method: 'POST',\n    headers: new Headers({ 'Accept': 'application/json', 'Content-Type': 'application/x-www-form-urlencoded' }),\n    body\n  });\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    log.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-exchange-code-for-token',\n      'Unable to exchange code for token. Please try again.'\n    );\n  }\n\n  const json = await resp.json();\n  log.debug('successfully got user info', json);\n  return json;\n}\n\nasync function _fetchUserInfo(authHeader) {\n  const USER_INFO_URL = `${BASE_URL}/openid-userinfo/v1/userinfo?schema=openid`;\n  log.debug('fetching user info from', USER_INFO_URL);\n  const resp = await fetch(USER_INFO_URL, {\n    method: 'GET',\n    headers: new Headers({'Accept': 'application/json', 'Authorization': authHeader}),\n    mode: 'cors',\n  });\n\n  log.debug('got status', resp.status);\n\n  if (resp.status !== 200) {\n    const body = await resp.text();\n\n    if (resp.status === 403) {\n      log.debug('got forbidden error');\n      if (body.includes('<ams:code>900908</ams:code>')) {\n        log.debug('client app isn\\'t subscribed to OpenID UserInfo endpoint');\n        log.error(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`);\n        throw new OAuthError(\n          'not-subscribed-to-user-info',\n          'This page has an authentication configuration error. Developers, see the console for details.'\n        );\n      } else {\n        log.error('invalid oauth bearer token');\n        throw new OAuthError(\n          'invalid-oauth-token',\n          'The provided authentication token is invalid. Please try again.'\n        );\n      }\n    }\n    log.error('Error getting OAuth User Info. Status Code:', resp.status, 'Response:\\n', body);\n    throw new OAuthError(\n      'unable-to-get-user-info',\n      'Unable to fetch user information. Please try again.'\n    );\n  }\n  const json = await resp.json();\n  log.debug('successfully got user info', json);\n  return json;\n}\n\nconst CLAIMS_PREFIX_RESOURCE_OWNER = 'http://byu.edu/claims/resourceowner_';\nconst CLAIMS_PREFIX_CLIENT = 'http://byu.edu/claims/client_';\nconst CLAIMS_PREFIX_WSO2 = 'http://wso2.org/claims/';\n\nconst CLAIMS_KNOWN_PREFIXES = [CLAIMS_PREFIX_CLIENT, CLAIMS_PREFIX_RESOURCE_OWNER, CLAIMS_PREFIX_WSO2];\n\nfunction groupClaimPrefixes(userInfo) {\n  const grouped = {\n    other: {}\n  };\n  for (const prefix of CLAIMS_KNOWN_PREFIXES) {\n    grouped[prefix] = {};\n  }\n  for (const key of Object.keys(userInfo)) {\n    const value = userInfo[key];\n    const prefix = CLAIMS_KNOWN_PREFIXES.find(it => key.startsWith(it));\n    if (prefix) {\n        grouped[prefix][key.substr(prefix.length)] = value;\n    } else {\n      grouped.other[key] = value;\n    }\n  }\n  return grouped;\n}\n\nfunction ungroupClaimPrefixes(grouped) {\n  const result = {};\n  for (const groupKey of CLAIMS_KNOWN_PREFIXES) {\n    const group = grouped[groupKey];\n    if (!group) continue;\n    for (const key of Object.keys(group)) {\n      result[groupKey + key] = group[key];\n    }\n  }\n  for (const other of Object.keys(grouped.other)) {\n    result[other] = grouped.other[other];\n  }\n  return result;\n}\n\nfunction getClaims(userInfo, prefix) {\n  return Object.keys(userInfo).filter(k => k.startsWith(prefix))\n    .reduce((agg, key) => {\n      agg[key.substr(prefix.length)] = userInfo[key];\n      return agg;\n    }, {});\n}\n\nfunction _processUserInfo(userInfo) {\n  const roClaims = getClaims(userInfo, CLAIMS_PREFIX_RESOURCE_OWNER);\n\n  const familyNamePosition = roClaims.surname_position;\n  const givenName = roClaims.preferred_first_name;\n  const familyName = roClaims.surname;\n\n  const displayName = familyNamePosition === 'F' ? `${familyName} ${givenName}` : `${givenName} ${familyName}`;\n\n  return {\n    personId: roClaims.person_id,\n    byuId: roClaims.byu_id,\n    netId: roClaims.net_id,\n    name: {\n      sortName: roClaims.sort_name,\n      displayName,\n      givenName,\n      familyName,\n      familyNamePosition,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _processTokenInfo({ userInfo, accessToken, expiresAt, authHeader, refreshToken }) {\n  const clientClaims = getClaims(userInfo, CLAIMS_PREFIX_CLIENT);\n  const wso2Claims = getClaims(userInfo, CLAIMS_PREFIX_WSO2);\n\n  return {\n    bearer: accessToken,\n    refresh: refreshToken,\n    authorizationHeader: authHeader,\n    expiresAt,\n    client: {\n      id: wso2Claims.client_id,\n      byuId: clientClaims.byu_id,\n      appName: wso2Claims.applicationname,\n    },\n    rawUserInfo: userInfo\n  };\n}\n\nfunction _validateAndGetStoredState(storedState, expectedCsrfToken) {\n  log.debug('validating stored state token. Expecting token', expectedCsrfToken, ', got state', storedState);\n  if (!storedState) {\n    log.error('no stored oauth login state');\n    throw new OAuthError('no-oauth-state', 'Your saved authentication information does not match. Please try again.');\n  }\n  const {e: stateExpiresString, c: storedCsrfToken, s: pageState} = storedState;\n\n  if (expectedCsrfToken !== storedCsrfToken) {\n    log.error('CSRF token mismatch')\n    throw new OAuthError(\n      'oauth-state-mismatch',\n      'Your saved authentication information does not match. Please try again.'\n    );\n  }\n\n  if (Number(stateExpiresString) < Date.now()) {\n    log.error('stored state has expired');\n    throw new OAuthError(\n      'oauth-state-expired',\n      'Your login attempt has timed out. Please try again.'\n    );\n  }\n\n  return pageState;\n}\n\nfunction _prepareStoredState(expires, csrfToken, codeVerifier, pageState) {\n  return {\n    e: expires,\n    c: csrfToken,\n    v: codeVerifier,\n    s: pageState,\n  }\n}\n\nclass OAuthError extends Error {\n  constructor(type, description, uri) {\n    super('OAuth Error: ' + description);\n    this.type = type;\n    this.description = description;\n    this.uri = uri;\n  }\n}\n\nconst allowableRandomChars = [...'0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'];\nconst randomCharRangeConvert = allowableRandomChars.length / 2**8; // Using Uint8Array for getRandomValues\n\nfunction randomString(length) {\n  const randomArray = new Uint8Array(length || 24);\n  const crypto = window.crypto || window.msCrypto;\n  crypto.getRandomValues(randomArray);\n\n  return randomArray.reduce((str, cur) => str + allowableRandomChars[Math.floor(cur * randomCharRangeConvert)], '');\n}\n\nfunction logStateChange(state, user, token, error) {\n  const logParts = [\n    'state change:',\n    {\n      state,\n      user: redactUser(user),\n      token: token, //redactToken(token),\n      error: error\n    }\n  ];\n  if (error) {\n    log.error(...logParts);\n  } else {\n    log.info(...logParts);\n  }\n}\n\nfunction redactUser(u) {\n  if (!u) return undefined;\n  return {\n    netId: u.netId,\n    'rest-is-redacted': true\n  };\n}\n\nfunction redactToken(t) {\n  log.debug('redacting token', t);\n  if (!t) return undefined;\n  const {bearer, expiresAt, client} = t;\n  return {\n    bearer: redactBearerToken(bearer),\n    expiresAt: !!expiresAt ? expiresAt.toISOString() : null,\n    client,\n    'rest-is-redacted': true\n  }\n}\nfunction redactBearerToken(b) {\n  if (!b) return undefined;\n  return b.substring(0, 2) + '...redacted...' + b.substring(b.length - 2)\n}\n\nfunction ensureOnlyInstance(obj) {\n  if (SINGLETON_INSTANCE) {\n    const trace = SINGLETON_INSTANCE.___startupTrace;\n    throw new Error('There is already an instance of byu-oauth-implicit running!  Please call `#shutdown()` on that instance before starting a new one. Instance was started at:\\n' + trace);\n  }\n  obj.___startupTrace = new Error().stack;\n  SINGLETON_INSTANCE = obj;\n}\n\nfunction cleanupOnlyInstance(obj) {\n  SINGLETON_INSTANCE = null;\n}\n\nexport function __forceShutdown() {\n  if (SINGLETON_INSTANCE) {\n    SINGLETON_INSTANCE.shutdown();\n    cleanupOnlyInstance(SINGLETON_INSTANCE);\n  }\n}\n","/*\n * Copyright 2018 Brigham Young University\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { IG_STATE_AUTO_REFRESH_FAILED, ImplicitGrantProvider } from \"./provider.js\";\nexport { IG_STATE_AUTO_REFRESH_FAILED }\n\nexport const DEFAULT_ISSUER = 'https://api.byu.edu';\nexport const DEFAULT_BASE_URL = 'https://api.byu.edu';\n\nexport const GLOBAL_CONFIG_KEY = 'byu-oauth-implicit-config';\n\n/**\n * @typedef {} ImplicitConfig\n * @prop {string} clientId\n * @prop {?string} issuer\n * @prop {?string} baseUrl\n * @prop {?string} callbackUrl\n * @prop {?boolean} requireAuthentication\n */\n\n/**\n * @param {ImplicitConfig|ImplicitConfig[]|undefined} cfgOrRules\n * @param location\n */\nexport async function configure(cfgOrRules, location = window.location) {\n  const cfg = resolveConfig(cfgOrRules, location);\n  const globalConfig = window[GLOBAL_CONFIG_KEY];\n\n  const config = Object.assign({\n    issuer: DEFAULT_ISSUER,\n    baseUrl: DEFAULT_BASE_URL,\n    callbackUrl: `${location.origin}${location.pathname}`,\n    autoRefreshOnTimeout: false\n  }, globalConfig, cfg);\n\n  if (!config.clientId) {\n    throw new Error('clientId must be specified in config');\n  }\n  const provider = new ImplicitGrantProvider(config, window, document);\n\n  return provider.startup();\n}\n\nfunction resolveConfig(rules, location) {\n  if (!rules) {\n    return {};\n  }\n\n  if ('clientId' in rules) {\n    return rules;\n  }\n\n  const keys = Object.keys(rules)\n    .filter(it => it.startsWith('https://') || it.startsWith('http://'));\n\n  if (keys.length === 0) {\n    return rules;\n  }\n\n  const key = keys\n    // order by length of key (most specific), descending\n    .sort((a, b) => b.length - a.length)\n    .find(it => location.href.startsWith(it));\n  if (key) {\n    return Object.assign({ callbackUrl: key }, rules[key]);\n  }\n  throw new Error(`Unable to match url [${location.href}] to one of [${keys}]`)\n}\n","export const EVENT_PREFIX = 'byu-browser-oauth';\n\nexport const EVENT_STATE_CHANGE = `${EVENT_PREFIX}-state-changed`;\nexport const EVENT_LOGIN_REQUESTED = `${EVENT_PREFIX}-login-requested`;\nexport const EVENT_LOGOUT_REQUESTED = `${EVENT_PREFIX}-logout-requested`;\nexport const EVENT_REFRESH_REQUESTED = `${EVENT_PREFIX}-refresh-requested`;\nexport const EVENT_CURRENT_INFO_REQUESTED = `${EVENT_PREFIX}-current-info-requested`;\n\nexport const STATE_INDETERMINATE = 'indeterminate';\nexport const STATE_UNAUTHENTICATED = 'unauthenticated';\nexport const STATE_AUTHENTICATED = 'authenticated';\nexport const STATE_AUTHENTICATING = 'authenticating';\nexport const STATE_REFRESHING = 'refreshing';\nexport const STATE_EXPIRED = 'expired';\nexport const STATE_ERROR = 'error';\n\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.hasCookies = hasCookies;\n\nvar _cookie = require('cookie');\n\nvar _cookie2 = _interopRequireDefault(_cookie);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar prefix = 'lS_';\n\nvar CookieStorage = function () {\n  function CookieStorage() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, CookieStorage);\n\n    this.cookieOptions = Object.assign({ path: '/' }, options);\n    prefix = options.prefix === undefined ? prefix : options.prefix;\n  }\n\n  _createClass(CookieStorage, [{\n    key: 'getItem',\n    value: function getItem(key) {\n      var cookies = _cookie2.default.parse(document.cookie);\n      if (!cookies || !cookies.hasOwnProperty(prefix + key)) {\n        return null;\n      }\n      return cookies[prefix + key];\n    }\n  }, {\n    key: 'setItem',\n    value: function setItem(key, value) {\n      document.cookie = _cookie2.default.serialize(prefix + key, value, this.cookieOptions);\n      return value;\n    }\n  }, {\n    key: 'removeItem',\n    value: function removeItem(key) {\n      var options = Object.assign({}, this.cookieOptions, { maxAge: -1 });\n      document.cookie = _cookie2.default.serialize(prefix + key, '', options);\n      return null;\n    }\n  }, {\n    key: 'clear',\n    value: function clear() {\n      var cookies = _cookie2.default.parse(document.cookie);\n      for (var key in cookies) {\n        if (key.indexOf(prefix) === 0) {\n          this.removeItem(key.substr(prefix.length));\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return CookieStorage;\n}();\n\nexports.default = CookieStorage;\nfunction hasCookies() {\n  var storage = new CookieStorage();\n\n  try {\n    var TEST_KEY = '__test';\n    storage.setItem(TEST_KEY, '1');\n    var value = storage.getItem(TEST_KEY);\n    storage.removeItem(TEST_KEY);\n\n    return value === '1';\n  } catch (e) {\n    return false;\n  }\n}","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = isSupported;\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar TEST_KEY = '__test';\n\nfunction hasStorage(name) {\n  try {\n    var storage = window[name];\n    storage.setItem(TEST_KEY, '1');\n    storage.removeItem(TEST_KEY);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction isSupported() {\n  var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'localStorage';\n\n  var storage = String(name).replace(/storage$/i, '').toLowerCase();\n\n  if (storage === 'local') {\n    return hasStorage('localStorage');\n  }\n\n  if (storage === 'session') {\n    return hasStorage('sessionStorage');\n  }\n\n  if (storage === 'cookie') {\n    return (0, _CookieStorage.hasCookies)();\n  }\n\n  if (storage === 'memory') {\n    return true;\n  }\n\n  throw new Error('Storage method `' + name + '` is not available.\\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.');\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar MemoryStorage = function () {\n  function MemoryStorage() {\n    _classCallCheck(this, MemoryStorage);\n\n    this._data = {};\n  }\n\n  _createClass(MemoryStorage, [{\n    key: \"getItem\",\n    value: function getItem(key) {\n      return this._data.hasOwnProperty(key) ? this._data[key] : null;\n    }\n  }, {\n    key: \"setItem\",\n    value: function setItem(key, value) {\n      return this._data[key] = String(value);\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(key) {\n      return delete this._data[key];\n    }\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      return this._data = {};\n    }\n  }]);\n\n  return MemoryStorage;\n}();\n\nexports.default = MemoryStorage;","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MemoryStorage = exports.CookieStorage = exports.isSupported = exports.storage = undefined;\n\nvar _isSupported = require('./isSupported');\n\nvar _isSupported2 = _interopRequireDefault(_isSupported);\n\nvar _CookieStorage = require('./CookieStorage');\n\nvar _CookieStorage2 = _interopRequireDefault(_CookieStorage);\n\nvar _MemoryStorage = require('./MemoryStorage');\n\nvar _MemoryStorage2 = _interopRequireDefault(_MemoryStorage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar storage = null;\n\nif ((0, _isSupported2.default)('localStorage')) {\n  // use localStorage\n  exports.storage = storage = window.localStorage;\n} else if ((0, _isSupported2.default)('sessionStorage')) {\n  // use sessionStorage\n  exports.storage = storage = window.sessionStorage;\n} else if ((0, _isSupported2.default)('cookieStorage')) {\n  // use cookies\n  exports.storage = storage = new _CookieStorage2.default();\n} else {\n  // use memory\n  exports.storage = storage = new _MemoryStorage2.default();\n}\n\nexports.default = storage;\nexports.storage = storage;\nexports.isSupported = _isSupported2.default;\nexports.CookieStorage = _CookieStorage2.default;\nexports.MemoryStorage = _MemoryStorage2.default;"],"names":["Math","floor","debug","args","log","LEVEL_DEBUG","info","LEVEL_INFO","error","LEVEL_ERROR","debugf","format","logf","infof","level","shouldLog","run","name","getFormattedTime","now","Date","h24","String","getHours","padStart","min","getMinutes","sec","getSeconds","millis","getMilliseconds","formatTimezone","date","abs","offset","getTimezoneOffset","absOffset","hourInt","hourDone","sign","nonNegative","minDone","priority","currentLevel","levelAttr","levelGlobalVar","DEFAULT_LEVEL","lower","toLowerCase","ALL_LEVELS","find","l","document","documentElement","getAttribute","o","window","byuOAuth","logging","tryDecode","str","decode","e","getKey","clientId","encodeURIComponent","getSessionKey","serializeSessionState","user","token","grouped","groupClaimPrefixes","rawUserInfo","smallerUserInfo","ro","CLAIMS_PREFIX_RESOURCE_OWNER","cl","CLAIMS_PREFIX_CLIENT","wso2","CLAIMS_PREFIX_WSO2","other","ui","at","bearer","rf","refresh","ah","authorizationHeader","ea","expiresAt","getTime","deserializeSessionState","state","groupedUserInfo","userInfo","ungroupClaimPrefixes","_processUserInfo","_processTokenInfo","accessToken","authHeader","refreshToken","_listenTo","provider","event","listener","_listeners","hasOwnProperty","Error","obs","call","detail","bind","addEventListener","_unlistenTo","removeEventListener","_dispatchEvent","CustomEvent","createEvent","initCustomEvent","dispatchEvent","_handleAuthenticationCallback","config","location","storage","searchParams","URLSearchParams","search","oauthCsrfToken","get","storedState","getOAuthState","clearOAuthState","pageState","_validateAndGetStoredState","tokenInfo","_fetchTokenInfo","v","access_token","refresh_token","expiresIn","expires_in","EXPIRATION_BUFFER","redactBearerToken","_fetchUserInfo","authn","code","codeVerifier","tokenUrl","BASE_URL","body","set","callbackUrl","resp","fetch","method","headers","Headers","status","text","OAuthError","json","USER_INFO_URL","mode","includes","prefix","CLAIMS_KNOWN_PREFIXES","key","Object","keys","value","it","startsWith","substr","length","result","groupKey","group","getClaims","filter","k","reduce","agg","roClaims","familyNamePosition","surname_position","givenName","preferred_first_name","familyName","surname","displayName","personId","person_id","byuId","byu_id","netId","net_id","sortName","sort_name","clientClaims","wso2Claims","client","id","client_id","appName","applicationname","expectedCsrfToken","stateExpiresString","c","storedCsrfToken","s","Number","_prepareStoredState","expires","csrfToken","randomString","randomArray","Uint8Array","crypto","msCrypto","getRandomValues","cur","allowableRandomChars","randomCharRangeConvert","logStateChange","logParts","redactUser","u","redactToken","t","toISOString","b","substring","ensureOnlyInstance","obj","SINGLETON_INSTANCE","trace","___startupTrace","stack","cleanupOnlyInstance","resolveConfig","rules","sort","a","href","assign","console","EVENT_PREFIX","EVENT_STATE_CHANGE","EVENT_LOGIN_REQUESTED","EVENT_LOGOUT_REQUESTED","EVENT_REFRESH_REQUESTED","EVENT_CURRENT_INFO_REQUESTED","STATE_INDETERMINATE","STATE_UNAUTHENTICATED","STATE_AUTHENTICATED","STATE_REFRESHING","STATE_EXPIRED","decodeURIComponent","encode","pairSplitRegExp","fieldContentRegExp","options","TypeError","opt","pairs","split","dec","i","pair","eq_idx","indexOf","trim","val","slice","undefined","enc","test","maxAge","isNaN","domain","path","toUTCString","httpOnly","secure","sameSite","_classCallCheck","instance","Constructor","defineProperty","exports","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","protoProps","staticProps","prototype","CookieStorage","setItem","getItem","removeItem","_cookie2","__esModule","default","_interopRequireDefault","_cookie","arguments","cookieOptions","cookies","parse","cookie","serialize","hasStorage","replace","_CookieStorage","hasCookies","MemoryStorage","_data","_isSupported2","_isSupported","_CookieStorage2","_MemoryStorage2","_MemoryStorage","localStorage","sessionStorage","StorageHandler","saveOAuthState","JSON","stringify","saveSessionState","getSessionState","stored","clearSessionState","sha256","sha256Lib","CHILD_IFRAME_ID","IG_STATE_AUTO_REFRESH_FAILED","ImplicitGrantProvider","constructor","storageHandler","baseUrl","store","freeze","_changeState","_checkPopupOpener","origin","opener","URL","_checkIframeOpener","iframe","parent","getElementById","contentWindow","handleStateChange","source","close","parentNode","removeChild","_maybeUpdateStoredSession","_checkExpired","startup","listen","_location","isAuthenticationCallback","err","hasStoredSession","_updateStateFromStorage","expirationTimeInMs","expiresInMs","__expirationTask","clearTimeout","setTimeout","_this","autoRefreshOnTimeout","startRefresh","isCallbackUrl","hasCode","shutdown","unlisten","startLogin","startLogout","handleCurrentInfoRequest","displayType","fromCharCode","csrf","codeChallenge","btoa","array","loginUrl","open","createElement","onload","html","innerHTML","_this2","src","style","appendChild","logoutRedirect","casLogoutUrl","logoutUrl","callback","serialized","type","description","uri","DEFAULT_ISSUER","DEFAULT_BASE_URL","GLOBAL_CONFIG_KEY","cfgOrRules","cfg","globalConfig","issuer","pathname"],"mappings":"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"}