this.BYU=this.BYU||{},this.BYU.oauth=this.BYU.oauth||{},this.BYU.oauth.implicit=function(a){'use strict';/*
   *  @license
   *    Copyright 2018 Brigham Young University
   *
   *    Licensed under the Apache License, Version 2.0 (the "License");
   *    you may not use this file except in compliance with the License.
   *    You may obtain a copy of the License at
   *
   *        http://www.apache.org/licenses/LICENSE-2.0
   *
   *    Unless required by applicable law or agreed to in writing, software
   *    distributed under the License is distributed on an "AS IS" BASIS,
   *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   *    See the License for the specific language governing permissions and
   *    limitations under the License.
   */function b(a){if(!a)return new Map;let b=a;a.startsWith('#')&&(b=a.substr(1));const c=b.split('&').map(function(a){return a.split('=',2)});return new Map(c)}function c(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,'default')?a['default']:a}function d(a,b){return b={exports:{}},a(b,b.exports),b.exports}/*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *//**
   * Module exports.
   * @public
   *//**
   * Parse a cookie header.
   *
   * Parse the given cookie header string into an object
   * The object has the various cookies as keys(names) => values
   *
   * @param {string} str
   * @param {object} [options]
   * @return {object}
   * @public
   *//**
   * Serialize data into a cookie header.
   *
   * Serialize the a name value pair into a cookie string suitable for
   * http headers. An optional options object specified cookie parameters.
   *
   * serialize('foo', 'bar', { httpOnly: true })
   *   => "foo=bar; httpOnly"
   *
   * @param {string} name
   * @param {string} val
   * @param {object} [options]
   * @return {string}
   * @public
   *//**
   * Try decoding a string using a decoding function.
   *
   * @param {string} str
   * @param {function} decode
   * @private
   */function e(a,b){try{return b(a)}catch(b){return a}}function f(a){return'oauth-state-'+encodeURIComponent(a)}/*
   *  @license
   *    Copyright 2018 Brigham Young University
   *
   *    Licensed under the Apache License, Version 2.0 (the "License");
   *    you may not use this file except in compliance with the License.
   *    You may obtain a copy of the License at
   *
   *        http://www.apache.org/licenses/LICENSE-2.0
   *
   *    Unless required by applicable law or agreed to in writing, software
   *    distributed under the License is distributed on an "AS IS" BASIS,
   *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   *    See the License for the specific language governing permissions and
   *    limitations under the License.
   */function g(a,b,c){if(a._listeners.hasOwnProperty(b))throw new Error('A listener is already registered for '+b);const d=a._listeners[b]=function(b){c.call(a,b.detail)}.bind(a);a.document.addEventListener(b,d,!1)}function h(a,b){a._listeners.hasOwnProperty(b)&&(a.document.removeEventListener(b,a._listeners[b],!1),delete a._listeners[b])}function i(a,b,c){let d;'function'==typeof a.window.CustomEvent?d=new CustomEvent(b,{detail:c}):(d=a.document.createEvent('CustomEvent'),d.initCustomEvent(b,!0,!1,c)),a.document.dispatchEvent(d)}async function j(a,b,c,d){if(c.has('error'))throw new T(c.get('error'),c.get('error_description'),c.get('error_uri'));const e=c.get('state'),f=d.getOAuthState(a.clientId);d.clearOAuthState(a.clientId);const g=o(f,e),h=c.get('access_token'),i=+c.get('expires_in'),j=new Date(Date.now()+1e3*i),l=`Bearer ${h}`,p=await k(l),q=m(p),r=n(p,h,j,l);return b.hash='',{state:y,user:q,token:r}}async function k(a){const b=await fetch('https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid',{method:'GET',headers:new Headers({Accept:'application/json',Authorization:a}),mode:'cors'});if(200!==b.status){const a=await b.text();if(403===b.status)if(a.includes('<ams:code>900908</ams:code>'))throw console.error(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`),new T('not-subscribe-to-user-info','This page has an authentication configuration error. Developers, see the console for details.');else throw new T('invalid-oauth-token','The provided authentication token is invalid. Please try again.');throw console.error('Error getting OAuth User Info. Status Code:',b.status,'Response:\n',a),new T('unable-to-get-user-info','Unable to fetch user information. Please try again.')}return await b.json()}function l(a,b){return Object.keys(a).filter(function(a){return a.startsWith(b)}).reduce(function(c,d){return c[d.substr(b.length)]=a[d],c},{})}function m(a){const b=l(a,Q),c=b.surname_position,d=a.given_name,e=a.family_name,f='F'===c?`${e} ${d}`:`${d} ${e}`;return{personId:b.person_id,byuId:b.byu_id,netId:b.net_id,name:{sortName:b.sort_name,displayName:f,givenName:d,familyName:e,familyNamePosition:c},rawUserInfo:a}}function n(a,b,c,d){const e=l(a,R),f=l(a,S);return{bearer:b,authorizationHeader:d,expiresAt:c,client:{id:f.client_id,byuId:e.byu_id,appName:f.applicationname},rawUserInfo:a}}function o(a,b){const{e:c,c:d,s:e}=a;if(b!==d)throw new T('oauth-state-mismatch','Your saved authentication information does not match. Please try again.');if(+c<Date.now())throw new T('oauth-state-expired','Your login attempt has timed out. Please try again.');return e}function p(a,b,c){return{e:a,c:b,s:c}}function q(){let a=new Uint32Array(3);const b=window.crypto||window.msCrypto;return b.getRandomValues(a),a.reduce(function(a,b){return a+b.toString(16)},'')}/*
   * Copyright 2018 Brigham Young University
   * 
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   * 
   *    http://www.apache.org/licenses/LICENSE-2.0
   * 
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *//**
   * @typedef {} ImplicitConfig
   * @prop {string} clientId
   * @prop {?string} issuer
   * @prop {?string} callbackUrl
   * @prop {?boolean} requireAuthentication
   *//**
   *
   * @param {ImplicitConfig} cfg
   */const r='byu-browser-oauth',s=`${r}-state-changed`,t=`${r}-login-requested`,u=`${r}-logout-requested`,v=`${r}-refresh-requested`,w=`${r}-current-info-requested`,x='indeterminate',y='authenticated';var z=decodeURIComponent,A=encodeURIComponent,B=/; */,C=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,D={parse:function(a,b){if('string'!=typeof a)throw new TypeError('argument str must be a string');for(var c={},d=b||{},f=a.split(B),g=d.decode||z,h=0;h<f.length;h++){var i=f[h],j=i.indexOf('=');// skip things that don't look like key=value
if(!(0>j)){var k=i.substr(0,j).trim(),l=i.substr(++j,i.length).trim();'"'==l[0]&&(l=l.slice(1,-1)),void 0==c[k]&&(c[k]=e(l,g))}// quoted values
}return c},serialize:function(a,b,c){var d=c||{},e=d.encode||A;if('function'!=typeof e)throw new TypeError('option encode is invalid');if(!C.test(a))throw new TypeError('argument name is invalid');var f=e(b);if(f&&!C.test(f))throw new TypeError('argument val is invalid');var g=a+'='+f;if(null!=d.maxAge){var h=d.maxAge-0;if(isNaN(h))throw new Error('maxAge should be a Number');g+='; Max-Age='+Math.floor(h)}if(d.domain){if(!C.test(d.domain))throw new TypeError('option domain is invalid');g+='; Domain='+d.domain}if(d.path){if(!C.test(d.path))throw new TypeError('option path is invalid');g+='; Path='+d.path}if(d.expires){if('function'!=typeof d.expires.toUTCString)throw new TypeError('option expires is invalid');g+='; Expires='+d.expires.toUTCString()}if(d.httpOnly&&(g+='; HttpOnly'),d.secure&&(g+='; Secure'),d.sameSite){var i='string'==typeof d.sameSite?d.sameSite.toLowerCase():d.sameSite;switch(i){case!0:g+='; SameSite=Strict';break;case'lax':g+='; SameSite=Lax';break;case'strict':g+='; SameSite=Strict';break;default:throw new TypeError('option sameSite is invalid');}}return g}},E=d(function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(b,'__esModule',{value:!0});var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();b.hasCookies=function(){var a=new g;try{var b='__test';a.setItem(b,'1');var c=a.getItem(b);return a.removeItem(b),'1'===c}catch(a){return!1}};var e=function(a){return a&&a.__esModule?a:{default:a}}(D),f='lS_',g=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,a),this.cookieOptions=Object.assign({path:'/'},b),f=b.prefix||f}return d(a,[{key:'getItem',value:function(a){var b=e.default.parse(document.cookie);return b&&b.hasOwnProperty(f+a)?b[f+a]:null}},{key:'setItem',value:function(a,b){return document.cookie=e.default.serialize(f+a,b,this.cookieOptions),b}},{key:'removeItem',value:function(a){var b=Object.assign({},this.cookieOptions,{maxAge:-1});return document.cookie=e.default.serialize(f+a,'',b),null}},{key:'clear',value:function(){var a=e.default.parse(document.cookie);for(var b in a)0===b.indexOf(f)&&this.removeItem(b.substr(f.length));return null}}]),a}();b.default=g});/**
   * Module variables.
   * @private
   *//**
   * RegExp to match field-content in RFC 7230 sec 3.2
   *
   * field-content = field-vchar [ 1*( SP / HTAB ) field-vchar ]
   * field-vchar   = VCHAR / obs-text
   * obs-text      = %x80-FF
   */c(E);var F=E.hasCookies,G=d(function(a,b){function c(a){try{var b=window[a];return b.setItem(d,'1'),b.removeItem(d),!0}catch(a){return!1}}Object.defineProperty(b,'__esModule',{value:!0}),b.default=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'localStorage',b=(a+'').replace(/storage$/i,'').toLowerCase();if('local'===b)return c('localStorage');if('session'===b)return c('sessionStorage');if('cookie'===b)return(0,E.hasCookies)();if('memory'===b)return!0;throw new Error('Storage method `'+a+'` is not available.\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.')};var d='__test'});c(G);var H=d(function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(b,'__esModule',{value:!0});var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(){c(this,a),this._data={}}return d(a,[{key:'getItem',value:function(a){return this._data.hasOwnProperty(a)?this._data[a]:null}},{key:'setItem',value:function(a,b){return this._data[a]=b+''}},{key:'removeItem',value:function(a){return delete this._data[a]}},{key:'clear',value:function(){return this._data={}}}]),a}();b.default=e});c(H);var I=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,'__esModule',{value:!0}),b.MemoryStorage=b.CookieStorage=b.isSupported=b.storage=void 0;var d=c(G),e=c(E),f=c(H),g=null;b.storage=(0,d.default)('localStorage')?g=window.localStorage:(0,d.default)('sessionStorage')?g=window.sessionStorage:(0,d.default)('cookieStorage')?g=new e.default:g=new f.default,b.default=g,b.storage=g,b.isSupported=d.default,b.CookieStorage=e.default,b.MemoryStorage=f.default}),J=c(I),K=I.MemoryStorage,L=I.CookieStorage,M=I.isSupported,N=I.storage;/*
   *  @license
   *    Copyright 2018 Brigham Young University
   *
   *    Licensed under the Apache License, Version 2.0 (the "License");
   *    you may not use this file except in compliance with the License.
   *    You may obtain a copy of the License at
   *
   *        http://www.apache.org/licenses/LICENSE-2.0
   *
   *    Unless required by applicable law or agreed to in writing, software
   *    distributed under the License is distributed on an "AS IS" BASIS,
   *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   *    See the License for the specific language governing permissions and
   *    limitations under the License.
   */class O{saveOAuthState(a,b){J.setItem(f(a),JSON.stringify(b))}getOAuthState(a){const b=J.getItem(f(a));return b?JSON.parse(b):null}clearOAuthState(a){J.removeItem(f(a))}}// 5 minutes
class P{constructor(a,b,c,d=new O){this.config=a,this.window=b,this.document=c,this.storageHandler=d,this._listeners={},this.store=Object.freeze({state:x,user:null,token:null,error:null})}_changeState(a,b,c,d){this.store=Object.freeze({state:a,user:b,token:c,error:d}),i(this,s,this.store)}async startup(){this.listen(),this._changeState(x);const a=this._location,b=this._hashParams;if(this.isAuthenticationCallback(a.href,b)){this._changeState('authenticating');try{const{state:c,user:d,token:e,error:f}=await j(this.config,a,b,this.storageHandler);this._changeState(c,d,e,f)}catch(a){console.error('OAuth Error',a),this._changeState('error',void 0,void 0,a)}}else this._changeState('unauthenticated')}get _location(){return this.window.location}get _hashParams(){return b(this._location.hash)}isAuthenticationCallback(a,b){const c=0===a.indexOf(this.config.callbackUrl),d=0!==b.size;return!!(c&&d)&&(b.has('access_token')||b.has('error'))}shutdown(){this.unlisten(),this._changeState(x)}listen(){g(this,t,this.startLogin),g(this,u,this.startLogout),g(this,v,this.startRefresh),g(this,w,this.handleCurrentInfoRequest)}unlisten(){h(this,t),h(this,u),h(this,v),h(this,w)}startLogin(){console.log('starting login',this);const{clientId:a,callbackUrl:b}=this.config,c=q(),d=p(Date.now()+300000,c,{});this.storageHandler.saveOAuthState(this.config.clientId,d);const e=`https://api.byu.edu/authorize?response_type=token&client_id=${a}&redirect_uri=${encodeURIComponent(b)}&scope=openid&state=${c}`;console.warn(`[OAuth] - Redirecting user to '${e}'`),this.window.location=e}startLogout(){const a=this.config.callbackUrl;this.window.location='http://api.byu.edu/logout?redirect_url='+a}startRefresh(){this.startLogin()}handleCurrentInfoRequest({callback:a}){a&&a(this.store)}}const Q='http://byu.edu/claims/resourceowner_',R='http://byu.edu/claims/client_',S='http://wso2.org/claims/';class T extends Error{constructor(a,b,c){super('OAuth Error: '+b),this.type=a,this.description=b,this.uri=c}}const U='https://api.byu.edu',V='byu-oauth-implicit-config';return a.DEFAULT_ISSUER=U,a.GLOBAL_CONFIG_KEY=V,a.configure=async function(a){const b=window[V],c=Object.assign({issuer:U,callbackUrl:`${location.origin}${location.pathname}`,requireAuthentication:!1},b,a);if(!c.clientId)throw new Error('clientId must be specified in config');const d=new P(c,window,document);return d.startup()},a}({});
//# sourceMappingURL=implicit-grant.nomodule.min.js.map
