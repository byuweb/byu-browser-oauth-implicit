this.BYU=this.BYU||{},this.BYU.oauth=this.BYU.oauth||{},this.BYU.oauth.implicit=function(a,b){'use strict';var R=Math.floor;function c(...a){i(S,...a)}function d(...a){i(T,...a)}function e(...a){i(U,...a)}function f(a,...b){h(S,a,...b)}function g(a,...b){h(T,a,...b)}function h(a,b,...c){l(a)&&a.run(`[byu-browser-oauth-implicit] [${a.name}] (${j()}) ${b}`,...c)}function i(a,...b){l(a)&&a.run("[byu-browser-oauth-implicit]",`[${a.name}]`,`(${j()})`,...b)}function j(){const a=new Date,b=(a.getHours()+"").padStart(2,"0"),c=(a.getMinutes()+"").padStart(2,"0"),d=(a.getSeconds()+"").padStart(2,"0"),e=(a.getMilliseconds()+"").padStart(3,"0");return`${b}:${c}:${d},${e}${k(a)}`}function k(a){var b=Math.abs;const c=a.getTimezoneOffset();if(0===c)return"Z";const d=b(c),e=R(d/60),f=(e+"").padStart(2,"0"),g=0<=c?"+":"-",h=(d%60+"").padStart(2,"0");return`${g}${f}${h}`}function l(a){return a.priority>=m().priority}function m(){const a=n()||o();if(!a)return W;const b=a.toLowerCase();return V.find(function(a){return a.name===b})||W}function n(){return document.documentElement.getAttribute("byu-oauth-logging")}function o(){const a=window.byuOAuth||{};return a.logging}function p(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}function q(a,b){return b={exports:{}},a(b,b.exports),b.exports}/*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   */ /**
   * Module exports.
   * @public
   */ /**
   * Try decoding a string using a decoding function.
   *
   * @param {string} str
   * @param {function} decode
   * @private
   */function r(a,b){try{return b(a)}catch(b){return a}}function s(a){return"oauth-state-"+encodeURIComponent(a)}function t(a){return s(a)+"-active-session"}/*
   *  @license
   *    Copyright 2018 Brigham Young University
   *
   *    Licensed under the Apache License, Version 2.0 (the "License");
   *    you may not use this file except in compliance with the License.
   *    You may obtain a copy of the License at
   *
   *        http://www.apache.org/licenses/LICENSE-2.0
   *
   *    Unless required by applicable law or agreed to in writing, software
   *    distributed under the License is distributed on an "AS IS" BASIS,
   *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   *    See the License for the specific language governing permissions and
   *    limitations under the License.
   */function u(a,b){const c=C(b.rawUserInfo),d={ro:c[Ea],cl:c[Fa],wso2:c[Ga],o:c.other};return{ui:d,at:b.bearer,rf:b.refresh,ah:b.authorizationHeader,ea:b.expiresAt.getTime()}}function v(a){const b={[Ea]:a.ui.ro,[Fa]:a.ui.cl,[Ga]:a.ui.wso2,other:a.ui.o},c=D(b),d=F(c),e=new Date(a.ea),f=G({userInfo:c,accessToken:a.at,expiresAt:e,authHeader:`Bearer ${a.at}`,refreshToken:a.rf});return{user:d,token:f}}function w(a,b,c){if(a._listeners.hasOwnProperty(b))throw new Error("A listener is already registered for "+b);const d=a._listeners[b]=function(b){c.call(a,b.detail)}.bind(a);a.document.addEventListener(b,d,!1)}function x(a,b){a._listeners.hasOwnProperty(b)&&(a.document.removeEventListener(b,a._listeners[b],!1),delete a._listeners[b])}function y(a,b,c){let d;"function"==typeof a.window.CustomEvent?d=new CustomEvent(b,{detail:c}):(d=a.document.createEvent("CustomEvent"),d.initCustomEvent(b,!0,!1,c)),a.document.dispatchEvent(d)}async function z(a,b,d){const e=new URLSearchParams(b.search),f=e.get("state"),g=d.getOAuthState(a.clientId);d.clearOAuthState(a.clientId),c("checking oauth state token");const h=H(g,f),i=await A(e.get("code"),a,g.v),j=i.access_token,k=i.refresh_token,l=i.expires_in-Ba,m=new Date(Date.now()+1e3*l),n=`Bearer ${j}`;c("got token",N(j),"which expires in",l,"seconds");const o=await B(n),p=F(o),q=G({userInfo:o,accessToken:j,expiresAt:m,authHeader:n,refreshToken:k});return{state:da,user:p,token:q}}async function A(a,b,d){c("Exchanging code for token");const f=`${za}/token`,g=new URLSearchParams;g.set("grant_type","authorization_code"),g.set("client_id",b.clientId),g.set("redirect_uri",b.callbackUrl),g.set("code",a),g.set("code_verifier",d);const h=await fetch(f,{method:"POST",headers:new Headers({Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}),body:g});if(200!==h.status){const a=await h.text();throw e("Error getting OAuth User Info. Status Code:",h.status,"Response:\n",a),new Ia("unable-to-exchange-code-for-token","Unable to exchange code for token. Please try again.")}const i=await h.json();return c("successfully got user info",i),i}async function B(a){const b=`${za}/openid-userinfo/v1/userinfo?schema=openid`;c("fetching user info from",b);const d=await fetch(b,{method:"GET",headers:new Headers({Accept:"application/json",Authorization:a}),mode:"cors"});if(c("got status",d.status),200!==d.status){const a=await d.text();if(403===d.status)if(c("got forbidden error"),a.includes("<ams:code>900908</ams:code>"))throw c("client app isn't subscribed to OpenID UserInfo endpoint"),e(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`),new Ia("not-subscribed-to-user-info","This page has an authentication configuration error. Developers, see the console for details.");else throw e("invalid oauth bearer token"),new Ia("invalid-oauth-token","The provided authentication token is invalid. Please try again.");throw e("Error getting OAuth User Info. Status Code:",d.status,"Response:\n",a),new Ia("unable-to-get-user-info","Unable to fetch user information. Please try again.")}const f=await d.json();return c("successfully got user info",f),f}function C(a){const b={other:{}};for(const c of Ha)b[c]={};for(const c of Object.keys(a)){const d=a[c],e=Ha.find(function(a){return c.startsWith(a)});e?b[e][c.substr(e.length)]=d:b.other[c]=d}return b}function D(a){const b={};for(const c of Ha){const d=a[c];if(d)for(const a of Object.keys(d))b[c+a]=d[a]}for(const c of Object.keys(a.other))b[c]=a.other[c];return b}function E(a,b){return Object.keys(a).filter(function(a){return a.startsWith(b)}).reduce(function(c,d){return c[d.substr(b.length)]=a[d],c},{})}function F(a){const b=E(a,Ea),c=b.surname_position,d=b.preferred_first_name,e=b.surname,f="F"===c?`${e} ${d}`:`${d} ${e}`;return{personId:b.person_id,byuId:b.byu_id,netId:b.net_id,name:{sortName:b.sort_name,displayName:f,givenName:d,familyName:e,familyNamePosition:c},rawUserInfo:a}}function G({userInfo:a,accessToken:b,expiresAt:c,authHeader:d,refreshToken:e}){const f=E(a,Fa),g=E(a,Ga);return{bearer:b,refresh:e,authorizationHeader:d,expiresAt:c,client:{id:g.client_id,byuId:f.byu_id,appName:g.applicationname},rawUserInfo:a}}function H(a,b){if(c("validating stored state token. Expecting token",b,", got state",a),!a)throw e("no stored oauth login state"),new Ia("no-oauth-state","Your saved authentication information does not match. Please try again.");const{e:d,c:f,s:g}=a;if(b!==f)throw e("CSRF token mismatch"),new Ia("oauth-state-mismatch","Your saved authentication information does not match. Please try again.");if(+d<Date.now())throw e("stored state has expired"),new Ia("oauth-state-expired","Your login attempt has timed out. Please try again.");return g}function I(a,b,c,d){return{e:a,c:b,v:c,s:d}}// Using Uint8Array for getRandomValues
function J(a){const b=new Uint8Array(a||24),c=window.crypto||window.msCrypto;return c.getRandomValues(b),b.reduce(function(a,b){return a+Ja[R(b*Ka)]},"")}function K(a,b,c,f){const g=["state change:",{state:a,user:L(b),token:c,//redactToken(token),
error:f}];f?e(...g):d(...g)}function L(a){return a?{netId:a.netId,"rest-is-redacted":!0}:void 0}function M(a){if(c("redacting token",a),!!a){const{bearer:b,expiresAt:c,client:d}=a;return{bearer:N(b),expiresAt:c?c.toISOString():null,client:d,"rest-is-redacted":!0}}}function N(a){return a?a.substring(0,2)+"...redacted..."+a.substring(a.length-2):void 0}function O(a){if(ya){const a=ya.___startupTrace;throw new Error("There is already an instance of byu-oauth-implicit running!  Please call `#shutdown()` on that instance before starting a new one. Instance was started at:\n"+a)}a.___startupTrace=new Error().stack,ya=a}function P(){ya=null}/*
   * Copyright 2018 Brigham Young University
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *    http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */function Q(a,b){if(!a)return{};if("clientId"in a)return a;const c=Object.keys(a).filter(function(a){return a.startsWith("https://")||a.startsWith("http://")});if(0===c.length)return a;const d=c// order by length of key (most specific), descending
.sort(function(c,a){return a.length-c.length}).find(function(a){return b.href.startsWith(a)});if(d)return Object.assign({callbackUrl:d},a[d]);throw new Error(`Unable to match url [${b.href}] to one of [${c}]`)}b=b&&b.hasOwnProperty("default")?b["default"]:b;const S={priority:1,name:"debug",run:function(...a){console.log(...a)}},T={priority:10,name:"info",run:function(...a){console.info?console.info(...a):console.log(...a)}},U={priority:100,name:"error",run:function(...a){console.error?console.error(...a):console.log(...a)}},V=[{priority:0,name:"trace",run:function(...a){console.trace?console.trace(...a):console.log(...a)}},S,T,U],W=U,X="byu-browser-oauth",Y=`${X}-state-changed`,Z=`${X}-login-requested`,$=`${X}-logout-requested`,_=`${X}-refresh-requested`,aa=`${X}-current-info-requested`,ba="indeterminate",ca="unauthenticated",da="authenticated",ea="refreshing",fa="expired";var ga=decodeURIComponent,ha=encodeURIComponent,ia=/; */,ja=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,ka={parse:/**
   * Parse a cookie header.
   *
   * Parse the given cookie header string into an object
   * The object has the various cookies as keys(names) => values
   *
   * @param {string} str
   * @param {object} [options]
   * @return {object}
   * @public
   */function(a,b){if("string"!=typeof a)throw new TypeError("argument str must be a string");for(var c={},d=b||{},e=a.split(ia),f=d.decode||ga,g=0;g<e.length;g++){var h=e[g],j=h.indexOf("=");// skip things that don't look like key=value
if(!(0>j)){var k=h.substr(0,j).trim(),l=h.substr(++j,h.length).trim();"\""==l[0]&&(l=l.slice(1,-1)),null==c[k]&&(c[k]=r(l,f))}}return c}/**
   * Serialize data into a cookie header.
   *
   * Serialize the a name value pair into a cookie string suitable for
   * http headers. An optional options object specified cookie parameters.
   *
   * serialize('foo', 'bar', { httpOnly: true })
   *   => "foo=bar; httpOnly"
   *
   * @param {string} name
   * @param {string} val
   * @param {object} [options]
   * @return {string}
   * @public
   */,serialize:function(a,b,c){var d=c||{},e=d.encode||ha;if("function"!=typeof e)throw new TypeError("option encode is invalid");if(!ja.test(a))throw new TypeError("argument name is invalid");var f=e(b);if(f&&!ja.test(f))throw new TypeError("argument val is invalid");var g=a+"="+f;if(null!=d.maxAge){var h=d.maxAge-0;if(isNaN(h))throw new Error("maxAge should be a Number");g+="; Max-Age="+R(h)}if(d.domain){if(!ja.test(d.domain))throw new TypeError("option domain is invalid");g+="; Domain="+d.domain}if(d.path){if(!ja.test(d.path))throw new TypeError("option path is invalid");g+="; Path="+d.path}if(d.expires){if("function"!=typeof d.expires.toUTCString)throw new TypeError("option expires is invalid");g+="; Expires="+d.expires.toUTCString()}if(d.httpOnly&&(g+="; HttpOnly"),d.secure&&(g+="; Secure"),d.sameSite){var i="string"==typeof d.sameSite?d.sameSite.toLowerCase():d.sameSite;switch(i){case!0:g+="; SameSite=Strict";break;case"lax":g+="; SameSite=Lax";break;case"strict":g+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid");}}return g}},la=q(function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();b.hasCookies=function(){var a=new g;try{a.setItem("__test","1");var b=a.getItem("__test");return a.removeItem("__test"),"1"===b}catch(a){return!1}};var e=function(a){return a&&a.__esModule?a:{default:a}}(ka),f="lS_",g=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,a),this.cookieOptions=Object.assign({path:"/"},b),f=void 0===b.prefix?f:b.prefix}return d(a,[{key:"getItem",value:function(a){var b=e.default.parse(document.cookie);return b&&b.hasOwnProperty(f+a)?b[f+a]:null}},{key:"setItem",value:function(a,b){return document.cookie=e.default.serialize(f+a,b,this.cookieOptions),b}},{key:"removeItem",value:function(a){var b=Object.assign({},this.cookieOptions,{maxAge:-1});return document.cookie=e.default.serialize(f+a,"",b),null}},{key:"clear",value:function(){var a=e.default.parse(document.cookie);for(var b in a)0===b.indexOf(f)&&this.removeItem(b.substr(f.length));return null}}]),a}();b.default=g});p(la);var ma=la.hasCookies,na=q(function(a,b){function c(a){try{var b=window[a];return b.setItem("__test","1"),b.removeItem("__test"),!0}catch(a){return!1}}Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"localStorage",b=(a+"").replace(/storage$/i,"").toLowerCase();if("local"===b)return c("localStorage");if("session"===b)return c("sessionStorage");if("cookie"===b)return(0,la.hasCookies)();if("memory"===b)return!0;throw new Error("Storage method `"+a+"` is not available.\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.")}});p(na);var oa=q(function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(){c(this,a),this._data={}}return d(a,[{key:"getItem",value:function(a){return this._data.hasOwnProperty(a)?this._data[a]:null}},{key:"setItem",value:function(a,b){return this._data[a]=b+""}},{key:"removeItem",value:function(a){return delete this._data[a]}},{key:"clear",value:function(){return this._data={}}}]),a}();b.default=e});p(oa);var pa=q(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.MemoryStorage=b.CookieStorage=b.isSupported=b.storage=void 0;var d=c(na),e=c(la),f=c(oa),g=null;b.storage=(0,d.default)("localStorage")?g=window.localStorage:(0,d.default)("sessionStorage")?g=window.sessionStorage:(0,d.default)("cookieStorage")?g=new e.default:g=new f.default,b.default=g,b.storage=g,b.isSupported=d.default,b.CookieStorage=e.default,b.MemoryStorage=f.default}),qa=p(pa),ra=pa.MemoryStorage,sa=pa.CookieStorage,ta=pa.isSupported,ua=pa.storage;/*
   *  @license
   *    Copyright 2018 Brigham Young University
   *
   *    Licensed under the Apache License, Version 2.0 (the "License");
   *    you may not use this file except in compliance with the License.
   *    You may obtain a copy of the License at
   *
   *        http://www.apache.org/licenses/LICENSE-2.0
   *
   *    Unless required by applicable law or agreed to in writing, software
   *    distributed under the License is distributed on an "AS IS" BASIS,
   *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   *    See the License for the specific language governing permissions and
   *    limitations under the License.
   */const va=new sa;class wa{saveOAuthState(a,b){va.setItem(s(a),JSON.stringify(b))}getOAuthState(a){const b=va.getItem(s(a));return b?JSON.parse(b):null}clearOAuthState(a){va.removeItem(s(a))}saveSessionState(a,b){qa.setItem(t(a),JSON.stringify(b))}getSessionState(a){const b=t(a),c=qa.getItem(b);return c?JSON.parse(c):null}clearSessionState(a){qa.removeItem(t(a))}}const xa=b.sha256;let ya,za;const Aa="byu-oauth-implicit-grant-refresh-iframe",Ba=305,Ca="implicit-grant-auto-refresh-failed";class Da{constructor(a,b,d,e=new wa){c("initializing provider with config",a),this.config=a,this.window=b,this.document=d,this.storageHandler=e,this._listeners={},za=this.config.baseUrl.replace(/\/+$/,""),this.store=Object.freeze({state:ba,user:null,token:null,error:null}),c("initialized provider")}_changeState(a,b,c,d){K(a,b,c,d),this.store=Object.freeze({state:a,user:b,token:c,error:d}),y(this,Y,this.store)}_checkPopupOpener(){try{const a=this.window.opener.location.origin;if(a===new URL(this.config.callbackUrl).origin)// Origins match
return this.window.opener}catch(a){// Failed to get window.opener.location.origin, so we must have been opened
// from a different origin.
// Fall through to the "return false" outside this try/catch block
}return!1}_checkIframeOpener(){try{const a=this.window.parent.document.getElementById(Aa);if(a&&a.contentWindow===this.window)return a}catch(a){// Failed to access window.parent info, so we must be in an iframe from a different
// origin.
// Fall through to the "return false" outside this try/catch block
}return!1}// Separate state change listener, because state change events
// might come from child iframe/popup window
handleStateChange({state:a,user:b,token:e,source:f}){c("in handleStateChange",a);const g=this._checkPopupOpener();// If this is a popup
if(g)// We're inside a child re-authentication popup
return f?void 0:(c("dispatching event to parent"),y(g,Y,{state:a,token:e,user:b,source:"popup"}),void(a===da&&(d("closing self"),this.window.close())));const h=this._checkIframeOpener();// If we're inside a "refresh" iframe
return h?f?void 0:(c("dispatching event to parent"),y(this.window.parent,Y,{state:a,token:e,user:b,source:"iframe"}),void(a===da&&(d("removing child iframe"),h.parentNode.removeChild(h)))):void(this._maybeUpdateStoredSession(a,b,e),a===da&&this._checkExpired(e.expiresAt.getTime()))}async startup(){O(this),d("starting up"),this.listen(),this._changeState(ba);const a=this._location;if(this.isAuthenticationCallback(a)){c("handling authentication callback"),this._changeState("authenticating");try{const{state:b,user:c,token:d,error:e}=await z(this.config,a,this.storageHandler);this._changeState(b,c,d,e)}catch(a){e("OAuth Error",a),this._changeState("error",void 0,void 0,a)}}else this.hasStoredSession()?(c("Has stored session"),this._updateStateFromStorage()):(c("no authentication present"),this._changeState(ca));return this}_checkExpired(a){var b=this;const d=a-Date.now();return c(`checking expiration time; expires in ${d} ms, ${new Date(a)}`),30000<d?(this.__expirationTask&&clearTimeout(this.__expirationTask),void(this.__expirationTask=setTimeout(function(){b.__expirationTask=null,b._checkExpired(a)},5e3))):void(this.config.autoRefreshOnTimeout?this.startRefresh("iframe"):this._changeState(fa,this.store.user,this.store.token))}get _location(){return this.window.location}isAuthenticationCallback(a){const b=0===a.href.indexOf(this.config.callbackUrl),c=a.search&&a.search.includes("code=")&&a.search.includes("state=");return!!(b&&c)}hasStoredSession(){return!!this.storageHandler.getSessionState(this.config.clientId)}shutdown(){d("shutting down"),this.unlisten(),this._changeState(ba),P()}listen(){c("setting up event listeners"),w(this,Z,this.startLogin),w(this,$,this.startLogout),w(this,_,this.startRefresh),w(this,aa,this.handleCurrentInfoRequest),w(this,Y,this.handleStateChange)}unlisten(){c("tearing down event listeners"),x(this,Z),x(this,$),x(this,_),x(this,aa),x(this,Y)}startLogin(a="window"){var b=String.fromCharCode,e=this;g("Starting login. mode=%s",a);const{clientId:f,callbackUrl:h}=this.config,i=J(),j=J(128),k=btoa(b(...xa.array(j))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),l=I(Date.now()+300000,i,j,{});this.storageHandler.saveOAuthState(this.config.clientId,l);const m=`${za}/authorize?response_type=code&client_id=${f}&redirect_uri=${encodeURIComponent(h)}&scope=openid&state=${i}&code_challenge=${k}&code_challenge_method=S256`;if(c("computed login url of",m),!a||"window"==a)return d(`Redirecting user to '${m}'`),void(this.window.location=m);if("popup"===a)return d("launching popup at",m),void this.window.open(m);d("Setting up hidden refresh iframe at",m);// last option: displayType == 'iframe'
let n=this.document.getElementById(Aa);n&&n.parentNode.removeChild(n),n=this.document.createElement("iframe"),n.onload=function(){let a=null;try{a=n.contentWindow.document.body.innerHTML}catch(a){// intentional do-nothing
}null===a&&(n.parentNode.removeChild(n),e._changeState(Ca,null,null),e._changeState(ca,null,null))},n.id=Aa,n.src=m,n.style="display:none",c("appending iframe",n),this.document.body.appendChild(n)}startLogout(){d("starting logout"),this.storageHandler.clearSessionState(this.config.clientId);// Need to ensure BOTH api.byu.edu and cas.byu.edu clean out their sessions
// With current config of those two sites, to have that full clean out AND a final "where to go after logout"
// redirect, we need to manually wrap them all together
const a=void 0===this.config.logoutRedirect?this.config.callbackUrl:this.config.logoutRedirect,b="https://cas.byu.edu/cas/logout?service="+encodeURIComponent(a),c=`${za}/logout?redirect_url=`+encodeURIComponent(b);d("logging out by redirecting to",c),this.window.location=c}async startRefresh(a="iframe"){g("starting refresh. displayType=%s",a);// Save copy of current info before triggering changeState
const b=Object.assign({},this.store.token),c=Object.assign({},this.store.user);if(this._changeState(ea,Object.assign({},this.store.user),Object.assign({},this.store.token)),"iframe"!==a)return void this.startLogin(a);// If we have a refresh token, then try that before doing the more complicated iframe version
if(!(b&&b.refresh))return void this.startLogin("iframe");const d=`${za}/token`,e=new URLSearchParams;e.set("grant_type","refresh_token"),e.set("client_id",this.config.clientId),e.set("refresh_token",b.refresh);const f=await fetch(d,{method:"POST",headers:new Headers({Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}),body:e});if(200!==f.status)return void this.startLogin("iframe");const h=await f.json();b.bearer=h.access_token,b.refresh=h.refresh_token;const i=h.expires_in-Ba;b.authorizationHeader=`Bearer ${b.bearer}`,b.expiresAt=new Date(Date.now()+1e3*i),this._changeState(da,c,b)}handleCurrentInfoRequest({callback:a}){c("got current info request"),a&&a(this.store)}_updateStateFromStorage(){c("updating state from local storage");const a=this.storageHandler.getSessionState(this.config.clientId);if(!a)return c("no stored state"),void this._changeState(ca);const{user:b,token:d}=v(a);b&&d?d.expiresAt>new Date?(c("found an unexpired saved session"),this._changeState(da,b,d)):(c("stored session was expired"),this._changeState(ca)):(c("no stored user or token"),this._changeState(ca))}_maybeUpdateStoredSession(a,b,d){if(f("updating stored session: state=%s hasUser=%s, hasToken=%s",a,!!b,!!d),a===ca||a===ea||a===fa)c("state is unauthenticated or expired, clearing stored session"),this.storageHandler.clearSessionState(this.config.clientId);else if(!!b&&!!d){c("storing session",L(b),M(d));const a=u(b,d);this.storageHandler.saveSessionState(this.config.clientId,a)}}}const Ea="http://byu.edu/claims/resourceowner_",Fa="http://byu.edu/claims/client_",Ga="http://wso2.org/claims/",Ha=[Fa,"http://byu.edu/claims/resourceowner_",Ga];class Ia extends Error{constructor(a,b,c){super("OAuth Error: "+b),this.type=a,this.description=b,this.uri=c}}const Ja=[..."0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"],Ka=Ja.length/256,La="https://api.byu.edu",Ma="https://api.byu.edu",Na="byu-oauth-implicit-config";return a.DEFAULT_BASE_URL=Ma,a.DEFAULT_ISSUER=La,a.GLOBAL_CONFIG_KEY=Na,a.IG_STATE_AUTO_REFRESH_FAILED=Ca,a.configure=/**
   * @typedef {} ImplicitConfig
   * @prop {string} clientId
   * @prop {?string} issuer
   * @prop {?string} baseUrl
   * @prop {?string} callbackUrl
   * @prop {?boolean} requireAuthentication
   */ /**
   * @param {ImplicitConfig|ImplicitConfig[]|undefined} cfgOrRules
   * @param location
   */async function(a,b=window.location){const c=Q(a,b),d=window[Na],e=Object.assign({issuer:La,baseUrl:Ma,callbackUrl:`${b.origin}${b.pathname}`,autoRefreshOnTimeout:!1},d,c);if(!e.clientId)throw new Error("clientId must be specified in config");const f=new Da(e,window,document);return f.startup()},a}({},sha256Lib);
//# sourceMappingURL=implicit-grant.nomodule.min.js.map
