this.BYU=this.BYU||{},this.BYU.oauth=this.BYU.oauth||{},this.BYU.oauth.implicit=function(a){'use strict';/*
   *  @license
   *    Copyright 2018 Brigham Young University
   *
   *    Licensed under the Apache License, Version 2.0 (the "License");
   *    you may not use this file except in compliance with the License.
   *    You may obtain a copy of the License at
   *
   *        http://www.apache.org/licenses/LICENSE-2.0
   *
   *    Unless required by applicable law or agreed to in writing, software
   *    distributed under the License is distributed on an "AS IS" BASIS,
   *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   *    See the License for the specific language governing permissions and
   *    limitations under the License.
   */function b(a){if(!a)return new Map;let b=a;a.startsWith("#")&&(b=a.substr(1));const c=b.split("&").map(function(a){return a.split("=",2)});return new Map(c)}function c(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}function d(a,b){return b={exports:{}},a(b,b.exports),b.exports}/*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   */ /**
   * Module exports.
   * @public
   */ /**
   * Try decoding a string using a decoding function.
   *
   * @param {string} str
   * @param {function} decode
   * @private
   */function e(a,b){try{return b(a)}catch(b){return a}}function f(a){return"oauth-state-"+encodeURIComponent(a)}function g(a){return f(a)+"-active-session"}/*
   *  @license
   *    Copyright 2018 Brigham Young University
   *
   *    Licensed under the Apache License, Version 2.0 (the "License");
   *    you may not use this file except in compliance with the License.
   *    You may obtain a copy of the License at
   *
   *        http://www.apache.org/licenses/LICENSE-2.0
   *
   *    Unless required by applicable law or agreed to in writing, software
   *    distributed under the License is distributed on an "AS IS" BASIS,
   *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   *    See the License for the specific language governing permissions and
   *    limitations under the License.
   */function h(a,b){const c=o(b.rawUserInfo),d={ro:c[W],cl:c[X],wso2:c[Y],o:c.other};return{ui:d,at:b.bearer,ah:b.authorizationHeader,ea:b.expiresAt.getTime()}}function i(a){const b={[W]:a.ui.ro,[X]:a.ui.cl,[Y]:a.ui.wso2,other:a.ui.o},c=p(b),d=r(c),e=new Date(a.ea),f=s(c,a.at,e,a.at);return{user:d,token:f}}function j(a,b,c){if(a._listeners.hasOwnProperty(b))throw new Error("A listener is already registered for "+b);const d=a._listeners[b]=function(b){c.call(a,b.detail)}.bind(a);a.document.addEventListener(b,d,!1)}function k(a,b){a._listeners.hasOwnProperty(b)&&(a.document.removeEventListener(b,a._listeners[b],!1),delete a._listeners[b])}function l(a,b,c){let d;"function"==typeof a.window.CustomEvent?d=new CustomEvent(b,{detail:c}):(d=a.document.createEvent("CustomEvent"),d.initCustomEvent(b,!0,!1,c)),a.document.dispatchEvent(d)}async function m(a,b,c,d){if(c.has("error"))throw new $(c.get("error"),c.get("error_description"),c.get("error_uri"));const e=c.get("state"),f=d.getOAuthState(a.clientId);d.clearOAuthState(a.clientId);const g=t(f,e),h=c.get("access_token"),i=+c.get("expires_in"),j=new Date(Date.now()+1e3*i),k=`Bearer ${h}`,l=await n(k),m=r(l),o=s(l,h,j,k);return b.hash="",{state:D,user:m,token:o}}async function n(a){const b=await fetch("https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid",{method:"GET",headers:new Headers({Accept:"application/json",Authorization:a}),mode:"cors"});if(200!==b.status){const a=await b.text();if(403===b.status)if(a.includes("<ams:code>900908</ams:code>"))throw console.error(`DEVELOPER ERROR: You may not be subscribed to the OpenID UserInfo endpoint. Please visit https://api.byu.edu/store/apis/info?name=OpenID-Userinfo&version=v1&provider=BYU%2Fjmooreoa to subscribe.`),new $("not-subscribe-to-user-info","This page has an authentication configuration error. Developers, see the console for details.");else throw new $("invalid-oauth-token","The provided authentication token is invalid. Please try again.");throw console.error("Error getting OAuth User Info. Status Code:",b.status,"Response:\n",a),new $("unable-to-get-user-info","Unable to fetch user information. Please try again.")}return await b.json()}function o(a){const b={other:{}};for(const c of Z)b[c]={};for(const c of Object.keys(a)){const d=a[c],e=Z.find(function(a){return c.startsWith(a)});e?b[e][c.substr(e.length)]=d:b.other[c]=d}return b}function p(a){const b={};for(const c of Z){const d=a[c];if(d)for(const a of Object.keys(d))b[c+a]=d[a]}for(const c of Object.keys(a.other))b[c]=a.other[c];return b}function q(a,b){return Object.keys(a).filter(function(a){return a.startsWith(b)}).reduce(function(c,d){return c[d.substr(b.length)]=a[d],c},{})}function r(a){const b=q(a,W),c=b.surname_position,d=a.given_name,e=a.family_name,f="F"===c?`${e} ${d}`:`${d} ${e}`;return{personId:b.person_id,byuId:b.byu_id,netId:b.net_id,name:{sortName:b.sort_name,displayName:f,givenName:d,familyName:e,familyNamePosition:c},rawUserInfo:a}}function s(a,b,c,d){const e=q(a,X),f=q(a,Y);return{bearer:b,authorizationHeader:d,expiresAt:c,client:{id:f.client_id,byuId:e.byu_id,appName:f.applicationname},rawUserInfo:a}}function t(a,b){const{e:c,c:d,s:e}=a;if(b!==d)throw new $("oauth-state-mismatch","Your saved authentication information does not match. Please try again.");if(+c<Date.now())throw new $("oauth-state-expired","Your login attempt has timed out. Please try again.");return e}function u(a,b,c){return{e:a,c:b,s:c}}function v(){let a=new Uint32Array(3);const b=window.crypto||window.msCrypto;return b.getRandomValues(a),a.reduce(function(a,b){return a+b.toString(16)},"")}/*
   * Copyright 2018 Brigham Young University
   * 
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   * 
   *    http://www.apache.org/licenses/LICENSE-2.0
   * 
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */const w=`${"byu-browser-oauth"}-state-changed`,x=`${"byu-browser-oauth"}-login-requested`,y=`${"byu-browser-oauth"}-logout-requested`,z=`${"byu-browser-oauth"}-refresh-requested`,A=`${"byu-browser-oauth"}-current-info-requested`,B="indeterminate",C="unauthenticated",D="authenticated";var E=decodeURIComponent,F=encodeURIComponent,G=/; */,H=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,I={parse:/**
   * Parse a cookie header.
   *
   * Parse the given cookie header string into an object
   * The object has the various cookies as keys(names) => values
   *
   * @param {string} str
   * @param {object} [options]
   * @return {object}
   * @public
   */function(a,b){if("string"!=typeof a)throw new TypeError("argument str must be a string");for(var c={},d=b||{},f=a.split(G),g=d.decode||E,h=0;h<f.length;h++){var j=f[h],k=j.indexOf("=");// skip things that don't look like key=value
if(!(0>k)){var l=j.substr(0,k).trim(),m=j.substr(++k,j.length).trim();"\""==m[0]&&(m=m.slice(1,-1)),null==c[l]&&(c[l]=e(m,g))}}return c}/**
   * Serialize data into a cookie header.
   *
   * Serialize the a name value pair into a cookie string suitable for
   * http headers. An optional options object specified cookie parameters.
   *
   * serialize('foo', 'bar', { httpOnly: true })
   *   => "foo=bar; httpOnly"
   *
   * @param {string} name
   * @param {string} val
   * @param {object} [options]
   * @return {string}
   * @public
   */,serialize:function(a,b,c){var d=Math.floor,e=c||{},f=e.encode||F;if("function"!=typeof f)throw new TypeError("option encode is invalid");if(!H.test(a))throw new TypeError("argument name is invalid");var g=f(b);if(g&&!H.test(g))throw new TypeError("argument val is invalid");var h=a+"="+g;if(null!=e.maxAge){var i=e.maxAge-0;if(isNaN(i))throw new Error("maxAge should be a Number");h+="; Max-Age="+d(i)}if(e.domain){if(!H.test(e.domain))throw new TypeError("option domain is invalid");h+="; Domain="+e.domain}if(e.path){if(!H.test(e.path))throw new TypeError("option path is invalid");h+="; Path="+e.path}if(e.expires){if("function"!=typeof e.expires.toUTCString)throw new TypeError("option expires is invalid");h+="; Expires="+e.expires.toUTCString()}if(e.httpOnly&&(h+="; HttpOnly"),e.secure&&(h+="; Secure"),e.sameSite){var j="string"==typeof e.sameSite?e.sameSite.toLowerCase():e.sameSite;switch(j){case!0:h+="; SameSite=Strict";break;case"lax":h+="; SameSite=Lax";break;case"strict":h+="; SameSite=Strict";break;default:throw new TypeError("option sameSite is invalid");}}return h}},J=d(function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();b.hasCookies=function(){var a=new g;try{a.setItem("__test","1");var b=a.getItem("__test");return a.removeItem("__test"),"1"===b}catch(a){return!1}};var e=function(a){return a&&a.__esModule?a:{default:a}}(I),f="lS_",g=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,a),this.cookieOptions=Object.assign({path:"/"},b),f=void 0===b.prefix?f:b.prefix}return d(a,[{key:"getItem",value:function(a){var b=e.default.parse(document.cookie);return b&&b.hasOwnProperty(f+a)?b[f+a]:null}},{key:"setItem",value:function(a,b){return document.cookie=e.default.serialize(f+a,b,this.cookieOptions),b}},{key:"removeItem",value:function(a){var b=Object.assign({},this.cookieOptions,{maxAge:-1});return document.cookie=e.default.serialize(f+a,"",b),null}},{key:"clear",value:function(){var a=e.default.parse(document.cookie);for(var b in a)0===b.indexOf(f)&&this.removeItem(b.substr(f.length));return null}}]),a}();b.default=g});c(J);var K=J.hasCookies,L=d(function(a,b){function c(a){try{var b=window[a];return b.setItem("__test","1"),b.removeItem("__test"),!0}catch(a){return!1}}Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"localStorage",b=(a+"").replace(/storage$/i,"").toLowerCase();if("local"===b)return c("localStorage");if("session"===b)return c("sessionStorage");if("cookie"===b)return(0,J.hasCookies)();if("memory"===b)return!0;throw new Error("Storage method `"+a+"` is not available.\n    Please use one of the following: localStorage, sessionStorage, cookieStorage, memoryStorage.")}});c(L);var M=d(function(a,b){function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(){c(this,a),this._data={}}return d(a,[{key:"getItem",value:function(a){return this._data.hasOwnProperty(a)?this._data[a]:null}},{key:"setItem",value:function(a,b){return this._data[a]=b+""}},{key:"removeItem",value:function(a){return delete this._data[a]}},{key:"clear",value:function(){return this._data={}}}]),a}();b.default=e});c(M);var N=d(function(a,b){function c(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0}),b.MemoryStorage=b.CookieStorage=b.isSupported=b.storage=void 0;var d=c(L),e=c(J),f=c(M),g=null;b.storage=(0,d.default)("localStorage")?g=window.localStorage:(0,d.default)("sessionStorage")?g=window.sessionStorage:(0,d.default)("cookieStorage")?g=new e.default:g=new f.default,b.default=g,b.storage=g,b.isSupported=d.default,b.CookieStorage=e.default,b.MemoryStorage=f.default}),O=c(N),P=N.MemoryStorage,Q=N.CookieStorage,R=N.isSupported,S=N.storage;/*
   *  @license
   *    Copyright 2018 Brigham Young University
   *
   *    Licensed under the Apache License, Version 2.0 (the "License");
   *    you may not use this file except in compliance with the License.
   *    You may obtain a copy of the License at
   *
   *        http://www.apache.org/licenses/LICENSE-2.0
   *
   *    Unless required by applicable law or agreed to in writing, software
   *    distributed under the License is distributed on an "AS IS" BASIS,
   *    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   *    See the License for the specific language governing permissions and
   *    limitations under the License.
   */class T{saveOAuthState(a,b){O.setItem(f(a),JSON.stringify(b))}getOAuthState(a){const b=O.getItem(f(a));return b?JSON.parse(b):null}clearOAuthState(a){O.removeItem(f(a))}saveSessionState(a,b){O.setItem(g(a),JSON.stringify(b))}getSessionState(a){const b=g(a),c=O.getItem(b);return c?JSON.parse(c):null}clearSessionState(a){O.removeItem(g(a))}}const U="byu-oauth-implicit-grant-refresh-iframe";class V{constructor(a,b,c,d=new T){this.config=a,this.window=b,this.document=c,this.storageHandler=d,this._listeners={},this.store=Object.freeze({state:B,user:null,token:null,error:null})}_changeState(a,b,c,d){this.store=Object.freeze({state:a,user:b,token:c,error:d}),l(this,w,this.store)}// Separate state change listener, because state change events
// might come from child iframe/popup window
handleStateChange({state:a,user:b,token:c}){// If this is a popup
if(this.window.opener)return this.window.opener.document.dispatchEvent(new CustomEvent(w,{detail:{state:a,token:c,user:b}})),void(a===D&&this.window.close());// If we're inside the "refresh" iframe,
// then delete now that authentication
// is complete
const d=parent.document.getElementById(U);return d?void(a===D&&d.parentNode.removeChild(d)):void(this._maybeUpdateStoredSession(a,b,c),a===D&&this._checkRefresh(c.expiresAt.getTime()))}async startup(){this.listen(),this._changeState(B);const a=this._location,b=this._hashParams;if(this.isAuthenticationCallback(a.href,b)){this._changeState("authenticating");try{const{state:c,user:d,token:e,error:f}=await m(this.config,a,b,this.storageHandler);this._changeState(c,d,e,f)}catch(a){console.error("OAuth Error",a),this._changeState("error",void 0,void 0,a)}}this.hasStoredSession()?this._updateStateFromStorage():this._changeState(C)}_checkRefresh(a){var b=this;// Simply using setTimeout for an hour in the future
// doesn't work; setTimeout isn't that precise over that long of a period.
// So re-check every five seconds until we're past the expiration time
const c=a-Date.now();if(0>c||33e5<c){// If we've expired OR if the WSO2 five-minute grace period was not added, then trigger a refresh.
// Wait an extra 5 seconds to avoid WSO2 clock skew problems
// Existing token *should* have a five-minute grace period after expiration:
// a new request will generate a new token, but the old token should still
// work during that grace period
let a=function(){return b.startRefresh("iframe")};return this.config.doNotAutoRefreshOnTimeout&&(a=function(){return b._changeState("implicit-grant-refresh-required")}),setTimeout(a,5e3)}setTimeout(function(){return b._checkRefresh(a)},5e3)}get _location(){return this.window.location}get _hashParams(){return b(this._location.hash)}isAuthenticationCallback(a,b){const c=0===a.indexOf(this.config.callbackUrl),d=0!==b.size;return!!(c&&d)&&(b.has("access_token")||b.has("error"))}hasStoredSession(){return!!this.storageHandler.getSessionState(this.config.clientId)}shutdown(){this.unlisten(),this._changeState(B)}listen(){j(this,x,this.startLogin),j(this,y,this.startLogout),j(this,z,this.startRefresh),j(this,A,this.handleCurrentInfoRequest),j(this,w,this.handleStateChange)}unlisten(){k(this,x),k(this,y),k(this,z),k(this,A),k(this,w)}startLogin(a="window"){var b=this;console.log("starting login",this);const{clientId:c,callbackUrl:d}=this.config,e=v(),f=u(Date.now()+300000,e,{});this.storageHandler.saveOAuthState(this.config.clientId,f);const g=`https://api.byu.edu/authorize?response_type=token&client_id=${c}&redirect_uri=${encodeURIComponent(d)}&scope=openid&state=${e}`;if(!a||"window"==a)return console.warn(`[OAuth] - Redirecting user to '${g}'`),void(this.window.location=g);// last option: displayType == 'iframe'
if("popup"===a)return void this.window.open(g);let h=document.getElementById(U);h&&h.parentNode.removeChild(h),h=document.createElement("iframe"),h.onload=function(){let a=null;try{a=h.contentWindow.document.body.innerHTML}catch(a){// intentional do-nothing
}null===a&&(h.parentNode.removeChild(h),b._changeState("implicit-grant-auto-refresh-failed",null,null))},h.id=U,h.src=g,h.style="display:none",document.body.appendChild(h)}startLogout(){this.storageHandler.clearSessionState(this.config.clientId);const a=this.config.callbackUrl;this.window.location="http://api.byu.edu/logout?redirect_url="+a}startRefresh(a="window"){this.startLogin(a)}handleCurrentInfoRequest({callback:a}){a&&a(this.store)}_updateStateFromStorage(){const a=this.storageHandler.getSessionState(this.config.clientId);if(!a)return void this._changeState(C);const{user:b,token:c}=i(a);b&&c?c.expiresAt>new Date?this._changeState(D,b,c):this._changeState(C):this._changeState(C)}_maybeUpdateStoredSession(a,b,c){if(a===C)this.storageHandler.clearSessionState(this.config.clientId);else if(!!b&&!!c){const a=h(b,c);this.storageHandler.saveSessionState(this.config.clientId,a)}}}const W="http://byu.edu/claims/resourceowner_",X="http://byu.edu/claims/client_",Y="http://wso2.org/claims/",Z=[X,"http://byu.edu/claims/resourceowner_",Y];class $ extends Error{constructor(a,b,c){super("OAuth Error: "+b),this.type=a,this.description=b,this.uri=c}}const _="byu-oauth-implicit-config";return a.DEFAULT_ISSUER="https://api.byu.edu",a.GLOBAL_CONFIG_KEY=_,a.configure=/**
   * @typedef {} ImplicitConfig
   * @prop {string} clientId
   * @prop {?string} issuer
   * @prop {?string} callbackUrl
   * @prop {?boolean} requireAuthentication
   */ /**
   *
   * @param {ImplicitConfig} cfg
   */async function(a){const b=window[_],c=Object.assign({issuer:"https://api.byu.edu",callbackUrl:`${location.origin}${location.pathname}`,doNotAutoRefreshOnTimeout:!1,displayType:"window"},b,a);if(!c.clientId)throw new Error("clientId must be specified in config");const d=new V(c,window,document);return d.startup()},a}({});
//# sourceMappingURL=implicit-grant.nomodule.min.js.map
