this.BYU=this.BYU||{},this.BYU.oauth=this.BYU.oauth||{},this.BYU.oauth.implicit=function(e){"use strict";var t="byu-browser-oauth",n=t+"-state-changed",o=t+"-login-requested",r=t+"-logout-requested",i=t+"-refresh-requested",a=t+"-state-requested",s="indeterminate",c="unauthenticated",u="authenticated",l="authenticating",d="error",h={state:s};!function(e){var t=function(t){e(t.detail)};document.addEventListener(n,t,!1),h.state===s?function(e,t){var n;"function"==typeof window.CustomEvent?n=new CustomEvent(e,{detail:t}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!1,t);document.dispatchEvent(n)}(a,{callback:e}):e(h)}(function(e){h=e});var f,m="https://api.byu.edu",w={},g=Object.freeze({state:s});var p="http://byu.edu/claims/resourceowner_",v="http://byu.edu/claims/client_",b="http://wso2.org/claims/";function _(e,t){return Object.keys(e).filter(function(e){return e.startsWith(t)}).reduce(function(n,o){return n[o.substr(t.length)]=e[o],n},{})}function y(e,t,o,r){g=Object.freeze({state:e,token:t,user:o,error:r}),function(e,t){var n;"function"==typeof window.CustomEvent?n=new CustomEvent(e,{detail:t}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!1,t);document.dispatchEvent(n)}(n,g)}function E(){console.log("startLogin",f);var e,t,n,o,r=(o=Uint32Array.of(1),(window.crypto||window.msCrypto).getRandomValues(o),e=new String(o[0]),t={},n=e+"."+btoa(JSON.stringify(t)),function(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}("session")?(window.sessionStorage.setItem("oauth-state",n),"s."+e):(document.cookie="oauth-state="+n+";max-age=300","c."+e)),i="https://api.byu.edu/authorize?response_type=token&client_id="+f.clientId+"&redirect_uri="+encodeURIComponent(f.callbackUrl)+"&scope=openid&state="+r;console.log("loginUrl",i),window.location=i}function U(){console.log("startLogout")}function k(){E()}function I(e){(0,e.callback)(g)}function O(e,t){if(w.hasOwnProperty(e))throw new Error("A listener is already registered for "+e);var n=w[e]=function(e){t(e.detail)};document.addEventListener(e,n,!1)}return e.DEFAULT_ISSUER=m,e.configure=function(e){if(console.log("config",e),!e)throw new Error("cfg must be defined");if(!e.clientId)throw new Error("clientId must be specified");f=Object.assign({issuer:m,callbackUrl:""+location.origin+location.pathname,requireAuthentication:!1},e),O(o,E),O(r,U),O(i,k),O(a,I),function(){if(!function(){var e=0===window.location.href.indexOf(f.callbackUrl);console.log(window.location.href,f.callbackUrl,window.location.href.indexOf(f.callbackUrl));var t=!!window.location.hash;if(console.log("hasHash",t),!e)return!1;if(!t)return!1;var n=new URLSearchParams(window.location.hash.substring(1));return console.log("params",n),!(!n.has("access_token")&&!n.has("error"))&&(console.log("has params"),!0)}())return console.log("Not an auth callback"),void y(c);y(l);var e=new URLSearchParams(window.location.hash.substring(1));if(e.has("error")){var t={type:e.get("error"),description:e.get("error_description"),uri:e.get("error_uri")};y(d,null,null,t)}else{e.get("state"),window.location.hash="";var n=e.get("access_token"),o=Number(e.get("expires_in")),r="Bearer "+n,i=new Date(Date.now()+1e3*o);fetch("https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid",{method:"GET",headers:new Headers({Accept:"application/json",authorization:r}),mode:"cors"}).then(function(e){return e.json()}).then(function(e){console.log("got user info",e);var t=_(e,p),o=_(e,v),a=_(e,b);console.log("claims",t,o,a);var s=t.surname_position,c=e.given_name,l=e.family_name,d="F"===s?l+" "+c:c+" "+l,h={personId:t.person_id,byuId:t.byu_id,netId:t.net_id,name:{sortName:t.sort_name,displayName:d,givenName:c,familyName:l,familyNamePosition:s},rawUserInfo:e},f={bearer:n,authorizationHeader:r,expiresAt:i,client:{id:a.client_id,byuId:o.byu_id,appName:a.applicationname},rawUserInfo:e};y(u,f,h)})}}()},e.startLogin=E,e.startLogout=U,e.startRefresh=k,e.handleStateRequested=I,e}({});
//# sourceMappingURL=implicit-grant.nomodule.min.js.map
