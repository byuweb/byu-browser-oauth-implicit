this.BYU=this.BYU||{},this.BYU.oauth=this.BYU.oauth||{},this.BYU.oauth.implicit=function(e){"use strict";var t,n="byu-browser-oauth",o=n+"-state-changed",r=n+"-login-requested",i=n+"-logout-requested",a=n+"-refresh-requested",s=n+"-current-info-requested",c="unauthenticated",u="authenticated",l="authenticating",d="error",h="https://api.byu.edu",f={},m=Object.freeze({state:"indeterminate"});var g="http://byu.edu/claims/resourceowner_",p="http://byu.edu/claims/client_",w="http://wso2.org/claims/";function v(e,t){return Object.keys(e).filter(function(e){return e.startsWith(t)}).reduce(function(n,o){return n[o.substr(t.length)]=e[o],n},{})}function b(e,t,n,r){m=Object.freeze({state:e,token:t,user:n,error:r}),function(e,t){var n;"function"==typeof window.CustomEvent?n=new CustomEvent(e,{detail:t}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!1,t);document.dispatchEvent(n)}(o,m)}function _(){console.log("startLogin",t);var e,n=function(e,n){var o,r=E(t.clientId),i=e+"."+btoa(JSON.stringify(n));!function(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}("sessionStorage")?(document.cookie=r+"="+i+";max-age=300",o=I):(window.sessionStorage.setItem(r,i),o=U);return o+"."+e}((e=new Uint32Array(3),(window.crypto||window.msCrypto).getRandomValues(e),e.reduce(function(e,t){return e+t.toString(16)},"")),{});console.log("csrf",n);var o="https://api.byu.edu/authorize?response_type=token&client_id="+t.clientId+"&redirect_uri="+encodeURIComponent(t.callbackUrl)+"&scope=openid&state="+n;console.log("loginUrl",o),window.location=o}function y(){console.log("startLogout"),window.location="http://api.byu.edu/logout?redirect_url="+t.callbackUrl}function E(e){return"oauth-state-"+encodeURIComponent(e)}var U="s",I="c";function k(){_()}function O(e){(0,e.callback)(m)}function R(e,t){if(console.log("listening to",e),f.hasOwnProperty(e))throw new Error("A listener is already registered for "+e);var n=f[e]=function(e){t(e.detail)};document.addEventListener(e,n,!1)}return e.DEFAULT_ISSUER=h,e.configure=function(e){if(console.log("config",e),!e)throw new Error("cfg must be defined");if(!e.clientId)throw new Error("clientId must be specified");t=Object.assign({issuer:h,callbackUrl:""+location.origin+location.pathname,requireAuthentication:!1},e),R(r,_),R(i,y),R(a,k),R(s,O),function(){if(!function(){var e=0===window.location.href.indexOf(t.callbackUrl);console.log(window.location.href,t.callbackUrl,window.location.href.indexOf(t.callbackUrl));var n=!!window.location.hash;if(console.log("hasHash",n),!e)return!1;if(!n)return!1;var o=new URLSearchParams(window.location.hash.substring(1));return console.log("params",o),!(!o.has("access_token")&&!o.has("error"))&&(console.log("has params"),!0)}())return console.log("Not an auth callback"),void b(c);b(l);var e=new URLSearchParams(window.location.hash.substring(1));if(e.has("error")){var n={type:e.get("error"),description:e.get("error_description"),uri:e.get("error_uri")};b(d,null,null,n)}else{var o=e.get("state");window.location.hash="";try{!function(e){var n=e.split("."),o=n[0],r=n[1],i=function(e){var n=E(t.clientId);switch(e){case U:return[window.sessionStorage.getItem(n)];case I:var o=[];return(document.cookie||"").split(";").map(function(e){return e.trim()}).forEach(function(e){0===e.indexOf(n+"=")&&o.push(e.split("=",2)[1])}),o}}(o);if(0===i.length)throw console.error("No OAuth state has been stored, or it has expired"),new Error("Your authentication session has expired or something has gone wrong.");var a=i.map(function(e){return e.split(".")}).find(function(e){var t=e[0];return e[1],t===r});if(!a)throw console.error("Authentication state mismatch - no saved values match CSRF token"),new Error("Your saved authentication information does not match. Please try again.");var s=a[1];JSON.parse(atob(s))}(o)}catch(e){return void b(d,null,null,{type:"oauth-state-mismatch",description:e.message||e})}!function(e){var n=E(t.clientId);switch(e){case U:window.sessionStorage.removeItem(n);break;case I:document.cookie=n+"=null;expires=Thu, 01 Jan 1970 00:00:00 GMT"}}("s");var r=e.get("access_token"),i=Number(e.get("expires_in")),a="Bearer "+r,s=new Date(Date.now()+1e3*i);fetch("https://api.byu.edu/openid-userinfo/v1/userinfo?schema=openid",{method:"GET",headers:new Headers({Accept:"application/json",authorization:a}),mode:"cors"}).then(function(e){return e.json()}).then(function(e){console.log("got user info",e);var t=v(e,g),n=v(e,p),o=v(e,w);console.log("claims",t,n,o);var i=t.surname_position,c=e.given_name,l=e.family_name,d="F"===i?l+" "+c:c+" "+l,h={personId:t.person_id,byuId:t.byu_id,netId:t.net_id,name:{sortName:t.sort_name,displayName:d,givenName:c,familyName:l,familyNamePosition:i},rawUserInfo:e},f={bearer:r,authorizationHeader:a,expiresAt:s,client:{id:o.client_id,byuId:n.byu_id,appName:o.applicationname},rawUserInfo:e};b(u,f,h)})}}()},e.startLogin=_,e.startLogout=y,e.startRefresh=k,e.handleCurrentInfoRequest=O,e}({});
//# sourceMappingURL=implicit-grant.nomodule.min.js.map
